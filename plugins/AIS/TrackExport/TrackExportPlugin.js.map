{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Calendar.js","webpack:///./src/Models/TracksModel.js","webpack:///./src/PluginPanel.js","webpack:///./src/Request.js","webpack:///./src/SearchControl.css?7ab7","webpack:///./src/SearchControl.js","webpack:///./src/SelectControl.css?21a2","webpack:///./src/SelectControl.js","webpack:///./src/Views/BaseView.js","webpack:///./src/Views/TracksView.css?715a","webpack:///./src/Views/TracksView.js","webpack:///./src/ViewsFactory.js","webpack:///./src/all.css","webpack:///./src/entry.js","webpack:///./src/locale.js"],"names":["SIMPLE_MODE","ADVANCED_MODE","_toMidnight","nsGmx","DateInterval","toMidnight","_fromUTC","date","timeOffset","getTimezoneOffset","Date","valueOf","_toUTC","_setMode","mode","_curMode","_dateInputs","datepicker","isSimple","$el","find","toggle","_moreIcon","toggleClass","attr","_gtxt","dateBegin","_dateBegin","dateEnd","_dateEnd","_selectFunc","call","_updateModel","activeInput","begin","end","dateToFix","$","dateInterval","set","MS_IN_DAY","_updateWidget","get","dayms","isValid","newDateBegin","newDateEnd","prevDateBegin","prevDateEnd","_shiftDates","delta","shift","_dateMin","_dateMax","module","exports","options","template","Handlebars","compile","extend","minimized","showSwitcher","dateMax","dateMin","dateFormat","name","html","moreIconClass","moreIconTitle","forecast","add","on","bind","onSelect","dateText","inst","input","showAnim","changeMonth","changeYear","minDate","maxDate","defaultDate","showOn","buttonImage","buttonImageOnly","container","append","canvas","Request","require","_defaultViconColor","_getUnderWayIcon","cog","sog","type_color","group_style","_getAtAnchorIcon","_vicons","_viconsDict","_styleLayer","_getVicons","gmxMap","layersByID","_gmx","properties","gmxStyles","styles","forEach","s","icon","Filter","RenderStyle","iconUrl","replace","Name","push","filter","_getViconSvgPromise","ic","Promise","resolve","httpRequest","XMLHttpRequest","onreadystatechange","readyState","responseText","a","exec","svg","color","length","open","document","location","protocol","url","send","_getVicon","vessel_type","f","re1","RegExp","re2","search","_loadViconPromise","_lmap","leafletMap","_tracks","_vmarkers","all","map","_data","tracks","msg","_layerName","layer","isDirty","data","value","free","total","t","removeLayer","fitToTrack","i","fitBounds","getBounds","drawTrack","addTo","eraseTrack","update","thisModel","then","searchRequest","view","trackLayer","id","orderdirection","orderby","sort","columns","query","r","values","txt","p","parseData","fields","lastTrack","positions","utc_date","repaint","lastPos","wholeDistance","distance","temp","latlngs","latitude","longitude","concat","line","L","polyline","vicon","bindPopup","vname","toFixed","viewFactory","_isReady","_activeView","_canvas","_div","_views","create","_create","sidebarPane","v","frame","resize","show","_returnInstance","_serverBase","window","serverBase","_fetchRequest","request","method","fetch","headers","body","encodeURI","_sendRequest","reject","callback","response","Status","toLowerCase","Result","sendCrossDomainJSONRequest","_getQueryString","WrapStyle","sendCrossDomainPostRequest","params","qs","JSON","stringify","_searchRequest","_modifyRequest","_checkVersion","ms","setTimeout","gmx","layersVersion","chkVersion","fetchRequest","sendRequest","modifyRequest","checkVersion","_searchString","_sparams","SearchControl","tab","searchparams","searcher","innerHTML","suggestions","appendChild","createElement","classList","q","querySelector","preferences","localStorage","getItem","asparams","split","sr","style","borderRight","paddingRight","width","searchInput","searchBut","prefeBut","removeBut","delay","suggestionsCount","suggestionsFrame","first","current","last","found","searchDone","vessel_name","doSearch","actualId","requests","searchpromise","status","console","log","json","parser","display","scrollCont","content","mCustomScrollbar","suggestion","querySelectorAll","cr","getBoundingClientRect","position","left","top","bottom","Math","round","height","el","onclick","e","currentTarget","addEventListener","offsetWidth","stopPropagation","ch","contains","sparam","remove","setItem","focus","clearTimeout","onkeydown","keyCode","previousSibling","nextSibling","scrollInertia","prepareSearchInput","click","onkeyup","apply","onpaste","originalEvent","clipboardData","getData","prototype","active","_isOptionsDisplayed","_select","_optionsList","_selected","className","o","join","_arrow","_options","_hideOptions","_setOptionsRect","selectedRc","bw","parseInt","getComputedStyle","borderWidth","isNaN","srcElement","dropDownList","_clean","empty","BaseView","model","gifLoader","isActive","is","clean","h","topOffset","bottomOffset","inProgress","tableTemplate","mcsbOptions","hide","isVisible","rc","Calendar","SelectControl","_toDd","D","isLng","dir","deg","_searchLayer","_selectLayers","vesselQuery","_thisView","imo","calendar","toISOString","getVicon","tzOffset","ts","indexOf","utcDate","locDate","toLocaleDateString","utc_time","toLocaleTimeString","local_date","local_time","lat","lon","mmsi","_layer","TracksView","_addCalendar","db","de","daysDiff","ceil","getTime","footer","selectLayer","l","selected","rv","c","Object","defineProperty","totalPositions","_renderPosTable","m","j","mapDateInterval","widgets","commonCalendar","getDateInterval","msd","d","attributes","getUTCDayBoundary","tr","insertCell","off","_onOpenPosClick","_onShowTrack","_onShowAllTracks","_onShowPos","_onExport","state","progress","grid","target","removeClass","addClass","div","showTrack","showAllTracks","each","checked","checkAll","ij","pos","setView","type","trackLine","reduce","features","geometry","gmxUtil","geometryToGeoJSON","coordinates","getFilename","spart","epart","Utils","downloadGeometry","fileName","format","arguments","MyCollectionView","MyCollectionModel","_mcm","_mcv","pluginName","menuId","toolbarIconId","cssTable","modulePath","gmxCore","getModulePath","PluginPanel","ViewsFactory","publicInterface","afterViewer","pluginPanel","sidebar","iconSidebarWidget","createTabFunction","inactive","hint","tabDiv","setPane","createTab","_activeTabId","addModule","css","_translationsHash","addtext"],"mappings":"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","file":"TrackExportPlugin.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/entry.js\");\n","const SIMPLE_MODE = 1,\r\n      ADVANCED_MODE = 2;\r\nconst _toMidnight = nsGmx.DateInterval.toMidnight, \r\n    _fromUTC = function (date) {\r\n        if (!date) return null;\r\n        var timeOffset = date.getTimezoneOffset() * 60 * 1000;\r\n        return new Date(date.valueOf() - timeOffset);\r\n    }, \r\n    _toUTC = function(date) {\r\n        if (!date) return null;\r\n        var timeOffset = date.getTimezoneOffset()*60*1000;\r\n        return new Date(date.valueOf() + timeOffset);\r\n    },\r\n    _setMode = function(mode) {\r\n        if (this._curMode === mode) {\r\n            return this;\r\n        }\r\n\r\n        //this.reset();\r\n        this._dateInputs.datepicker('hide');\r\n\r\n        this._curMode = mode;\r\n        var isSimple = mode === SIMPLE_MODE;\r\n\r\n        $el.find('.CalendarWidget-onlyMaxVersion').toggle(!isSimple);\r\n\r\n        this._moreIcon\r\n            .toggleClass('icon-calendar', isSimple)\r\n            .toggleClass('icon-calendar-empty', !isSimple)\r\n            .attr('title', isSimple ? _gtxt('CalendarWidget.ExtendedViewTitle') : _gtxt('CalendarWidget.MinimalViewTitle'));\r\n\r\n\r\n        var dateBegin = this._dateBegin.datepicker('getDate'),\r\n            dateEnd = this._dateEnd.datepicker('getDate');\r\n\r\n        if (isSimple && dateBegin && dateEnd && dateBegin.valueOf() !== dateEnd.valueOf()) {\r\n            _selectFunc.call(this, this._dateEnd);\r\n            _updateModel().call(this);\r\n        }\r\n\r\n        //this.trigger('modechange');\r\n\r\n        return this;\r\n    },\r\n    _selectFunc = function(activeInput) {\r\n        var begin = this._dateBegin.datepicker('getDate');\r\n        var end   = this._dateEnd.datepicker('getDate');\r\n\r\n        if (end && begin && begin > end) {\r\n            var dateToFix = activeInput[0] == this._dateEnd[0] ? this._dateBegin : this._dateEnd;\r\n            dateToFix.datepicker('setDate', $(activeInput[0]).datepicker('getDate'));\r\n        } else if (this._curMode === SIMPLE_MODE) {\r\n            //либо установлена только одна дата, либо две, но отличающиеся\r\n            if (!begin != !end || begin && begin.valueOf() !== end.valueOf()) {\r\n                this._dateEnd.datepicker('setDate', this._dateBegin.datepicker('getDate'));\r\n            }\r\n        }\r\n    },\r\n    _updateModel = function() {\r\n        var dateBegin = _fromUTC(this._dateBegin.datepicker('getDate')),\r\n            dateEnd = _fromUTC(this._dateEnd.datepicker('getDate'));\r\n\r\n        this.dateInterval.set({\r\n            dateBegin: dateBegin ? _toMidnight(dateBegin) : null,\r\n            dateEnd: dateEnd ? _toMidnight(dateEnd.valueOf() + nsGmx.DateInterval.MS_IN_DAY) : null\r\n        });\r\n    },\r\n    _updateWidget = function() {\r\n        var dateBegin = this.dateInterval.get('dateBegin'),\r\n            dateEnd = this.dateInterval.get('dateEnd'),\r\n            dayms = nsGmx.DateInterval.MS_IN_DAY;\r\n\r\n        if (!dateBegin || !dateEnd) {\r\n            return;\r\n        };\r\n\r\n        var isValid = !(dateBegin % dayms) && !(dateEnd % dayms);\r\n\r\n        var newDateBegin = _toUTC(dateBegin),\r\n            newDateEnd;\r\n        if (isValid) {\r\n            newDateEnd = _toUTC(new Date(dateEnd - dayms));\r\n            if (dateEnd - dateBegin > dayms) {\r\n                _setMode.call(this, ADVANCED_MODE);\r\n            }\r\n        } else {\r\n            newDateEnd = _toUTC(dateEnd);\r\n            _setMode.call(this, ADVANCED_MODE);\r\n        }\r\n\r\n        //если мы сюда пришли после выбора интервала в самом виджете, вызов setDate сохраняет фокус на input-поле\r\n        //возможно, это какая-то проблема jQueryUI.datepicker'ов.\r\n        //чтобы этого избежать, явно проверяем, нужно ли изменять дату\r\n        var prevDateBegin = this._dateBegin.datepicker('getDate'),\r\n            prevDateEnd = this._dateEnd.datepicker('getDate');\r\n\r\n        if (!prevDateBegin || prevDateBegin.valueOf() !== newDateBegin.valueOf()) {\r\n            this._dateBegin.datepicker('setDate', newDateBegin);\r\n        }\r\n\r\n        if (!prevDateEnd || prevDateEnd.valueOf() !== newDateEnd.valueOf()) {\r\n            this._dateEnd.datepicker('setDate', newDateEnd);\r\n        }\r\n    },\r\n    _shiftDates = function(delta) {\r\n        var dateBegin = _fromUTC(this._dateBegin.datepicker('getDate')),\r\n            dateEnd = _fromUTC(this._dateEnd.datepicker('getDate'));\r\n\r\n        if (!dateBegin || !dateEnd) {\r\n            return;\r\n        }\r\n\r\n        var shift = (dateEnd - dateBegin + nsGmx.DateInterval.MS_IN_DAY) * delta,\r\n            newDateBegin = new Date(dateBegin.valueOf() + shift),\r\n            newDateEnd = new Date(dateEnd.valueOf() + shift);\r\n\r\n        if ((!this._dateMin || _toMidnight(this._dateMin) <= _toMidnight(newDateBegin)) &&\r\n            (!this._dateMax || _toMidnight(this._dateMax) >= _toMidnight(newDateEnd)))\r\n        {\r\n            this._dateBegin.datepicker('setDate', _toUTC(newDateBegin));\r\n            this._dateEnd.datepicker('setDate', _toUTC(newDateEnd));\r\n\r\n            _updateModel.call(this);\r\n        }\r\n    };\r\n\r\nmodule.exports = function(options){\r\n\r\n    $el = $('<div class=\"CalendarWidget ui-widget\"></div>');\r\n\r\n    this.template = Handlebars.compile(`\r\n    <table>\r\n    <tr>\r\n        <td><div class = \"CalendarWidget-iconScrollLeft ui-helper-noselect icon-left-open\"></div></td>\r\n        <td class = \"CalendarWidget-inputCell\"><input class = \"gmx-input-text CalendarWidget-dateBegin\"></td>\r\n        <td class = \"CalendarWidget-inputCell CalendarWidget-onlyMaxVersion\"><input class = \"gmx-input-text CalendarWidget-dateEnd\"></td>\r\n        <td><div class = \"CalendarWidget-iconScrollRight ui-helper-noselect icon-right-open\" ></div></td>\r\n        <td><div class = \"CalendarWidget-iconMore {{moreIconClass}}\" title = \"{{moreIconTitle}}\"></div></td>\r\n        <td><div class = \"CalendarWidget-forecast\" hidden>{{forecast}}</div></td>\r\n    </tr><tr>\r\n        <td></td>\r\n        <td class = \"CalendarWidget-dateBeginInfo\"></td>\r\n        <td class = \"CalendarWidget-dateEndInfo\"></td>\r\n        <td></td>\r\n        <td></td>\r\n    </tr>\r\n</table>\r\n<div class=\"CalendarWidget-footer\"></div>`);\r\n\r\n    options = $.extend({\r\n        minimized: true,\r\n        showSwitcher: true,\r\n        dateMax: null,\r\n        dateMin: null,\r\n        dateFormat: 'dd.mm.yy',\r\n        name: null\r\n    }, options);\r\n\r\n    this._dateMin = options.dateMin;\r\n    this._dateMax = options.dateMax;\r\n    this.dateInterval = options.dateInterval;\r\n\r\n    $el.html(this.template({\r\n        moreIconClass: options.minimized ? 'icon-calendar' : 'icon-calendar-empty',\r\n        moreIconTitle: options.minimized ? _gtxt('CalendarWidget.ExtendedViewTitle') : _gtxt('CalendarWidget.MinimalViewTitle'),\r\n        forecast: _gtxt('CalendarWidget.forecast')\r\n    }));\r\n\r\n    this._moreIcon = $el.find('.CalendarWidget-iconMore')\r\n        .toggle(!!options.showSwitcher);\r\n\r\n    this._dateBegin = $el.find('.CalendarWidget-dateBegin');\r\n    this._dateEnd = $el.find('.CalendarWidget-dateEnd');\r\n    this._dateInputs = this._dateBegin.add(this._dateEnd);\r\n\r\n    $el.find('.CalendarWidget-iconScrollLeft').on('click', function() {\r\n        _shiftDates.call(this, -1);\r\n    }.bind(this));\r\n    $el.find('.CalendarWidget-iconScrollRight').on('click', function() {\r\n        _shiftDates.call(this, 1);\r\n    }.bind(this));\r\n\r\n    this._dateInputs.datepicker({\r\n        onSelect: function(dateText, inst){\r\n            _selectFunc.call(this, inst.input);\r\n            _updateModel.call(this);\r\n        }.bind(this),\r\n        showAnim: 'fadeIn',\r\n        changeMonth: true,\r\n        changeYear: true,\r\n        minDate: this._dateMin ? _toUTC(this._dateMin) : null,\r\n        maxDate: this._dateMax ? _toUTC(this._dateMax) : null,\r\n        dateFormat: options.dateFormat,\r\n        defaultDate: _toUTC(this._dateMax || new Date()),\r\n        showOn: options.buttonImage ? 'both' : 'focus',\r\n        buttonImageOnly: true\r\n    });\r\n\r\n    //устанавливаем опцию после того, как добавили календарик в canvas\r\n    if (options.buttonImage) {\r\n        this._dateInputs.datepicker('option', 'buttonImage', options.buttonImage);\r\n    }\r\n\r\n    $el.find('.CalendarWidget-onlyMaxVersion').toggle(!options.minimized);\r\n\r\n    options.dateBegin && this._dateBegin.datepicker('setDate', _toUTC(options.dateBegin));\r\n    options.dateEnd && this._dateEnd.datepicker('setDate', _toUTC(options.dateEnd));\r\n\r\n    if (options.container) {\r\n        if (typeof options.container === 'string')\r\n            $('#' + options.container).append($el);\r\n        else\r\n            $(options.container).append($el);\r\n    }\r\n\r\n    _setMode.call(this, options.minimized ? SIMPLE_MODE : ADVANCED_MODE);\r\n\r\n    _updateWidget.call(this);\r\n\r\n    this.dateInterval.on('change', function(){_updateWidget.call(this)}.bind(this), this);\r\n\r\n    //for backward compatibility\r\n    this.canvas = $el;\r\n}","const Request = require('../Request');\r\n\r\n//////////////////////////\r\n\r\nconst _defaultViconColor = '#999',\r\n    _getUnderWayIcon = function (cog, sog, type_color, group_style) {\r\n        return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(${ (!cog ? 0 : cog)}deg)\"><title>sog: ${sog}${_gtxt('TrackExport.kn')} cog: ${cog}°</title><path style=\"fill:${ type_color};\" d=\"M13.8,20.07a1,1,0,0,1-.69-0.28l-1.79-1.72a0.72,0.72,0,0,0-1,0L8.52,19.79a1,1,0,0,1-.69.28,1,1,0,0,1-1-1V8.65c0-1.52,1.55-7.59,4-7.59s4,6.07,4,7.59V19a1,1,0,0,1-1,1h0Z\"/><path style=\"fill:${ group_style};\" d=\"M10.82,1.57c1.93,0,3.5,5.57,3.5,7.09V19a0.52,0.52,0,0,1-.51.53,0.49,0.49,0,0,1-.34-0.14l-1.79-1.72a1.22,1.22,0,0,0-1.71,0L8.17,19.42a0.49,0.49,0,0,1-.34.14A0.52,0.52,0,0,1,7.32,19V8.65c0-1.51,1.57-7.09,3.5-7.09h0m0-1c-3,0-4.5,6.72-4.5,8.09V19a1.52,1.52,0,0,0,1.51,1.53,1.49,1.49,0,0,0,1-.42l1.79-1.72a0.22,0.22,0,0,1,.32,0l1.79,1.72a1.49,1.49,0,0,0,1,.42A1.52,1.52,0,0,0,15.32,19V8.65c0-1.37-1.51-8.09-4.5-8.09h0Z\"/><ellipse style=\"fill:#fff;\" cx=\"10.82\" cy=\"10.54\" rx=\"1.31\" ry=\"1.35\"/><path style=\"fill:#fff;\" d=\"M10.73,3.34h0.12a0.35,0.35,0,0,1,.35.35v6.85a0,0,0,0,1,0,0H10.38a0,0,0,0,1,0,0V3.69A0.35,0.35,0,0,1,10.73,3.34Z\"/></svg>`;\r\n    },\r\n    _getAtAnchorIcon = function (cog, sog, type_color, group_style) {\r\n        return `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(${ (!cog ? 0 : cog)}deg)\"><title>sog: ${sog}${_gtxt('TrackExport.kn')} cog: ${cog}°</title><rect style=\"fill:${ type_color};stroke:${ group_style};stroke-miterlimit:10;\" x=\"5.9\" y=\"5.6\" width=\"9.19\" height=\"9.19\" rx=\"2\" ry=\"2\" transform=\"translate(-4.13 10.41) rotate(-45)\"/><circle style=\"fill:#fff;\" cx=\"10.5\" cy=\"10.19\" r=\"1.5\"/></svg>`;\r\n    },\r\n\r\n    _vicons = [], _viconsDict = {},\r\n    _styleLayer = '-EE5587AF1F70433AA878462272C0274C',\r\n    _getVicons = function () {\r\n        if (!_styleLayer || !nsGmx.gmxMap.layersByID[_styleLayer])\r\n            return;\r\n        nsGmx.gmxMap.layersByID[_styleLayer]._gmx.properties.gmxStyles.styles.forEach(s => {\r\n        let icon = {\r\n            \"filter\": s.Filter, \r\n            \"url\": s.RenderStyle.iconUrl.replace(/^https?:/, \"\")\r\n                .replace(/^\\/\\/kosmosnimki.ru/, \"//www.kosmosnimki.ru\"), \"name\": s.Name\r\n        };\r\n        _vicons.push(icon);\r\n        _viconsDict[icon.filter] = icon;\r\n    });\r\n// console.log(_icons);\r\n// console.log(_iconsDict);\r\n},\r\n_getViconSvgPromise = function (ic) {\r\n    return new Promise(resolve => {\r\n        let httpRequest = new XMLHttpRequest();\r\n        httpRequest.onreadystatechange = function () {\r\n            if (httpRequest.readyState === 4) {\r\n                ic[\"svg\"] = httpRequest.responseText;\r\n                let a = /\\.cls-1{fill:(#[^};]+)/.exec(ic.svg);\r\n                ic.color = _defaultViconColor;\r\n                if (a && a.length)\r\n                    ic.color = a[1];\r\n                resolve();\r\n            }\r\n        }\r\n        httpRequest.open(\"GET\", document.location.protocol + ic.url.replace(/^https?:/, \"\"));\r\n        httpRequest.send();\r\n    })\r\n},\r\n_getVicon = function(vessel_type, cog, sog){ \r\n    for(let f in _viconsDict){\r\n        let re1 = new RegExp(\"'\"+vessel_type+\"'\"),\r\n        re2 = new RegExp(sog != 0 ? \">0\" : \"=0\");\r\n//console.log(vessel_type+\" \"+sog+\" \"+f+\" \"+f.search(re1)+\" \"+f.search(re2))\r\n        if(f.search(re1)!=-1 && f.search(re2)!=-1){\r\n            return {color: _viconsDict[f].color, svg:(sog != 0 ? _getUnderWayIcon(cog, sog, _viconsDict[f].color, '#fff') : _getAtAnchorIcon(cog, sog, _viconsDict[f].color, '#fff'))};\r\n        }\r\n    }\r\n    return {color: '#f00', svg:(sog != 0 ? _getUnderWayIcon(cog, sog, _defaultViconColor, '#fff') : _getAtAnchorIcon(cog, sog, _defaultViconColor, sog, '#fff'))};\r\n};\r\nlet _loadViconPromise;\r\n\r\n//////////////////////////\r\n\r\nmodule.exports = function (options) {\r\n\r\n    const _lmap = nsGmx.leafletMap,\r\n        _tracks = [], _vmarkers = [];\r\n       \r\n    _getVicons();\r\n    _loadViconPromise = Promise.all(_vicons.map(_getViconSvgPromise));\r\n\r\n    const _data = {tracks:[], msg:[]};        \r\n    const _layerName = options.layer;\r\n\r\n    return {\r\n        isDirty: false,\r\n        get data() { return _data },\r\n        set data(value) { _data = value; },\r\n        free: function(){\r\n            _data.total = null;\r\n            _data.tracks.length = 0;\r\n            _data.msg.length = 0;\r\n            _tracks.forEach(t=>{\r\n                _lmap.removeLayer(t);\r\n            });\r\n            _tracks.length = 0;\r\n            _vmarkers.length = 0; \r\n        },\r\n        fitToTrack: function(i){\r\n            _lmap.fitBounds(_tracks[i].getBounds());\r\n        },\r\n        drawTrack: function(i){\r\n            _tracks[i].addTo(_lmap);         \r\n        },\r\n        eraseTrack: function(i){\r\n            _lmap.removeLayer(_tracks[i]);         \r\n        },\r\n        update: function () {\r\n\r\n            if (!this.isDirty)\r\n                return;\r\n\r\n            const thisModel = this;\r\n            return Promise.resolve().then(()=>{\r\n                    thisModel.free();                       \r\n                    return Request.searchRequest({\r\n                        layer: thisModel.view.trackLayer.id,\r\n                        orderdirection: 'desc',\r\n                        orderby: thisModel.view.trackLayer.sort,\r\n                        columns: thisModel.view.trackLayer.columns,\r\n                        query: thisModel.view.trackLayer.query\r\n                    }, 'POST').then(r=>{\r\n                        return _loadViconPromise.then(()=>{\r\n//console.log(r)\r\n                        if (!r.values.length){\r\n                            _data.msg = [{txt:_gtxt('TrackExport.nodata')}];\r\n                        }\r\n                        else{\r\n                            _data.total = r.values.length;\r\n                            r.values.forEach(p=>{\r\n                                let data = thisModel.view.trackLayer.parseData(r.fields, p, _getVicon),\r\n                                    lastTrack = _data.tracks[_data.tracks.length-1];\r\n                                if (!lastTrack || lastTrack.positions[0].utc_date!=data.utc_date){\r\n                                    lastTrack = { utc_date: data.utc_date, positions: [] };\r\n                                    _data.tracks.push(lastTrack);\r\n                                }\r\n                                lastTrack.positions.push(data);\r\n                            });\r\n                        }\r\n                        });\r\n                    });\r\n            }).then(()=>{    \r\n                \r\n                // draw track on map\r\n                thisModel.view.repaint();\r\n                if (_data.tracks.length){\r\n                    let lastPos, wholeDistance = 0;\r\n                    _data.tracks.forEach(t=>{\r\n                        t.distance = 0;\r\n                        let temp, latlngs = t.positions.map(p=>{\r\n                            if (temp)\r\n                                t.distance = t.distance + _lmap.distance(temp, [p.latitude, p.longitude]);\r\n                            temp = [p.latitude, p.longitude];\r\n                            return temp;\r\n                        });\r\n                        if (lastPos){\r\n                            t.distance = t.distance + _lmap.distance(lastPos, latlngs[0]);\r\n                            latlngs = [lastPos].concat(latlngs);\r\n                        }\r\n                        lastPos = temp;  \r\n                        let line = L.polyline(latlngs, {color: t.positions[0] && t.positions[0].vicon ? t.positions[0].vicon.color : 'red'}).addTo(_lmap); \r\n                        line.bindPopup(`<b>${thisModel.view.vname}</b><br>${t.utc_date}<br>${(t.distance/1000).toFixed(3)} ${_gtxt('TrackExport.km')}`);                    \r\n                        _tracks.push(line);\r\n                        \r\n                        wholeDistance = wholeDistance + t.distance;\r\n                    });\r\n                    \r\n                    _lmap.fitBounds(_tracks[0].getBounds());\r\n                }\r\n  \r\n                thisModel.isDirty = false;\r\n            });\r\n\r\n        } // this.update\r\n    };\r\n}","// let PRODUCTION = false;\r\n// if (has('PRODUCTION'))\r\n//     PRODUCTION = true;\r\n\r\n\r\nmodule.exports = function (viewFactory) {\r\n    let _isReady = false,\r\n        _activeView,\r\n        _canvas = _div(null),\r\n        _views = viewFactory.create(),\r\n        _create = function () {\r\n            $(this.sidebarPane).append(_canvas);\r\n            $(_canvas).append(_views.map(v => v.frame));\r\n            _views[0].resize(true);\r\n            _views[0].show();\r\n            _activeView = _views[0];\r\n            _isReady = true;\r\n        };\r\n    const _returnInstance = {\r\n        show: function () {          \r\n            if (!_isReady)\r\n            {\r\n                _create.call(this);\r\n            }\r\n            else{       \r\n                _activeView && _activeView.show();\r\n            }\r\n        }\r\n    }\r\n    return _returnInstance;\r\n    /*\r\n    let _leftMenuBlock,\r\n        _canvas = _div(null),\r\n        _activeView,\r\n        _views = viewFactory.create(),\r\n        // _aisSearchView,\r\n        // _myFleetMembersView,\r\n        // _historyView,\r\n        //_gifLoader = '<img src=\"img/progress.gif\">',\r\n        _isReady = false,\r\n        _createTabs = function () {\r\n            let tabsTemplate = '<table class=\"ais_tabs\" border=0><tr>' +\r\n                '<td class=\"ais_tab dbsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.DbSearchTab\"}}</div>' +\r\n                '</td><td class=\"ais_tab scrsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.ScreenSearchTab\"}}</div>' +\r\n                '</td><td class=\"ais_tab myfleet_tab unselectable\" unselectable=\"on\">' + // ACTIVE\r\n                '<div>{{i \"AISSearch2.MyFleetTab\"}}</div>' +\r\n                '</td></tr></table>'\r\n\r\n            if (NOSIDEBAR)\r\n                $(_leftMenuBlock.workCanvas).append(_canvas);\r\n            else\r\n                $(this.sidebarPane).append(_canvas);\r\n\r\n            $(_canvas).append(Handlebars.compile(tabsTemplate));\r\n            $(_canvas).append(_views.map(v => v.frame));\r\n    \r\n            let tabs = $('.ais_tab', _canvas),\r\n                _this = this;           \r\n            _views.forEach((v,i) =>{\r\n                v.tab = tabs.eq(i);\r\n                v.resize(true);\r\n            }); \r\n            tabs.on('click', function () {\r\n                if (!$(this).is('.active')) {\r\n                    let target = this;\r\n                    tabs.each(function (i, tab) {\r\n                        if (!$(tab).is('.active') && target == tab) {\r\n                            $(tab).addClass('active');\r\n                            _views[i].show();\r\n                            _activeView = _views[i];\r\n                        }\r\n                        else {\r\n                            $(tab).removeClass('active');\r\n                            _views[i].hide();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            // Show the first tab\r\n            tabs.eq(0).removeClass('active').click();\r\n\r\n            if (NOSIDEBAR) {\r\n                _returnInstance.hide = function () {\r\n                    $(_leftMenuBlock.parentWorkCanvas).hide();\r\n                    nsGmx.leafletMap.removeLayer(highlight);\r\n                }\r\n\r\n                $(_leftMenuBlock.parentWorkCanvas)\r\n                    .attr('class', 'left_aispanel')\r\n                    .insertAfter('.layers-before');\r\n                var blockItem = _leftMenuBlock.leftPanelItem,\r\n                    blockTitle = $('.leftmenu-path', blockItem.panelCanvas);\r\n                var toggleTitle = function () {\r\n                    if (blockItem.isCollapsed())\r\n                        blockTitle.show();\r\n                    else\r\n                        blockTitle.hide();\r\n                }\r\n                $(blockItem).on('changeVisibility', toggleTitle);\r\n                toggleTitle();\r\n            }\r\n\r\n            // All has been done at first time\r\n            _isReady = true;\r\n        },\r\n\r\n    _returnInstance = {\r\n        show: function () {\r\n            let lmap = nsGmx.leafletMap;\r\n            if (NOSIDEBAR && !_leftMenuBlock)\r\n                _leftMenuBlock = new leftMenu();\r\n\r\n            if ((NOSIDEBAR && (!_leftMenuBlock.createWorkCanvas(\"aispanel\",\r\n                function () { lmap.gmxControlIconManager.get(this.menuId)._iconClick() },\r\n                { path: [_gtxt('AISSearch2.caption')] })\r\n            )) || (!_isReady)) // SIDEBAR\r\n            {\r\n                _createTabs.call(this);\r\n            }\r\n            else{\r\n                if (NOSIDEBAR){\r\n                    $(_leftMenuBlock.parentWorkCanvas)\r\n                    .insertAfter('.layers-before');\r\n                }            \r\n                _activeView && _activeView.show();\r\n            }\r\n        }\r\n    };\r\n    return _returnInstance;\r\n    */\r\n}\r\n\r\n","const _serverBase = window.serverBase.replace(/^https?:/, document.location.protocol),\r\n    _fetchRequest = function(url, request, method){\r\n        if (url[0]=='/')\r\n            url = _serverBase + url.replace(/^\\//, '');\r\n        if (method=='POST')\r\n            return fetch(url, {                \r\n                headers: {'Content-Type': 'application/x-www-form-urlencoded'},\r\n                method: 'POST', // *GET, POST, PUT, DELETE, etc.\r\n                mode: 'cors', // no-cors, cors, *same-origin);\r\n                body: encodeURI(request)\r\n            });\r\n    },\r\n    _sendRequest = function(url, request, method){\r\n        return new Promise((resolve, reject) => {\r\n            const callback = response => {\r\n                if (!response.Status || response.Status.toLowerCase() != 'ok' || !response.Result) {\r\n                    reject(response);\r\n                }\r\n                else\r\n                    resolve(response.Result);\r\n            };\r\n            if (url[0]=='/')\r\n                url = _serverBase + url.replace(/^\\//, '');\r\n            if (!method || method == 'GET')\r\n                window.sendCrossDomainJSONRequest(url + `?${_getQueryString(request)}`, callback);\r\n            if (method == 'POST'){\r\n                request.WrapStyle='message';\r\n                window.sendCrossDomainPostRequest(url, request, callback);\r\n            }\r\n        });\r\n    },\r\n    _getQueryString = function(params){\r\n        let qs = '';\r\n        for (let p in params) {\r\n            if (qs != '')\r\n            qs += '&';\r\n        qs += p + '=' + (typeof params[p]=='object' ? JSON.stringify(params[p]) : params[p]);\r\n        }\r\n        return qs;\r\n    }\r\n    _searchRequest = function(params, method){\r\n        return _sendRequest(`${_serverBase}VectorLayer/Search.ashx`, params, method);\r\n    },\r\n    _modifyRequest = function(params){\r\n        const url = `${_serverBase}VectorLayer/ModifyVectorObjects.ashx?${_getQueryString(params)}`;\r\n        return _sendRequest(url);\r\n    },\r\n    _checkVersion = function(layer, ms){\r\n        setTimeout(()=>{\r\n            L.gmx.layersVersion.chkVersion(layer);\r\n//console.log('ChV')                   \r\n            setTimeout(()=>{\r\n                L.gmx.layersVersion.chkVersion(layer);\r\n//console.log('ChV')                   \r\n                setTimeout(()=>{\r\n                    L.gmx.layersVersion.chkVersion(layer); \r\n//console.log('ChV')                   \r\n                }, ms);\r\n            }, ms);                                            \r\n        }, ms);\r\n    };\r\nmodule.exports = {\r\n    fetchRequest: _fetchRequest,\r\n    sendRequest: _sendRequest,\r\n    searchRequest : _searchRequest, \r\n    modifyRequest: _modifyRequest,\r\n    checkVersion: _checkVersion\r\n};","// extracted by mini-css-extract-plugin","\r\n\r\nlet _searchString = \"\",\r\n_sparams = 'imo name mmsi';\r\nconst SearchControl = function ({ tab, container, callback, searchparams, searcher }) {\r\n\r\n    container.innerHTML = '<div class=\"filter\"><input type=\"text\" placeholder=\"' + _gtxt(\"Lloyds.search_placeholder\") + '\"/>' +\r\n        (!searchparams ? '' : '<div class=\"preferences\"></div>') +\r\n        '<div class=\"searchremove\"><img class=\"search\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        '<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\"></div>' +\r\n        '</div>';\r\n    let suggestions = tab.appendChild(document.createElement('div'));\r\n    suggestions.classList.add(\"suggestions\");\r\n    suggestions.innerHTML = '<div class=\"suggestion\">SOME VESSEL<br><span>mmsi:0, imo:0</span></div>';\r\n\r\n    this.frame = { find: (q) => { return container.querySelector(q) } };\r\n\r\n    let preferences = false;\r\n    if (searchparams){\r\n        _sparams = localStorage.getItem(searchparams);\r\n        preferences = tab.appendChild(document.createElement('div'));\r\n        preferences.classList.add(\"preferences\");\r\n        preferences.innerHTML = '<div class=\"section\">Поиск по:</div>' +\r\n            '<div class=\"line\"><div class=\"checkbox imo disabled\"></div><div class=\"label\">IMO<label></div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox mmsi\"></div><div class=\"label\">MMSI<label></div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox name disabled\"></div><div class=\"label\">названию</div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox callsign\"></div><div class=\"label\">позывному<label></div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox owner\"></div><div class=\"label\">собственнику<label></div></div>';\r\n        !_sparams && (_sparams = 'imo name mmsi');\r\n        if (_sparams.search(/imo/) < 0)\r\n            _sparams += ' imo';\r\n        if (_sparams.search(/name/) < 0)\r\n            _sparams += ' name';\r\n        let asparams = _sparams.split(' ');\r\n        asparams.forEach((p, i) => { preferences.querySelector('.' + p).classList.add('checked') });\r\n    }\r\n    else{\r\n        let sr = this.frame.find('.filter .searchremove');\r\n        sr.style.borderRight = 'none';\r\n        sr.style.paddingRight = 0;\r\n        this.frame.find('.filter input').style.width = '85%';\r\n    }\r\n\r\n    this.frame = { find: (q) => { return container.querySelector(q) } }\r\n    this.searchInput = this.frame.find('.filter input');\r\n\r\n    let searchBut = this.frame.find('.filter .search'),\r\n        prefeBut = this.frame.find('.filter .preferences'),\r\n        removeBut = this.frame.find('.filter .remove'),\r\n        delay,\r\n        //suggestions = this.frame.find('.suggestions'),\r\n        suggestionsCount = 5,\r\n        suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 },\r\n        found = { values: [] },\r\n        searchDone = function () {\r\n            if (found.values.length > 0) {\r\n                _searchString = found.values[suggestionsFrame.current].vessel_name;\r\n                this.searchInput.value = (_searchString);\r\n                callback(found.values[suggestionsFrame.current]);\r\n            }\r\n            // else {\r\n            //     _clean.call(this);\r\n            // }\r\n        },\r\n        doSearch = function (actualId) {\r\n            let requests = [];\r\n            // _sparams.split(' ').forEach(sp=>{       \r\n            //     requests.push(fetch(\"//kosmosnimki.ru/demo/lloyds/api/v1/Ship/Search/\" + sp + \"/\" + _searchString));\r\n            // });\r\n            requests.push(new searcher.searchpromise([{name:'query', value: [_searchString]}]));\r\n            Promise.all(requests)\r\n            .then(a=>{\r\n//console.log(a)\r\n                return Promise.all(a.map(r=>{\r\n                    if (r.status != 200){\r\n                        console.log(r)                       \r\n                        return [];\r\n                    }\r\n                    else\r\n                        return r.json()\r\n                }))\r\n            })\r\n            .then(a=>{\r\n//console.log(actualId+\" \"+delay)\r\n                if (actualId==delay){\r\n                    found = {values:[]};\r\n                    a.forEach(r=>{found.values = found.values.concat( searcher.parser(r) );});\r\n//console.log(found.values)\r\n                }\r\n                else \r\n                    return Promise.reject(\"stop\")                    \r\n            })\r\n            .then(function () { // SUCCEEDED\r\n//console.log(_searchString)\r\n                if (found.values.length == 0 || _searchString == \"\") {\r\n                    suggestions.style.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                let scrollCont = suggestions.querySelector('.mCSB_container'),\r\n                    content = Handlebars.compile(\r\n                        '{{#each values}}<div class=\"suggestion\" id=\"{{@index}}\">{{vessel_name}}<br><span>mmsi:{{mmsi}}, imo:{{imo}}, {{callsign}}</span><br><span>{{owner}}</span></div>{{/each}}'\r\n                    )(found);\r\n                if (!scrollCont) {\r\n                    suggestions.innerHTML = (content);\r\n                    $(suggestions).mCustomScrollbar();\r\n                }\r\n                else\r\n                    scrollCont.innerHTML = (content);\r\n\r\n                let suggestion = suggestions.querySelectorAll('.suggestion');\r\n                if (suggestions.style.display != 'block') {\r\n                    let cr = this.frame.find('.filter').getBoundingClientRect();\r\n                    suggestions.style.display = 'block';\r\n                    suggestions.style.position = 'fixed';\r\n                    suggestions.style.left = cr.left + \"px\"; suggestions.style.top = (cr.bottom - 3) + \"px\";\r\n                    suggestions.style.width = (Math.round(cr.width) - 2) + \"px\";\r\n                    // $(suggestions).offset({ left: cr.left, top: cr.bottom - 3 });\r\n                    // $(suggestions).outerWidth(cr.width)\r\n                }\r\n\r\n                suggestions.style.height = suggestion[0].getBoundingClientRect().height *\r\n                    (found.values.length > suggestionsCount ? suggestionsCount : found.values.length) + \"px\";\r\n\r\n                suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 };\r\n                suggestion[suggestionsFrame.current].classList.add('selected');\r\n                suggestion.forEach(((el, i) =>\r\n                    el.onclick = (e => {\r\n                        suggestionsFrame.current = e.currentTarget.id;\r\n                        suggestions.style.display = 'none';\r\n                        searchDone.call(this);\r\n                    }).bind(this)\r\n                ).bind(this));\r\n            }.bind(this),\r\n            function (response) { // FAILED\r\n                if (response!=\"stop\")\r\n                    console.log(response);\r\n            });\r\n        };\r\n\r\n    tab.addEventListener('click', function (e) {\r\n        suggestions.style.display = 'none';\r\n    });\r\n    if (preferences) {\r\n        tab.addEventListener('click', function (e) {\r\n            preferences.style.display = 'none';\r\n        });\r\n        prefeBut.onclick = function (e) {\r\n            if (preferences.style.display != 'block') {\r\n                let cr = this.frame.find('.filter').getBoundingClientRect();\r\n                preferences.style.display = 'block';\r\n                preferences.style.position = 'fixed';\r\n                preferences.style.left = (cr.left + (cr.width - preferences.offsetWidth) / 2) + \"px\";\r\n                preferences.style.top = (cr.bottom + 10) + \"px\";\r\n                e.stopPropagation()\r\n            }\r\n        }.bind(this);\r\n\r\n        preferences.querySelectorAll('.line').forEach(el => el.onclick = e => {\r\n            let ch = el.querySelector('.checkbox');\r\n            if (!ch.classList.contains('disabled')) {\r\n                let sparam = ch.classList.value.replace(/ *(checked|checkbox) */g, '');\r\n                if (ch.classList.contains('checked')) {\r\n                    ch.classList.remove('checked');\r\n                    _sparams = _sparams.replace(new RegExp(sparam), '').replace(/ {2,}/g, ' ');\r\n                }\r\n                else {\r\n                    ch.classList.add('checked');\r\n                    _sparams = _sparams + ' ' + sparam;\r\n                }\r\n                _sparams = _sparams.replace(/^\\s+|\\s+$/g, '')\r\n                localStorage.setItem(searchparams, _sparams);\r\n                //console.log(_sparams)\r\n            }\r\n            e.stopPropagation()\r\n        });\r\n    }\r\n    \r\n    removeBut.onclick = (function (e) {\r\n        _searchString = '';\r\n        callback(null);\r\n        this.searchInput.value = ('');\r\n        this.searchInput.focus();\r\n        clearTimeout(delay)\r\n        removeBut.style.display = 'none';\r\n        searchBut.style.display = 'block';\r\n        suggestions.style.display = 'none';\r\n        //_clean.call(this);\r\n    }.bind(this));\r\n\r\n    this.searchInput.onkeydown = (function (e) {\r\n        let suggestion = suggestions.querySelector('.suggestion.selected');\r\n        if (suggestions.style.display == 'block') {\r\n            if (e.keyCode == 38) {\r\n                if (suggestionsFrame.current > 0) {\r\n                    suggestionsFrame.current--;\r\n                    suggestion.classList.remove('selected')\r\n                    suggestion.previousSibling.classList.add('selected');\r\n                }\r\n            }\r\n            else if (e.keyCode == 40) {\r\n                if (suggestionsFrame.current < found.values.length - 1) {\r\n                    suggestionsFrame.current++;\r\n                    suggestion.classList.remove('selected')\r\n                    suggestion.nextSibling.classList.add('selected');\r\n                }\r\n            }\r\n            if (suggestionsFrame.last < suggestionsFrame.current) {\r\n                suggestionsFrame.last = suggestionsFrame.current;\r\n                suggestionsFrame.first = suggestionsFrame.last - (suggestionsCount - 1);\r\n            }\r\n            if (suggestionsFrame.first > suggestionsFrame.current) {\r\n                suggestionsFrame.first = suggestionsFrame.current;\r\n                suggestionsFrame.last = suggestionsFrame.first + (suggestionsCount - 1);\r\n            }\r\n\r\n            $(suggestions).mCustomScrollbar(\"scrollTo\", \"#\" + suggestionsFrame.first, { scrollInertia: 0 });\r\n        }\r\n    });\r\n\r\n    let prepareSearchInput = function (temp, keyCode) {\r\n        removeBut.style.display = 'block';\r\n        searchBut.style.display = 'none';\r\n//console.log(\"delay clear\"+delay)\r\n//console.log(_searchString + \"==\"+ temp)\r\n        if (_searchString == temp && (!keyCode || keyCode != 13))\r\n            return false;\r\n\r\n        clearTimeout(delay);\r\n\r\n        _searchString = temp;\r\n        if (_searchString == \"\") {\r\n            removeBut.click();\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    this.searchInput.onkeyup = (function (e) {\r\n        let temp = (this.searchInput.value || \"\")\r\n            .replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n        if (!prepareSearchInput(temp, e.keyCode))\r\n            return;\r\n        if (e.keyCode == 13) {\r\n            suggestions.style.display = 'none';\r\n            searchDone.call(this);\r\n        }\r\n        else{\r\n            delay = setTimeout((() => {\r\n                doSearch.apply(this, [delay])\r\n            }).bind(this), 200);\r\n        }\r\n    }.bind(this));\r\n\r\n\r\n    this.searchInput.onpaste = function (e) {\r\n        let temp = ((e.originalEvent || window.clipboardData || e).clipboardData.getData('text') || \"\")\r\n            .replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n        if (!prepareSearchInput(temp))\r\n            return;\r\n        delay = setTimeout((() => {\r\n            doSearch.call(this, [delay])\r\n        }).bind(this), 200);\r\n    }.bind(this);\r\n\r\n}\r\n\r\nSearchControl.prototype.focus = function () {\r\n    this.searchInput.focus();\r\n}\r\n\r\nmodule.exports = SearchControl;","// extracted by mini-css-extract-plugin","module.exports = function(container, options, active, callback){\r\n    let _isOptionsDisplayed = false,\r\n    _select = document.createElement('div'),\r\n    _optionsList = document.createElement('div'),\r\n    _selected = active; \r\n\r\n    _select.className = 'select-control';\r\n    _select.innerHTML = `<span class=\"select-active\">${options[active]}</span><span class=\"icon-down-open\"></span>`;\r\n    _optionsList.className = 'select-list';\r\n    _optionsList.innerHTML = options.map((o, i)=>`<div class=\"select-options\" id=\"${i}\">${o}</div>`).join('');\r\n    \r\n    container.append(_select);\r\n    document.body.append(_optionsList);\r\n\r\n    const _arrow = _select.querySelector('.icon-down-open'),\r\n    _options = _optionsList.querySelectorAll('.select-options'),\r\n    _hideOptions = function(){\r\n            _optionsList.style.display = 'none';\r\n            _optionsList.querySelectorAll('.select-options')[_selected].classList.remove('selected');\r\n            _arrow.classList.remove('icon-up-open');\r\n            _arrow.classList.add('icon-down-open');\r\n            _isOptionsDisplayed = false;\r\n    };\r\n\r\n    let _setOptionsRect = function(){\r\n        let selectedRc = _select.getBoundingClientRect(),\r\n            bw = parseInt(getComputedStyle(_optionsList).borderWidth);\r\n        if (isNaN(bw)) bw = 0;\r\n        _optionsList.style.width = selectedRc.width - 2 * bw + \"px\";\r\n        _optionsList.style.top = selectedRc.bottom - 3 + \"px\";\r\n        _optionsList.style.left = selectedRc.left + \"px\";  \r\n    }  \r\n\r\n    for (let i=0; i<_options.length; ++i)\r\n        _options[i].addEventListener('click', e=>{\r\n            _hideOptions();\r\n            _selected = parseInt(e.srcElement.id);  \r\n            _select.querySelector('.select-active').innerHTML = options[_selected];          \r\n            callback(_selected);\r\n        });\r\n\r\n    _optionsList.addEventListener('mouseleave', e=>{\r\n        _hideOptions();\r\n    });\r\n    _select.addEventListener('click', e=>{\r\n//console.log(_isOptionsDisplayed)\r\n        if (_isOptionsDisplayed){\r\n            _hideOptions();\r\n        }\r\n        else{\r\n            _setOptionsRect();\r\n            _optionsList.style.display = 'block';\r\n            _optionsList.querySelectorAll('.select-options')[_selected].classList.add('selected');\r\n            _arrow.classList.remove('icon-down-open');\r\n            _arrow.classList.add('icon-up-open');\r\n            _isOptionsDisplayed = true;\r\n        }\r\n    });\r\n\r\n    return {dropDownList: _optionsList};\r\n\r\n}","let _clean = function(){  \r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0]){\r\n        scrollCont.empty();\r\n    }\r\n    else{\r\n        this.container.empty();\r\n    }\r\n};\r\n\r\nconst BaseView = function (model) {\r\n    model.view = this;\r\n    this.model = model;\r\n    this.gifLoader = '<img src=\"img/progress.gif\">';\r\n};\r\n\r\nBaseView.prototype = function () {\r\n    return {\r\n        get isActive(){\r\n            return this.frame.is(\":visible\");\r\n        },\r\n        resize: function (clean) {\r\n            if(!this.frame)\r\n                return;\r\n\r\n//console.log($('.iconSidebarControl-pane').height(), this.topOffset, this.bottomOffset)\r\n            let h = $('.iconSidebarControl-pane').height() - this.topOffset - this.bottomOffset;\r\n            // if (this.startScreen){\r\n            //     this.startScreen.height(h);\r\n            //     this.container.css({ position:\"relative\", top: -h+\"px\" });\r\n            // }\r\n            this.container.height(h);\r\n\r\n            if (clean){\r\n                this.container.empty()\r\n            }\r\n        },\r\n        repaint: function(){\r\n            _clean.call(this); \r\n            \r\n            this.inProgress(false);\r\n\r\n            if (!this.model.data)\r\n                return;\r\n\r\n            let scrollCont = this.container.find('.mCSB_container'),\r\n            content = $(\r\n                //Handlebars.compile(this.tableTemplate)(this.model.data)\r\n                this.tableTemplate\r\n            ); \r\n\r\n            if (!scrollCont[0]) {\r\n                this.container.append(content).mCustomScrollbar(this.mcsbOptions);\r\n            }\r\n            else {\r\n                $(scrollCont).append(content);\r\n            }\r\n\r\n        },\r\n        show: function () {\r\n            if (!this.frame)\r\n                return;\r\n            this.frame.show();\r\n            this.model.update();\r\n        },\r\n        hide: function () {\r\n            this.frame.hide();\r\n        },\r\n        get isVisible(){\r\n            const rc = this.frame[0].getBoundingClientRect();\r\n            return rc.width!=0 && rc.height!=0;\r\n        }\r\n    }\r\n}();\r\n\r\nmodule.exports = BaseView;","// extracted by mini-css-extract-plugin","require(\"./TracksView.css\");\r\nrequire(\"../SearchControl.css\");\r\nrequire(\"../SelectControl.css\");\r\nconst BaseView = require('./BaseView.js'),\r\n      Request = require('../Request'),\r\n      Calendar = require('../Calendar'),\r\n      SearchControl = require('../SearchControl'),\r\n      SelectControl = require('../SelectControl');\r\n\r\nconst _toDd = function (D, isLng) {\r\n    let dir = D < 0 ? isLng ? 'W' : 'S' : isLng ? 'E' : 'N',\r\n        deg = Math.round((D < 0 ? D = -D : D) * 1000000) / 1000000\r\n    return deg.toFixed(2) + \" \"//\"°\"\r\n        + dir\r\n};\r\n\r\nconst _searchLayer = 'EE5587AF1F70433AA878462272C0274C',//'CE660F806D164FE58556638D752A4203',\r\n      _selectLayers = [\r\n        {\r\n            name: 'FOS', id: 'ED043040A005429B8F46AAA682BE49C3', sort: 'timestamp',            \r\n            columns: JSON.stringify([{\"Value\":\"mmsi\"},{\"Value\":\"timestamp\"},{\"Value\":\"course\"},{\"Value\":\"speed\"},{\"Value\":\"port_of_destination\"},{\"Value\":\"eta\"},{\"Value\":\"heading\"},{\"Value\":\"lon\"},{\"Value\":\"lat\"}]),\r\n            get vesselQuery() { return `([imo] IN (${_thisView.imo})) and `; },\r\n            get query() { return this.vesselQuery + `'${_thisView.calendar.dateInterval.get('dateBegin').toISOString()}'<=[timestamp] and [timestamp]<'${_thisView.calendar.dateInterval.get('dateEnd').toISOString()}'`;},\r\n            parseData: function(fields, value, getVicon){                             \r\n                let tzOffset = new Date().getTimezoneOffset(), ts = value[fields.indexOf('timestamp')],\r\n                utcDate = new Date((value[fields.indexOf('timestamp')] + tzOffset*60)*1000), locDate =  new Date(value[fields.indexOf('timestamp')]*1000);                \r\n                return {\r\n                    ts: ts,\r\n                    cog: value[fields.indexOf('course')], sog: value[fields.indexOf('speed')],\r\n                    utc_date: utcDate.toLocaleDateString(), utc_time: utcDate.toLocaleTimeString(),\r\n                    local_date: locDate.toLocaleDateString(), local_time: locDate.toLocaleTimeString(),\r\n                    lat: _toDd(value[fields.indexOf('lat')]), lon: _toDd(value[fields.indexOf('lon')], true),\r\n                    latitude: value[fields.indexOf('lat')], longitude: value[fields.indexOf('lon')],\r\n                    vicon: getVicon('Undefined', value[fields.indexOf('course')], value[fields.indexOf('speed')])\r\n                }\r\n\r\n            }\r\n        }, \r\n        {\r\n            name: 'AIS', sort: 'ts_pos_utc', id: '8EE2C7996800458AAF70BABB43321FA4', //'5790ADDFBDD64880BAC95DF13B8327EA', \r\n            columns: JSON.stringify([{\"Value\":\"mmsi\"},{\"Value\":\"flag_country\"},{\"Value\":\"callsign\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"cog\"},{\"Value\":\"sog\"},{\"Value\":\"draught\"},{\"Value\":\"vessel_type\"},{\"Value\":\"destination\"},{\"Value\":\"ts_eta\"},{\"Value\":\"nav_status\"},{\"Value\":\"heading\"},{\"Value\":\"rot\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]),\r\n            get query() {return `([mmsi] IN (${_thisView.mmsi})) and '${_thisView.calendar.dateInterval.get('dateBegin').toISOString()}'<=[ts_pos_utc] and [ts_pos_utc]<'${_thisView.calendar.dateInterval.get('dateEnd').toISOString()}'`;},\r\n            parseData: function(fields, value, getVicon){                             \r\n                let tzOffset = new Date().getTimezoneOffset(), ts = value[fields.indexOf('ts_pos_utc')],\r\n                utcDate = new Date((value[fields.indexOf('ts_pos_utc')] + tzOffset*60)*1000), locDate =  new Date(value[fields.indexOf('timestamp')]*1000);                \r\n                return {\r\n                    ts: ts,\r\n                    cog: value[fields.indexOf('cog')], sog: value[fields.indexOf('sog')],\r\n                    utc_date: utcDate.toLocaleDateString(), utc_time: utcDate.toLocaleTimeString(),\r\n                    local_date: locDate.toLocaleDateString(), local_time: locDate.toLocaleTimeString(),\r\n                    lat: _toDd(value[fields.indexOf('latitude')]), lon: _toDd(value[fields.indexOf('longitude')], true),\r\n                    latitude: value[fields.indexOf('latitude')], longitude: value[fields.indexOf('longitude')],\r\n                    vicon: getVicon(value[fields.indexOf('vessel_type')], value[fields.indexOf('cog')], value[fields.indexOf('sog')])\r\n                }\r\n\r\n            }       \r\n        }\r\n        ];\r\n\r\nlet _thisView, _layer;\r\n\r\nconst TracksView = function ({ model, layer }) {\r\n    _thisView = this;\r\n        BaseView.call(this, model);\r\n\r\n        this.frame = $(Handlebars.compile(`<div class=\"trackexport-view\">\r\n            <div class=\"header\">\r\n                <table border=0 class=\"instruments unselectable\">\r\n                <tr>\r\n                    <td class=\"search_input_container\"></td>\r\n                    <tr>\r\n                        <td class=\"select_container\"></td>\r\n                    </tr>\r\n                </tr>\r\n                </table> \r\n\r\n                <table border=0><tr>\r\n                <td><div class=\"calendar\"></div></td>\r\n                <td style=\"vertical-align: top\"><div class=\"reload\" title=\"${_gtxt('TrackExport.reload')}\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z\"></path></svg></div></td>\r\n                </table></tr> \r\n \r\n            </div> \r\n            <div class=\"refresh\" style=\"display: none; padding-top: 100%;padding-left: 50%;\"><img src=\"img/progress.gif\"></div>\r\n            <div class=\"grid\"></div>\r\n            <div class=\"footer unselectable\">\r\n       \r\n            </div>\r\n            </div>`\r\n        )());\r\n        _addCalendar.call(this);\r\n\r\n        this.trackLayer = _selectLayers[0];\r\n        this.frame.find('.reload').on('click', (e=>{\r\n            let db = _thisView.calendar.dateInterval.get('dateBegin'),\r\n                de = _thisView.calendar.dateInterval.get('dateEnd'),\r\n                daysDiff = Math.ceil((de.getTime() - db.getTime()) / (24*3600000));\r\n//console.log(_thisView.calendar, daysDiff)\r\n            if ((this.mmsi || this.imo) && daysDiff<8) {\r\n                this.model.isDirty = true;\r\n                this.inProgress(true);\r\n                this.show();\r\n            }\r\n            else{\r\n                this.model.free(); \r\n                if(daysDiff>7)\r\n                    this.model.data.msg = [{txt:_gtxt('TrackExport.intervalExceeds')}];\r\n                this.repaint();\r\n            }\r\n        }).bind(this));\r\n\r\n        this.container = this.frame.find('.grid');\r\n        this.footer = this.frame.find('.footer');       \r\n        this.selectLayer = new SelectControl(this.frame.find('.select_container')[0], _selectLayers.map(l=>l.name), 0, selected=>{_thisView.trackLayer = _selectLayers[selected]}); \r\n        this.selectLayer.dropDownList.classList.add('trackexport-view');     \r\n        this.searchInput = new SearchControl({tab:this.frame[0], container:this.frame.find('.search_input_container')[0], \r\n            searcher: {\r\n                searchpromise: function(params){\r\n                    var request =  `layer=${_searchLayer}&columns=[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"vessel_type\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]&orderby=vessel_name&${params[0].name}=${params[0].value}`;\r\n                    return Request.fetchRequest('/Plugins/AIS/SearchShip.ashx', request, 'POST');\r\n                },\r\n                parser: function(response){                \r\n                    if (response.Status && response.Status.toLowerCase()=='ok' && response.Result){                    \r\n                        let columns = response.Result.columns,\r\n                            values = response.Result.values;\r\n                        return values.map(v=>{\r\n                            let rv = {};\r\n                            columns.forEach((c, i)=>{rv[c] = v[i]});\r\n                            return rv;\r\n                        });\r\n                    }\r\n                    else{\r\n                        console.log(response);\r\n                        return [];\r\n                    }\r\n                }\r\n            },\r\n            callback:(v=>{\r\n                if(!v){\r\n                    _thisView.mmsi =  null;\r\n                    _thisView.imo =  null;\r\n                    _thisView.vname = null;\r\n                    _thisView.model.free();\r\n                    _thisView.repaint();\r\n                }\r\n                else{\r\n                    _thisView.mmsi =  v.mmsi;\r\n                    _thisView.imo =  v.imo;\r\n                    _thisView.vname = v.vessel_name;\r\n                }\r\n\r\n            }).bind(this)\r\n        });\r\n\r\n        Object.defineProperty(this, \"tableTemplate\", {\r\n            get: function () {\r\n                let totalPositions = this.model.data.total,\r\n                    rv = (!totalPositions ? `` : `<table class=\"track-table\"><tr>\r\n                        <td></td>\r\n                        <td>\r\n                        <span class='export shape' title=\"${_gtxt(\"TrackExport.export\")}\">shp</span> \r\n                        <span class='export geojson' title=\"${_gtxt(\"TrackExport.export\")}\">geojson</span> \r\n                        <span class='export gpx' title=\"${_gtxt(\"TrackExport.export\")}\">gpx</span> \r\n                        </td>\r\n                        <td><div class=\"track all\"><input type=\"checkbox\" checked title=\"${_gtxt(\"TrackExport.allDailyTracks\")}\"></div></td>\r\n                        <td><div class=\"count\">${totalPositions}</div></td></tr></table>`) +                    \r\n                    this.model.data.tracks.map((t,i) => {\r\n                        return `<table class=\"track-table\" border=\"0\">\r\n                        <tbody><tr>\r\n                        <td><div class=\"open_positions track_${i} ui-helper-noselect icon-right-open ${this.model.data.tracks.length>1 ? 'icon-right-open' : 'icon-down-open'} \" title=\"${_gtxt('TrackExport.positions')}\"></div></td>\r\n                        <td><span class=\"date\">${t.utc_date}</span></td>\r\n                        <td><div class=\"track\"><input type=\"checkbox\" checked title=\"${_gtxt('TrackExport.dailyTrack')}\" id=\"${i}\"></div></td>\r\n                        <td><div class=\"count\">${t.positions.length}</div></td></tr></tbody></table>\r\n\r\n                        <div class=\"track_${i}\" >${_thisView.model.data.tracks.length==1 ? _renderPosTable(i) : \"\"}</div>`;\r\n                    }).join('') +\r\n                    (this.model.data.msg ? this.model.data.msg.map(m => `<div class=\"msg\">${m.txt}</div>`).join('') : '');\r\n                return rv;\r\n            }\r\n        });  \r\n\r\n        Object.defineProperty(this, \"topOffset\", {\r\n            get: function () { \r\n                return this.frame.find('.header')[0].getBoundingClientRect().height;\r\n            }\r\n        });  \r\n        Object.defineProperty(this, \"bottomOffset\", {\r\n            get: function () {             \r\n                return this.frame.find('.footer')[0].getBoundingClientRect().height;\r\n            }\r\n        }); \r\n    }, \r\n    _renderPosTable = function(i){\r\n        let t = _thisView.model.data.tracks[i];\r\n            return `<table class=\"positions-table\"><tbody>` +\r\n            t.positions.map((p,j) => { return `<tr>                \r\n            <td><span class=\"utc_time\">${p.utc_time}</span><span class=\"local_time\">${p.local_time}</span></td>\r\n            <td><span class=\"utc_date\">${t.utc_date}</span><span class=\"local_date\">${p.local_date}</span></td>\r\n            <td>${p.lon}&nbsp;&nbsp;${p.lat}</td>\r\n            <td>${p.vicon ? p.vicon.svg : ''}</td><td></td>\r\n            <td><div class=\"show_pos\" id=\"${i}_${j}\" title=\"${_gtxt('TrackExport.position')}\"><img src=\"plugins/AIS/AISSearch/svg/center.svg\"></div></td>\r\n            </tr>\r\n            <tr><td colspan=\"6\" class=\"more\"><hr><div class=\"vi_more\"></div></td></tr>`;}).join('') + \r\n            `</tbody></table>`;\r\n    },\r\n    _addCalendar = function(){            \r\n        const calendar = this.frame.find('.calendar')[0];\r\n        // walkaround with focus at first input in ui-dialog\r\n        calendar.innerHTML = ('<span class=\"ui-helper-hidden-accessible\"><input type=\"text\"/></span>');\r\n\r\n        const mapDateInterval = nsGmx.widgets.commonCalendar.getDateInterval(),\r\n              dateInterval = new nsGmx.DateInterval(),\r\n              msd = 24*3600000;\r\n    \r\n        dateInterval\r\n            .set('dateBegin', mapDateInterval.get('dateBegin'))\r\n            .set('dateEnd', mapDateInterval.get('dateEnd'))\r\n            .on('change', function (e) {\r\n                let d = new Date(e.attributes.dateEnd.getTime() - msd*7);\r\n                _thisView.calendar._dateInputs.datepicker('option', 'minDate', d);\r\n                if (e.attributes.dateBegin.getTime()<d.getTime())\r\n                    e.attributes.dateBegin = new Date(d.getTime());\r\n// console.log(d)\r\n// console.log(_thisView.calendar.dateInterval.get('dateBegin'))\r\n            });\r\n\r\n        this.calendar = new Calendar({\r\n            dateInterval: dateInterval,\r\n            name: 'catalogInterval',\r\n            container: calendar,\r\n            dateMin: new Date(nsGmx.DateInterval.getUTCDayBoundary().dateBegin.getTime() - msd*6),\r\n            //dateMax: new Date(),\r\n            dateFormat: 'dd.mm.yy',\r\n            minimized: false,\r\n            showSwitcher: false\r\n        });\r\n\r\n        let tr = calendar.querySelector('tr:nth-of-type(1)');\r\n        tr.insertCell(2).innerHTML = '&nbsp; - &nbsp;';\r\n        tr.insertCell(6).innerHTML = \r\n        '<img class=\"default_date\" style=\"cursor:pointer; padding:10px\" title=\"'+_gtxt('TrackExport.calendar_today')+'\" src=\"plugins/AIS/AISSearch/svg/calendar.svg\">';\r\n        calendar.querySelector('.default_date').addEventListener('click', () => {\r\n            let db = nsGmx.DateInterval.getUTCDayBoundary(new Date());\r\n            dateInterval.set({\r\n                dateBegin: db.dateBegin,\r\n                dateEnd: db.dateEnd\r\n            });\r\n        });\r\n    },\r\n    _clean = function () {\r\n        this.frame.find('.open_positions').off('click', _onOpenPosClick);\r\n        this.frame.find('.track-table .track:not(\".all\") input').off('click', _onShowTrack),\r\n        this.frame.find('.track-table .track.all input').off('click', _onShowAllTracks),\r\n        this.frame.find('.show_pos').off('click', _onShowPos);\r\n        this.frame.find('.track-table .export').off('click', _onExport);\r\n    };\r\n\r\nTracksView.prototype = Object.create(BaseView.prototype);\r\n\r\nTracksView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('div.refresh'), grid = this.frame.find('div.grid');\r\n    if (state){\r\n        grid.hide();\r\n        progress.show();\r\n    }\r\n    else{\r\n        progress.hide();\r\n        grid.show();\r\n    }\r\n};\r\n\r\n// TracksView.prototype.resize = function () { \r\n//     let h = $('.iconSidebarControl-pane').height() - this.frame.find('.instruments').outerHeight()\r\n//     - this.frame.find('.results').outerHeight() - this.frame.find('.menu').outerHeight();\r\n//     this.container.height(h+1);\r\n// };\r\n\r\nconst _onOpenPosClick = function(e){\r\n        let icon = $(e.target), id;\r\n        for (var i=0; e.target.classList[i]; ++i){\r\n            if (e.target.classList[i].search(/track_/)!=-1){\r\n                id = e.target.classList[i];\r\n                break;\r\n            }\r\n        }\r\n        if (icon.is('.icon-down-open')) {\r\n            icon.removeClass('icon-down-open').addClass('.icon-right-open');\r\n            if(id){\r\n                let div = $(`.${id}:not(.open_positions)`);\r\n                div.hide();\r\n                if (id!='track_0'){\r\n                    div.find('.show_pos').off('click', _onShowPos);\r\n                    div.html('');\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            icon.addClass('icon-down-open').removeClass('.icon-right-open');\r\n            if (id){\r\n                let div = $(`.${id}:not(.open_positions)`);\r\n                if (!$(`.${id} .positions-table`)[0]){\r\n                    div.html(_renderPosTable(parseInt(id.split('_')[1])));\r\n                    div.find('.show_pos').on('click', _onShowPos);\r\n                }\r\n                div.show(); \r\n            }                \r\n        }\r\n    }, \r\n    _onShowAllTracks = function(e){\r\n        let showTrack = _thisView.frame.find('.track-table .track:not(\".all\") input'),\r\n            showAllTracks = _thisView.frame.find('.track-table .track.all input'); \r\n        showTrack.each((i, el)=>{\r\n            el.checked = showAllTracks[0].checked;\r\n            if (showAllTracks[0].checked)\r\n                _thisView.model.drawTrack(el.id);\r\n            else\r\n                _thisView.model.eraseTrack(el.id);\r\n        });\r\n    },\r\n    _onShowTrack = function(e){\r\n        let showTrack = _thisView.frame.find('.track-table .track:not(\".all\") input'),\r\n            showAllTracks = _thisView.frame.find('.track-table .track.all input'); \r\n        let id = parseInt(e.currentTarget.id);\r\n        if (e.currentTarget.checked)\r\n            _thisView.model.drawTrack(id);\r\n        else\r\n            _thisView.model.eraseTrack(id);\r\n\r\n        let checkAll = true;\r\n        showTrack.each((i, el)=>{checkAll = checkAll && el.checked});\r\n        showAllTracks[0].checked = checkAll;\r\n    },\r\n    _onShowPos = function(e){\r\n        let ij = e.currentTarget.id.split('_'), pos = _thisView.model.data.tracks[ij[0]].positions[ij[1]];\r\n        //_thisView.model.fitToTrack(ij[0]);\r\n        nsGmx.leafletMap.setView([pos.latitude, pos.longitude]);\r\n    },\r\n    _onExport = function(e){\r\n        let type = e.currentTarget.className.replace(/export */, ''),\r\n        tracks = _thisView.model.data.tracks,\r\n        trackLine = tracks.reduce((p,c)=>{\r\n            c.positions.forEach(pos=>p.push([pos.longitude, pos.latitude])); \r\n            return p;\r\n        }, []),\r\n        features = [{geometry:L.gmxUtil.geometryToGeoJSON({type:'LINESTRING', coordinates:trackLine})}];\r\n        let getFilename = function(){\r\n            let spart = tracks[0].utc_date, //`${s.getFullYear()}_${s.getMonth()+1}_${s.getDate()}`,\r\n            epart = tracks.length>1 ? '_' +  tracks[tracks.length-1].utc_date: ''; //tracks.length>1 ? `_${e.getFullYear()}_${e.getMonth()+1}_${e.getDate()}` : '';\r\n            return `${_thisView.vname}_${spart}${epart}`.replace(/[!\\?\\:<>\"'#]/g, '').replace(/[ \\.\\/\\\\-]/g, '_');\r\n        }\r\n        nsGmx.Utils.downloadGeometry(features, {fileName: getFilename(), format: type}); \r\n//console.log(features, {fileName: `${_thisView.vname}_${tracks[0].utc_date}${tracks.length>1?'_' + tracks[tracks.length-1].utc_date:''}`.replace(/ |\\./g, '_'), format: type,});\r\n    };\r\n\r\nTracksView.prototype.repaint = function () { \r\n    _clean.call(this);\r\n    BaseView.prototype.repaint.call(this);      \r\n    \r\n    this.frame.find('.open_positions').on('click', _onOpenPosClick);\r\n    this.frame.find('.track-table .track:not(\".all\") input').on('click', _onShowTrack);\r\n    this.frame.find('.track-table .track.all input').on('click', _onShowAllTracks);\r\n    this.frame.find('.track-table .export').on('click', _onExport);\r\n\r\n    this.frame.find('.track_0 .positions-table .show_pos').on('click', _onShowPos);\r\n};\r\n\r\nTracksView.prototype.show = function () {\r\n    if (!this.frame)\r\n        return;\r\n\r\n    this.searchInput.focus();\r\n    BaseView.prototype.show.apply(this, arguments);\r\n};\r\n\r\nmodule.exports = TracksView;\r\n","const MyCollectionView = require('./Views/TracksView'),\r\n      MyCollectionModel = require('./Models/TracksModel');\r\nmodule.exports = function (options) {   \r\n    const _mcm = new MyCollectionModel({layer: options.layer}),\r\n          _mcv = new MyCollectionView({model:_mcm, layer: options.layer}); \r\n    return {\r\n        create: function () {\r\n            return [_mcv];\r\n        }\r\n    };\r\n}","// extracted by mini-css-extract-plugin","require(\"./all.css\");\r\nrequire(\"./locale.js\");\r\n\r\nconst pluginName = 'TrackExportPlugin',\r\n      menuId = 'TrackExportPlugin',\r\n      toolbarIconId = null, \r\n      cssTable = 'TrackExportPlugin',\r\n      modulePath = gmxCore.getModulePath(pluginName);\r\n\r\nconst PluginPanel = require('./PluginPanel.js'),\r\n      ViewsFactory = require('./ViewsFactory');\r\n\r\nconst publicInterface = {\r\n    pluginName: pluginName,\r\n    afterViewer: function (params, map) {\r\n        const options = {\r\n                modulePath: modulePath,\r\n                layer: params.layer\r\n            },\r\n            viewFactory = new ViewsFactory(options),\r\n            pluginPanel = new PluginPanel(viewFactory);\r\n        pluginPanel.menuId = menuId;\r\n\r\n        let sidebar = window.iconSidebarWidget,\r\n        tab = window.createTabFunction({\r\n                    icon: \"TrackExport\", //menuId,\r\n                    active: \"hardnav-sidebar-icon\",\r\n                    inactive: \"hardnav-sidebar-icon\",\r\n                    hint: _gtxt('TrackExport.title')\r\n                })()\r\n\r\n        let tabDiv = tab.querySelector('.TrackExport');\r\n        pluginPanel.sidebarPane = sidebar.setPane(\r\n            menuId, {\r\n                createTab: ()=>{      \r\n                    !tab.querySelector('.TrackExport') && tab.append(tabDiv);  \r\n                     tab.querySelector('.TrackExport').innerHTML = `<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1\" viewBox=\"0 0 24 24\" style=\"height: 18px;width: 18px;\">\r\n                     <path d=\"M 20 2 C 18.970152 2 18.141273 2.7807107 18.03125 3.78125 L 14.5625 4.78125 C 14.19654 4.3112749 13.641793 4 13 4 C 11.895431 4 11 4.8954305 11 6 C 11 7.1045695 11.895431 8 13 8 C 13.052792 8 13.104488 8.0040159 13.15625 8 L 16.53125 14.6875 C 16.440877 14.788724 16.349735 14.881869 16.28125 15 L 11.9375 14.46875 C 11.705723 13.620636 10.921625 13 10 13 C 8.8954305 13 8 13.895431 8 15 C 8 15.217462 8.0295736 15.428987 8.09375 15.625 L 4.96875 18.25 C 4.6825722 18.092012 4.3500149 18 4 18 C 2.8954305 18 2 18.895431 2 20 C 2 21.104569 2.8954305 22 4 22 C 5.1045695 22 6 21.104569 6 20 C 6 19.782538 5.9704264 19.571013 5.90625 19.375 L 9.03125 16.75 C 9.3174278 16.907988 9.6499851 17 10 17 C 10.754554 17 11.409413 16.585686 11.75 15.96875 L 16.0625 16.53125 C 16.294277 17.379364 17.078375 18 18 18 C 19.104569 18 20 17.104569 20 16 C 20 14.895431 19.104569 14 18 14 C 17.947208 14 17.895512 13.995984 17.84375 14 L 14.5 7.3125 C 14.761761 7.0130168 14.922918 6.6355416 14.96875 6.21875 L 18.4375 5.21875 C 18.80346 5.6887251 19.358207 6 20 6 C 21.104569 6 22 5.1045695 22 4 C 22 2.8954305 21.104569 2 20 2 z\" style=\"&#10;\"/>\r\n                 </svg>`;\r\n                    return tab;\r\n                }\r\n            }\r\n        )\r\n        sidebar.addEventListener('opened', function (e) {\r\n            if (sidebar._activeTabId == menuId)\r\n                pluginPanel.show();\r\n        });\r\n    }\r\n};\r\n\r\ngmxCore.addModule(pluginName, publicInterface, {\r\n    css: cssTable + '.css'\r\n});\r\n","\r\n    _translationsHash.addtext('rus', {\r\n        \"TrackExport.title\": \"Треки судов\",\r\n\r\n        \"TrackExport.calendar_today\": \"сегодня\",\r\n        \"TrackExport.nodata\": \"Нет данных\",\r\n        \"TrackExport.reload\": \"Загрузить/Обновить\",\r\n        \"TrackExport.allDailyTracks\":\"все треки\",\r\n        \"TrackExport.dailyTrack\":\"трек за сутки\",\r\n        \"TrackExport.positions\":\"положение судна\",\r\n        \"TrackExport.position\":\"показать\",\r\n        \"TrackExport.export\":\"экспорт\",\r\n        \"TrackExport.km\":\"км\",\r\n        \"TrackExport.kn\":\"уз\",\r\n        \"TrackExport.intervalExceeds\":\"Интервал больше 7 дней\",\r\n        \r\n    });\r\n    _translationsHash.addtext('eng', {\r\n        \"TrackExport.title\": \"Vessel tracks\",\r\n\r\n        \"TrackExport.calendar_today\": \"today\",\r\n        \"TrackExport.nodata\": \"No data\",\r\n        \"TrackExport.reload\": \"Load/Update\",\r\n        \"TrackExport.allDailyTracks\":\"whole track\",\r\n        \"TrackExport.dailyTrack\":\"daily track\",\r\n        \"TrackExport.positions\":\"vessel positions\",\r\n        \"TrackExport.position\":\"position\",\r\n        \"TrackExport.export\":\"export\",\r\n        \"TrackExport.km\":\"km\",\r\n        \"TrackExport.kn\":\"kn\",\r\n        \"TrackExport.intervalExceeds\":\"Interval exceeds 7 days\",\r\n    });\r\n"],"sourceRoot":""}