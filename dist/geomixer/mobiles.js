(function () {
var define = null;
var buildDate = '2018-7-18 10:24:02';
var buildUUID = '4fdd711b66e84175994b26eb47666b4e';
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ES6Promise=e()}(this,function(){"use strict";function t(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}function e(t){return"function"==typeof t}function i(t){q=t}function n(t){W=t}function o(){return function(){return process.nextTick(h)}}function r(){return"undefined"!=typeof V?function(){V(h)}:l()}function s(){var t=0,e=new X(h),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function a(){var t=new MessageChannel;return t.port1.onmessage=h,function(){return t.port2.postMessage(0)}}function l(){var t=setTimeout;return function(){return t(h,1)}}function h(){for(var t=0;t<H;t+=2){var e=$[t],i=$[t+1];e(i),$[t]=void 0,$[t+1]=void 0}H=0}function u(){try{var t=require,e=t("vertx");return V=e.runOnLoop||e.runOnContext,r()}catch(i){return l()}}function c(t,e){var i=arguments,n=this,o=new this.constructor(p);void 0===o[et]&&E(o);var r=n._state;return r?!function(){var t=i[r-1];W(function(){return k(r,o,t,n._result)})}():w(n,o,t,e),o}function d(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(p);return b(i,t),i}function p(){}function m(){return new TypeError("You cannot resolve a promise with itself")}function f(){return new TypeError("A promises callback cannot return that same promise.")}function _(t){try{return t.then}catch(e){return rt.error=e,rt}}function g(t,e,i,n){try{t.call(e,i,n)}catch(o){return o}}function v(t,e,i){W(function(t){var n=!1,o=g(i,e,function(i){n||(n=!0,e!==i?b(t,i):L(t,i))},function(e){n||(n=!0,T(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&o&&(n=!0,T(t,o))},t)}function y(t,e){e._state===nt?L(t,e._result):e._state===ot?T(t,e._result):w(e,void 0,function(e){return b(t,e)},function(e){return T(t,e)})}function x(t,i,n){i.constructor===t.constructor&&n===c&&i.constructor.resolve===d?y(t,i):n===rt?(T(t,rt.error),rt.error=null):void 0===n?L(t,i):e(n)?v(t,i,n):L(t,i)}function b(e,i){e===i?T(e,m()):t(i)?x(e,i,_(i)):L(e,i)}function P(t){t._onerror&&t._onerror(t._result),S(t)}function L(t,e){t._state===it&&(t._result=e,t._state=nt,0!==t._subscribers.length&&W(S,t))}function T(t,e){t._state===it&&(t._state=ot,t._result=e,W(P,t))}function w(t,e,i,n){var o=t._subscribers,r=o.length;t._onerror=null,o[r]=e,o[r+nt]=i,o[r+ot]=n,0===r&&t._state&&W(S,t)}function S(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,o=void 0,r=t._result,s=0;s<e.length;s+=3)n=e[s],o=e[s+i],n?k(i,n,o,r):o(r);t._subscribers.length=0}}function M(){this.error=null}function I(t,e){try{return t(e)}catch(i){return st.error=i,st}}function k(t,i,n,o){var r=e(n),s=void 0,a=void 0,l=void 0,h=void 0;if(r){if(s=I(n,o),s===st?(h=!0,a=s.error,s.error=null):l=!0,i===s)return void T(i,f())}else s=o,l=!0;i._state!==it||(r&&l?b(i,s):h?T(i,a):t===nt?L(i,s):t===ot&&T(i,s))}function C(t,e){try{e(function(e){b(t,e)},function(e){T(t,e)})}catch(i){T(t,i)}}function O(){return at++}function E(t){t[et]=at++,t._state=void 0,t._result=void 0,t._subscribers=[]}function z(t,e){this._instanceConstructor=t,this.promise=new t(p),this.promise[et]||E(this.promise),j(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&L(this.promise,this._result))):T(this.promise,A())}function A(){return new Error("Array Methods must be provided an Array")}function D(t){return new z(this,t).promise}function R(t){var e=this;return new e(j(t)?function(i,n){for(var o=t.length,r=0;r<o;r++)e.resolve(t[r]).then(i,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function B(t){var e=this,i=new e(p);return T(i,t),i}function N(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function Z(t){this[et]=O(),this._result=this._state=void 0,this._subscribers=[],p!==t&&("function"!=typeof t&&N(),this instanceof Z?C(this,t):F())}function U(){var t=void 0;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=t.Promise;if(i){var n=null;try{n=Object.prototype.toString.call(i.resolve())}catch(e){}if("[object Promise]"===n&&!i.cast)return}t.Promise=Z}var G=void 0;G=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var j=G,H=0,V=void 0,q=void 0,W=function(t,e){$[H]=t,$[H+1]=e,H+=2,2===H&&(q?q(h):tt())},K="undefined"!=typeof window?window:void 0,Y=K||{},X=Y.MutationObserver||Y.WebKitMutationObserver,J="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Q="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3),tt=void 0;tt=J?o():X?s():Q?a():void 0===K&&"function"==typeof require?u():l();var et=Math.random().toString(36).substring(16),it=void 0,nt=1,ot=2,rt=new M,st=new M,at=0;return z.prototype._enumerate=function(t){for(var e=0;this._state===it&&e<t.length;e++)this._eachEntry(t[e],e)},z.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===d){var o=_(t);if(o===c&&t._state!==it)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(i===Z){var r=new i(p);x(r,t,o),this._willSettleAt(r,e)}else this._willSettleAt(new i(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},z.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===it&&(this._remaining--,t===ot?T(n,i):this._result[e]=i),0===this._remaining&&L(n,this._result)},z.prototype._willSettleAt=function(t,e){var i=this;w(t,void 0,function(t){return i._settledAt(nt,e,t)},function(t){return i._settledAt(ot,e,t)})},Z.all=D,Z.race=R,Z.resolve=d,Z.reject=B,Z._setScheduler=i,Z._setAsap=n,Z._asap=W,Z.prototype={constructor:Z,then:c,"catch":function(t){return this.then(null,t)}},Z.polyfill=U,Z.Promise=Z,Z.polyfill(),Z}),function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function i(t){return"string"!=typeof t&&(t=String(t)),t}function n(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return g.iterable&&(e[Symbol.iterator]=function(){return e}),e}function o(t){this.map={},t instanceof o?t.forEach(function(t,e){this.append(e,t)},this):Array.isArray(t)?t.forEach(function(t){this.append(t[0],t[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function r(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function s(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function a(t){var e=new FileReader,i=s(e);return e.readAsArrayBuffer(t),i}function l(t){var e=new FileReader,i=s(e);return e.readAsText(t),i}function h(t){for(var e=new Uint8Array(t),i=new Array(e.length),n=0;n<e.length;n++)i[n]=String.fromCharCode(e[n]);return i.join("")}function u(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function c(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,t)if("string"==typeof t)this._bodyText=t;else if(g.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(g.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(g.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(g.arrayBuffer&&g.blob&&y(t))this._bodyArrayBuffer=u(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!g.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t)&&!x(t))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=u(t)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):g.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},g.blob&&(this.blob=function(){var t=r(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?r(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var t=r(this);if(t)return t;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(h(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(t){var e=t.toUpperCase();return b.indexOf(e)>-1?e:t}function p(t,e){e=e||{};var i=e.body;if(t instanceof p){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new o(t.headers)),this.method=t.method,this.mode=t.mode,i||null==t._bodyInit||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new o(e.headers)),this.method=d(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function m(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),o=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(o))}}),e}function f(t){var e=new o,i=t.replace(/\r?\n[\t ]+/g," ");return i.split(/\r?\n/).forEach(function(t){var i=t.split(":"),n=i.shift().trim();if(n){var o=i.join(":").trim();e.append(n,o)}}),e}function _(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new o(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var g={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};if(g.arrayBuffer)var v=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],y=function(t){return t&&DataView.prototype.isPrototypeOf(t)},x=ArrayBuffer.isView||function(t){return t&&v.indexOf(Object.prototype.toString.call(t))>-1};o.prototype.append=function(t,n){t=e(t),n=i(n);var o=this.map[t];this.map[t]=o?o+","+n:n},o.prototype["delete"]=function(t){delete this.map[e(t)]},o.prototype.get=function(t){return t=e(t),this.has(t)?this.map[t]:null},o.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},o.prototype.set=function(t,n){this.map[e(t)]=i(n)},o.prototype.forEach=function(t,e){for(var i in this.map)this.map.hasOwnProperty(i)&&t.call(e,this.map[i],i,this)},o.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),n(t)},o.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),n(t)},o.prototype.entries=function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),n(t)},g.iterable&&(o.prototype[Symbol.iterator]=o.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];p.prototype.clone=function(){return new p(this,{body:this._bodyInit})},c.call(p.prototype),c.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new o(this.headers),url:this.url})},_.error=function(){var t=new _(null,{status:0,statusText:""});return t.type="error",t};var P=[301,302,303,307,308];_.redirect=function(t,e){if(P.indexOf(e)===-1)throw new RangeError("Invalid status code");return new _(null,{status:e,headers:{location:t}})},t.Headers=o,t.Request=p,t.Response=_,t.fetch=function(t,e){return new Promise(function(i,n){var o=new p(t,e),r=new XMLHttpRequest;r.onload=function(){var t={status:r.status,statusText:r.statusText,headers:f(r.getAllResponseHeaders()||"")};t.url="responseURL"in r?r.responseURL:t.headers.get("X-Request-URL");var e="response"in r?r.response:r.responseText;i(new _(e,t))},r.onerror=function(){n(new TypeError("Network request failed"))},r.ontimeout=function(){n(new TypeError("Network request failed"))},r.open(o.method,o.url,!0),"include"===o.credentials?r.withCredentials=!0:"omit"===o.credentials&&(r.withCredentials=!1),"responseType"in r&&g.blob&&(r.responseType="blob"),o.headers.forEach(function(t,e){r.setRequestHeader(e,t)}),r.send("undefined"==typeof o._bodyInit?null:o._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.L={})}(this,function(t){"use strict";function e(t){var e,i,n,o;for(i=1,n=arguments.length;i<n;i++){o=arguments[i];for(e in o)t[e]=o[e]}return t}function i(t,e){var i=Array.prototype.slice;if(t.bind)return t.bind.apply(t,i.call(arguments,1));var n=i.call(arguments,2);return function(){return t.apply(e,n.length?n.concat(i.call(arguments)):arguments)}}function n(t){return t._leaflet_id=t._leaflet_id||++me,t._leaflet_id}function o(t,e,i){var n,o,r,s;return s=function(){n=!1,o&&(r.apply(i,o),o=!1)},r=function(){n?o=arguments:(t.apply(i,arguments),setTimeout(s,e),n=!0)}}function r(t,e,i){var n=e[1],o=e[0],r=n-o;return t===n&&i?t:((t-o)%r+r)%r+o}function s(){return!1}function a(t,e){var i=Math.pow(10,void 0===e?6:e);return Math.round(t*i)/i}function l(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function h(t){return l(t).split(/\s+/)}function u(t,e){t.hasOwnProperty("options")||(t.options=t.options?pe(t.options):{});for(var i in e)t.options[i]=e[i];return t.options}function c(t,e,i){var n=[];for(var o in t)n.push(encodeURIComponent(i?o.toUpperCase():o)+"="+encodeURIComponent(t[o]));return(e&&e.indexOf("?")!==-1?"&":"?")+n.join("&")}function d(t,e){return t.replace(fe,function(t,i){var n=e[i];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(e)),n})}function p(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return i;return-1}function m(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}function f(t){var e=+new Date,i=Math.max(0,16-(e-ve));return ve=e+i,window.setTimeout(t,i)}function _(t,e,n){return n&&ye===f?void t.call(e):ye.call(window,i(t,e))}function g(t){t&&xe.call(window,t)}function v(){}function y(t){if("undefined"!=typeof L&&L&&L.Mixin){t=_e(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}function x(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e}function b(t,e,i){return t instanceof x?t:_e(t)?new x(t[0],t[1]):void 0===t||null===t?t:"object"==typeof t&&"x"in t&&"y"in t?new x(t.x,t.y):new x(t,e,i)}function P(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])}function T(t,e){return!t||t instanceof P?t:new P(t,e)}function w(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;n<o;n++)this.extend(i[n])}function S(t,e){return t instanceof w?t:new w(t,e)}function M(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,void 0!==i&&(this.alt=+i)}function I(t,e,i){return t instanceof M?t:_e(t)&&"object"!=typeof t[0]?3===t.length?new M(t[0],t[1],t[2]):2===t.length?new M(t[0],t[1]):null:void 0===t||null===t?t:"object"==typeof t&&"lat"in t?new M(t.lat,"lng"in t?t.lng:t.lon,t.alt):void 0===e?null:new M(t,e,i)}function k(t,e,i,n){return _e(t)?(this._a=t[0],this._b=t[1],this._c=t[2],void(this._d=t[3])):(this._a=t,this._b=e,this._c=i,void(this._d=n))}function C(t,e,i,n){return new k(t,e,i,n)}function O(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function E(t,e){var i,n,o,r,s,a,l="";for(i=0,o=t.length;i<o;i++){for(s=t[i],n=0,r=s.length;n<r;n++)a=s[n],l+=(n?"L":"M")+a.x+" "+a.y;l+=e?ui?"z":"x":""}return l||"M0 0"}function z(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}function A(t,e,i,n){return"touchstart"===e?R(t,i,n):"touchmove"===e?U(t,i,n):"touchend"===e&&G(t,i,n),this}function D(t,e,i){var n=t["_leaflet_"+e+i];return"touchstart"===e?t.removeEventListener(pi,n,!1):"touchmove"===e?t.removeEventListener(mi,n,!1):"touchend"===e&&(t.removeEventListener(fi,n,!1),t.removeEventListener(_i,n,!1)),this}function R(t,e,n){var o=i(function(t){if("mouse"!==t.pointerType&&t.MSPOINTER_TYPE_MOUSE&&t.pointerType!==t.MSPOINTER_TYPE_MOUSE){if(!(gi.indexOf(t.target.tagName)<0))return;Q(t)}Z(t,e)});t["_leaflet_touchstart"+n]=o,t.addEventListener(pi,o,!1),yi||(document.documentElement.addEventListener(pi,B,!0),document.documentElement.addEventListener(mi,N,!0),document.documentElement.addEventListener(fi,F,!0),document.documentElement.addEventListener(_i,F,!0),yi=!0)}function B(t){vi[t.pointerId]=t,xi++}function N(t){vi[t.pointerId]&&(vi[t.pointerId]=t)}function F(t){delete vi[t.pointerId],xi--}function Z(t,e){t.touches=[];for(var i in vi)t.touches.push(vi[i]);t.changedTouches=[t],e(t)}function U(t,e,i){var n=function(t){(t.pointerType!==t.MSPOINTER_TYPE_MOUSE&&"mouse"!==t.pointerType||0!==t.buttons)&&Z(t,e)};t["_leaflet_touchmove"+i]=n,t.addEventListener(mi,n,!1)}function G(t,e,i){var n=function(t){Z(t,e)};t["_leaflet_touchend"+i]=n,t.addEventListener(fi,n,!1),t.addEventListener(_i,n,!1)}function j(t,e,i){function n(t){var e;if(oi){if(!Be||"mouse"===t.pointerType)return;e=xi}else e=t.touches.length;if(!(e>1)){var i=Date.now(),n=i-(r||i);s=t.touches?t.touches[0]:t,a=n>0&&n<=l,r=i}}function o(t){if(a&&!s.cancelBubble){if(oi){if(!Be||"mouse"===t.pointerType)return;var i,n,o={};for(n in s)i=s[n],o[n]=i&&i.bind?i.bind(s):i;s=o}s.type="dblclick",e(s),r=null}}var r,s,a=!1,l=250;return t[Li+bi+i]=n,t[Li+Pi+i]=o,t[Li+"dblclick"+i]=e,t.addEventListener(bi,n,!1),t.addEventListener(Pi,o,!1),t.addEventListener("dblclick",e,!1),this}function H(t,e){var i=t[Li+bi+e],n=t[Li+Pi+e],o=t[Li+"dblclick"+e];return t.removeEventListener(bi,i,!1),t.removeEventListener(Pi,n,!1),Be||t.removeEventListener("dblclick",o,!1),this}function V(t,e,i,n){if("object"==typeof e)for(var o in e)W(t,o,e[o],i);else{e=h(e);for(var r=0,s=e.length;r<s;r++)W(t,e[r],i,n)}return this}function q(t,e,i,n){if("object"==typeof e)for(var o in e)K(t,o,e[o],i);else if(e){e=h(e);for(var r=0,s=e.length;r<s;r++)K(t,e[r],i,n)}else{for(var a in t[Ti])K(t,a,t[Ti][a]);delete t[Ti]}return this}function W(t,e,i,o){var r=e+n(i)+(o?"_"+n(o):"");if(t[Ti]&&t[Ti][r])return this;var s=function(e){return i.call(o||t,e||window.event)},a=s;oi&&0===e.indexOf("touch")?A(t,e,s,r):!ri||"dblclick"!==e||!j||oi&&He?"addEventListener"in t?"mousewheel"===e?t.addEventListener("onwheel"in t?"wheel":"mousewheel",s,!1):"mouseenter"===e||"mouseleave"===e?(s=function(e){e=e||window.event,ot(t,e)&&a(e)},t.addEventListener("mouseenter"===e?"mouseover":"mouseout",s,!1)):("click"===e&&Fe&&(s=function(t){rt(t,a)}),t.addEventListener(e,s,!1)):"attachEvent"in t&&t.attachEvent("on"+e,s):j(t,s,r),t[Ti]=t[Ti]||{},t[Ti][r]=s}function K(t,e,i,o){var r=e+n(i)+(o?"_"+n(o):""),s=t[Ti]&&t[Ti][r];return s?(oi&&0===e.indexOf("touch")?D(t,e,r):!ri||"dblclick"!==e||!H||oi&&He?"removeEventListener"in t?"mousewheel"===e?t.removeEventListener("onwheel"in t?"wheel":"mousewheel",s,!1):t.removeEventListener("mouseenter"===e?"mouseover":"mouseleave"===e?"mouseout":e,s,!1):"detachEvent"in t&&t.detachEvent("on"+e,s):H(t,r),void(t[Ti][r]=null)):this}function Y(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,nt(t),this}function X(t){return W(t,"mousewheel",Y),this}function J(t){return V(t,"mousedown touchstart dblclick",Y),W(t,"click",it),this}function Q(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function $(t){return Q(t),Y(t),this}function tt(t,e){if(!e)return new x(t.clientX,t.clientY);var i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1;return new x(t.clientX/n-i.left-e.clientLeft,t.clientY/o-i.top-e.clientTop)}function et(t){return Be?t.wheelDeltaY/2:t.deltaY&&0===t.deltaMode?-t.deltaY/wi:t.deltaY&&1===t.deltaMode?20*-t.deltaY:t.deltaY&&2===t.deltaMode?60*-t.deltaY:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?20*-t.detail:t.detail?t.detail/-32765*60:0}function it(t){Si[t.type]=!0}function nt(t){var e=Si[t.type];return Si[t.type]=!1,e}function ot(t,e){var i=e.relatedTarget;if(!i)return!0;try{for(;i&&i!==t;)i=i.parentNode}catch(n){return!1}return i!==t}function rt(t,e){var i=t.timeStamp||t.originalEvent&&t.originalEvent.timeStamp,n=Ie&&i-Ie;return n&&n>100&&n<500||t.target._simulatedClick&&!t._simulated?void $(t):(Ie=i,void e(t))}function st(t){return"string"==typeof t?document.getElementById(t):t}function at(t,e){var i=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!i||"auto"===i)&&document.defaultView){var n=document.defaultView.getComputedStyle(t,null);i=n?n[e]:null}return"auto"===i?null:i}function lt(t,e,i){var n=document.createElement(t);return n.className=e||"",i&&i.appendChild(n),n}function ht(t){var e=t.parentNode;e&&e.removeChild(t)}function ut(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function ct(t){var e=t.parentNode;e.lastChild!==t&&e.appendChild(t)}function dt(t){var e=t.parentNode;e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function pt(t,e){if(void 0!==t.classList)return t.classList.contains(e);var i=gt(t);return i.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(i)}function mt(t,e){if(void 0!==t.classList)for(var i=h(e),n=0,o=i.length;n<o;n++)t.classList.add(i[n]);else if(!pt(t,e)){var r=gt(t);_t(t,(r?r+" ":"")+e)}}function ft(t,e){void 0!==t.classList?t.classList.remove(e):_t(t,l((" "+gt(t)+" ").replace(" "+e+" "," ")))}function _t(t,e){void 0===t.className.baseVal?t.className=e:t.className.baseVal=e}function gt(t){return void 0===t.className.baseVal?t.className:t.className.baseVal}function vt(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&yt(t,e)}function yt(t,e){var i=!1,n="DXImageTransform.Microsoft.Alpha";try{i=t.filters.item(n)}catch(o){if(1===e)return}e=Math.round(100*e),i?(i.Enabled=100!==e,i.Opacity=e):t.style.filter+=" progid:"+n+"(opacity="+e+")"}function xt(t){for(var e=document.documentElement.style,i=0;i<t.length;i++)if(t[i]in e)return t[i];return!1}function bt(t,e,i){var n=e||new x(0,0),o=n.x+"px,"+n.y+"px",r=(Xe?"translate("+o+")":"translate3d("+o+", 0)")+(i?" scale("+i+")":"");t._transform!==r&&(t.style[Ii]=t._transform=r)}function Pt(t,e){t._leaflet_pos=e,$e?bt(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function Lt(t){return t._leaflet_pos||new x(0,0)}function Tt(){V(window,"dragstart",Q)}function wt(){q(window,"dragstart",Q)}function St(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(Mt(),Ei=t,zi=t.style.outline,t.style.outline="none",V(window,"keydown",Mt))}function Mt(){Ei&&(Ei.style.outline=zi,Ei=void 0,zi=void 0,q(window,"keydown",Mt))}function It(t,e){return new Ri(t,e)}function kt(t,e){if(!e||!t.length)return t.slice();var i=e*e;return t=At(t,i),t=Et(t,i)}function Ct(t,e,i){return Math.sqrt(Ft(t,e,i,!0))}function Ot(t,e,i){return Ft(t,e,i)}function Et(t,e){var i=t.length,n=typeof Uint8Array!=void 0+""?Uint8Array:Array,o=new n(i);o[0]=o[i-1]=1,zt(t,o,e,0,i-1);var r,s=[];for(r=0;r<i;r++)o[r]&&s.push(t[r]);return s}function zt(t,e,i,n,o){var r,s,a,l=0;for(s=n+1;s<=o-1;s++)a=Ft(t[s],t[n],t[o],!0),a>l&&(r=s,l=a);l>i&&(e[r]=1,zt(t,e,i,n,r),zt(t,e,i,r,o))}function At(t,e){for(var i=[t[0]],n=1,o=0,r=t.length;n<r;n++)Nt(t[n],t[o])>e&&(i.push(t[n]),o=n);return o<r-1&&i.push(t[r-1]),i}function Dt(t,e,i,n,o){var r,s,a,l=n?Ki:Bt(t,i),h=Bt(e,i);for(Ki=h;;){if(!(l|h))return[t,e];if(l&h)return!1;r=l||h,s=Rt(t,e,r,i,o),a=Bt(s,i),r===l?(t=s,l=a):(e=s,h=a)}}function Rt(t,e,i,n,o){var r,s,a=e.x-t.x,l=e.y-t.y,h=n.min,u=n.max;return 8&i?(r=t.x+a*(u.y-t.y)/l,s=u.y):4&i?(r=t.x+a*(h.y-t.y)/l,s=h.y):2&i?(r=u.x,s=t.y+l*(u.x-t.x)/a):1&i&&(r=h.x,s=t.y+l*(h.x-t.x)/a),new x(r,s,o)}function Bt(t,e){var i=0;return t.x<e.min.x?i|=1:t.x>e.max.x&&(i|=2),t.y<e.min.y?i|=4:t.y>e.max.y&&(i|=8),i}function Nt(t,e){var i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function Ft(t,e,i,n){var o,r=e.x,s=e.y,a=i.x-r,l=i.y-s,h=a*a+l*l;return h>0&&(o=((t.x-r)*a+(t.y-s)*l)/h,o>1?(r=i.x,s=i.y):o>0&&(r+=a*o,s+=l*o)),a=t.x-r,l=t.y-s,n?a*a+l*l:new x(r,s)}function Zt(t){return!_e(t[0])||"object"!=typeof t[0][0]&&"undefined"!=typeof t[0][0]}function Ut(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Zt(t)}function Gt(t,e,i){var n,o,r,s,a,l,h,u,c,d=[1,4,2,8];for(o=0,h=t.length;o<h;o++)t[o]._code=Bt(t[o],e);for(s=0;s<4;s++){for(u=d[s],n=[],o=0,h=t.length,r=h-1;o<h;r=o++)a=t[o],l=t[r],a._code&u?l._code&u||(c=Rt(l,a,u,e,i),c._code=Bt(c,e),n.push(c)):(l._code&u&&(c=Rt(l,a,u,e,i),c._code=Bt(c,e),n.push(c)),n.push(a));t=n}return t}function jt(t){return new mn(t)}function Ht(t,e){return new gn(t,e)}function Vt(t,e){return new yn(t,e)}function qt(t,e,i){return new xn(t,e,i)}function Wt(t,e){return new bn(t,e)}function Kt(t,e){return new Pn(t,e)}function Yt(t,e){var i,n,o,r,s="Feature"===t.type?t.geometry:t,a=s?s.coordinates:null,l=[],h=e&&e.pointToLayer,u=e&&e.coordsToLatLng||Xt;if(!a&&!s)return null;switch(s.type){case"Point":return i=u(a),h?h(t,i):new gn(i);case"MultiPoint":for(o=0,r=a.length;o<r;o++)i=u(a[o]),l.push(h?h(t,i):new gn(i));return new dn(l);case"LineString":case"MultiLineString":return n=Jt(a,"LineString"===s.type?0:1,u),new bn(n,e);case"Polygon":case"MultiPolygon":return n=Jt(a,"Polygon"===s.type?1:2,u),new Pn(n,e);case"GeometryCollection":for(o=0,r=s.geometries.length;o<r;o++){var c=Yt({geometry:s.geometries[o],type:"Feature",properties:t.properties},e);c&&l.push(c)}return new dn(l);default:throw new Error("Invalid GeoJSON object.")}}function Xt(t){return new M(t[1],t[0],t[2])}function Jt(t,e,i){for(var n,o=[],r=0,s=t.length;r<s;r++)n=e?Jt(t[r],e-1,i):(i||Xt)(t[r]),o.push(n);return o}function Qt(t,e){return e="number"==typeof e?e:6,void 0!==t.alt?[a(t.lng,e),a(t.lat,e),a(t.alt,e)]:[a(t.lng,e),a(t.lat,e)]}function $t(t,e,i,n){for(var o=[],r=0,s=t.length;r<s;r++)o.push(e?$t(t[r],e-1,i,n):Qt(t[r],n));return!e&&i&&o.push(o[0]),o}function te(t,i){return t.feature?e({},t.feature,{geometry:i}):ee(i)}function ee(t){return"Feature"===t.type||"FeatureCollection"===t.type?t:{type:"Feature",properties:{},geometry:t}}function ie(t,e){return new Ln(t,e)}function ne(t,e,i){return new In(t,e,i)}function oe(t){return new An(t)}function re(t){return new Dn(t)}function se(t,e){return new Rn(t,e)}function ae(t,e){return new Bn(t,e)}function le(t){return hi?new Fn(t):null}function he(t){return ui||ci?new jn(t):null}function ue(t,e){return new Hn(t,e)}var ce="1.3.1+HEAD.fa374e6",de=Object.freeze;Object.freeze=function(t){return t};var pe=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}(),me=0,fe=/\{ *([\w_-]+) *\}/g,_e=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ge="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",ve=0,ye=window.requestAnimationFrame||m("RequestAnimationFrame")||f,xe=window.cancelAnimationFrame||m("CancelAnimationFrame")||m("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)},be=(Object.freeze||Object)({freeze:de,extend:e,create:pe,bind:i,lastId:me,stamp:n,throttle:o,wrapNum:r,falseFn:s,formatNum:a,trim:l,splitWords:h,setOptions:u,getParamString:c,template:d,isArray:_e,indexOf:p,emptyImageUrl:ge,requestFn:ye,cancelFn:xe,requestAnimFrame:_,cancelAnimFrame:g});v.extend=function(t){var i=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=i.__super__=this.prototype,o=pe(n);o.constructor=i,i.prototype=o;for(var r in this)this.hasOwnProperty(r)&&"prototype"!==r&&"__super__"!==r&&(i[r]=this[r]);return t.statics&&(e(i,t.statics),delete t.statics),t.includes&&(y(t.includes),e.apply(null,[o].concat(t.includes)),delete t.includes),o.options&&(t.options=e(pe(o.options),t.options)),e(o,t),o._initHooks=[],o.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=o._initHooks.length;t<e;t++)o._initHooks[t].call(this)}},i},v.include=function(t){return e(this.prototype,t),this},v.mergeOptions=function(t){return e(this.prototype.options,t),this},v.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i),this};var Pe={on:function(t,e,i){if("object"==typeof t)for(var n in t)this._on(n,t[n],e);else{t=h(t);for(var o=0,r=t.length;o<r;o++)this._on(t[o],e,i)}return this},off:function(t,e,i){if(t)if("object"==typeof t)for(var n in t)this._off(n,t[n],e);else{t=h(t);for(var o=0,r=t.length;o<r;o++)this._off(t[o],e,i)}else delete this._events;return this},_on:function(t,e,i){this._events=this._events||{};var n=this._events[t];n||(n=[],this._events[t]=n),i===this&&(i=void 0);for(var o={fn:e,ctx:i},r=n,s=0,a=r.length;s<a;s++)if(r[s].fn===e&&r[s].ctx===i)return;r.push(o)},_off:function(t,e,i){var n,o,r;if(this._events&&(n=this._events[t])){if(!e){for(o=0,r=n.length;o<r;o++)n[o].fn=s;return void delete this._events[t]}if(i===this&&(i=void 0),n)for(o=0,r=n.length;o<r;o++){var a=n[o];if(a.ctx===i&&a.fn===e)return a.fn=s,this._firingCount&&(this._events[t]=n=n.slice()),void n.splice(o,1)}}},fire:function(t,i,n){if(!this.listens(t,n))return this;var o=e({},i,{type:t,target:this,sourceTarget:i&&i.sourceTarget||this});if(this._events){var r=this._events[t];if(r){this._firingCount=this._firingCount+1||1;for(var s=0,a=r.length;s<a;s++){var l=r[s];l.fn.call(l.ctx||this,o)}this._firingCount--}}return n&&this._propagateEvent(o),this},listens:function(t,e){var i=this._events&&this._events[t];if(i&&i.length)return!0;if(e)for(var n in this._eventParents)if(this._eventParents[n].listens(t,e))return!0;return!1},once:function(t,e,n){if("object"==typeof t){for(var o in t)this.once(o,t[o],e);return this}var r=i(function(){this.off(t,e,n).off(t,r,n)},this);return this.on(t,e,n).on(t,r,n)},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[n(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[n(t)],this},_propagateEvent:function(t){for(var i in this._eventParents)this._eventParents[i].fire(t.type,e({layer:t.target,propagatedFrom:t.target},t),!0)}};Pe.addEventListener=Pe.on,Pe.removeEventListener=Pe.clearAllEventListeners=Pe.off,Pe.addOneTimeEventListener=Pe.once,Pe.fireEvent=Pe.fire,Pe.hasEventListeners=Pe.listens;var Le=v.extend(Pe),Te=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};x.prototype={clone:function(){return new x(this.x,this.y)},add:function(t){return this.clone()._add(b(t));
},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(b(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new x(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new x(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Te(this.x),this.y=Te(this.y),this},distanceTo:function(t){t=b(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=b(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=b(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+a(this.x)+", "+a(this.y)+")"}},P.prototype={extend:function(t){return t=b(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new x((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new x(this.min.x,this.max.y)},getTopRight:function(){return new x(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof x?b(t):T(t),t instanceof P?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=T(t);var e=this.min,i=this.max,n=t.min,o=t.max,r=o.x>=e.x&&n.x<=i.x,s=o.y>=e.y&&n.y<=i.y;return r&&s},overlaps:function(t){t=T(t);var e=this.min,i=this.max,n=t.min,o=t.max,r=o.x>e.x&&n.x<i.x,s=o.y>e.y&&n.y<i.y;return r&&s},isValid:function(){return!(!this.min||!this.max)}},w.prototype={extend:function(t){var e,i,n=this._southWest,o=this._northEast;if(t instanceof M)e=t,i=t;else{if(!(t instanceof w))return t?this.extend(I(t)||S(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||o?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),o.lat=Math.max(i.lat,o.lat),o.lng=Math.max(i.lng,o.lng)):(this._southWest=new M(e.lat,e.lng),this._northEast=new M(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,o=Math.abs(e.lng-i.lng)*t;return new w(new M(e.lat-n,e.lng-o),new M(i.lat+n,i.lng+o))},getCenter:function(){return new M((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new M(this.getNorth(),this.getWest())},getSouthEast:function(){return new M(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof M||"lat"in t?I(t):S(t);var e,i,n=this._southWest,o=this._northEast;return t instanceof w?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=o.lat&&e.lng>=n.lng&&i.lng<=o.lng},intersects:function(t){t=S(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),r=o.lat>=e.lat&&n.lat<=i.lat,s=o.lng>=e.lng&&n.lng<=i.lng;return r&&s},overlaps:function(t){t=S(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),r=o.lat>e.lat&&n.lat<i.lat,s=o.lng>e.lng&&n.lng<i.lng;return r&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return!!t&&(t=S(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e))},isValid:function(){return!(!this._southWest||!this._northEast)}},M.prototype={equals:function(t,e){if(!t)return!1;t=I(t);var i=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return i<=(void 0===e?1e-9:e)},toString:function(t){return"LatLng("+a(this.lat,t)+", "+a(this.lng,t)+")"},distanceTo:function(t){return Se.distance(this,I(t))},wrap:function(){return Se.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return S([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new M(this.lat,this.lng,this.alt)}};var we={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),n=this.transformation.transform(e.min,i),o=this.transformation.transform(e.max,i);return new P(n,o)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?r(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?r(t.lat,this.wrapLat,!0):t.lat,n=t.alt;return new M(i,e,n)},wrapLatLngBounds:function(t){var e=t.getCenter(),i=this.wrapLatLng(e),n=e.lat-i.lat,o=e.lng-i.lng;if(0===n&&0===o)return t;var r=t.getSouthWest(),s=t.getNorthEast(),a=new M(r.lat-n,r.lng-o),l=new M(s.lat-n,s.lng-o);return new w(a,l)}},Se=e({},we,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,o=e.lat*i,r=Math.sin((e.lat-t.lat)*i/2),s=Math.sin((e.lng-t.lng)*i/2),a=r*r+Math.cos(n)*Math.cos(o)*s*s,l=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return this.R*l}}),Me={R:6378137,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,i=this.MAX_LATITUDE,n=Math.max(Math.min(i,t.lat),-i),o=Math.sin(n*e);return new x(this.R*t.lng*e,this.R*Math.log((1+o)/(1-o))/2)},unproject:function(t){var e=180/Math.PI;return new M((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return new P([-t,-t],[t,t])}()};k.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new x((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};var Ie,ke,Ce,Oe,Ee=e({},Se,{code:"EPSG:3857",projection:Me,transformation:function(){var t=.5/(Math.PI*Me.R);return C(t,.5,-t,.5)}()}),ze=e({},Ee,{code:"EPSG:900913"}),Ae=document.documentElement.style,De="ActiveXObject"in window,Re=De&&!document.addEventListener,Be="msLaunchUri"in navigator&&!("documentMode"in document),Ne=z("webkit"),Fe=z("android"),Ze=z("android 2")||z("android 3"),Ue=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ge=Fe&&z("Google")&&Ue<537&&!("AudioNode"in window),je=!!window.opera,He=z("chrome"),Ve=z("gecko")&&!Ne&&!je&&!De,qe=!He&&z("safari"),We=z("phantom"),Ke="OTransition"in Ae,Ye=0===navigator.platform.indexOf("Win"),Xe=De&&"transition"in Ae,Je="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ze,Qe="MozPerspective"in Ae,$e=!window.L_DISABLE_3D&&(Xe||Je||Qe)&&!Ke&&!We,ti="undefined"!=typeof orientation||z("mobile"),ei=ti&&Ne,ii=ti&&Je,ni=!window.PointerEvent&&window.MSPointerEvent,oi=!(!window.PointerEvent&&!ni),ri=!window.L_NO_TOUCH&&(oi||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),si=ti&&je,ai=ti&&Ve,li=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,hi=function(){return!!document.createElement("canvas").getContext}(),ui=!(!document.createElementNS||!O("svg").createSVGRect),ci=!ui&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&"object"==typeof e.adj}catch(i){return!1}}(),di=(Object.freeze||Object)({ie:De,ielt9:Re,edge:Be,webkit:Ne,android:Fe,android23:Ze,androidStock:Ge,opera:je,chrome:He,gecko:Ve,safari:qe,phantom:We,opera12:Ke,win:Ye,ie3d:Xe,webkit3d:Je,gecko3d:Qe,any3d:$e,mobile:ti,mobileWebkit:ei,mobileWebkit3d:ii,msPointer:ni,pointer:oi,touch:ri,mobileOpera:si,mobileGecko:ai,retina:li,canvas:hi,svg:ui,vml:ci}),pi=ni?"MSPointerDown":"pointerdown",mi=ni?"MSPointerMove":"pointermove",fi=ni?"MSPointerUp":"pointerup",_i=ni?"MSPointerCancel":"pointercancel",gi=["INPUT","SELECT","OPTION"],vi={},yi=!1,xi=0,bi=ni?"MSPointerDown":oi?"pointerdown":"touchstart",Pi=ni?"MSPointerUp":oi?"pointerup":"touchend",Li="_leaflet_",Ti="_leaflet_events",wi=Ye&&He?2*window.devicePixelRatio:Ve?window.devicePixelRatio:1,Si={},Mi=(Object.freeze||Object)({on:V,off:q,stopPropagation:Y,disableScrollPropagation:X,disableClickPropagation:J,preventDefault:Q,stop:$,getMousePosition:tt,getWheelDelta:et,fakeStop:it,skipped:nt,isExternalTarget:ot,addListener:V,removeListener:q}),Ii=xt(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),ki=xt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ci="webkitTransition"===ki||"OTransition"===ki?ki+"End":"transitionend";if("onselectstart"in document)ke=function(){V(window,"selectstart",Q)},Ce=function(){q(window,"selectstart",Q)};else{var Oi=xt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);ke=function(){if(Oi){var t=document.documentElement.style;Oe=t[Oi],t[Oi]="none"}},Ce=function(){Oi&&(document.documentElement.style[Oi]=Oe,Oe=void 0)}}var Ei,zi,Ai=(Object.freeze||Object)({TRANSFORM:Ii,TRANSITION:ki,TRANSITION_END:Ci,get:st,getStyle:at,create:lt,remove:ht,empty:ut,toFront:ct,toBack:dt,hasClass:pt,addClass:mt,removeClass:ft,setClass:_t,getClass:gt,setOpacity:vt,testProp:xt,setTransform:bt,setPosition:Pt,getPosition:Lt,disableTextSelection:ke,enableTextSelection:Ce,disableImageDrag:Tt,enableImageDrag:wt,preventOutline:St,restoreOutline:Mt}),Di=Le.extend({run:function(t,e,i,n){this.stop(),this._el=t,this._inProgress=!0,this._duration=i||.25,this._easeOutPower=1/Math.max(n||.5,.2),this._startPos=Lt(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=_(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,i=1e3*this._duration;e<i?this._runFrame(this._easeOut(e/i),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var i=this._startPos.add(this._offset.multiplyBy(t));e&&i._round(),Pt(this._el,i),this.fire("step")},_complete:function(){g(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),Ri=Le.extend({options:{crs:Ee,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=u(this,e),this._initContainer(t),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),void 0!==e.zoom&&(this._zoom=this._limitZoom(e.zoom)),e.center&&void 0!==e.zoom&&this.setView(I(e.center),e.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this.callInitHooks(),this._zoomAnimated=ki&&$e&&!si&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),V(this._proxy,Ci,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,i,n){if(i=void 0===i?this._zoom:this._limitZoom(i),t=this._limitCenter(I(t),i,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&n!==!0){void 0!==n.animate&&(n.zoom=e({animate:n.animate},n.zoom),n.pan=e({animate:n.animate,duration:n.duration},n.pan));var o=this._zoom!==i?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,i,n.zoom):this._tryAnimatedPan(t,n.pan);if(o)return clearTimeout(this._sizeTimer),this}return this._resetView(t,i),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||($e?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||($e?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,i){var n=this.getZoomScale(e),o=this.getSize().divideBy(2),r=t instanceof x?t:this.latLngToContainerPoint(t),s=r.subtract(o).multiplyBy(1-1/n),a=this.containerPointToLatLng(o.add(s));return this.setView(a,e,{zoom:i})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():S(t);var i=b(e.paddingTopLeft||e.padding||[0,0]),n=b(e.paddingBottomRight||e.padding||[0,0]),o=this.getBoundsZoom(t,!1,i.add(n));if(o="number"==typeof e.maxZoom?Math.min(e.maxZoom,o):o,o===1/0)return{center:t.getCenter(),zoom:o};var r=n.subtract(i).divideBy(2),s=this.project(t.getSouthWest(),o),a=this.project(t.getNorthEast(),o),l=this.unproject(s.add(a).divideBy(2).add(r),o);return{center:l,zoom:o}},fitBounds:function(t,e){if(t=S(t),!t.isValid())throw new Error("Bounds are not valid.");var i=this._getBoundsCenterZoom(t,e);return this.setView(i.center,i.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=b(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Di,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){mt(this._mapPane,"leaflet-pan-anim");var i=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,i,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,i){function n(t){var e=t?-1:1,i=t?g:f,n=g*g-f*f+e*x*x*v*v,o=2*i*x*v,r=n/o,s=Math.sqrt(r*r+1)-r,a=s<1e-9?-18:Math.log(s);return a}function o(t){return(Math.exp(t)-Math.exp(-t))/2}function r(t){return(Math.exp(t)+Math.exp(-t))/2}function s(t){return o(t)/r(t)}function a(t){return f*(r(b)/r(b+y*t))}function l(t){return f*(r(b)*s(b+y*t)-o(b))/x}function h(t){return 1-Math.pow(1-t,1.5)}function u(){var i=(Date.now()-P)/T,n=h(i)*L;i<=1?(this._flyToFrame=_(u,this),this._move(this.unproject(c.add(d.subtract(c).multiplyBy(l(n)/v)),m),this.getScaleZoom(f/a(n),m),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}if(i=i||{},i.animate===!1||!$e)return this.setView(t,e,i);this._stop();var c=this.project(this.getCenter()),d=this.project(t),p=this.getSize(),m=this._zoom;t=I(t),e=void 0===e?m:e;var f=Math.max(p.x,p.y),g=f*this.getZoomScale(m,e),v=d.distanceTo(c)||1,y=1.42,x=y*y,b=n(0),P=Date.now(),L=(n(1)-b)/y,T=i.duration?1e3*i.duration:1e3*L*.8;return this._moveStart(!0,i.noMoveStart),u.call(this),this},flyToBounds:function(t,e){var i=this._getBoundsCenterZoom(t,e);return this.flyTo(i.center,i.zoom,e)},setMaxBounds:function(t){return t=S(t),t.isValid()?(this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds))},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var i=this.getCenter(),n=this._limitCenter(i,this._zoom,S(t));return i.equals(n)||this.panTo(n,e),this._enforcingBounds=!1,this},invalidateSize:function(t){if(!this._loaded)return this;t=e({animate:!1,pan:!0},t===!0?{animate:!0}:t);var n=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var o=this.getSize(),r=n.divideBy(2).round(),s=o.divideBy(2).round(),a=r.subtract(s);return a.x||a.y?(t.animate&&t.pan?this.panBy(a):(t.pan&&this._rawPanBy(a),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:n,newSize:o})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=e({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var n=i(this._handleGeolocationResponse,this),o=i(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(n,o,t):navigator.geolocation.getCurrentPosition(n,o,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){var e=t.code,i=t.message||(1===e?"permission denied":2===e?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+i+"."})},_handleGeolocationResponse:function(t){var e=t.coords.latitude,i=t.coords.longitude,n=new M(e,i),o=n.toBounds(t.coords.accuracy),r=this._locateOptions;if(r.setView){var s=this.getBoundsZoom(o);this.setView(n,r.maxZoom?Math.min(s,r.maxZoom):s)}var a={latlng:n,bounds:o,timestamp:t.timestamp};for(var l in t.coords)"number"==typeof t.coords[l]&&(a[l]=t.coords[l]);this.fire("locationfound",a)},addHandler:function(t,e){if(!e)return this;var i=this[t]=new e(this);return this._handlers.push(i),this.options[t]&&i.enable(),this},remove:function(){if(this._initEvents(!0),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),ht(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this._loaded&&this.fire("unload");var e;for(e in this._layers)this._layers[e].remove();for(e in this._panes)ht(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var i="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),n=lt("div",i,e||this._mapPane);return t&&(this._panes[t]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),i=this.unproject(t.getTopRight());return new w(e,i)},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,i){t=S(t),i=b(i||[0,0]);var n=this.getZoom()||0,o=this.getMinZoom(),r=this.getMaxZoom(),s=t.getNorthWest(),a=t.getSouthEast(),l=this.getSize().subtract(i),h=T(this.project(a,n),this.project(s,n)).getSize(),u=$e?this.options.zoomSnap:1,c=l.x/h.x,d=l.y/h.y,p=e?Math.max(c,d):Math.min(c,d);return n=this.getScaleZoom(p,n),u&&(n=Math.round(n/(u/100))*(u/100),n=e?Math.ceil(n/u)*u:Math.floor(n/u)*u),Math.max(o,Math.min(r,n))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new x(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var i=this._getTopLeftPoint(t,e);return new P(i,i.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(void 0===t?this.getZoom():t)},getPane:function(t){return"string"==typeof t?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var i=this.options.crs;return e=void 0===e?this._zoom:e,i.scale(t)/i.scale(e)},getScaleZoom:function(t,e){var i=this.options.crs;e=void 0===e?this._zoom:e;var n=i.zoom(t*i.scale(e));return isNaN(n)?1/0:n},project:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.latLngToPoint(I(t),e)},unproject:function(t,e){return e=void 0===e?this._zoom:e,this.options.crs.pointToLatLng(b(t),e)},layerPointToLatLng:function(t){var e=b(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(I(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(I(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(S(t))},distance:function(t,e){return this.options.crs.distance(I(t),I(e))},containerPointToLayerPoint:function(t){return b(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return b(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(b(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(I(t)))},mouseEventToContainerPoint:function(t){return tt(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=st(t);if(!e)throw new Error("Map container not found.");if(e._leaflet_id)throw new Error("Map container is already initialized.");V(e,"scroll",this._onScroll,this),this._containerId=n(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&$e,mt(t,"leaflet-container"+(ri?" leaflet-touch":"")+(li?" leaflet-retina":"")+(Re?" leaflet-oldie":"")+(qe?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=at(t,"position");"absolute"!==e&&"relative"!==e&&"fixed"!==e&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Pt(this._mapPane,new x(0,0)),this.createPane("tilePane"),this.createPane("shadowPane"),this.createPane("overlayPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(mt(t.markerPane,"leaflet-zoom-hide"),mt(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e){Pt(this._mapPane,new x(0,0));var i=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var n=this._zoom!==e;this._moveStart(n,!1)._move(t,e)._moveEnd(n),this.fire("viewreset"),i&&this.fire("load")},_moveStart:function(t,e,i,n){return t&&this.fire("zoomstart",{center:i,zoom:n}),e||this.fire("movestart"),this},_move:function(t,e,i){void 0===e&&(e=this._zoom);var n=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),(n||i&&i.pinch)&&this.fire("zoom",i),this.fire("move",i)},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return g(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){Pt(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[n(this._container)]=this;var e=t?q:V;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),$e&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){g(this._resizeRequest),this._resizeRequest=_(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var i,o=[],r="mouseout"===e||"mouseover"===e,s=t.target||t.srcElement,a=!1;s;){if(i=this._targets[n(s)],i&&("click"===e||"preclick"===e)&&!t._simulated&&this._draggableMoved(i)){a=!0;break}if(i&&i.listens(e,!0)){if(r&&!ot(s,t))break;if(o.push(i),r)break}if(s===this._container)break;s=s.parentNode}return o.length||a||r||!ot(s,t)||(o=[this]),o},_handleDOMEvent:function(t){if(this._loaded&&!nt(t)){var e=t.type;"mousedown"!==e&&"keypress"!==e||St(t.target||t.srcElement),this._fireDOMEvent(t,e)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,i,n){if("click"===t.type){var o=e({},t);o.type="preclick",this._fireDOMEvent(o,o.type,n)}if(!t._stopped&&(n=(n||[]).concat(this._findEventTargets(t,i)),n.length)){var r=n[0];"contextmenu"===i&&r.listens(i,!0)&&Q(t);var s={originalEvent:t};if("keypress"!==t.type){var a=r.getLatLng&&(!r._radius||r._radius<=10);s.containerPoint=a?this.latLngToContainerPoint(r.getLatLng()):this.mouseEventToContainerPoint(t),s.layerPoint=this.containerPointToLayerPoint(s.containerPoint),s.latlng=a?r.getLatLng():this.layerPointToLatLng(s.layerPoint)}for(var l=0;l<n.length;l++)if(n[l].fire(i,s,!0),s.originalEvent._stopped||n[l].options.bubblingMouseEvents===!1&&p(this._mouseEvents,i)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return Lt(this._mapPane)||new x(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var i=t&&void 0!==e?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return i.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var i=this.getSize()._divideBy(2);return this.project(t,e)._subtract(i)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return this.project(t,e)._subtract(n)},_latLngBoundsToNewLayerBounds:function(t,e,i){var n=this._getNewPixelOrigin(i,e);return T([this.project(t.getSouthWest(),e)._subtract(n),this.project(t.getNorthWest(),e)._subtract(n),this.project(t.getSouthEast(),e)._subtract(n),this.project(t.getNorthEast(),e)._subtract(n)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,i){if(!i)return t;var n=this.project(t,e),o=this.getSize().divideBy(2),r=new P(n.subtract(o),n.add(o)),s=this._getBoundsOffset(r,i,e);return s.round().equals([0,0])?t:this.unproject(n.add(s),e)},_limitOffset:function(t,e){if(!e)return t;var i=this.getPixelBounds(),n=new P(i.min.add(t),i.max.add(t));return t.add(this._getBoundsOffset(n,e))},_getBoundsOffset:function(t,e,i){var n=T(this.project(e.getNorthEast(),i),this.project(e.getSouthWest(),i)),o=n.min.subtract(t.min),r=n.max.subtract(t.max),s=this._rebound(o.x,-r.x),a=this._rebound(o.y,-r.y);return new x(s,a)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),i=this.getMaxZoom(),n=$e?this.options.zoomSnap:1;return n&&(t=Math.round(t/n)*n),Math.max(e,Math.min(i,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ft(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var i=this._getCenterOffset(t)._trunc();return!((e&&e.animate)!==!0&&!this.getSize().contains(i))&&(this.panBy(i,e),!0)},_createAnimProxy:function(){var t=this._proxy=lt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(t){var e=Ii,i=this._proxy.style[e];bt(this._proxy,this.project(t.center,t.zoom),this.getZoomScale(t.zoom,1)),i===this._proxy.style[e]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",function(){var t=this.getCenter(),e=this.getZoom();bt(this._proxy,this.project(t,e),this.getZoomScale(e,1))},this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ht(this._proxy),delete this._proxy},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,i){if(this._animatingZoom)return!0;if(i=i||{},!this._zoomAnimated||i.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var n=this.getZoomScale(e),o=this._getCenterOffset(t)._divideBy(1-1/n);return!(i.animate!==!0&&!this.getSize().contains(o))&&(_(function(){this._moveStart(!0,!1,t,e)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,n,o){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,mt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:o}),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ft(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom),_(function(){this._moveEnd(!0)},this))}}),Bi=v.extend({options:{position:"topright"},initialize:function(t){u(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),i=this.getPosition(),n=t._controlCorners[i];return mt(e,"leaflet-control"),i.indexOf("bottom")!==-1?n.insertBefore(e,n.firstChild):n.appendChild(e),this},remove:function(){return this._map?(ht(this._container),this.onRemove&&this.onRemove(this._map),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Ni=function(t){return new Bi(t)};Ri.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){
function t(t,o){var r=i+t+" "+i+o;e[t+o]=lt("div",r,n)}var e=this._controlCorners={},i="leaflet-",n=this._controlContainer=lt("div",i+"control-container",this._container);t("top","left"),t("top","right"),t("bottom","left"),t("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)ht(this._controlCorners[t]);ht(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Fi=Bi.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,i,n){return i<n?-1:n<i?1:0}},initialize:function(t,e,i){u(this,i),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var n in t)this._addLayer(t[n],n);for(n in e)this._addLayer(e[n],n,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Bi.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(n(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){mt(this._container,"leaflet-control-layers-expanded"),this._form.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._form.clientHeight?(mt(this._form,"leaflet-control-layers-scrollbar"),this._form.style.height=t+"px"):ft(this._form,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ft(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=lt("div",t),i=this.options.collapsed;e.setAttribute("aria-haspopup",!0),J(e),X(e);var n=this._form=lt("form",t+"-list");i&&(this._map.on("click",this.collapse,this),Fe||V(e,{mouseenter:this.expand,mouseleave:this.collapse},this));var o=this._layersLink=lt("a",t+"-toggle",e);o.href="#",o.title="Layers",ri?(V(o,"click",$),V(o,"click",this.expand,this)):V(o,"focus",this.expand,this),i||this.expand(),this._baseLayersList=lt("div",t+"-base",n),this._separator=lt("div",t+"-separator",n),this._overlaysList=lt("div",t+"-overlays",n),e.appendChild(n)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&n(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(i(function(t,e){return this.options.sortFunction(t.layer,e.layer,t.name,e.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ut(this._baseLayersList),ut(this._overlaysList),this._layerControlInputs=[];var t,e,i,n,o=0;for(i=0;i<this._layers.length;i++)n=this._layers[i],this._addItem(n),e=e||n.overlay,t=t||!n.overlay,o+=n.overlay?0:1;return this.options.hideSingleBase&&(t=t&&o>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(n(t.target)),i=e&&e.overlay?"add"===t.type?"overlayadd":"overlayremove":"add"===t.type?"baselayerchange":null;i&&this._map.fire(i,e)},_createRadioElement:function(t,e){var i='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",n=document.createElement("div");return n.innerHTML=i,n.firstChild},_addItem:function(t){var e,i=document.createElement("label"),o=this._map.hasLayer(t.layer);t.overlay?(e=document.createElement("input"),e.type="checkbox",e.className="leaflet-control-layers-selector",e.defaultChecked=o):e=this._createRadioElement("leaflet-base-layers",o),this._layerControlInputs.push(e),e.layerId=n(t.layer),V(e,"click",this._onInputClick,this);var r=document.createElement("span");r.innerHTML=" "+t.name;var s=document.createElement("div");i.appendChild(s),s.appendChild(e),s.appendChild(r);var a=t.overlay?this._overlaysList:this._baseLayersList;return a.appendChild(i),this._checkDisabledLayers(),i},_onInputClick:function(){var t,e,i=this._layerControlInputs,n=[],o=[];this._handlingClick=!0;for(var r=i.length-1;r>=0;r--)t=i[r],e=this._getLayer(t.layerId).layer,t.checked?n.push(e):t.checked||o.push(e);for(r=0;r<o.length;r++)this._map.hasLayer(o[r])&&this._map.removeLayer(o[r]);for(r=0;r<n.length;r++)this._map.hasLayer(n[r])||this._map.addLayer(n[r]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var t,e,i=this._layerControlInputs,n=this._map.getZoom(),o=i.length-1;o>=0;o--)t=i[o],e=this._getLayer(t.layerId).layer,t.disabled=void 0!==e.options.minZoom&&n<e.options.minZoom||void 0!==e.options.maxZoom&&n>e.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expand:function(){return this.expand()},_collapse:function(){return this.collapse()}}),Zi=function(t,e,i){return new Fi(t,e,i)},Ui=Bi.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",i=lt("div",e+" leaflet-bar"),n=this.options;return this._zoomInButton=this._createButton(n.zoomInText,n.zoomInTitle,e+"-in",i,this._zoomIn),this._zoomOutButton=this._createButton(n.zoomOutText,n.zoomOutTitle,e+"-out",i,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),i},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,i,n,o){var r=lt("a",i,n);return r.innerHTML=t,r.href="#",r.title=e,r.setAttribute("role","button"),r.setAttribute("aria-label",e),J(r),V(r,"click",$),V(r,"click",o,this),V(r,"click",this._refocusOnMap,this),r},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";ft(this._zoomInButton,e),ft(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMinZoom())&&mt(this._zoomOutButton,e),(this._disabled||t._zoom===t.getMaxZoom())&&mt(this._zoomInButton,e)}});Ri.mergeOptions({zoomControl:!0}),Ri.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Ui,this.addControl(this.zoomControl))});var Gi=function(t){return new Ui(t)},ji=Bi.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",i=lt("div",e),n=this.options;return this._addScales(n,e+"-line",i),t.on(n.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),i},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,i){t.metric&&(this._mScale=lt("div",e,i)),t.imperial&&(this._iScale=lt("div",e,i))},_update:function(){var t=this._map,e=t.getSize().y/2,i=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(i)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),i=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,i,e/t)},_updateImperial:function(t){var e,i,n,o=3.2808399*t;o>5280?(e=o/5280,i=this._getRoundNum(e),this._updateScale(this._iScale,i+" mi",i/e)):(n=this._getRoundNum(o),this._updateScale(this._iScale,n+" ft",n/o))},_updateScale:function(t,e,i){t.style.width=Math.round(this.options.maxWidth*i)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}}),Hi=function(t){return new ji(t)},Vi=Bi.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(t){u(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=lt("div","leaflet-control-attribution"),J(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),this._container},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var i=[];this.options.prefix&&i.push(this.options.prefix),t.length&&i.push(t.join(", ")),this._container.innerHTML=i.join(" | ")}}});Ri.mergeOptions({attributionControl:!0}),Ri.addInitHook(function(){this.options.attributionControl&&(new Vi).addTo(this)});var qi=function(t){return new Vi(t)};Bi.Layers=Fi,Bi.Zoom=Ui,Bi.Scale=ji,Bi.Attribution=Vi,Ni.layers=Zi,Ni.zoom=Gi,Ni.scale=Hi,Ni.attribution=qi;var Wi=v.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Wi.addTo=function(t,e){return t.addHandler(e,this),this};var Ki,Yi={Events:Pe},Xi=ri?"touchstart mousedown":"mousedown",Ji={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},Qi={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},$i=Le.extend({options:{clickTolerance:3},initialize:function(t,e,i,n){u(this,n),this._element=t,this._dragStartTarget=e||t,this._preventOutline=i},enable:function(){this._enabled||(V(this._dragStartTarget,Xi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&($i._dragging===this&&this.finishDrag(),q(this._dragStartTarget,Xi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(!t._simulated&&this._enabled&&(this._moved=!1,!pt(this._element,"leaflet-zoom-anim")&&!($i._dragging||t.shiftKey||1!==t.which&&1!==t.button&&!t.touches||($i._dragging=this,this._preventOutline&&St(this._element),Tt(),ke(),this._moving)))){this.fire("down");var e=t.touches?t.touches[0]:t;this._startPoint=new x(e.clientX,e.clientY),V(document,Qi[t.type],this._onMove,this),V(document,Ji[t.type],this._onUp,this)}},_onMove:function(t){if(!t._simulated&&this._enabled){if(t.touches&&t.touches.length>1)return void(this._moved=!0);var e=t.touches&&1===t.touches.length?t.touches[0]:t,i=new x(e.clientX,e.clientY),n=i.subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(Q(t),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=Lt(this._element).subtract(n),mt(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),mt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,g(this._animRequest),this._lastEvent=t,this._animRequest=_(this._updatePosition,this,!0)))}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),Pt(this._element,this._newPos),this.fire("drag",t)},_onUp:function(t){!t._simulated&&this._enabled&&this.finishDrag()},finishDrag:function(){ft(document.body,"leaflet-dragging"),this._lastTarget&&(ft(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var t in Qi)q(document,Qi[t],this._onMove,this),q(document,Ji[t],this._onUp,this);wt(),Ce(),this._moved&&this._moving&&(g(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1,$i._dragging=!1}}),tn=(Object.freeze||Object)({simplify:kt,pointToSegmentDistance:Ct,closestPointOnSegment:Ot,clipSegment:Dt,_getEdgeIntersection:Rt,_getBitCode:Bt,_sqClosestPointOnSegment:Ft,isFlat:Zt,_flat:Ut}),en=(Object.freeze||Object)({clipPolygon:Gt}),nn={project:function(t){return new x(t.lng,t.lat)},unproject:function(t){return new M(t.y,t.x)},bounds:new P([-180,-90],[180,90])},on={R:6378137,R_MINOR:6356752.314245179,bounds:new P([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(t){var e=Math.PI/180,i=this.R,n=t.lat*e,o=this.R_MINOR/i,r=Math.sqrt(1-o*o),s=r*Math.sin(n),a=Math.tan(Math.PI/4-n/2)/Math.pow((1-s)/(1+s),r/2);return n=-i*Math.log(Math.max(a,1e-10)),new x(t.lng*e*i,n)},unproject:function(t){for(var e,i=180/Math.PI,n=this.R,o=this.R_MINOR/n,r=Math.sqrt(1-o*o),s=Math.exp(-t.y/n),a=Math.PI/2-2*Math.atan(s),l=0,h=.1;l<15&&Math.abs(h)>1e-7;l++)e=r*Math.sin(a),e=Math.pow((1-e)/(1+e),r/2),h=Math.PI/2-2*Math.atan(s*e)-a,a+=h;return new M(a*i,t.x*i/n)}},rn=(Object.freeze||Object)({LonLat:nn,Mercator:on,SphericalMercator:Me}),sn=e({},Se,{code:"EPSG:3395",projection:on,transformation:function(){var t=.5/(Math.PI*on.R);return C(t,.5,-t,.5)}()}),an=e({},Se,{code:"EPSG:4326",projection:nn,transformation:C(1/180,1,-1/180,.5)}),ln=e({},we,{projection:nn,transformation:C(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var i=e.lng-t.lng,n=e.lat-t.lat;return Math.sqrt(i*i+n*n)},infinite:!0});we.Earth=Se,we.EPSG3395=sn,we.EPSG3857=Ee,we.EPSG900913=ze,we.EPSG4326=an,we.Simple=ln;var hn=Le.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[n(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[n(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var i=this.getEvents();e.on(i,this),this.once("remove",function(){e.off(i,this)},this)}this.onAdd(e),this.getAttribution&&e.attributionControl&&e.attributionControl.addAttribution(this.getAttribution()),this.fire("add"),e.fire("layeradd",{layer:this})}}});Ri.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=n(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=n(t);return this._layers[e]?(this._loaded&&t.onRemove(this),t.getAttribution&&this.attributionControl&&this.attributionControl.removeAttribution(t.getAttribution()),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return!!t&&n(t)in this._layers},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},_addLayers:function(t){t=t?_e(t)?t:[t]:[];for(var e=0,i=t.length;e<i;e++)this.addLayer(t[e])},_addZoomLimit:function(t){!isNaN(t.options.maxZoom)&&isNaN(t.options.minZoom)||(this._zoomBoundLayers[n(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=n(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-(1/0),i=this._getZoomSpan();for(var n in this._zoomBoundLayers){var o=this._zoomBoundLayers[n].options;t=void 0===o.minZoom?t:Math.min(t,o.minZoom),e=void 0===o.maxZoom?e:Math.max(e,o.maxZoom)}this._layersMaxZoom=e===-(1/0)?void 0:e,this._layersMinZoom=t===1/0?void 0:t,i!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var un=hn.extend({initialize:function(t,e){u(this,e),this._layers={};var i,n;if(t)for(i=0,n=t.length;i<n;i++)this.addLayer(t[i])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){return!!t&&(t in this._layers||this.getLayerId(t)in this._layers)},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e,i,n=Array.prototype.slice.call(arguments,1);for(e in this._layers)i=this._layers[e],i[t]&&i[t].apply(i,n);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return n(t)}}),cn=function(t,e){return new un(t,e)},dn=un.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),un.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),un.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new w;for(var e in this._layers){var i=this._layers[e];t.extend(i.getBounds?i.getBounds():i.getLatLng())}return t}}),pn=function(t){return new dn(t)},mn=v.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0]},initialize:function(t){u(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var i=this._getIconUrl(t);if(!i){if("icon"===t)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var n=this._createImg(i,e&&"IMG"===e.tagName?e:null);return this._setIconStyles(n,t),n},_setIconStyles:function(t,e){var i=this.options,n=i[e+"Size"];"number"==typeof n&&(n=[n,n]);var o=b(n),r=b("shadow"===e&&i.shadowAnchor||i.iconAnchor||o&&o.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(i.className||""),r&&(t.style.marginLeft=-r.x+"px",t.style.marginTop=-r.y+"px"),o&&(t.style.width=o.x+"px",t.style.height=o.y+"px")},_createImg:function(t,e){return e=e||document.createElement("img"),e.src=t,e},_getIconUrl:function(t){return li&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}}),fn=mn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return fn.imagePath||(fn.imagePath=this._detectIconPath()),(this.options.imagePath||fn.imagePath)+mn.prototype._getIconUrl.call(this,t)},_detectIconPath:function(){var t=lt("div","leaflet-default-icon-path",document.body),e=at(t,"background-image")||at(t,"backgroundImage");return document.body.removeChild(t),e=null===e||0!==e.indexOf("url")?"":e.replace(/^url\(["']?/,"").replace(/marker-icon\.png["']?\)$/,"")}}),_n=Wi.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new $i(t,t,(!0))),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),mt(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ft(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,i=e._map,n=this._marker.options.autoPanSpeed,o=this._marker.options.autoPanPadding,r=Lt(e._icon),s=i.getPixelBounds(),a=i.getPixelOrigin(),l=T(s.min._subtract(a).add(o),s.max._subtract(a).subtract(o));if(!l.contains(r)){var h=b((Math.max(l.max.x,r.x)-l.max.x)/(s.max.x-l.max.x)-(Math.min(l.min.x,r.x)-l.min.x)/(s.min.x-l.min.x),(Math.max(l.max.y,r.y)-l.max.y)/(s.max.y-l.max.y)-(Math.min(l.min.y,r.y)-l.min.y)/(s.min.y-l.min.y)).multiplyBy(n);i.panBy(h,{animate:!1}),this._draggable._newPos._add(h),this._draggable._startPos._add(h),Pt(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=_(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(g(this._panRequest),this._panRequest=_(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,i=e._shadow,n=Lt(e._icon),o=e._map.layerPointToLatLng(n);i&&Pt(i,n),e._latlng=o,t.latlng=o,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){g(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),gn=hn.extend({options:{icon:new fn,interactive:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10,keyboard:!0,title:"",alt:"",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",bubblingMouseEvents:!1},initialize:function(t,e){u(this,e),this._latlng=I(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=I(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),i=t.icon.createIcon(this._icon),n=!1;i!==this._icon&&(this._icon&&this._removeIcon(),n=!0,t.title&&(i.title=t.title),"IMG"===i.tagName&&(i.alt=t.alt||"")),mt(i,e),t.keyboard&&(i.tabIndex="0"),this._icon=i,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex});var o=t.icon.createShadow(this._shadow),r=!1;o!==this._shadow&&(this._removeShadow(),r=!0),o&&(mt(o,e),o.alt=""),this._shadow=o,t.opacity<1&&this._updateOpacity(),n&&this.getPane().appendChild(this._icon),this._initInteraction(),o&&r&&this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),ht(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ht(this._shadow),this._shadow=null},_setPos:function(t){Pt(this._icon,t),this._shadow&&Pt(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon.style.zIndex=this._zIndex+t},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(mt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),_n)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new _n(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;vt(this._icon,t),this._shadow&&vt(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}}),vn=hn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return u(this,t),this._renderer&&this._renderer._updateStyle(this),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+this._renderer.options.tolerance}}),yn=vn.extend({options:{fill:!0,radius:10},initialize:function(t,e){u(this,e),this._latlng=I(t),this._radius=this.options.radius},setLatLng:function(t){return this._latlng=I(t),this.redraw(),this.fire("move",{latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return vn.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,i=this._clickTolerance(),n=[t+i,e+i];this._pxBounds=new P(this._point.subtract(n),this._point.add(n))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}}),xn=yn.extend({initialize:function(t,i,n){if("number"==typeof i&&(i=e({},n,{radius:i})),u(this,i),this._latlng=I(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new w(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:vn.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,i=this._map,n=i.options.crs;if(n.distance===Se.distance){var o=Math.PI/180,r=this._mRadius/Se.R/o,s=i.project([e+r,t]),a=i.project([e-r,t]),l=s.add(a).divideBy(2),h=i.unproject(l).lat,u=Math.acos((Math.cos(r*o)-Math.sin(e*o)*Math.sin(h*o))/(Math.cos(e*o)*Math.cos(h*o)))/o;(isNaN(u)||0===u)&&(u=r/Math.cos(Math.PI/180*e)),this._point=l.subtract(i.getPixelOrigin()),this._radius=isNaN(u)?0:l.x-i.project([h,t-u]).x,this._radiusY=l.y-s.y}else{var c=n.unproject(n.project(this._latlng).subtract([this._mRadius,0]));this._point=i.latLngToLayerPoint(this._latlng),this._radius=this._point.x-i.latLngToLayerPoint(c).x}this._updateBounds()}}),bn=vn.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){u(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e,i,n=1/0,o=null,r=Ft,s=0,a=this._parts.length;s<a;s++)for(var l=this._parts[s],h=1,u=l.length;h<u;h++){e=l[h-1],i=l[h];var c=r(t,e,i,!0);c<n&&(n=c,o=r(t,e,i))}return o&&(o.distance=Math.sqrt(n)),o},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,r,s,a=this._rings[0],l=a.length;if(!l)return null;for(t=0,e=0;t<l-1;t++)e+=a[t].distanceTo(a[t+1])/2;if(0===e)return this._map.layerPointToLatLng(a[0]);for(t=0,n=0;t<l-1;t++)if(o=a[t],r=a[t+1],i=o.distanceTo(r),n+=i,n>e)return s=(n-e)/i,this._map.layerPointToLatLng([r.x-s*(r.x-o.x),r.y-s*(r.y-o.y)])},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=I(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new w,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return Zt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],i=Zt(t),n=0,o=t.length;n<o;n++)i?(e[n]=I(t[n]),this._bounds.extend(e[n])):e[n]=this._convertLatLngs(t[n]);return e},_project:function(){var t=new P;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t);var e=this._clickTolerance(),i=new x(e,e);this._bounds.isValid()&&t.isValid()&&(t.min._subtract(i),t.max._add(i),this._pxBounds=t)},_projectLatlngs:function(t,e,i){var n,o,r=t[0]instanceof M,s=t.length;if(r){for(o=[],n=0;n<s;n++)o[n]=this._map.latLngToLayerPoint(t[n]),i.extend(o[n]);e.push(o)}else for(n=0;n<s;n++)this._projectLatlngs(t[n],e,i)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);var e,i,n,o,r,s,a,l=this._parts;for(e=0,n=0,o=this._rings.length;e<o;e++)for(a=this._rings[e],i=0,r=a.length;i<r-1;i++)s=Dt(a[i],a[i+1],t,i,!0),s&&(l[n]=l[n]||[],l[n].push(s[0]),s[1]===a[i+1]&&i!==r-2||(l[n].push(s[1]),n++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,i=0,n=t.length;i<n;i++)t[i]=kt(t[i],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var i,n,o,r,s,a,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(i=0,r=this._parts.length;i<r;i++)for(a=this._parts[i],n=0,s=a.length,o=s-1;n<s;o=n++)if((e||0!==n)&&Ct(t,a[o],a[n])<=l)return!0;return!1}});bn._flat=Ut;var Pn=bn.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var t,e,i,n,o,r,s,a,l,h=this._rings[0],u=h.length;if(!u)return null;
for(r=s=a=0,t=0,e=u-1;t<u;e=t++)i=h[t],n=h[e],o=i.y*n.x-n.y*i.x,s+=(i.x+n.x)*o,a+=(i.y+n.y)*o,r+=3*o;return l=0===r?h[0]:[s/r,a/r],this._map.layerPointToLatLng(l)},_convertLatLngs:function(t){var e=bn.prototype._convertLatLngs.call(this,t),i=e.length;return i>=2&&e[0]instanceof M&&e[0].equals(e[i-1])&&e.pop(),e},_setLatLngs:function(t){bn.prototype._setLatLngs.call(this,t),Zt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Zt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,i=new x(e,e);if(t=new P(t.min.subtract(i),t.max.add(i)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(t)){if(this.options.noClip)return void(this._parts=this._rings);for(var n,o=0,r=this._rings.length;o<r;o++)n=Gt(this._rings[o],t,!0),n.length&&this._parts.push(n)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e,i,n,o,r,s,a,l,h=!1;if(!this._pxBounds.contains(t))return!1;for(o=0,a=this._parts.length;o<a;o++)for(e=this._parts[o],r=0,l=e.length,s=l-1;r<l;s=r++)i=e[r],n=e[s],i.y>t.y!=n.y>t.y&&t.x<(n.x-i.x)*(t.y-i.y)/(n.y-i.y)+i.x&&(h=!h);return h||bn.prototype._containsPoint.call(this,t,!0)}}),Ln=dn.extend({initialize:function(t,e){u(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e,i,n,o=_e(t)?t:t.features;if(o){for(e=0,i=o.length;e<i;e++)n=o[e],(n.geometries||n.geometry||n.features||n.coordinates)&&this.addData(n);return this}var r=this.options;if(r.filter&&!r.filter(t))return this;var s=Yt(t,r);return s?(s.feature=ee(t),s.defaultOptions=s.options,this.resetStyle(s),r.onEachFeature&&r.onEachFeature(t,s),this.addLayer(s)):this},resetStyle:function(t){return t.options=e({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){"function"==typeof e&&(e=e(t.feature)),t.setStyle&&t.setStyle(e)}}),Tn={toGeoJSON:function(t){return te(this,{type:"Point",coordinates:Qt(this.getLatLng(),t)})}};gn.include(Tn),xn.include(Tn),yn.include(Tn),bn.include({toGeoJSON:function(t){var e=!Zt(this._latlngs),i=$t(this._latlngs,e?1:0,!1,t);return te(this,{type:(e?"Multi":"")+"LineString",coordinates:i})}}),Pn.include({toGeoJSON:function(t){var e=!Zt(this._latlngs),i=e&&!Zt(this._latlngs[0]),n=$t(this._latlngs,i?2:e?1:0,!0,t);return e||(n=[n]),te(this,{type:(i?"Multi":"")+"Polygon",coordinates:n})}}),un.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(i){e.push(i.toGeoJSON(t).geometry.coordinates)}),te(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===e)return this.toMultiPoint(t);var i="GeometryCollection"===e,n=[];return this.eachLayer(function(e){if(e.toGeoJSON){var o=e.toGeoJSON(t);if(i)n.push(o.geometry);else{var r=ee(o);"FeatureCollection"===r.type?n.push.apply(n,r.features):n.push(r)}}}),i?te(this,{geometries:n,type:"GeometryCollection"}):{type:"FeatureCollection",features:n}}});var wn=ie,Sn=hn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,i){this._url=t,this._bounds=S(e),u(this,i)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(mt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ht(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&ct(this._image),this},bringToBack:function(){return this._map&&dt(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=S(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t="IMG"===this._url.tagName,e=this._image=t?this._url:lt("img");return mt(e,"leaflet-image-layer"),this._zoomAnimated&&mt(e,"leaflet-zoom-animated"),this.options.className&&mt(e,this.options.className),e.onselectstart=s,e.onmousemove=s,e.onload=i(this.fire,this,"load"),e.onerror=i(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(e.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t?void(this._url=e.src):(e.src=this._url,void(e.alt=this.options.alt))},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),i=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;bt(this._image,i,e)},_reset:function(){var t=this._image,e=new P(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),i=e.getSize();Pt(t,e.min),t.style.width=i.x+"px",t.style.height=i.y+"px"},_updateOpacity:function(){vt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)}}),Mn=function(t,e,i){return new Sn(t,e,i)},In=Sn.extend({options:{autoplay:!0,loop:!0},_initImage:function(){var t="VIDEO"===this._url.tagName,e=this._image=t?this._url:lt("video");if(mt(e,"leaflet-image-layer"),this._zoomAnimated&&mt(e,"leaflet-zoom-animated"),e.onselectstart=s,e.onmousemove=s,e.onloadeddata=i(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),o=[],r=0;r<n.length;r++)o.push(n[r].src);return void(this._url=n.length>0?o:[e.src])}_e(this._url)||(this._url=[this._url]),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop;for(var a=0;a<this._url.length;a++){var l=lt("source");l.src=this._url[a],e.appendChild(l)}}}),kn=hn.extend({options:{offset:[0,7],className:"",pane:"popupPane"},initialize:function(t,e){u(this,t),this._source=e},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&vt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&vt(this._container,1),this.bringToFront()},onRemove:function(t){t._fadeAnimated?(vt(this._container,0),this._removeTimeout=setTimeout(i(ht,void 0,this._container),200)):ht(this._container)},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=I(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&ct(this._container),this},bringToBack:function(){return this._map&&dt(this._container),this},_updateContent:function(){if(this._content){var t=this._contentNode,e="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof e)t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=b(this.options.offset),i=this._getAnchor();this._zoomAnimated?Pt(this._container,t.add(i)):e=e.add(t).add(i);var n=this._containerBottom=-e.y,o=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=n+"px",this._container.style.left=o+"px"}},_getAnchor:function(){return[0,0]}}),Cn=kn.extend({options:{maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t.openPopup(this),this},onAdd:function(t){kn.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof vn||this._source.on("preclick",Y))},onRemove:function(t){kn.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof vn||this._source.off("preclick",Y))},getEvents:function(){var t=kn.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this._close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var t="leaflet-popup",e=this._container=lt("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),i=this._wrapper=lt("div",t+"-content-wrapper",e);if(this._contentNode=lt("div",t+"-content",i),J(i),X(this._contentNode),V(i,"contextmenu",Y),this._tipContainer=lt("div",t+"-tip-container",e),this._tip=lt("div",t+"-tip",this._tipContainer),this.options.closeButton){var n=this._closeButton=lt("a",t+"-close-button",e);n.href="#close",n.innerHTML="&#215;",V(n,"click",this._onCloseButtonClick,this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var i=t.offsetWidth;i=Math.min(i,this.options.maxWidth),i=Math.max(i,this.options.minWidth),e.width=i+1+"px",e.whiteSpace="",e.height="";var n=t.offsetHeight,o=this.options.maxHeight,r="leaflet-popup-scrolled";o&&n>o?(e.height=o+"px",mt(t,r)):ft(t,r),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),i=this._getAnchor();Pt(this._container,e.add(i))},_adjustPan:function(){if(!(!this.options.autoPan||this._map._panAnim&&this._map._panAnim._inProgress)){var t=this._map,e=parseInt(at(this._container,"marginBottom"),10)||0,i=this._container.offsetHeight+e,n=this._containerWidth,o=new x(this._containerLeft,-i-this._containerBottom);o._add(Lt(this._container));var r=t.layerPointToContainerPoint(o),s=b(this.options.autoPanPadding),a=b(this.options.autoPanPaddingTopLeft||s),l=b(this.options.autoPanPaddingBottomRight||s),h=t.getSize(),u=0,c=0;r.x+n+l.x>h.x&&(u=r.x+n-h.x+l.x),r.x-u-a.x<0&&(u=r.x-a.x),r.y+i+l.y>h.y&&(c=r.y+i-h.y+l.y),r.y-c-a.y<0&&(c=r.y-a.y),(u||c)&&t.fire("autopanstart").panBy([u,c])}},_onCloseButtonClick:function(t){this._close(),$(t)},_getAnchor:function(){return b(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),On=function(t,e){return new Cn(t,e)};Ri.mergeOptions({closePopupOnClick:!0}),Ri.include({openPopup:function(t,e,i){return t instanceof Cn||(t=new Cn(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:(this._popup&&this._popup.options.autoClose&&this.closePopup(),this._popup=t,this.addLayer(t))},closePopup:function(t){return t&&t!==this._popup||(t=this._popup,this._popup=null),t&&this.removeLayer(t),this}}),hn.include({bindPopup:function(t,e){return t instanceof Cn?(u(t,e),this._popup=t,t._source=this):(this._popup&&!e||(this._popup=new Cn(e,this)),this._popup.setContent(t)),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t,e){if(t instanceof hn||(e=t,t=this),t instanceof dn)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._popup&&this._map&&(this._popup._source=t,this._popup.update(),this._map.openPopup(this._popup,e)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(t){return this._popup&&(this._popup._map?this.closePopup():this.openPopup(t)),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){var e=t.layer||t.target;if(this._popup&&this._map)return $(t),e instanceof vn?void this.openPopup(t.layer||t.target,t.latlng):void(this._map.hasLayer(this._popup)&&this._popup._source===e?this.closePopup():this.openPopup(e,t.latlng))},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){13===t.originalEvent.keyCode&&this._openPopup(t)}});var En=kn.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,interactive:!1,opacity:.9},onAdd:function(t){kn.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&this._source.fire("tooltipopen",{tooltip:this},!0)},onRemove:function(t){kn.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&this._source.fire("tooltipclose",{tooltip:this},!0)},getEvents:function(){var t=kn.prototype.getEvents.call(this);return ri&&!this.options.permanent&&(t.preclick=this._close),t},_close:function(){this._map&&this._map.closeTooltip(this)},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=lt("div",e)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e=this._map,i=this._container,n=e.latLngToContainerPoint(e.getCenter()),o=e.layerPointToContainerPoint(t),r=this.options.direction,s=i.offsetWidth,a=i.offsetHeight,l=b(this.options.offset),h=this._getAnchor();"top"===r?t=t.add(b(-s/2+l.x,-a+l.y+h.y,!0)):"bottom"===r?t=t.subtract(b(s/2-l.x,-l.y,!0)):"center"===r?t=t.subtract(b(s/2+l.x,a/2-h.y+l.y,!0)):"right"===r||"auto"===r&&o.x<n.x?(r="right",t=t.add(b(l.x+h.x,h.y-a/2+l.y,!0))):(r="left",t=t.subtract(b(s+h.x-l.x,a/2-h.y-l.y,!0))),ft(i,"leaflet-tooltip-right"),ft(i,"leaflet-tooltip-left"),ft(i,"leaflet-tooltip-top"),ft(i,"leaflet-tooltip-bottom"),mt(i,"leaflet-tooltip-"+r),Pt(i,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&vt(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return b(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),zn=function(t,e){return new En(t,e)};Ri.include({openTooltip:function(t,e,i){return t instanceof En||(t=new En(i).setContent(t)),e&&t.setLatLng(e),this.hasLayer(t)?this:this.addLayer(t)},closeTooltip:function(t){return t&&this.removeLayer(t),this}}),hn.include({bindTooltip:function(t,e){return t instanceof En?(u(t,e),this._tooltip=t,t._source=this):(this._tooltip&&!e||(this._tooltip=new En(e,this)),this._tooltip.setContent(t)),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(t||!this._tooltipHandlersAdded){var e=t?"off":"on",i={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?i.add=this._openTooltip:(i.mouseover=this._openTooltip,i.mouseout=this.closeTooltip,this._tooltip.options.sticky&&(i.mousemove=this._moveTooltip),ri&&(i.click=this._openTooltip)),this[e](i),this._tooltipHandlersAdded=!t}},openTooltip:function(t,e){if(t instanceof hn||(e=t,t=this),t instanceof dn)for(var i in this._layers){t=this._layers[i];break}return e||(e=t.getCenter?t.getCenter():t.getLatLng()),this._tooltip&&this._map&&(this._tooltip._source=t,this._tooltip.update(),this._map.openTooltip(this._tooltip,e),this._tooltip.options.interactive&&this._tooltip._container&&(mt(this._tooltip._container,"leaflet-clickable"),this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip:function(){return this._tooltip&&(this._tooltip._close(),this._tooltip.options.interactive&&this._tooltip._container&&(ft(this._tooltip._container,"leaflet-clickable"),this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip:function(t){return this._tooltip&&(this._tooltip._map?this.closeTooltip():this.openTooltip(t)),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_openTooltip:function(t){var e=t.layer||t.target;this._tooltip&&this._map&&this.openTooltip(e,this._tooltip.options.sticky?t.latlng:void 0)},_moveTooltip:function(t){var e,i,n=t.latlng;this._tooltip.options.sticky&&t.originalEvent&&(e=this._map.mouseEventToContainerPoint(t.originalEvent),i=this._map.containerPointToLayerPoint(e),n=this._map.layerPointToLatLng(i)),this._tooltip.setLatLng(n)}});var An=mn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&"DIV"===t.tagName?t:document.createElement("div"),i=this.options;if(e.innerHTML=i.html!==!1?i.html:"",i.bgPos){var n=b(i.bgPos);e.style.backgroundPosition=-n.x+"px "+-n.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});mn.Default=fn;var Dn=hn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ti,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){u(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView(),this._update()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),ht(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(ct(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(dt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllTiles(),this._update()),this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=o(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof x?t:new x(t,t)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e,i=this.getPane().children,n=-t(-(1/0),1/0),o=0,r=i.length;o<r;o++)e=i[o].style.zIndex,i[o]!==this._container&&e&&(n=t(n,+e));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Re){vt(this._container,this.options.opacity);var t=+new Date,e=!1,i=!1;for(var n in this._tiles){var o=this._tiles[n];if(o.current&&o.loaded){var r=Math.min(1,(t-o.loaded)/200);vt(o.el,r),r<1?e=!0:(o.active?i=!0:this._onOpaqueTile(o),o.active=!0)}}i&&!this._noPrune&&this._pruneTiles(),e&&(g(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this))}},_onOpaqueTile:s,_initContainer:function(){this._container||(this._container=lt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(void 0!==t){for(var i in this._levels)this._levels[i].el.children.length||i===t?(this._levels[i].el.style.zIndex=e-Math.abs(t-i),this._onUpdateLevel(i)):(ht(this._levels[i].el),this._removeTilesAtZoom(i),this._onRemoveLevel(i),delete this._levels[i]);var n=this._levels[t],o=this._map;return n||(n=this._levels[t]={},n.el=lt("div","leaflet-tile-container leaflet-zoom-animated",this._container),n.el.style.zIndex=e,n.origin=o.project(o.unproject(o.getPixelOrigin()),t).round(),n.zoom=t,this._setZoomTransform(n,o.getCenter(),o.getZoom()),s(n.el.offsetWidth),this._onCreateLevel(n)),this._level=n,n}},_onUpdateLevel:s,_onRemoveLevel:s,_onCreateLevel:s,_pruneTiles:function(){if(this._map){var t,e,i=this._map.getZoom();if(i>this.options.maxZoom||i<this.options.minZoom)return void this._removeAllTiles();for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var n=e.coords;this._retainParent(n.x,n.y,n.z,n.z-5)||this._retainChildren(n.x,n.y,n.z,n.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)ht(this._levels[t].el),this._onRemoveLevel(t),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,i,n){var o=Math.floor(t/2),r=Math.floor(e/2),s=i-1,a=new x((+o),(+r));a.z=+s;var l=this._tileCoordsToKey(a),h=this._tiles[l];return h&&h.active?(h.retain=!0,!0):(h&&h.loaded&&(h.retain=!0),s>n&&this._retainParent(o,r,s,n))},_retainChildren:function(t,e,i,n){for(var o=2*t;o<2*t+2;o++)for(var r=2*e;r<2*e+2;r++){var s=new x(o,r);s.z=i+1;var a=this._tileCoordsToKey(s),l=this._tiles[a];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),i+1<n&&this._retainChildren(o,r,i+1,n))}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return void 0!==e.minNativeZoom&&t<e.minNativeZoom?e.minNativeZoom:void 0!==e.maxNativeZoom&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,i,n){var o=this._clampZoom(Math.round(e));(void 0!==this.options.maxZoom&&o>this.options.maxZoom||void 0!==this.options.minZoom&&o<this.options.minZoom)&&(o=void 0);var r=this.options.updateWhenZooming&&o!==this._tileZoom;n&&!r||(this._tileZoom=o,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==o&&this._update(t),i||this._pruneTiles(),this._noPrune=!!i),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var i in this._levels)this._setZoomTransform(this._levels[i],t,e)},_setZoomTransform:function(t,e,i){var n=this._map.getZoomScale(i,t.zoom),o=t.origin.multiplyBy(n).subtract(this._map._getNewPixelOrigin(e,i)).round();$e?bt(t.el,o,n):Pt(t.el,o)},_resetGrid:function(){var t=this._map,e=t.options.crs,i=this._tileSize=this.getTileSize(),n=this._tileZoom,o=this._map.getPixelWorldBounds(this._tileZoom);o&&(this._globalTileRange=this._pxBoundsToTileRange(o)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],n).x/i.x),Math.ceil(t.project([0,e.wrapLng[1]],n).x/i.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],n).y/i.x),Math.ceil(t.project([e.wrapLat[1],0],n).y/i.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(t){var e=this._map,i=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),n=e.getZoomScale(i,this._tileZoom),o=e.project(t,this._tileZoom).floor(),r=e.getSize().divideBy(2*n);return new P(o.subtract(r),o.add(r))},_update:function(t){var e=this._map;if(e){var i=this._clampZoom(e.getZoom());if(void 0===t&&(t=e.getCenter()),void 0!==this._tileZoom){var n=this._getTiledPixelBounds(t),o=this._pxBoundsToTileRange(n),r=o.getCenter(),s=[],a=this.options.keepBuffer,l=new P(o.getBottomLeft().subtract([a,-a]),o.getTopRight().add([a,-a]));if(!(isFinite(o.min.x)&&isFinite(o.min.y)&&isFinite(o.max.x)&&isFinite(o.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var h in this._tiles){var u=this._tiles[h].coords;u.z===this._tileZoom&&l.contains(new x(u.x,u.y))||(this._tiles[h].current=!1)}if(Math.abs(i-this._tileZoom)>1)return void this._setView(t,i);for(var c=o.min.y;c<=o.max.y;c++)for(var d=o.min.x;d<=o.max.x;d++){var p=new x(d,c);if(p.z=this._tileZoom,this._isValidTile(p)){var m=this._tiles[this._tileCoordsToKey(p)];m?m.current=!0:s.push(p)}}if(s.sort(function(t,e){return t.distanceTo(r)-e.distanceTo(r)}),0!==s.length){this._loading||(this._loading=!0,this.fire("loading"));var f=document.createDocumentFragment();for(d=0;d<s.length;d++)this._addTile(s[d],f);this._level.el.appendChild(f)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var i=this._globalTileRange;if(!e.wrapLng&&(t.x<i.min.x||t.x>i.max.x)||!e.wrapLat&&(t.y<i.min.y||t.y>i.max.y))return!1}if(!this.options.bounds)return!0;var n=this._tileCoordsToBounds(t);return S(this.options.bounds).overlaps(n)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,i=this.getTileSize(),n=t.scaleBy(i),o=n.add(i),r=e.unproject(n,t.z),s=e.unproject(o,t.z);return[r,s]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),i=new w(e[0],e[1]);return this.options.noWrap||(i=this._map.wrapLatLngBounds(i)),i},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),i=new x((+e[0]),(+e[1]));return i.z=+e[2],i},_removeTile:function(t){var e=this._tiles[t];e&&(Ge||e.el.setAttribute("src",ge),ht(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){mt(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=s,t.onmousemove=s,Re&&this.options.opacity<1&&vt(t,this.options.opacity),Fe&&!Ze&&(t.style.WebkitBackfaceVisibility="hidden")},_addTile:function(t,e){var n=this._getTilePos(t),o=this._tileCoordsToKey(t),r=this.createTile(this._wrapCoords(t),i(this._tileReady,this,t));this._initTile(r),this.createTile.length<2&&_(i(this._tileReady,this,t,null,r)),Pt(r,n),this._tiles[o]={el:r,coords:t,current:!0},e.appendChild(r),this.fire("tileloadstart",{tile:r,coords:t})},_tileReady:function(t,e,n){if(this._map&&n.getAttribute("src")!==ge){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var o=this._tileCoordsToKey(t);n=this._tiles[o],n&&(n.loaded=+new Date,this._map._fadeAnimated?(vt(n.el,0),g(this._fadeFrame),this._fadeFrame=_(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(mt(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Re||!this._map._fadeAnimated?_(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))}},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new x(this._wrapX?r(t.x,this._wrapX):t.x,this._wrapY?r(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new P(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}}),Rn=Dn.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1},initialize:function(t,e){this._url=t,e=u(this,e),e.detectRetina&&li&&e.maxZoom>0&&(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom++):(e.zoomOffset++,e.maxZoom--),e.minZoom=Math.max(0,e.minZoom)),"string"==typeof e.subdomains&&(e.subdomains=e.subdomains.split("")),Fe||this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return V(n,"load",i(this._tileOnLoad,this,e,n)),V(n,"error",i(this._tileOnError,this,e,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),n.alt="",n.setAttribute("role","presentation"),n.src=this.getTileUrl(t),n},getTileUrl:function(t){var i={r:li?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var n=this._globalTileRange.max.y-t.y;this.options.tms&&(i.y=n),i["-y"]=n}return d(this._url,e(i,this.options))},_tileOnLoad:function(t,e){Re?setTimeout(i(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,i){var n=this.options.errorTileUrl;n&&e.getAttribute("src")!==n&&(e.src=n),t(i,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,i=this.options.zoomReverse,n=this.options.zoomOffset;return i&&(t=e-t),t+n},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=s,e.onerror=s,e.complete||(e.src=ge,ht(e),delete this._tiles[t]))}}),Bn=Rn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,i){this._url=t;var n=e({},this.defaultWmsParams);for(var o in i)o in this.options||(n[o]=i[o]);i=u(this,i);var r=i.detectRetina&&li?2:1,s=this.getTileSize();n.width=s.x*r,n.height=s.y*r,this.wmsParams=n},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,Rn.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),i=this._crs,n=T(i.project(e[0]),i.project(e[1])),o=n.min,r=n.max,s=(this._wmsVersion>=1.3&&this._crs===an?[o.y,o.x,r.y,r.x]:[o.x,o.y,r.x,r.y]).join(","),a=Rn.prototype.getTileUrl.call(this,t);return a+c(this.wmsParams,a,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+s},setParams:function(t,i){return e(this.wmsParams,t),i||this.redraw(),this}});Rn.WMS=Bn,se.wms=ae;var Nn=hn.extend({options:{padding:.1,tolerance:0},initialize:function(t){u(this,t),n(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&mt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),
t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var i=this._map.getZoomScale(e,this._zoom),n=Lt(this._container),o=this._map.getSize().multiplyBy(.5+this.options.padding),r=this._map.project(this._center,e),s=this._map.project(t,e),a=s.subtract(r),l=o.multiplyBy(-i).add(n).add(o).subtract(a);$e?bt(this._container,l,i):Pt(this._container,l)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),i=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new P(i,i.add(e.multiplyBy(1+2*t)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Fn=Nn.extend({getEvents:function(){var t=Nn.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Nn.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");V(t,"mousemove",o(this._onMouseMove,32,this),this),V(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),V(t,"mouseout",this._handleMouseOut,this),this._ctx=t.getContext("2d")},_destroyContainer:function(){g(this._redrawRequest),delete this._ctx,ht(this._container),q(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){this._drawnLayers={},Nn.prototype._update.call(this);var t=this._bounds,e=this._container,i=t.getSize(),n=li?2:1;Pt(e,t.min),e.width=n*i.x,e.height=n*i.y,e.style.width=i.x+"px",e.style.height=i.y+"px",li&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Nn.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[n(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,i=e.next,o=e.prev;i?i.prev=o:this._drawLast=o,o?o.next=i:this._drawFirst=i,delete t._order,delete this._layers[n(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(t.options.dashArray){var e,i=t.options.dashArray.split(","),n=[];for(e=0;e<i.length;e++)n.push(Number(i[e]));t.options._dashArray=n}},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||_(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new P,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.clearRect(0,0,this._container.width,this._container.height)},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var i=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,i.x,i.y),this._ctx.clip()}this._drawing=!0;for(var n=this._drawFirst;n;n=n.next)t=n.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var i,n,o,r,s=t._parts,a=s.length,l=this._ctx;if(a){for(this._drawnLayers[t._leaflet_id]=t,l.beginPath(),i=0;i<a;i++){for(n=0,o=s[i].length;n<o;n++)r=s[i][n],l[n?"lineTo":"moveTo"](r.x,r.y);e&&l.closePath()}this._fillStroke(l,t)}}},_updateCircle:function(t){if(this._drawing&&!t._empty()){var e=t._point,i=this._ctx,n=Math.max(Math.round(t._radius),1),o=(Math.max(Math.round(t._radiusY),1)||n)/n;this._drawnLayers[t._leaflet_id]=t,1!==o&&(i.save(),i.scale(1,o)),i.beginPath(),i.arc(e.x,e.y/o,n,0,2*Math.PI,!1),1!==o&&i.restore(),this._fillStroke(i,t)}},_fillStroke:function(t,e){var i=e.options;i.fill&&(t.globalAlpha=i.fillOpacity,t.fillStyle=i.fillColor||i.color,t.fill(i.fillRule||"evenodd")),i.stroke&&0!==i.weight&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=i.opacity,t.lineWidth=i.weight,t.strokeStyle=i.color,t.lineCap=i.lineCap,t.lineJoin=i.lineJoin,t.stroke())},_onClick:function(t){for(var e,i,n=this._map.mouseEventToLayerPoint(t),o=this._drawFirst;o;o=o.next)e=o.layer,e.options.interactive&&e._containsPoint(n)&&!this._map._draggableMoved(e)&&(i=e);i&&(it(t),this._fireEvent([i],t))},_onMouseMove:function(t){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(ft(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null)},_handleMouseHover:function(t,e){for(var i,n,o=this._drawFirst;o;o=o.next)i=o.layer,i.options.interactive&&i._containsPoint(e)&&(n=i);n!==this._hoveredLayer&&(this._handleMouseOut(t),n&&(mt(this._container,"leaflet-interactive"),this._fireEvent([n],t,"mouseover"),this._hoveredLayer=n)),this._hoveredLayer&&this._fireEvent([this._hoveredLayer],t)},_fireEvent:function(t,e,i){this._map._fireDOMEvent(e,i||e.type,t)},_bringToFront:function(t){var e=t._order,i=e.next,n=e.prev;i&&(i.prev=n,n?n.next=i:i&&(this._drawFirst=i),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t))},_bringToBack:function(t){var e=t._order,i=e.next,n=e.prev;n&&(n.next=i,i?i.prev=n:n&&(this._drawLast=n),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t))}}),Zn=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch(t){return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),Un={_initContainer:function(){this._container=lt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Nn.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=Zn("shape");mt(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=Zn("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[n(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;ht(e),t.removeInteractiveTarget(e),delete this._layers[n(t)]},_updateStyle:function(t){var e=t._stroke,i=t._fill,n=t.options,o=t._container;o.stroked=!!n.stroke,o.filled=!!n.fill,n.stroke?(e||(e=t._stroke=Zn("stroke")),o.appendChild(e),e.weight=n.weight+"px",e.color=n.color,e.opacity=n.opacity,n.dashArray?e.dashStyle=_e(n.dashArray)?n.dashArray.join(" "):n.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=n.lineCap.replace("butt","flat"),e.joinstyle=n.lineJoin):e&&(o.removeChild(e),t._stroke=null),n.fill?(i||(i=t._fill=Zn("fill")),o.appendChild(i),i.color=n.fillColor||n.color,i.opacity=n.fillOpacity):i&&(o.removeChild(i),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),i=Math.round(t._radius),n=Math.round(t._radiusY||i);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+i+","+n+" 0,23592600")},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){ct(t._container)},_bringToBack:function(t){dt(t._container)}},Gn=ci?Zn:O,jn=Nn.extend({getEvents:function(){var t=Nn.prototype.getEvents.call(this);return t.zoomstart=this._onZoomStart,t},_initContainer:function(){this._container=Gn("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Gn("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ht(this._container),q(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_onZoomStart:function(){this._update()},_update:function(){if(!this._map._animatingZoom||!this._bounds){Nn.prototype._update.call(this);var t=this._bounds,e=t.getSize(),i=this._container;this._svgSize&&this._svgSize.equals(e)||(this._svgSize=e,i.setAttribute("width",e.x),i.setAttribute("height",e.y)),Pt(i,t.min),i.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=Gn("path");t.options.className&&mt(e,t.options.className),t.options.interactive&&mt(e,"leaflet-interactive"),this._updateStyle(t),this._layers[n(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){ht(t._path),t.removeInteractiveTarget(t._path),delete this._layers[n(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,i=t.options;e&&(i.stroke?(e.setAttribute("stroke",i.color),e.setAttribute("stroke-opacity",i.opacity),e.setAttribute("stroke-width",i.weight),e.setAttribute("stroke-linecap",i.lineCap),e.setAttribute("stroke-linejoin",i.lineJoin),i.dashArray?e.setAttribute("stroke-dasharray",i.dashArray):e.removeAttribute("stroke-dasharray"),i.dashOffset?e.setAttribute("stroke-dashoffset",i.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),i.fill?(e.setAttribute("fill",i.fillColor||i.color),e.setAttribute("fill-opacity",i.fillOpacity),e.setAttribute("fill-rule",i.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,E(t._parts,e))},_updateCircle:function(t){var e=t._point,i=Math.max(Math.round(t._radius),1),n=Math.max(Math.round(t._radiusY),1)||i,o="a"+i+","+n+" 0 1,0 ",r=t._empty()?"M0 0":"M"+(e.x-i)+","+e.y+o+2*i+",0 "+o+2*-i+",0 ";this._setPath(t,r)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){ct(t._path)},_bringToBack:function(t){dt(t._path)}});ci&&jn.include(Un),Ri.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if("overlayPane"===t||void 0===t)return!1;var e=this._paneRenderers[t];return void 0===e&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&le(t)||he(t)}});var Hn=Pn.extend({initialize:function(t,e){Pn.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=S(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});jn.create=Gn,jn.pointsToPath=E,Ln.geometryToLayer=Yt,Ln.coordsToLatLng=Xt,Ln.coordsToLatLngs=Jt,Ln.latLngToCoords=Qt,Ln.latLngsToCoords=$t,Ln.getFeature=te,Ln.asFeature=ee,Ri.mergeOptions({boxZoom:!0});var Vn=Wi.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){V(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){q(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ht(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){return!(!t.shiftKey||1!==t.which&&1!==t.button)&&(this._clearDeferredResetState(),this._resetState(),ke(),Tt(),this._startPoint=this._map.mouseEventToContainerPoint(t),void V(document,{contextmenu:$,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this))},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=lt("div","leaflet-zoom-box",this._container),mt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new P(this._point,this._startPoint),i=e.getSize();Pt(this._box,e.min),this._box.style.width=i.x+"px",this._box.style.height=i.y+"px"},_finish:function(){this._moved&&(ht(this._box),ft(this._container,"leaflet-crosshair")),Ce(),wt(),q(document,{contextmenu:$,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var e=new w(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){27===t.keyCode&&this._finish()}});Ri.addInitHook("addHandler","boxZoom",Vn),Ri.mergeOptions({doubleClickZoom:!0});var qn=Wi.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,i=e.getZoom(),n=e.options.zoomDelta,o=t.originalEvent.shiftKey?i-n:i+n;"center"===e.options.doubleClickZoom?e.setZoom(o):e.setZoomAround(t.containerPoint,o)}});Ri.addInitHook("addHandler","doubleClickZoom",qn),Ri.mergeOptions({dragging:!0,inertia:!Ze,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Wn=Wi.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new $i(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}mt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ft(this._map._container,"leaflet-grab"),ft(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=S(this._map.options.maxBounds);this._offsetLimit=T(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,i=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(i),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),i=this._initialWorldOffset,n=this._draggable._newPos.x,o=(n-e+i)%t+e-i,r=(n+e+i)%t-e-i,s=Math.abs(o+i)<Math.abs(r+i)?o:r;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=s},_onDragEnd:function(t){var e=this._map,i=e.options,n=!i.inertia||this._times.length<2;if(e.fire("dragend",t),n)e.fire("moveend");else{this._prunePositions(+new Date);var o=this._lastPos.subtract(this._positions[0]),r=(this._lastTime-this._times[0])/1e3,s=i.easeLinearity,a=o.multiplyBy(s/r),l=a.distanceTo([0,0]),h=Math.min(i.inertiaMaxSpeed,l),u=a.multiplyBy(h/l),c=h/(i.inertiaDeceleration*s),d=u.multiplyBy(-c/2).round();d.x||d.y?(d=e._limitOffset(d,e.options.maxBounds),_(function(){e.panBy(d,{duration:c,easeLinearity:s,noMoveStart:!0,animate:!0})})):e.fire("moveend")}}});Ri.addInitHook("addHandler","dragging",Wn),Ri.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Kn=Wi.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),V(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),q(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,i=t.scrollTop||e.scrollTop,n=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(n,i)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e,i,n=this._panKeys={},o=this.keyCodes;for(e=0,i=o.left.length;e<i;e++)n[o.left[e]]=[-1*t,0];for(e=0,i=o.right.length;e<i;e++)n[o.right[e]]=[t,0];for(e=0,i=o.down.length;e<i;e++)n[o.down[e]]=[0,t];for(e=0,i=o.up.length;e<i;e++)n[o.up[e]]=[0,-1*t]},_setZoomDelta:function(t){var e,i,n=this._zoomKeys={},o=this.keyCodes;for(e=0,i=o.zoomIn.length;e<i;e++)n[o.zoomIn[e]]=t;for(e=0,i=o.zoomOut.length;e<i;e++)n[o.zoomOut[e]]=-t},_addHooks:function(){V(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){q(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e,i=t.keyCode,n=this._map;if(i in this._panKeys){if(n._panAnim&&n._panAnim._inProgress)return;e=this._panKeys[i],t.shiftKey&&(e=b(e).multiplyBy(3)),n.panBy(e),n.options.maxBounds&&n.panInsideBounds(n.options.maxBounds)}else if(i in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[i]);else{if(27!==i||!n._popup||!n._popup.options.closeOnEscapeKey)return;n.closePopup()}$(t)}}});Ri.addInitHook("addHandler","keyboard",Kn),Ri.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Yn=Wi.extend({addHooks:function(){V(this._map._container,"mousewheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){q(this._map._container,"mousewheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=et(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var o=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),o),$(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),i=this._map.options.zoomSnap||0;t._stop();var n=this._delta/(4*this._map.options.wheelPxPerZoomLevel),o=4*Math.log(2/(1+Math.exp(-Math.abs(n))))/Math.LN2,r=i?Math.ceil(o/i)*i:o,s=t._limitZoom(e+(this._delta>0?r:-r))-e;this._delta=0,this._startTime=null,s&&("center"===t.options.scrollWheelZoom?t.setZoom(e+s):t.setZoomAround(this._lastMousePos,e+s))}});Ri.addInitHook("addHandler","scrollWheelZoom",Yn),Ri.mergeOptions({tap:!0,tapTolerance:15});var Xn=Wi.extend({addHooks:function(){V(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){q(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(t.touches){if(Q(t),this._fireClick=!0,t.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var e=t.touches[0],n=e.target;this._startPos=this._newPos=new x(e.clientX,e.clientY),n.tagName&&"a"===n.tagName.toLowerCase()&&mt(n,"leaflet-active"),this._holdTimeout=setTimeout(i(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",e))},this),1e3),this._simulateEvent("mousedown",e),V(document,{touchmove:this._onMove,touchend:this._onUp},this)}},_onUp:function(t){if(clearTimeout(this._holdTimeout),q(document,{touchmove:this._onMove,touchend:this._onUp},this),this._fireClick&&t&&t.changedTouches){var e=t.changedTouches[0],i=e.target;i&&i.tagName&&"a"===i.tagName.toLowerCase()&&ft(i,"leaflet-active"),this._simulateEvent("mouseup",e),this._isTapValid()&&this._simulateEvent("click",e)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(t){var e=t.touches[0];this._newPos=new x(e.clientX,e.clientY),this._simulateEvent("mousemove",e)},_simulateEvent:function(t,e){var i=document.createEvent("MouseEvents");i._simulated=!0,e.target._simulatedClick=!0,i.initMouseEvent(t,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}});ri&&!oi&&Ri.addInitHook("addHandler","tap",Xn),Ri.mergeOptions({touchZoom:ri&&!Ze,bounceAtZoomLimits:!0});var Jn=Wi.extend({addHooks:function(){mt(this._map._container,"leaflet-touch-zoom"),V(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ft(this._map._container,"leaflet-touch-zoom"),q(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(t.touches&&2===t.touches.length&&!e._animatingZoom&&!this._zooming){var i=e.mouseEventToContainerPoint(t.touches[0]),n=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),"center"!==e.options.touchZoom&&(this._pinchStartLatLng=e.containerPointToLatLng(i.add(n)._divideBy(2))),this._startDist=i.distanceTo(n),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),V(document,"touchmove",this._onTouchMove,this),V(document,"touchend",this._onTouchEnd,this),Q(t)}},_onTouchMove:function(t){if(t.touches&&2===t.touches.length&&this._zooming){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),o=e.mouseEventToContainerPoint(t.touches[1]),r=n.distanceTo(o)/this._startDist;if(this._zoom=e.getScaleZoom(r,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&r<1||this._zoom>e.getMaxZoom()&&r>1)&&(this._zoom=e._limitZoom(this._zoom)),"center"===e.options.touchZoom){if(this._center=this._startLatLng,1===r)return}else{var s=n._add(o)._divideBy(2)._subtract(this._centerPoint);if(1===r&&0===s.x&&0===s.y)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(s),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),g(this._animRequest);var a=i(e._move,e,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=_(a,this,!0),Q(t)}},_onTouchEnd:function(){return this._moved&&this._zooming?(this._zooming=!1,g(this._animRequest),q(document,"touchmove",this._onTouchMove),q(document,"touchend",this._onTouchEnd),void(this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom)))):void(this._zooming=!1)}});Ri.addInitHook("addHandler","touchZoom",Jn),Ri.BoxZoom=Vn,Ri.DoubleClickZoom=qn,Ri.Drag=Wn,Ri.Keyboard=Kn,Ri.ScrollWheelZoom=Yn,Ri.Tap=Xn,Ri.TouchZoom=Jn,Object.freeze=de,t.version=ce,t.Control=Bi,t.control=Ni,t.Browser=di,t.Evented=Le,t.Mixin=Yi,t.Util=be,t.Class=v,t.Handler=Wi,t.extend=e,t.bind=i,t.stamp=n,t.setOptions=u,t.DomEvent=Mi,t.DomUtil=Ai,t.PosAnimation=Di,t.Draggable=$i,t.LineUtil=tn,t.PolyUtil=en,t.Point=x,t.point=b,t.Bounds=P,t.bounds=T,t.Transformation=k,t.transformation=C,t.Projection=rn,t.LatLng=M,t.latLng=I,t.LatLngBounds=w,t.latLngBounds=S,t.CRS=we,t.GeoJSON=Ln,t.geoJSON=ie,t.geoJson=wn,t.Layer=hn,t.LayerGroup=un,t.layerGroup=cn,t.FeatureGroup=dn,t.featureGroup=pn,t.ImageOverlay=Sn,t.imageOverlay=Mn,t.VideoOverlay=In,t.videoOverlay=ne,t.DivOverlay=kn,t.Popup=Cn,t.popup=On,t.Tooltip=En,t.tooltip=zn,t.Icon=mn,t.icon=jt,t.DivIcon=An,t.divIcon=oe,t.Marker=gn,t.marker=Ht,t.TileLayer=Rn,t.tileLayer=se,t.GridLayer=Dn,t.gridLayer=re,t.SVG=jn,t.svg=he,t.Renderer=Nn,t.Canvas=Fn,t.canvas=le,t.Path=vn,t.CircleMarker=yn,t.circleMarker=Vt,t.Circle=xn,t.circle=qt,t.Polyline=bn,t.polyline=Wt,t.Polygon=Pn,t.polygon=Kt,t.Rectangle=Hn,t.rectangle=ue,t.Map=Ri,t.map=It;var Qn=window.L;t.noConflict=function(){return window.L=Qn,this},window.L=t}),function(){"use strict";function t(t,e){this.layer=t,this.ts=t.options.tileSize,this.tileElem=e,this.tile=e.el;var n=e.coords,o=n.z,r=Math.pow(2,o),s=n.x%r,a=n.y%r,l=i;s<0&&(s+=r),a<0&&(a+=r),this.ntp={z:o,x:s,y:a},this.tilePoint=n,this.zoom=o,this.gmx=t._gmx,this.zKey=this.layer._tileCoordsToKey(n,o),this.worldWidthMerc=l.worldWidthMerc;var h=l.getTileNumFromLeaflet(n,o);this.tpx=this.ts*h.x,this.tpy=this.ts*(1+h.y);var u=l.tileSizes[n.z]*this.ts/256;this.tbounds=l.getBoundsByTilePoint(this.ntp,u),this.topLeft={tilePoint:n,tileSize:u,mInPixel:this.ts/u,pix:{px:this.ts*n.x,py:this.ts*n.y},wm:{x:u*n.x-this.worldWidthMerc,y:this.worldWidthMerc-u*n.y},bounds:l.getBoundsByTilePoint(n,u)},this.gmxTilePoint=h,this.showRaster=o>=this.gmx.minZoomRasters&&"rasterBGfunc"in this.gmx||o>=this.gmx.minZoomQuicklooks&&"quicklookBGfunc"in this.gmx,this.rasters={},this.rasterRequests={},this.itemsView=[],this._uniqueID=0,this.gmx.badTiles=this.gmx.badTiles||{}}var e;"undefined"!=typeof module&&module.exports?(e=require("leaflet"),e.gmx={},module.exports=e.gmx):e=window.L;var i={lastMapId:0,debug:/\bdebug=1\b/.test(location.search),fromWebMercY:function(t){return 90*(4*Math.atan(Math.exp(t/i.rMajor))/Math.PI-1)},newId:function(){return i.lastMapId+=1,"_"+i.lastMapId},uniqueGlobalName:function(t){var e=i.newId();return window[e]=t,e},_apiLoadedFrom:null,apiLoadedFrom:function(t){if(null===i._apiLoadedFrom){var e=document.currentScript?document.currentScript.src:i._searchApiScriptUrl(t);i._apiLoadedFrom=e?e.substring(0,e.lastIndexOf("/")):""}return i._apiLoadedFrom},_searchApiScriptUrl:function(t){for(var e=t?[new RegExp("\b"+t+"\b")]:[/\bleaflet-geomixer(-\w*)?\.js\b/,/\bgeomixer(-\w*)?\.js\b/],n=document.getElementsByTagName("script"),o=0,r=n.length;o<r;o++){for(var s=n[o].getAttribute("src"),a=0,l=e.length;a<l;a++)if(e[a].exec(s)){i._apiLoadedFrom=s.split("?")[0];break}if(i._apiLoadedFrom)break}return i._apiLoadedFrom||""},searchScriptAPIKey:function(){for(var t=0,e=i._searchApiScriptUrl(),n=e.length;t<n;t++){var o=e[t].split("=");if("key"===o[0])return o[1]}return""},createWorker:function(t){return new Promise(function(e,i){"createImageBitmap"in window&&"Worker"in window?0===t.indexOf(location.origin)?e(new Worker(t)):fetch(t,{mode:"cors"}).then(function(t){return t.blob()}).then(function(t){e(new Worker(window.URL.createObjectURL(t,{type:"application/javascript; charset=utf-8"})))}):i({error:"Browser don`t support `createImageBitmap` or `Worker`"})})},isPageHidden:function(){return document.hidden||document.msHidden||document.webkitHidden||document.mozHidden||!1},normalizeHostname:function(t){var i=e.gmxUtil.parseUri(("http"!==t.substr(0,4)?e.gmxUtil.protocol+"//":"")+t);return t=i.host+i.directory,"/"===t[t.length-1]&&(t=t.substring(0,t.length-1)),t},getLayerItemFromServer:function(t){var n=t.query?t.query:"["+t.field+"]="+t.value,o=e.gmxUtil.protocol+"//maps.kosmosnimki.ru/",r={WrapStyle:"func",geometry:!0,layer:t.layerID,query:n};return t.border&&(r.border=t.border),i.requestJSONP(t.url||(window.serverBase||o)+"VectorLayer/Search.ashx",r,t)},getCadastreFeatures:function(t){if(t.latlng){var e=t.latlng,n={WrapStyle:"func",text:(e.lat+" "+e.lng).replace(/\./g,","),tolerance:t.tolerance||0};return i.requestJSONP(t.url||"http://pkk5.rosreestr.ru/api/features/",n,t)}return null},getFormData:function(t){var e=[];for(var i in t){var n=t[i];e.push(i+"="+("object"==typeof n?JSON.stringify(n):n))}return e.join("&")},requestLink:function(t,i,n){return n=n||{},new Promise(function(o,r){var s=null;if(t.indexOf(".css")===-1){s=document.createElement("script"),s.setAttribute("charset","UTF-8");var a=e.extend({},i,e.gmx.gmxMapManager.syncParams),l=[];for(var h in a)l.push(h+"="+encodeURIComponent(a[h]));var u=t+(t.indexOf("?")===-1?"?":"&")+l.join("&"),c=function(a){e.gmxUtil.loaderStatus(u,!0),s.parentNode.removeChild(s),a?(r(t),console.warn("Not found script:",t)):o(t,i,n)};s.onerror=c,s.onload=function(){c()},e.gmxUtil.loaderStatus(u,null,"vector"),s.setAttribute("src",u)}else s=document.createElement("link"),s.rel="stylesheet",s.type="text/css",s.href=t,o(t,i,n);document.getElementsByTagName("head").item(0).appendChild(s)})},requestJSONP:function(t,n,o){o=o||{};var r=new e.gmx.Deferred,s=document.createElement("script");s.setAttribute("charset","UTF-8");var a="callbackParamName"in o?o.callbackParamName:"CallbackName",l=e.extend({},n,e.gmx.gmxMapManager.syncParams);if(a){var h=i.uniqueGlobalName(function(t){delete window[h],r.resolve(t,o)});l[a]=h}var u=[];for(var c in l)u.push(c+"="+encodeURIComponent(l[c]));var d=t+(t.indexOf("?")===-1?"?":"&")+u.join("&");return s.onerror=function(t){r.reject(t),e.gmxUtil.loaderStatus(d,!0),s.parentNode.removeChild(s)},s.onload=function(){e.gmxUtil.loaderStatus(d,!0),s.parentNode.removeChild(s)},e.gmxUtil.loaderStatus(d,null,"vector"),s.setAttribute("src",d),document.getElementsByTagName("head").item(0).appendChild(s),r},getXmlHttp:function(){var t;if("undefined"!=typeof XMLHttpRequest)t=new XMLHttpRequest;else try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(i){t=!1}}return t},request:function(t){var n=i.getXmlHttp();if(n){if(n.open(t.type?t.type:"GET",t.url,t.async||!1),t.headers)for(var o in t.headers)n.setRequestHeader(o,t.headers[o]);var r=e.gmxUtil.loaderStatus(t.url);t.async&&(t.withCredentials&&(n.withCredentials=!0),n.onreadystatechange=function(){4===n.readyState&&(e.gmxUtil.loaderStatus(r,!0),200===n.status?(t.callback(n.responseText),n=null):t.onError&&t.onError(n))});var s=null;if(t.params){s=t.params;var a=e.gmx.gmxMapManager.getSyncParams(!0);a&&(s+="&"+a)}return n.send(s),!(!t.async&&200===n.status)||(t.callback(n.responseText),e.gmxUtil.loaderStatus(r,!0),n.status)}return t.onError&&t.onError({Error:"bad XMLHttpRequest!"}),!1},tileSizes:[],getTileNumFromLeaflet:function(t,e){"z"in t&&(e=t.z);var i=Math.pow(2,e),n=t.x%i+(t.x<0?i:0),o=t.y%i+(t.y<0?i:0);return{z:e,x:n%i-i/2,y:i/2-1-o%i}},getTilePosZoomDelta:function(t,e,i){var n=Math.pow(2,e-i),o=256/n,r=t.x%n,s=t.y%n;return{size:o,zDelta:n,x:o*r,y:o*s}},isItemIntersectBounds:function(t,e){var i=t.type,n=t.coordinates;"POLYGON"!==i&&"Polygon"!==i||(n=[n]);
for(var o=0,r=n.length;o<r;o++)for(var s=0,a=n[o].length;s<a;s++)if(e.clipPolygon(n[o][s]).length)return!0;return!1},geoItemBounds:function(t){if(!t)return{bounds:null,boundsArr:[]};var e=t.type,n=t.coordinates,o=null,r=0,s=0,a=null,l=[];if("MULTIPOLYGON"===e||"MultiPolygon"===e)for(a=i.bounds(),r=0,s=n.length;r<s;r++){for(var h=[],u=0,c=n[r].length;u<c;u++)o=i.bounds(n[r][u]),h.push(o),0===u&&a.extendBounds(o);l.push(h)}else if("POLYGON"===e||"Polygon"===e)for(a=i.bounds(),r=0,s=n.length;r<s;r++)o=i.bounds(n[r]),l.push(o),0===r&&a.extendBounds(o);else if("POINT"===e||"Point"===e)a=i.bounds([n]);else if("MULTIPOINT"===e||"MultiPoint"===e)for(a=i.bounds(),r=0,s=n.length;r<s;r++)o=i.bounds([n[r]]),a.extendBounds(o);else if("LINESTRING"===e||"LineString"===e)a=i.bounds(n);else if("MULTILINESTRING"===e||"MultiLineString"===e)for(a=i.bounds(),r=0,s=n.length;r<s;r++)o=i.bounds(n[r]),a.extendBounds(o);return{bounds:a,boundsArr:l}},getUnFlattenGeo:function(t){var e=t.type,n=e.indexOf("POLYGON")!==-1||e.indexOf("Polygon")!==-1,o=t.coordinates,r=o;if(n){r=[];var s="POLYGON"===e||"Polygon"===e;s&&(o=[o]);for(var a=0,l=o.length;a<l;a++){for(var h=[],u=0,c=o[a].length;u<c;u++)h[u]=i.unFlattenRing(o[a][u]);r.push(h)}s&&(r=r[0])}return{type:e,coordinates:r}},unFlattenRing:function(t){if("number"!=typeof t[0])return t;for(var e=t.length,i=0,n=new Array(e/2),o=0;o<e;o+=2)n[i++]=[t[o],t[o+1]];return n},geoFlatten:function(t){var e=t.type,n=e.indexOf("POLYGON")!==-1||e.indexOf("Polygon")!==-1,o="POLYGON"===e||"Polygon"===e,r=t.coordinates;if(n){o&&(r=[r]);for(var s=0,a=r.length;s<a;s++)for(var l=0,h=r[s].length;l<h;l++)r[s][l]=i.flattenRing(r[s][l])}},flattenRing:function(t){for(var e=t.length,i=0,n="function"==typeof Float64Array?Float64Array:Array,o=new n(2*e),r=0;r<e;r++)o[i++]=t[r][0],o[i++]=t[r][1];return o},isRectangle:function(t){return t&&t[0]&&(5===t[0].length||4===t[0].length)&&(t[0][0][0]===t[0][1][0]||t[0][0][1]===t[0][1][1])&&(t[0][1][0]===t[0][2][0]||t[0][1][1]===t[0][2][1])&&(t[0][2][0]===t[0][3][0]||t[0][2][1]===t[0][3][1])&&(t[0][3][0]===t[0][0][0]||t[0][3][1]===t[0][0][1])},getGeometryBounds:function(t){var e=i.geoItemBounds(t);return e.bounds},getMarkerPolygon:function(t,e,i){var n=(t.min.x+t.max.x)/2,o=(t.min.y+t.max.y)/2;return[[n-e,o-i],[n-e,o+i],[n+e,o+i],[n+e,o-i],[n-e,o-i]]},getQuicklookPointsFromProperties:function(t,n){var o=n.tileAttributeIndexes,r={x1:i.getPropItem(n.quicklookX1||("x1"in o?"x1":"X1"),t,o)||0,y1:i.getPropItem(n.quicklookY1||("y1"in o?"y1":"Y1"),t,o)||0,x2:i.getPropItem(n.quicklookX2||("x2"in o?"x2":"X2"),t,o)||0,y2:i.getPropItem(n.quicklookY2||("y2"in o?"y2":"Y2"),t,o)||0,x3:i.getPropItem(n.quicklookX3||("x3"in o?"x3":"X3"),t,o)||0,y3:i.getPropItem(n.quicklookY3||("y3"in o?"y3":"Y3"),t,o)||0,x4:i.getPropItem(n.quicklookX4||("x4"in o?"x4":"X4"),t,o)||0,y4:i.getPropItem(n.quicklookY4||("y4"in o?"y4":"Y4"),t,o)||0},s=i.bounds([[r.x1,r.y1],[r.x2,r.y2],[r.x3,r.y3],[r.x4,r.y4]]);if(s.max.x===s.min.x||s.max.y===s.min.y)return null;if(!n.quicklookPlatform){var a=3857==n.srs?e.CRS.EPSG3857:e.Projection.Mercator,l=a.project(e.latLng(r.y1,r.x1));r.x1=l.x,r.y1=l.y,l=a.project(e.latLng(r.y2,r.x2)),r.x2=l.x,r.y2=l.y,l=a.project(e.latLng(r.y3,r.x3)),r.x3=l.x,r.y3=l.y,l=a.project(e.latLng(r.y4,r.x4)),r.x4=l.x,r.y4=l.y}return r},getPropertiesHash:function(t,e){var i={};for(var n in e)i[n]=t[e[n]];return i},getPropItem:function(t,e,i){return t in i?e[i[t]]:""},dec2rgba:function(t,e){var i=t>>16&255,n=t>>8&255,o=255&t;return"rgba("+i+", "+n+", "+o+", "+e+")"},dec2hex:function(t){return(t+16777216).toString(16).substr(-6)},dec2color:function(t,e){return e<1?this.dec2rgba(t,e):"#"+this.dec2hex(t)},oneDay:86400,isTileKeysIntersects:function(t,e){if(t.z<e.z){var i=t;t=e,e=i}var n=t.z-e.z;return t.x>>n===e.x&&t.y>>n===e.y},rotatePoints:function(t,e,i,n){var o=[];e*=Math.PI/180;var r=Math.sin(e),s=Math.cos(e);i||(i=1);for(var a=0;a<t.length;a++){var l=i*t[a].x-n.x,h=i*t[a].y-n.y;o.push({x:s*l-r*h+n.x,y:r*l+s*h+n.y})}return o},getPatternIcon:function(t,e,n){if(!e.fillPattern)return null;var o=!0,r=e.fillPattern,s=t?t.properties:null,a=r.step>0?r.step:0,l={minWidth:1,maxWidth:1e3,minStep:0,maxStep:1e3};r.patternStepFunction&&null!==s&&(a=r.patternStepFunction(s,n),o=!1),a>l.maxStep?a=l.maxStep:a<l.minStep&&(a=l.minStep);var h=r.width>0?r.width:8;r.patternWidthFunction&&null!==s&&(h=r.patternWidthFunction(s,n),o=!1),h>l.maxWidth?h=l.maxWidth:h<l.minWidth&&(h=l.minWidth);var u=e.fillOpacity;e.opacityFunction&&null!==s&&(u=e.opacityFunction(s,n)/100,o=!1);var c=[16711680,65280,255],d=null!=r.colors?r.colors:c,p=d.length,m=[],f=0;for(f=0;f<p;f++){var _=d[f];r.patternColorsFunction&&null!==r.patternColorsFunction[f]&&(_=null!==s?r.patternColorsFunction[f](s,n):c[f%3],o=!1),m.push(_)}0===p&&(m=[0],u=0,p=1);var g=h+a,v=g*p,y=0,x=0,b=v,P=v,L=r.style||"horizontal",T=!1;if("diagonal1"===L||"diagonal2"===L||"cross"===L||"cross1"===L?T=!0:"circle"===L?(P=b=2*g,y=Math.floor(P/2),x=2*Math.PI/p):"vertical"===L?b=1:"horizontal"===L&&(P=1),P*b>l.maxWidth)return console.log({func:"getPatternIcon",Error:"MAX_PATTERN_SIZE",alert:"Bitmap from pattern is too big"}),null;var w=document.createElement("canvas");w.width=P,w.height=b;var S=w.getContext("2d");for(S.clearRect(0,0,w.width,w.height),"diagonal2"!==L&&"vertical"!==L||(S.translate(P,0),S.rotate(Math.PI/2)),f=0;f<p;f++){S.beginPath();var M=i.dec2color(m[f],u);if(S.fillStyle=M,T){var I=f*g,k=I+h;S.moveTo(I,0),S.lineTo(k,0),S.lineTo(0,k),S.lineTo(0,I),S.lineTo(I,0),I+=v,k=I+h,S.moveTo(I,0),S.lineTo(k,0),S.lineTo(0,k),S.lineTo(0,I),S.lineTo(I,0),"cross"!==L&&"cross1"!==L||(I=f*g,k=I+h,S.moveTo(P,I),S.lineTo(P,k),S.lineTo(P-k,0),S.lineTo(P-I,0),S.lineTo(P,I),I+=v,k=I+h,S.moveTo(P,I),S.lineTo(P,k),S.lineTo(P-k,0),S.lineTo(P-I,0),S.lineTo(P,I))}else"circle"===L?(S.arc(y,y,h,f*x,(f+1)*x),S.lineTo(y,y)):S.fillRect(0,f*g,P,h);S.closePath(),S.fill()}var C=document.createElement("canvas");C.width=P,C.height=b;var O=C.getContext("2d");return O.drawImage(w,0,0,P,b),{notFunc:o,canvas:C}},setSVGIcon:function(t){return'<svg role="img" class="svgIcon"><use xlink:href="#'+t+'" href="#'+t+'"></use></svg>'},getSVGIcon:function(t){var i='<svg xmlns="'+e.Path.SVG_NS+'" xmlns:xlink="http://www.w3.org/1999/xlink"',n=t.type,o=t.fillStyle||"rgba(255, 255, 255, 0.5)",r=t.strokeStyle||"#0000ff",s=t.lineWidth||2,a={className:"gmx-svg-icon"};t.className&&(a.className=t.className);var l=t.iconSize;if(a.iconSize=[l,l],i+=' height = "'+l+'px"  width = "'+l+'px">',"circle"===n){if(t.fillRadialGradient){i+='<defs><radialGradient id="myRadialGradient4" spreadMethod="pad">';for(var h=t.fillRadialGradient.colorStop||t.fillRadialGradient.addColorStop||[[0,"#ffff00",.8],[1,"#ff0000",.8]],u=0,c=h.length;u<c;u++){var d=h[u];i+='<stop offset="'+100*d[0]+'%"   stop-color="'+d[1]+'" stop-opacity="'+d[2]+'"/>'}i+="</radialGradient></defs>",o="url(#myRadialGradient4)",r=s=null}l/=2,i+='<g><circle cx="'+l+'" cy="'+l+'" r="'+l+'" style="',o&&(i+=" fill:"+o+";"),r&&(i+=' stroke:"'+r+";"),s&&(i+=' stroke-width:"'+s+";"),i+=';" />'}else"square"===n&&(i+='<g><rect width="'+l+'" height="'+l+'" style="',o&&(i+=" fill:"+o+";"),r&&(i+=" stroke:"+r+";"),s&&(i+=" stroke-width:"+2*s+";"),i+='" />');if(t.text){var p=t.text;i+='<text x="50%" y="50%" dy="0.4em"';for(var m in p)"count"!==m&&(i+=" "+m+'="'+p[m]+'"');i+=">"+p.count+"</text>"}return i+="</g></svg>",a.html=i,new e.DivIcon(a)},toPixels:function(t,e,i,n){var o=t[0]*n;o=.5+o<<0;var r=t[1]*n;return r=.5+r<<0,[o-e,i-r].concat(t.slice(2))},getPixelPoint:function(t,e){var n=t.topLeft,o=n.mInPixel,r=t.item,s=r.currentStyle||r.parsedStyleKeys||{},a=t.style||{},l=s.iconScale||1,h=s.iconCenter||!1,u=s.sx||a.sx||4,c=s.sy||a.sy||4,d=s.weight||a.weight||0,p=s.iconAnchor||a.iconAnchor||null,m=t.tpx,f=t.tpy;!h&&p&&(g-=p[0],_-=p[1]),u*=l,c*=l,u+=d,c+=d;var _=f-e[1]*o,g=e[0]*o-m;return g-u>256?g=(e[0]-2*i.worldWidthMerc)*o-m:g<-u&&(g=(e[0]+2*i.worldWidthMerc)*o-m),_-c>256||g-u>256||g+u<0||_+c<0?null:{sx:u,sy:c,px1:.5+g<<0,py1:.5+_<<0}},getImageData:function(t){if(e.gmxUtil.isIE9||e.gmxUtil.isIE10)return null;var i=document.createElement("canvas"),n=t.width,o=t.height;i.width=n,i.height=o;var r=i.getContext("2d");return r.drawImage(t,0,0),r.getImageData(0,0,n,o).data},DEFAULT_REPLACEMENT_COLOR:16711935,isIE:function(t){return t===i.getIEversion()},gtIE:function(t){return t<i.getIEversion()},getIEversion:function(){var t=navigator.userAgent||"",e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);var i=t.indexOf("Trident/");if(i>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var o=t.indexOf("Edge/");return o>0?parseInt(t.substring(o+5,t.indexOf(".",o)),10):-1},replaceColor:function(t,i,n){if(e.gmxUtil.isIE9||e.gmxUtil.isIE10)return t;var o=document.createElement("canvas"),r=t.width,s=t.height;o.width=r,o.height=s;var a,l=!1,h=o.getContext("2d");if("string"==typeof i&&(i=parseInt("0x"+i.replace(/#/,""))),i!==this.DEFAULT_REPLACEMENT_COLOR){var u=i>>16&255,c=i>>8&255,d=255&i;n?a=h.createImageData(r,s):(h.drawImage(t,0,0),a=h.getImageData(0,0,r,s),n=a.data);for(var p=a.data,m=0,f=n.length;m<f;m+=4)255!==n[m]&&238!==n[m]||0!==n[m+1]||255!==n[m+2]||(p[m]=u,p[m+1]=c,p[m+2]=d,p[m+3]=n[m+3],l=!0)}return l?h.putImageData(a,0,0):h.drawImage(t,0,0),o},drawIconPath:function(t,n){if(e.Util.isArray(t)&&!(t.length<3)&&n.ctx){var o=!1,r=n.ctx,s=n.radian;(n.px||n.py)&&(r.translate(n.px||0,n.py||0),o=!0),!s&&n.rotateRes&&(s=Math.PI+i.degRad(n.rotateRes)),s&&(r.rotate(s),o=!0),r.moveTo(t[0],t[1]);for(var a=2,l=t.length;a<l;a+=2)r.lineTo(t[a],t[a+1]);o&&r.setTransform(1,0,0,1,0,0)}},pointToCanvas:function(t){var n=t.gmx,o=t.topLeft,r=o.mInPixel,s=t.pointAttr,a=t.style||{},l=t.item,h=l.currentStyle||l.parsedStyleKeys,u=h.iconScale||1,c=h.image,d=s.sx,p=s.sy,m=s.px1,f=s.py1,_=m,g=f,v=t.ctx;if("image"===h.type&&(d=a.sx,p=a.sy,c=a.image),h.iconCenter?(_-=d/2,g-=p/2):"circle"===a.type&&(m+=d/2,f+=p/2),h.iconPath&&(t.px=m,t.py=f,t.rotateRes=h.rotate||0),c)"iconColor"in h&&!e.gmxUtil.isIE11&&(c=this.replaceColor(c,h.iconColor,t.imageData)),a.rotateRes=h.rotate||0,"opacity"in a&&(v.globalAlpha=h.opacity||a.opacity),n.transformFlag?(v.setTransform(r,0,0,r,-t.tpx,t.tpy),v.drawImage(c,m,-f,d,p),v.setTransform(r,0,0,-r,-t.tpx,t.tpy)):(1!==u&&(d*=u,p*=u,m=s.px1,f=s.py1,_=m,g=f,h.iconCenter&&(_-=d/2,g-=p/2)),a.rotateRes?(v.translate(m,f),v.rotate(i.degRad(a.rotateRes)),v.translate(-m,-f),v.drawImage(c,_,g,d,p),v.setTransform(1,0,0,1,0,0)):v.drawImage(c,_,g,d,p)),"opacity"in a&&(v.globalAlpha=1);else if(a.fillColor||h.fillRadialGradient){if(v.beginPath(),h.iconPath)i.drawIconPath(h.iconPath,t);else if("circle"===a.type||h.fillRadialGradient){var y=a.iconSize/2;if(h.fillRadialGradient){var x=h.fillRadialGradient;y=x.r2*u;for(var b=v.createRadialGradient(m+x.x1,f+x.y1,x.r1*u,m+x.x2,f+x.y2,y),P=0,L=x.addColorStop.length;P<L;P++){var T=x.addColorStop[P];b.addColorStop(T[0],T[1])}v.fillStyle=b}v.arc(m,f,y,0,2*Math.PI)}else v.fillRect(_,g,d,p);v.fill()}h.strokeStyle&&(v.beginPath(),h.iconPath?i.drawIconPath(h.iconPath,t):"circle"===a.type?v.arc(m,f,a.iconSize/2,0,2*Math.PI):v.strokeRect(_,g,d,p),v.stroke())},lineToCanvasAsIcon:function(t,e){var n=t.length,o=e.ctx,r=e.item,s=r.currentStyle||r.parsedStyleKeys,a=s.iconPath;if(n>0){"getLineDash"in o&&o.getLineDash().length>0&&o.setLineDash([]),o.beginPath();for(var l,h=0;h<n;h++)l=t[h],i.drawIconPath(a,{ctx:o,px:l.x,py:l.y,radian:l.radian});s.strokeStyle&&o.stroke(),s.fillStyle&&o.fill()}},lineToCanvas:function(t){var e=t.topLeft,n=e.mInPixel,o=t.coords,r=t.ctx,s=t.item,a=s.currentStyle||s.parsedStyleKeys,l=a.iconPath?[]:null,h=null,u=null;r.beginPath();for(var c=0,d=o.length;c<d;c++){var p=i.toPixels(o[c],t.tpx,t.tpy,n,t.topLeft),m=p[0],f=p[1];h===m&&u===f||(l&&l.push({x:m,y:f,radian:p[2]}),0===c?r.moveTo(m,f):r.lineTo(m,f),h=m,u=f)}return r.stroke(),l},getCoordsPixels:function(t){for(var e=t.gmx,n=t.coords,o=t.hiddenLines||[],r=[],s=[],a=!1,l={gmx:e,topLeft:t.topLeft,tpx:t.tpx,tpy:t.tpy,coords:null,hiddenLines:null},h=0,u=n.length;h<u;h++){for(var c=n[h],d=o[h]||[],p=[],m=[],f=0,_=c.length;f<_;f++){l.coords=c[f],l.hiddenLines=d[f]||[];var g=i.getRingPixels(l);p.push(g.coords),m.push(g.hidden),g.hidden&&(a=!0)}r.push(p),s.push(m)}return{coords:r,hidden:a?s:null,z:t.topLeft.tilePoint.z}},getRingPixels:function(t){if(0===t.coords.length)return null;for(var e=t.topLeft,i=e.mInPixel,n=t.coords,o=t.hiddenLines||null,r=t.tpx,s=t.tpy,a=0,l=0,h=null,u=null,c="number"==typeof n[0]?2:1,d=[],p=[],m=0,f=n.length;m<f;m+=c){var _=!1;o&&m===o[l]&&(_=!0,l++);var g=1===c?n[m]:[n[m],n[m+1]],v=Math.round(g[0]*i),y=Math.round(g[1]*i),x=Math.round(v-r),b=Math.round(s-y);h===x&&u===b||(h=x,u=b,_&&p.push(a),d[a++]=v,d[a++]=y)}return{coords:d,hidden:p.length?p:null}},polygonToCanvas:function(t){if(0===t.coords.length)return null;var e=t.hiddenLines||null,i=t.coords,n=t.ctx,o=t.tpx,r=t.tpy,s=0,a=0,l="number"==typeof i[0]?2:1,h=null,u=null;n.beginPath();for(var c=0,d=i.length;c<d;c+=l){var p=1===l?i[c]:[i[c],i[c+1]],m=Math.round(p[0]-o),f=Math.round(r-p[1]),_=!1,g="round";e&&c===e[a]&&(_=!0,g="butt",a++),n.lineCap!==g&&(n.lineCap=g),h===m&&u===f||(n[_?"moveTo":"lineTo"](m,f),h=m,u=f,s++)}1===s&&n.lineTo(h+1,u),n.stroke()},polygonToCanvasFill:function(t){if(!(t.coords.length<3)){var e=t.coords,i=t.tpx,n=t.tpy,o=1,r=t.ctx;r.lineWidth=0,"number"==typeof e[0]?(o=2,r.moveTo(Math.round(e[0]-i),Math.round(n-e[1]))):r.moveTo(Math.round(e[0][0]-i),Math.round(n-e[0][1]));for(var s=o,a=e.length;s<a;s+=o){var l=1===o?e[s]:[e[s],e[s+1]];r.lineTo(Math.round(l[0]-i),Math.round(n-l[1]))}}},isPatternNode:function(t){return t instanceof HTMLCanvasElement||t instanceof HTMLImageElement},labelCanvasContext:null,getLabelWidth:function(t,e){if(e){if(!i.labelCanvasContext){var n=document.createElement("canvas");n.width=n.height=512,i.labelCanvasContext=n.getContext("2d")}var o=i.labelCanvasContext;o.clearRect(0,0,512,512),o.font!==e.font&&(o.font=e.font),o.fillStyle!==e.fillStyle&&(o.fillStyle=e.fillStyle);var r=t.split("\n");return r.map(function(t){return o.fillText(t,0,0),[t,o.measureText(t).width]})}return 0},setLabel:function(t,i,n,o){var r=n[0],s=n[1];t.shadowColor!==o.strokeStyle&&(t.shadowColor=o.strokeStyle),t.shadowBlur!==o.shadowBlur&&(t.shadowBlur=o.shadowBlur),t.font!==o.font&&(t.font=o.font),e.Browser.gecko?t.strokeStyle!==o.fillStyle&&(t.strokeStyle=o.fillStyle):(t.strokeStyle!==o.strokeStyle&&(t.strokeStyle=o.strokeStyle),t.fillStyle!==o.fillStyle&&(t.fillStyle=o.fillStyle)),t.strokeText(i,r,s),e.Browser.gecko||t.fillText(i,r,s)},worldWidthFull:40075016.685578495,rMajor:6378137,degRad:function(t){return t*(Math.PI/180)},distVincenty:function(t,e,n,o){for(var r={lon:i.degRad(t),lat:i.degRad(e)},s={lon:i.degRad(n),lat:i.degRad(o)},a=i.rMajor,l=6356752.3142,h=1/298.257223563,u=s.lon-r.lon,c=Math.atan((1-h)*Math.tan(r.lat)),d=Math.atan((1-h)*Math.tan(s.lat)),p=Math.sin(c),m=Math.cos(c),f=Math.sin(d),_=Math.cos(d),g=u,v=2*Math.PI,y=20;Math.abs(g-v)>1e-12&&--y>0;){var x=Math.sin(g),b=Math.cos(g),P=Math.sqrt(_*x*(_*x)+(m*f-p*_*b)*(m*f-p*_*b));if(0===P)return 0;var L=p*f+m*_*b,T=Math.atan2(P,L),w=m*_*x/P,S=1-w*w,M=L-2*p*f/S;isNaN(M)&&(M=0);var I=h/16*S*(4+h*(4-3*S));v=g,g=u+(1-I)*h*w*(T+I*P*(M+I*L*(-1+2*M*M)))}if(0===y)return NaN;var k=S*(a*a/(l*l)-1),C=1+k/16384*(4096+k*(-768+k*(320-175*k))),O=k/1024*(256+k*(-128+k*(74-47*k))),E=O*P*(M+O/4*(L*(-1+2*M*M)-O/6*M*(-3+4*P*P)*(-3+4*M*M))),z=l*C*(T-E);return z},_vfi:function(t,e,i){return[-Math.cos(t)*Math.sin(e)+Math.sin(t)*Math.sin(i)*Math.cos(e),Math.cos(t)*Math.cos(e)+Math.sin(t)*Math.sin(i)*Math.sin(e),-Math.sin(t)*Math.cos(i)]},getCircleLatLngs:function(t,n){var o=0,r=0;if(t instanceof e.LatLng)o=t.lng,r=t.lat;else{if(!e.Util.isArray(t))return null;o=t[1],r=t[0]}for(var s=Math.PI/180,a=o*s,l=r*s,h=i.rMajor,u=h*Math.sin(n/h),c=h*Math.cos(n/h),d=[c*Math.cos(l)*Math.cos(a),c*Math.cos(l)*Math.sin(a),c*Math.sin(l)],p=[],m=0,f=2*Math.PI+1e-6;m<f;m+=s){for(var _=i._vfi(m,a,l),g=[],v=0;v<3;v++)g[v]=d[v]+u*_[v];var y=Math.acos(g[0]/Math.sqrt(g[0]*g[0]+g[1]*g[1]))/s;g[1]<0&&(y=-y),y<o-180?y+=360:y>o+180&&(y-=360),p.push([Math.asin(g[2]/h)/s,y])}return p},parseCoordinates:function(t){var i=null,n=/\(EPSG:(\d+)\)/g,o=n.exec(t);if(o&&(i=o[1],t=t.replace(n,"")),t.match(/[йцукенгшщзхъфывапролджэячсмитьбюЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮqrtyuiopadfghjklzxcvbmQRTYUIOPADFGHJKLZXCVBM_:]/))return null;if(t.indexOf(" ")===-1&&t.indexOf(",")===-1)return null;t.indexOf(" ")!==-1&&(t=t.replace(/,/g,"."));var r=[];for(n=/(-?\d+(\.\d+)?)([^\d\-]*)/g,o=n.exec(t);o;)r.push(o[1]),o=n.exec(t);if(r.length<2)return null;var s,a=Math.floor(r.length/2),l=0,h=1;for(s=0;s<a;s++)l+=parseFloat(r[s])*h,h/=60;var u=0;for(h=1,s=a;s<r.length;s++)u+=parseFloat(r[s])*h,h/=60;Math.max(t.indexOf("N"),t.indexOf("S"))>Math.max(t.indexOf("E"),t.indexOf("W"))&&(o=u,u=l,l=o);var c;return 3857==i&&(c=e.Projection.SphericalMercator.unproject(new e.Point(l,u)),u=c.lng,l=c.lat),(Math.abs(u)>180||Math.abs(l)>180)&&(c=e.Projection.Mercator.unproject(new e.Point(l,u)),u=c.lng,l=c.lat),t.indexOf("W")!==-1&&(u=-u),t.indexOf("S")!==-1&&(l=-l),[l,u]},pad2:function(t){return t>=0&&t<10?"0"+t:""+t},trunc:function(t){return(""+(Math.round(1e7*t)/1e7+1e-8)).substring(0,9)},formatDegrees:function(t,e){t=Math.round(1e7*t)/1e7+1e-8;var n=Math.floor(t),o=Math.floor(60*(t-n)),r=i.toPrecision(3600*(t-n-o/60),2),s=i.pad2(n)+"°";return void 0===e&&(e=2),e>0&&(s+=i.pad2(o)+"'"),e>1&&(s+=i.pad2(r)+'"'),s},latLonFormatCoordinates:function(t,e){return t%=360,t>180?t-=360:t<-180&&(t+=360),i.formatDegrees(Math.abs(e))+(e>0?" N, ":" S, ")+i.formatDegrees(Math.abs(t))+(t>0?" E":" W")},latLonToString:function(t,e,n){return t%=360,t>180?t-=360:t<-180&&(t+=360),n&&(t=i.toPrecision(t,n),e=i.toPrecision(e,n)),e+(e>0?" N, ":" S, ")+t+(t>0?" E":" W")},formatCoordinates:function(t,e){return i.latLonFormatCoordinates(t,e)},latLonFormatCoordinates2:function(t,e){return i.trunc(Math.abs(e))+(e>0?" N, ":" S, ")+i.trunc(Math.abs(t))+(t>0?" E":" W")},formatCoordinates2:function(t,e){return i.latLonFormatCoordinates2(t,e)},getPixelScale:function(t){return 256/i.tileSizes[t]},forEachPoint:function(t,e){if(!t||0===t.length)return[];var n,o,r=[];if(t[0].length)for(n=0,o=t.length;n<o;n++)"string"!=typeof t[n]&&r.push(i.forEachPoint(t[n],e));else{if(2===t.length)return e(t);for(n=0,o=t.length/2;n<o;n++)r.push(e([t[2*n],t[2*n+1]]))}return r},getItemCenter:function(t,e){var n=t.bounds,o=n.min,r=n.max,s=t.type,a="POINT"===s||"MULTIPOINT"===s,l=a?[o.x,o.y]:[(o.x+r.x)/2,(o.y+r.y)/2];if("MULTIPOLYGON"===s)return l;if("POLYGON"===s)for(var h=0,u=e.length;h<u;h++){var c=e[h],d=c.geo,p=d.coordinates,m=c.dataOption,f=m.bounds;if(f.contains(l)){"POLYGON"===d.type&&(p=[p]);for(var _=0,g=p.length;_<g;_++)for(var v=0,y=p[_],x=y.length;v<x;v++){var b=i.getHSegmentsInPolygon(l[1],y[v]);if(b)return b.max.center}}}else{if("POINT"===s||"MULTIPOINT"===s)return l;if("LINESTRING"===s||"MULTILINESTRING"===s)return l}return null},getHSegmentsInPolygon:function(t,e){var i,n,o,r=[],s=1,a=e[0];"number"==typeof e[0]&&(s=2,a=[e[0],e[1]]);var l=t>a[1];for(i=s,n=e.length;i<n;i+=s){var h=1===s?e[i]:[e[i],e[i+1]],u=t>h[1];l!==u&&r.push(a[0]-(a[0]-h[0])*(a[1]-t)/(a[1]-h[1])),a=h,l=u}if(n=r.length){r=r.sort();var c=0,d=-1;for(i=1;i<n;i+=2){var p=i-1,m=Math.abs(r[i]-r[p]);m>c&&(c=m,d=p)}o={y:t,segArr:r,max:{width:c,center:[(r[d]+r[d+1])/2,t]}}}return o},isPointInPolygonArr:function(t,e){var i=!1,n=t[0],o=t[1],r=1,s=e[0];"number"==typeof e[0]&&(r=2,s=[e[0],e[1]]);for(var a=r,l=e.length;a<l;a+=r){var h=1===r?e[a]:[e[a],e[a+1]],u=Math.min(s[0],h[0]),c=Math.max(s[0],h[0]),d=Math.max(s[1],h[1]);if(n>u&&n<=c&&o<=d&&s[0]!==h[0]){var p=(n-s[0])*(h[1]-s[1])/(h[0]-s[0])+s[1];(s[1]===h[1]||o<=p)&&(i=!i)}s=h}return i},isPointInPolygonWithHoles:function(t,e){if(!i.isPointInPolygonArr(t,e[0]))return!1;for(var n=1,o=e.length;n<o;n++)if(i.isPointInPolygonArr(t,e[n]))return!1;return!0},isClockwise:function(t){for(var e,i=0,n=0,o=t.length;n<o;n++)e=(n+1)%o,i+=t[n][0]*t[e][1],i-=t[e][0]*t[n][1];return i<0},isPointInPolyLine:function(t,i,n,o){var r=t[0],s=t[1],a={x:r,y:s},l=r-i,h=r+i,u=s-i,c=s+i,d=0;i*=i;for(var p=1,m=n.length;p<m;p++)if(o&&p===o[d])d++;else{var f=n[p-1],_=n[p],g=f[0],v=f[1],y=_[0],x=_[1];if(!(Math.max(g,y)<l||Math.min(g,y)>h||Math.max(v,x)<u||Math.min(v,x)>c)){var b=e.LineUtil._sqClosestPointOnSegment(a,{x:g,y:v},{x:y,y:x},!0);if(b<i)return!0}}return!1},isPointInLines:function(t){for(var e=t.coords,n=t.point,o=t.delta,r=t.boundsArr,s=t.hidden,a=0,l=e.length,h=!1;a<l;a++)if(h=!r[a]||r[a].contains(n),h&&i.isPointInPolyLine(n,o,e[a],s?s[a]:null))return!0;return!1},getLength:function(t,n){var o=0;if(t&&t.length){var r=!1,s=!1;n=void 0===n||n,t.forEach(function(t){if(e.Util.isArray(t)){if(e.Util.isArray(t[0]))return o+=i.getLength(t,n);n&&(t=e.Projection.Mercator.unproject({x:t[0],y:t[1]}))}r!==!1&&s!==!1&&(o+=parseFloat(i.distVincenty(r,s,t.lng,t.lat))),r=t.lng,s=t.lat})}return o},getText:function(t){return t=t||"",e.gmxLocale?e.gmxLocale.getText(t):t.split(".").pop()},prettifyDistance:function(t,e){var n=" "+i.getText("units.km");return"nm"===e?Math.round(.539956803*t)/1e3+" "+i.getText("units.nm"):"km"===e?Math.round(t)/1e3+n:t<2e3||"m"===e?Math.round(t)+" "+i.getText("units.m"):t<2e5?Math.round(t/10)/100+n:Math.round(t/1e3)+n},geoJSONGetLength:function(t){var e,n,o,r,s,a=0;if("GeometryCollection"===t.type?a+=t.geometries.forEach(i.geoJSONGetLength):"Feature"===t.type?a+=i.geoJSONGetLength(t.geometry):"FeatureCollection"===t.type&&(a+=t.features.forEach(i.geoJSONGetLength)),"LineString"===t.type||"MultiLineString"===t.type)for(s=t.coordinates,"LineString"===t.type&&(s=[s]),e=0,o=s.length;e<o;e++)a+=i.getRingLength(s[e]);if("Polygon"===t.type||"MultiPolygon"===t.type)for(s=t.coordinates,"Polygon"===t.type&&(s=[s]),e=0,o=s.length;e<o;e++)for(n=0,r=s[e].length;n<r;n++)a+=i.getRingLength(s[e][n]);return a},getRingLength:function(t){var n=0;if(t&&t.length){var o=!1,r=!1;t.forEach(function(t){return e.Util.isArray(t)&&t.length>2?n+=i.getRingLength(t):(o!==!1&&r!==!1&&(n+=parseFloat(i.distVincenty(o,r,t[0],t[1]))),o=t[0],void(r=t[1]))})}return n},geoJSONGetArea:function(t){var e=0;if("GeometryCollection"===t.type?e+=t.geometries.forEach(i.geoJSONGetArea):"Feature"===t.type?e+=i.geoJSONGetArea(t.geometry):"FeatureCollection"===t.type&&(e+=t.features.forEach(i.geoJSONGetArea)),"Polygon"===t.type||"MultiPolygon"===t.type){var n=t.coordinates;"Polygon"===t.type&&(n=[n]);for(var o=0,r=n.length;o<r;o++){e+=i.getRingArea(n[o][0]);for(var s=1,a=n[o].length;s<a;s++)e-=i.getRingArea(n[o][s])}}return e},geoJSONGetLatLng:function(t){if("Feature"===t.type)return i.geoJSONGetLatLng(t.geometry);if("Point"===t.type)return e.latLng(t.coordinates[1],t.coordinates[0]);throw new Error("cannot get "+t.type+" latLng")},getRingArea:function(t){for(var e=0,n=0,o=t.length;n<o;n++){var r=n===o-1?0:n+1,s=t[n],a=t[r];e+=s[0]*Math.sin(i.degRad(a[1]))-a[0]*Math.sin(i.degRad(s[1]))}var l=Math.abs(e*i.lambertCoefX*i.lambertCoefY/2);return l},getArea:function(t){for(var e=0,n=0,o=t.length;n<o;n++){var r=n===o-1?0:n+1,s=t[n],a=t[r];e+=s.lng*Math.sin(i.degRad(a.lat))-a.lng*Math.sin(i.degRad(s.lat))}return Math.abs(e*i.lambertCoefX*i.lambertCoefY/2)},prettifyArea:function(t,e){var n=" "+i.getText("units.km2");return"km2"===e?""+Math.round(t/100)/1e4+n:"ha"===e?""+Math.round(t/100)/100+" "+i.getText("units.ha"):t<1e5||"m2"===e?Math.round(t)+" "+i.getText("units.m2"):t<3e6?(""+Math.round(t/1e3)/1e3).replace(".",",")+n:t<3e7?(""+Math.round(t/1e4)/100).replace(".",",")+n:t<3e8?(""+Math.round(t/1e5)/10).replace(".",",")+n:Math.round(t/1e6)+n},geoLength:function(t){var e=0,n=t.type;if("MULTILINESTRING"===n||"MultiLineString"===n){for(var o=0,r=t.coordinates.length;o<r;o++)e+=i.geoLength({type:"LINESTRING",coordinates:t.coordinates[o]});return e}return"LINESTRING"!==n&&"LineString"!==n||(e=i.getLength(t.coordinates)),e},geometryToGeoJSON:function(t,e,n){if(!t)return null;var o="MULTIPOLYGON"===t.type?"MultiPolygon":"POLYGON"===t.type?"Polygon":"MULTILINESTRING"===t.type?"MultiLineString":"LINESTRING"===t.type?"LineString":"MULTIPOINT"===t.type?"MultiPoint":"POINT"===t.type?"Point":t.type,r=t.coordinates;return e&&(r=i.coordsFromMercator(o,r,n)),{type:o,coordinates:r}},convertGeometry:function(t,e,n){var o="MULTIPOLYGON"===t.type?"MultiPolygon":"POLYGON"===t.type?"Polygon":"MULTILINESTRING"===t.type?"MultiLineString":"LINESTRING"===t.type?"LineString":"MULTIPOINT"===t.type?"MultiPoint":"POINT"===t.type?"Point":t.type,r=t.coordinates;return r=e?i.coordsFromMercator(o,r,n):i.coordsToMercator(o,r,n),{type:t.type,coordinates:r}},geoJSONtoGeometry:function(t,e){if("FeatureCollection"===t.type)return i.geoJSONtoGeometry(t.features[0],e);if("Feature"===t.type)return i.geoJSONtoGeometry(t.geometry,e);if("FeatureCollection"===t.type)return i.geoJSONtoGeometry(t.features[0],e);var n="MultiPolygon"===t.type?"MULTIPOLYGON":"Polygon"===t.type?"POLYGON":"MultiLineString"===t.type?"MULTILINESTRING":"LineString"===t.type?"LINESTRING":"MultiPoint"===t.type?"MULTIPOINT":"Point"===t.type?"POINT":t.type,o=t.coordinates;return e&&(o=i.coordsToMercator(t.type,o)),{type:n,coordinates:o}},_coordsConvert:function(t,n,o,r){var s,a,l,h=[];if("Point"===t)o?(l=(r?e.CRS.EPSG3857:e.Projection.Mercator).project({lat:n[1],lng:n[0]}),h=[l.x,l.y]):(l=e.Projection.Mercator.unproject({y:n[1],x:n[0]}),h=[l.lng,l.lat],r&&(h[1]=i.fromWebMercY(n[1])));else if("LineString"===t||"MultiPoint"===t)for(s=0,a=n.length;s<a;s++)h.push(i._coordsConvert("Point",n[s],o,r));else if("Polygon"===t||"MultiLineString"===t)for(s=0,a=n.length;s<a;s++)h.push(i._coordsConvert("MultiPoint",n[s],o,r));else if("MultiPolygon"===t)for(s=0,a=n.length;s<a;s++)h.push(i._coordsConvert("Polygon",n[s],o,r));return h},coordsFromMercator:function(t,e,n){return i._coordsConvert(t,e,!1,n)},coordsToMercator:function(t,e,n){return i._coordsConvert(t,e,!0,n)},transformGeometry:function(t,e){return t?{type:t.type,coordinates:i.forEachPoint(t.coordinates,function(t){return e(t)})}:t},geoArea:function(t,n){var o,r,s=0,a=t.type||"";if(n=void 0===n||n,"MULTIPOLYGON"===a||"MultiPolygon"===a){for(o=0,r=t.coordinates.length;o<r;o++)s+=i.geoArea({type:"POLYGON",coordinates:t.coordinates[o]},n);return s}if("POLYGON"===a||"Polygon"===a){for(s=i.geoArea(t.coordinates[0],n),o=1,r=t.coordinates.length;o<r;o++)s-=i.geoArea(t.coordinates[o],n);return s}if(t.length){var l=[],h="number"==typeof t[0]?2:1;for(o=0,r=t.length;o<r;o+=h){var u=1===h?t[o]:[t[o],t[o+1]];l.push(n?e.Projection.Mercator.unproject({y:u[1],x:u[0]}):{lat:u[1],lng:u[0]})}return i.getArea(l)}return 0},getGeoJSONSummary:function(t,e){var n,o,r,s=t.type,a=e||{},l=0;if("Point"===s)r=t.coordinates,l=i.formatCoordinates(r[0],r[1]);else if("Polygon"===s)l=i.prettifyArea(i.geoArea(t,!1),a.squareUnit);else if("MultiPolygon"===s){for(r=t.coordinates,n=0,o=r.length;n<o;n++)l+=i.geoArea({type:"Polygon",coordinates:r[n]},!1);l=i.prettifyArea(l,a.squareUnit)}else if("LineString"===s)l=i.prettifyDistance(i.geoJSONGetLength(t),a.distanceUnit);else if("MultiLineString"===s){for(r=t.coordinates,n=0,o=r.length;n<o;n++)l+=i.geoJSONGetLength({type:"LineString",coordinates:r[n]});l=i.prettifyDistance(l,a.distanceUnit)}return l},getCoordinatesString:function(t,n){var o,r=t.lng,s=t.lat,a=["",""," (EPSG:3395)"," (EPSG:3857)"],l=a.length,h="";return n=n||0,r>180&&(r-=360),r<-180&&(r+=360),n%l===0?h=i.formatCoordinates2(r,s):n%l===1?h=i.formatCoordinates(r,s):n%l===2?(o=e.Projection.Mercator.project(new e.LatLng(s,r)),h=""+Math.round(o.x)+", "+Math.round(o.y)+a[2]):(o=e.CRS.EPSG3857.project(new e.LatLng(s,r)),h=""+Math.round(o.x)+", "+Math.round(o.y)+a[3]),h},getGeometriesSummary:function(t,n){var o="",r="",s=0;return n||(n={}),t&&t.forEach(function(t){if(t){r=t.type.toUpperCase();var a=e.gmxUtil.geometryToGeoJSON(t,!0,3857==n.srs);if(r.indexOf("POINT")!==-1){var l=e.latLng(a.coordinates.reverse());o="<b>"+i.getText("Coordinates")+"</b>: "+i.getCoordinatesString(l,n.coordinatesFormat)}else r.indexOf("LINESTRING")!==-1?s+=i.geoJSONGetLength(a):r.indexOf("POLYGON")!==-1&&(s+=i.geoJSONGetArea(a))}}),o||(r.indexOf("LINESTRING")!==-1?o="<b>"+i.getText("Length")+"</b>: "+i.prettifyDistance(s,n.distanceUnit):r.indexOf("POLYGON")!==-1&&(o="<b>"+i.getText("Area")+"</b>: "+i.prettifyArea(s,n.squareUnit))),o},getGeometrySummary:function(t,e){return i.getGeometriesSummary([t],e||{})},chkOnEdge:function(t,e,i){return t[0]<i.min.x&&e[0]<i.min.x||t[0]>i.max.x&&e[0]>i.max.x||(t[1]<i.min.y&&e[1]<i.min.y||t[1]>i.max.y&&e[1]>i.max.y)},getHidden:function(t,e){for(var n=[],o="number"==typeof t[0]?2:1,r=null,s=0,a=t.length;s<a;s+=o){var l=1===o?t[s]:[t[s],t[s+1]];r&&i.chkOnEdge(l,r,e)&&n.push(s),r=l}return n},getNormalizeBounds:function(t,n){var o=t.getNorthWest(),r=t.getSouthEast(),s=o.lng,a=r.lng,l=(a-s)/2,h=null,u=null,c=[];if(l>=180)s=-180,a=180;else if(a>180||s<-180){var d=(a+s)/2%360;d>180?d-=360:d<-180&&(d+=360),s=d-l,a=d+l,s<-180?(h=s+360,u=180,s=-180):a>180&&(h=-180,u=a-360,a=180)}var p={x:s,y:r.lat},m={x:a,y:o.lat};if(void 0!==n&&(p=e.Projection.Mercator.project(new e.LatLng([r.lat,s])),m=e.Projection.Mercator.project(new e.LatLng([o.lat,a])),p.y-=n,m.y-=n),c.push(i.bounds([[p.x,p.y],[m.x,m.y]])),h){var f={x:h,y:r.lat},_={x:u,y:o.lat};void 0!==n&&(f=e.Projection.Mercator.project(new e.LatLng([r.lat,h])),_=e.Projection.Mercator.project(new e.LatLng([o.lat,u])),f.y-=n,_.y-=n),c.push(i.bounds([[f.x,f.y],[_.x,_.y]]))}return c},toPrecision:function(t,e){var i=Math.pow(10,e?e:4);return Math.round(i*t)/i},getBoundsByTilePoint:function(t){var e=i.getTileNumFromLeaflet(t);return i.getTileBounds(e.x,e.y,e.z)},getTileBounds:function(t,e,n){var o=i.tileSizes[n],r=t*o,s=e*o;return i.bounds([[r,s],[r+o,s+o]])},parseTemplate:function(t,e){var i=t.match(/\[([^\]]+)\]/gi);if(i)for(var n=0,o=i.length;n<o;n++){var r=i[n],s=r.substr(1,r.length-2),a=s in e?e[s]:"";t=t.replace(r,a)}return t},getDefaultBalloonTemplate:function(t,e){var i="";for(var n in t)(!e||n in e)&&(i+="<b>"+n+":</b> ["+n+"]<br />");return i+="<br />[SUMMARY]<br />"},parseBalloonTemplate:function(t,n){var o=n.properties;t||(t=i.getDefaultBalloonTemplate(o,n.tileAttributeTypes));var r=t.match(/\[([^\]]+)\]/gi);if(r)for(var s=n.tileAttributeTypes,a=n.unitOptions,l=n.geometries,h=0,u=r.length;h<u;h++){var c=r[h],d=c.substr(1,c.length-2),p="";d in o?p=e.gmxUtil.attrToString(s[d],o[d]):"SUMMARY"===d&&(p=n.summary||e.gmxUtil.getGeometriesSummary(l,a)),t=t.replace(c,p)}return t},styleKeys:{marker:{server:["image","angle","scale","minScale","maxScale","size","circle","center","color"],client:["iconUrl","iconAngle","iconScale","iconMinScale","iconMaxScale","iconSize","iconCircle","iconCenter","iconColor"]},outline:{server:["color","opacity","thickness","dashes"],client:["color","opacity","weight","dashArray"]},fill:{server:["color","opacity","image","pattern","radialGradient","linearGradient"],client:["fillColor","fillOpacity","fillIconUrl","fillPattern","fillRadialGradient","fillLinearGradient"]},label:{server:["text","field","template","color","haloColor","size","spacing","align"],client:["labelText","labelField","labelTemplate","labelColor","labelHaloColor","labelFontSize","labelSpacing","labelAlign"]}},styleFuncKeys:{iconSize:"iconSizeFunction",iconAngle:"rotateFunction",iconScale:"scaleFunction",iconColor:"iconColorFunction",opacity:"opacityFunction",fillOpacity:"fillOpacityFunction",color:"colorFunction",fillColor:"fillColorFunction"},styleFuncError:{iconSize:function(){return 8},iconAngle:function(){return 0},iconScale:function(){return 1},iconColor:function(){return 255},opacity:function(){return 1},fillOpacity:function(){return.5},color:function(){return 255},fillColor:function(){return 255}},defaultStyles:{MinZoom:1,MaxZoom:21,Filter:"",Balloon:"",DisableBalloonOnMouseMove:!0,DisableBalloonOnClick:!1,RenderStyle:{point:{color:255,weight:1,iconSize:8},linestring:{color:255,weight:1},polygon:{color:255,weight:1}}},getDefaultStyle:function(t){var n=i.defaultStyles,o=e.extend({},n);return o.RenderStyle=n.RenderStyle[t],
o},toServerStyle:function(t){var e={};for(var n in i.styleKeys)for(var o=i.styleKeys[n],r=0,s=o.client.length;r<s;r++){var a=o.client[r];if(a in t){e[n]||(e[n]={});var l=t[a];"opacity"!==a&&"fillOpacity"!==a||(l*=100),e[n][o.server[r]]=l}}return"iconAnchor"in t&&(e.marker||(e.marker={}),e.marker.dx=-t.iconAnchor[0],e.marker.dy=-t.iconAnchor[1]),e},fromServerStyle:function(t){var n,o,r,s,a,l={type:""};for(s in i.styleKeys){var h=i.styleKeys[s];for(o=0,r=h.client.length;o<r;o++)a=h.client[o],a in t&&(l[a]=t[a]);if(n=t[s],n&&"object"==typeof n)for(o=0,r=h.server.length;o<r;o++)if(a=h.server[o],a in n){var u=h.client[o],c=n[a];if("string"==typeof c){if(i.styleFuncKeys[u])if(null===c.match(/[^\d\.]/))c=Number(c);else{var d=e.gmx.Parsers.parseExpression(c);null===d?c=i.styleFuncError[u]():l[i.styleFuncKeys[u]]=d}}else"opacity"===a&&(c/=100);l[u]=c}}if(t.marker&&(n=t.marker,"dx"in n||"dy"in n)){var p=n.dx||0,m=n.dy||0;l.iconAnchor=[-p,-m]}for(s in t)i.styleKeys[s]||(l[s]=t[s]);return l},getUnixTimeFromStr:function(t){var i=e.Util.trim(t).split(" "),n=i[0].split("."),o=i[1]?i[1].split(":"):[0,0,0];return 4===n[2].length&&(n=n.reverse()),Date.UTC(n[0],n[1]-1,n[2],o[0]||0,o[1]||0,o[2]||0)/1e3},getDateFromStr:function(t){var i=e.Util.trim(t).split(" ");i=i[0].split("."),4===i[2].length&&(i=i.reverse());var n=new Date(i[0],i[1]-1,i[2]);return n},getUTCdate:function(t){var e=new Date(1e3*t);return[e.getUTCFullYear(),i.pad2(e.getUTCMonth()+1),i.pad2(e.getUTCDate())].join(".")},getUTCtime:function(t){var e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),o=Math.floor(t-3600*e-60*n);return[i.pad2(e),i.pad2(n),i.pad2(o)].join(":")},getUTCdateTime:function(t){var e=t%86400;return e?[i.getUTCdate(t),i.getUTCtime(t%86400)].join(" "):i.getUTCdate(t)},attrToString:function(t,i){return"date"===t?i?e.gmxUtil.getUTCdate(i):i:"time"===t?i?e.gmxUtil.getUTCtime(i):i:"datetime"===t&&i?e.gmxUtil.getUTCdateTime(i):i},getTileAttributes:function(t){var e={},i={};if(t.attributes){var n=t.attributes,o=t.attrTypes||null;t.identityField&&(e[t.identityField]=0);for(var r=0;r<n.length;r++){var s=n[r];e[s]=r+1,i[s]=o?o[r]:"string"}}return{tileAttributeTypes:i,tileAttributeIndexes:e}}};i.lambertCoefX=100*i.distVincenty(0,0,.01,0),i.lambertCoefY=100*i.distVincenty(0,0,0,.01)*180/Math.PI,function(){for(var t=0;t<30;t++)i.tileSizes[t]=i.worldWidthFull/Math.pow(2,t)}(),i.worldWidthMerc=i.worldWidthFull/2,i.Bounds=function(t){this.min={x:Number.MAX_VALUE,y:Number.MAX_VALUE},this.max={x:-Number.MAX_VALUE,y:-Number.MAX_VALUE},this.extendArray(t)},i.Bounds.prototype={extend:function(t,e){return t<this.min.x&&(this.min.x=t),t>this.max.x&&(this.max.x=t),e<this.min.y&&(this.min.y=e),e>this.max.y&&(this.max.y=e),this},extendBounds:function(t){return this.extendArray([[t.min.x,t.min.y],[t.max.x,t.max.y]])},extendArray:function(t){if(!t||!t.length)return this;var e,i;if("number"==typeof t[0])for(e=0,i=t.length;e<i;e+=2)this.extend(t[e],t[e+1]);else for(e=0,i=t.length;e<i;e++)this.extend(t[e][0],t[e][1]);return this},addBuffer:function(t,e,i,n){return this.min.x-=t,this.min.y-=e||t,this.max.x+=i||t,this.max.y+=n||e||t,this},contains:function(t){var e=this.min,i=this.max,n=t[0],o=t[1];return n>=e.x&&n<=i.x&&o>=e.y&&o<=i.y},getCenter:function(){var t=this.min,e=this.max;return[(t.x+e.x)/2,(t.y+e.y)/2]},addOffset:function(t){return this.min.x+=t[0],this.max.x+=t[0],this.min.y+=t[1],this.max.y+=t[1],this},intersects:function(t){var e=this.min,i=this.max,n=t.min,o=t.max;return o.x>e.x&&n.x<i.x&&o.y>e.y&&n.y<i.y},intersectsWithDelta:function(t,e,i){var n=this.min,o=this.max,r=e||0,s=i||0,a=t.min,l=t.max;return l.x+r>n.x&&a.x-r<o.x&&l.y+s>n.y&&a.y-s<o.y},isEqual:function(t){var e=this.min,i=this.max,n=t.min,o=t.max;return o.x===i.x&&n.x===e.x&&o.y===i.y&&n.y===e.y},isNodeIntersect:function(t){for(var e=0,i=t.length;e<i;e++)if(this.contains(t[e]))return{num:e,point:t[e]};return null},clipPolygon:function(t,i){if(t.length){var n,o,r,s,a,l,h,u,c,d=[1,4,2,8];if(e.LineUtil.isFlat(t)){var p=t;t=p.map(function(t){return new e.Point(t[0],t[1],i)})}for(o=0,h=t.length;o<h;o++)t[o]._code=this._getBitCode(t[o]);for(s=0;s<4;s++){for(u=d[s],n=[],o=0,h=t.length,r=h-1;o<h;r=o++)a=t[o],l=t[r],a._code&u?l._code&u||(c=this._getEdgeIntersection(l,a,u,i),c._code=this._getBitCode(c),n.push(c)):(l._code&u&&(c=this._getEdgeIntersection(l,a,u,i),c._code=this._getBitCode(c),n.push(c)),n.push(a));t=n}}return t.map(function(t){return[t.x,t.y]})},_getBitCode:function(t){var e=0;return t.x<this.min.x?e|=1:t.x>this.max.x&&(e|=2),t.y<this.min.y?e|=4:t.y>this.max.y&&(e|=8),e},_getEdgeIntersection:function(t,i,n,o){var r,s,a=i.x-t.x,l=i.y-t.y,h=this.min,u=this.max;return 8&n?(r=t.x+a*(u.y-t.y)/l,s=u.y):4&n?(r=t.x+a*(h.y-t.y)/l,s=h.y):2&n?(r=u.x,s=t.y+l*(u.x-t.x)/a):1&n&&(r=h.x,s=t.y+l*(h.x-t.x)/a),new e.Point(r,s,o)},clipPolyLine:function(t,e,i){i=i||0;var n,o,r,s,a,l,h=this.min,u=this.max,c=[h.x-i,h.y-i,u.x+i,u.y+i],d=function(t){var e=0;return t[0]<c[0]?e|=1:t[0]>c[2]&&(e|=2),t[1]<c[1]?e|=4:t[1]>c[3]&&(e|=8),e},p=function(t,e){return Math.PI/2+Math.atan2(e[1]-t[1],t[0]-e[0])},m=function(t,e,i){return 8&i?[t[0]+(e[0]-t[0])*(c[3]-t[1])/(e[1]-t[1]),c[3]]:4&i?[t[0]+(e[0]-t[0])*(c[1]-t[1])/(e[1]-t[1]),c[1]]:2&i?[c[2],t[1]+(e[1]-t[1])*(c[2]-t[0])/(e[0]-t[0])]:1&i?[c[0],t[1]+(e[1]-t[1])*(c[0]-t[0])/(e[0]-t[0])]:null},f=[],_=t.length,g=d(t[0],c),v=[];for(n=1;n<_;n++)if(o=t[n-1],r=t[n],o[0]!==r[0]||o[1]!==r[1]){for(a=l=d(r,c);;){if(!(g|a)){e&&(o[2]=p(o,r),s=t[n+1],r[2]=s?p(r,s):o[2]),v.push(o),a!==l?(v.push(r),n<_-1&&(f.push(v),v=[])):n===_-1&&v.push(r);break}if(g&a)break;g?(o=m(o,r,g,c),g=d(o,c)):(r=m(o,r,a,c),a=d(r,c))}g=l}return v.length&&f.push(v),f},toLatLngBounds:function(t){var n=e.Projection.Mercator,o=n.unproject(this.min),r=n.unproject(this.max),s=[[o.lat,o.lng],[r.lat,r.lng]];return t&&(s[0][0]=i.fromWebMercY(this.min.y),s[1][0]=i.fromWebMercY(this.max.y)),e.latLngBounds(s)}},i.bounds=function(t){return new i.Bounds(t)},i.parseUri=function(t){for(var e=i.parseUri.options,n=e.parser[e.strictMode?"strict":"loose"].exec(t),o={},r=14;r--;)o[e.key[r]]=n[r]||"";return o[e.q.name]={},o[e.key[12]].replace(e.q.parser,function(t,i,n){i&&(o[e.q.name][i]=n)}),o.hostOnly=o.host,o.host=o.authority,o},i.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},i.layerHelper={modifyObject:function(t,i,n,o){return new Promise(function(r,s){n.forEach(function(t){t.action=t.action||(t.id?"update":"insert")});var a={WrapStyle:"None",LayerName:i,objects:JSON.stringify(n)};a.geometry_cs=o?o:"EPSG:4326",e.gmxUtil.sendCrossDomainPostRequest(t,a,function(t){t&&"ok"===t.Status?(e.gmx.layersVersion.chkVersion(i),r(t.Result)):s()})})["catch"](console.log)}},e.gmxUtil||(e.gmxUtil={}),e.extend(e.gmxUtil,{debug:i.debug,createWorker:i.createWorker,apiLoadedFrom:i.apiLoadedFrom,newId:i.newId,isPageHidden:i.isPageHidden,protocol:"https:"!==location.protocol?"http:":location.protocol,prefixURL:location.href.substr(0,location.href.lastIndexOf("/")+1),loaderStatus:function(){},isIE9:i.isIE(9),isIE10:i.isIE(10),isIE11:i.isIE(11),gtIE11:i.gtIE(11),getText:i.getText,getFormData:i.getFormData,requestJSONP:i.requestJSONP,requestLink:i.requestLink,getCadastreFeatures:i.getCadastreFeatures,request:i.request,getLayerItemFromServer:i.getLayerItemFromServer,fromServerStyle:i.fromServerStyle,toServerStyle:i.toServerStyle,getDefaultStyle:i.getDefaultStyle,bounds:i.bounds,getNormalizeBounds:i.getNormalizeBounds,getGeometryBounds:i.getGeometryBounds,tileSizes:i.tileSizes,getDateFromStr:i.getDateFromStr,getUnixTimeFromStr:i.getUnixTimeFromStr,getUTCdate:i.getUTCdate,getUTCtime:i.getUTCtime,getUTCdateTime:i.getUTCdateTime,attrToString:i.attrToString,getTileAttributes:i.getTileAttributes,formatCoordinates:function(t,e){return i["formatCoordinates"+(e?"2":"")](t.lng,t.lat)},formatDegrees:i.formatDegrees,pad2:i.pad2,dec2hex:i.dec2hex,dec2rgba:i.dec2rgba,trunc:i.trunc,latLonFormatCoordinates:i.latLonFormatCoordinates,latLonFormatCoordinates2:i.latLonFormatCoordinates2,latLonToString:i.latLonToString,toPrecision:i.toPrecision,getLength:i.getLength,geoLength:i.geoLength,prettifyDistance:i.prettifyDistance,getArea:i.getArea,prettifyArea:i.prettifyArea,geoArea:i.geoArea,parseBalloonTemplate:i.parseBalloonTemplate,setSVGIcon:i.setSVGIcon,getSVGIcon:i.getSVGIcon,getCoordinatesString:i.getCoordinatesString,getGeometriesSummary:i.getGeometriesSummary,getGeometrySummary:i.getGeometrySummary,getGeoJSONSummary:i.getGeoJSONSummary,getPropertiesHash:i.getPropertiesHash,distVincenty:i.distVincenty,parseCoordinates:i.parseCoordinates,geometryToGeoJSON:i.geometryToGeoJSON,coordsFromMercator:i.coordsFromMercator,convertGeometry:i.convertGeometry,transformGeometry:i.transformGeometry,geoJSONtoGeometry:i.geoJSONtoGeometry,geoJSONGetArea:i.geoJSONGetArea,geoJSONGetLength:i.geoJSONGetLength,geoJSONGetLatLng:i.geoJSONGetLatLng,fromWebMercY:i.fromWebMercY,parseUri:i.parseUri,isRectangle:i.isRectangle,isClockwise:i.isClockwise,isPointInPolygonWithHoles:i.isPointInPolygonWithHoles,getPatternIcon:i.getPatternIcon,getCircleLatLngs:i.getCircleLatLngs,normalizeHostname:i.normalizeHostname,getTileBounds:i.getTileBounds,getBoundsByTilePoint:i.getBoundsByTilePoint,parseTemplate:i.parseTemplate}),e.gmxUtil.layerHelper=i.layerHelper,e.gmxUtil.isOldVersion="0.7"===e.version.substr(0,3),e.gmxUtil.isIEOrEdge=e.gmxUtil.gtIE11||e.gmxUtil.isIE11||e.gmxUtil.isIE10||e.gmxUtil.isIE9,"requestIdleCallback"in window||(window.requestIdleCallback=function(t,e){var i=e?e.timeout:0;return window.setTimeout(t,i)},window.cancelIdleCallback=window.clearTimeout),String.prototype.eval||(String.prototype.eval=function(t){return this.replace(/\${(.*?)}/g,function(e,i){var n=i.replace(/(["'\.\w\$]+)/g,function(t){return/["']/.test(t[0])?t:"scope."+t});try{return new Function("scope","return "+n)(t)}catch(o){return""}})}),e.gmx=e.gmx||{},e.gmx.gmxProxy="//maps.kosmosnimki.ru/ApiSave.ashx",function(){function t(t,r,s){var a="gmxAPIutils_id"+o++,l=e.DomUtil.create("iframe");l.style.display="none",l.setAttribute("id",t),l.setAttribute("name",t),l.src="javascript:true",l.callbackName=a;var h=i.parseUri(s),u=(h.protocol?h.protocol+":":e.gmxUtil.protocol)+"//"+(h.host||window.location.host);return n[u]=n[u]||{},n[u][a]={callback:r,iframe:l},l}var n={},o=0,r=function(t){if(t.origin in n){var e=decodeURIComponent(t.data.replace(/\n/g,"\n\\"));try{var i=JSON.parse(e)}catch(o){console.log({Status:"error",ErrorInfo:{ErrorMessage:"JSON.parse exeption",ExceptionType:"JSON.parse",StackTrace:e}})}var r=n[t.origin][i.CallbackName];r&&(delete n[t.origin][i.CallbackName],delete i.CallbackName,r.iframe.parentNode&&r.iframe.parentNode.removeChild(r.iframe),"callback"in r&&r.callback(i))}};e.DomEvent.on(window,"message",r),i.createPostIframe2=t}(),function(){function t(t,n,o,r){var s,a,l="$$iframe_"+i.newId(),h=i.createPostIframe2(l,o,t);if(r)s=r,a=s.getAttribute("action"),s.setAttribute("action",t),s.target=l;else if(e.Browser.ielt9){var u="<form id="+l+'" enctype="multipart/form-data" style="display:none" target="'+l+'" action="'+t+'" method="post"></form>';s=document.createElement(u)}else s=document.createElement("form"),s.style.display="none",s.setAttribute("enctype","multipart/form-data"),s.target=l,s.setAttribute("method","POST"),s.setAttribute("action",t),s.id=l;var c=document.createElement("div");c.style.display="none","window"===n.WrapStyle&&(n.WrapStyle="message"),"message"===n.WrapStyle&&(n.CallbackName=h.callbackName);for(var d in n){var p=document.createElement("input"),m="undefined"!=typeof n[d]?n[d]:"";p.setAttribute("type","hidden"),p.setAttribute("name",d),p.setAttribute("value",m),c.appendChild(p)}s.appendChild(c),r||document.body.appendChild(s),document.body.appendChild(h),s.submit(),r?(s.removeChild(c),null!==a?s.setAttribute("action",a):s.removeAttribute("action")):s.parentNode.removeChild(s)}e.gmxUtil.sendCrossDomainPostRequest=i.sendCrossDomainPostRequest=t}(),function(){var t=/\[(.+?)\]/g,i=/(floor\()/g,n={functionFromExpression:function(e){return new Function("props","indexes","return "+e.replace(t,'props[indexes["$1"]]').replace(i,"Math.$1")+";")}},o=function(t,e){return{head:t,tail:e}},r=function(t,e){return o(t,e)},s=function(t,e){return o(t,e)},a=new s((-1),null),l=function(t){return t.head===-1},h=function(t,e){return new s(t.head+e,t.tail)},u=function(t){var e=t.length;return function(i,n){return i.substr(n.head,e)===t?h(n,e):a}},c=function(t){var e=t.length;return t=t.toLowerCase(),function(i,n){return i.substr(n.head,e).toLowerCase()===t?h(n,e):a}},d=function(t,e){var i=t.charCodeAt(0),n=e.charCodeAt(0);return function(t,e){var o=t.charCodeAt(e.head);return o>=i&&o<=n?h(e,1):a}},p=function(t){return function(e,i){return e.length>i.head&&l(t(e,i))?h(i,1):a}},m=function(t){return function(e,i){for(var n=0;n<t.length;n++)if(i=t[n](e,i),l(i))return a;return i}},f=function(t){return function(e,i){for(var n=0;n<t.length;n++){var o=t[n](e,i);if(!l(o))return o}return a}},_=function(t,e){return e},g=function(t){return f([t,_])},v=function(t,e){return function(i,n){for(var o=0;;){var r=e(i,n);if(l(r))return o>=t?n:a;o+=1,n=r}}},y=function(t,e,i){var n=m([e,v(t-1,m([i,e]))]);return t>0?n:f([n,_])},x=v(0,f([u(" "),u("\t"),u("\n")])),b=function(t,e,i){return y(t,e,m([x,i,x]))},P=function(t){for(var e=[],i=0;i<t.length;i++)e.length>0&&e.push(x),e.push(t[i]);return m(e)},L=function(t){return function(e,i){var n=t(e,i);return l(n)?a:new s(n.head,new r(e.substr(i.head,n.head-i.head),n.tail))}},T=function(t,e){return function(i,n){var o=n,h=t(i,new s(o.head,null));return l(h)?a:new s(h.head,new r(e(h.tail),o.tail))}},w=L(v(1,f([d("a","z"),d("A","Z"),d("а","я"),d("А","Я"),d("0","9"),u("_")]))),S=L(v(1,f([d("a","z"),d("A","Z"),d("а","я"),d("А","Я"),d("0","9"),u("_"),u(" ")]))),M=f([w,m([u('"'),S,u('"')]),m([u("`"),S,u("`")])]),I=m([u("'"),L(v(0,p(u("'")))),u("'")]),k=v(1,d("0","9")),C=L(m([g(u("-")),k,g(m([u("."),k]))])),O=f([C,I]),E=function(t,e){return e(t,new s(0,null))},z=T(P([M,L(f([u("=="),u("!="),u("<>"),u("<="),u(">="),u("="),u("<"),u(">"),c("LIKE")])),f([O,M])]),function(t){var i=t.tail.tail.head,n=t.tail.head,o=t.head,r=null;return"LIKE"===n.toUpperCase()&&(r=function(t){var e=null;return(e=function(i,n){var r=o.charAt(i),s=t.charAt(n);return""===r?""===s:"%"===r?e(i+1,n)||""!==s&&e(i,n+1):r===s&&e(i+1,n+1)})(0,0)}),function(t,s,a){var l=t[s[i]],h=o;if(o in s&&(h=t[s[h]]),"date"!==a[i]&&"datetime"!==a[i]||"string"!=typeof h||(h=e.gmxUtil.getUnixTimeFromStr(h)),"boolean"==typeof l&&"string"==typeof h&&(l=l?"True":"False"),null===l)return!1;if(null!==r)return r(l);if("="===n||"=="===n)return l==h;if("!="===n||"<>"===n)return l!=h;var u,c;return o in s||"string"!=typeof h||E(h,C).head!==h.length?(u=l,c=h,"<"===n?u<c:">"===n?u>c:"<="===n?u<=c:">="===n&&u>=c):(u=parseFloat(l),c=parseFloat(h),"<"===n?u<c:">"===n?u>c:"<="===n?u<=c:">="===n&&u>=c)}}),A=T(P([M,c("IN"),u("("),b(0,O,u(",")),u(")")]),function(t){for(var e=t;null!=e.tail;)e=e.tail;var i=e.head;return function(e,n){var o=e[n[i]];if(null==o)return!1;for(var r=t;null!==r.tail;){if(r.head===o)return!0;r=r.tail}return!1}}),D=function(t,e){return D(t,e)},R=function(t,e){return R(t,e)},B=T(P([c("NOT"),D]),function(t){var e=t.head;return function(t,i,n){return!e(t,i,n)}});D=f([B,z,A,P([u("("),R,u(")")])]);var N=T(b(2,D,c("AND")),function(t){return function(e,i,n){for(var o=!0,r=t;null!=r;)o=o&&r.head(e,i,n),r=r.tail;return o}}),F=T(b(2,D,c("OR")),function(t){return function(e,i,n){for(var o=!1,r=t;null!=r;)o=o||r.head(e,i,n),r=r.tail;return o}});R=f([N,F,D]);var Z=m([x,R,x]);n.parseSQL=function(t){var e=E(t,Z);return e.head===t.length?e.tail.head:E(t,x).head===t.length?function(){return!0}:null};var U=function(t,e){return U(t,e)},G=function(t,e){return G(t,e)};U=T(b(1,G,L(f([u("+"),u("-")]))),function(t){return function(e,i,n){for(var o=t,r=0;null!==o;){if(r+=o.head(e,i,n),null===o.tail)return r;"-"===o.tail.head&&(r=-r),o=o.tail.tail}return r}});var j=f([T(C,function(t){return function(){return parseFloat(t.head)}}),T(m([u("floor("),U,u(")")]),function(t){return function(e,i,n){var o=t.head(e,i,n);return Math.floor(o)}}),T(m([u("["),w,u("]")]),function(t){return function(e,i){return parseFloat(e[i[t.head]])}}),P([u("("),U,u(")")])]);j=f([j,T(P([u("-"),j]),function(t){return function(e,i,n){return-t.head(e,i,n)}})]),G=T(b(1,j,L(f([u("*"),u("/")]))),function(t){return function(e,i,n){for(var o=t,r=1;null!==o;){if(r*=o.head(e,i,n),null===o.tail)return r;"/"===o.tail.head&&(r=1/r),o=o.tail.tail}return r}}),j=f([j,T(P([u("-"),j]),function(t){return function(e,i,n){return-t.head(e,i,n)}})]);var H=m([x,U,x]);n.parseExpression=function(t){var e=E(t,H);return e.head===t.length?e.tail.head:null};var V=T(v(0,f([C,u(","),u("M"),u("C"),v(1,f([u(" "),u("\t"),u("\r"),u("\n")]))])),function(t){for(var e=[];null!==t;)e.push(parseFloat(t.head)),t=t.tail;return e.reverse(),e});n.parseSVGPath=function(t){var e=E(t,V);return e.head===t.length?e.tail.head:[]},e.gmx=e.gmx||{},e.gmx.Parsers=n}();var n=function(t){var e,i=[],o=[],r=!1,s=!1,a=!1,l=!1,h=this._fulfill=function(t){if(!r){var n=t?i:o;e=[].slice.call(arguments,1),r=!0,s=t,n.forEach(function(t){t.apply(null,e)}),i=o=[]}};this.resolve=function(){l||h.apply(null,[!0].concat([].slice.call(arguments)))},this.reject=function(){l||h.apply(null,[!1].concat([].slice.call(arguments)))};var u=this.cancel=function(){l||r||(l=!0,t&&t())},c=this.then=function(t,a){if(l)return null;var h=null,c=new n(function(){u(),h&&h.cancel()}),d=function(t,e){return function(){if(t){var i=t.apply(null,arguments);i instanceof n?(h=i,i.then(c.resolve,c.reject)):c.resolve(i)}else c._fulfill.apply(null,[e].concat([].slice.call(arguments)))}};return r?d(s?t:a,s).apply(null,e):(i.push(d(t,!0)),o.push(d(a,!1))),c};this.once=function(t){a||(a=!0,c(t))},this.always=function(t){c(t,t)},this.getFulfilledData=function(){return e}};n.all=function(){var t=[].slice.apply(arguments),e=new n,i=t.length,o=new Array(t.length);return i?t.forEach(function(t,n){t.then(function(t){o[n]=t,i--,0===i&&e.resolve.apply(e,o)},function(){e.reject()})}):e.resolve(),e},e.gmx=e.gmx||{},e.gmx.Deferred=n,function(){e.gmx=e.gmx||{},e.gmx.workerPromise=e.gmxUtil.createWorker(e.gmxUtil.apiLoadedFrom()+"/ImageBitmapLoader-worker.js").then(function(t){var i=function(){this.jobs={},this.worker=t,this.worker.onmessage=this.chkMessage.bind(this)};i.prototype={chkMessage:function(t){for(var i,n=t.data,o=n.url,r=0,s=this.jobs[o]||[],a=s.length;r<a;r++)i=s[r],n.load?i.resolve(n):i.reject(n);delete this.jobs[o],e.gmxUtil.loaderStatus(o,!0)},push:function(t,i){t&&"."===t[0]&&0!==t.indexOf(e.gmxUtil.prefixURL)&&(t=e.gmxUtil.prefixURL+t);var n={options:i},o=t||e.gmxUtil.newId();return"undefined"==typeof this.jobs[o]&&(this.jobs[o]=[]),this.jobs[o].push(n),this.worker.postMessage({src:o,options:i}),e.gmxUtil.loaderStatus(o),new Promise(function(t,e){n.resolve=t,n.reject=e})["catch"](e.Util.falseFn)}};var n=new i;e.gmx.getBitmap=n.push.bind(n),e.gmx.getJSON=n.push.bind(n),e.gmxUtil.debug&&(e.gmx.sendCmd=function(t,i){return i.cmd=t,i.syncParams=e.gmx.gmxMapManager.syncParams,n.push(null,i)}),t.onerror=function(t){console.warn("Error: Worker init: ImageBitmapLoader-worker.js",t),t.target.terminate(),delete e.gmx.getBitmap,delete e.gmx.getJSON,delete e.gmx.sendCmd}})}(),function(){var t=function(t,i,n){this._id=t,this.def=new e.gmx.Deferred(e.gmx.imageLoader._cancelRequest.bind(e.gmx.imageLoader,this)),this.remove=e.gmx.imageLoader._removeRequestFromCache.bind(e.gmx.imageLoader,this),this.url=i,this.options=n||{}},i=e.Class.extend({includes:e.Evented?e.Evented.prototype:e.Mixin.Events,statics:{MAX_COUNT:20},initialize:function(){this.curCount=0,this.requests=[],this.inProgress={},this.requestsCache={},this.uniqueID=0},_checkIE11bugFix:function(t,e){if(!this.divIE11bugFix){var i=document.createElement("div");this.divIE11bugFix=i,i.style.visibility="hidden",i.style.position="absolute",document.body.insertBefore(i,document.body.childNodes[0])}var n=function(){t.resolve(e)};this.divIE11bugFix.appendChild(e),setTimeout(n,0)},_resolveRequest:function(t,i,n){var o=t.def;if(i){if(!n&&t.options.cache){var r=t.url,s=this.requestsCache[r],a=t._id;s||(s=this.requestsCache[r]={image:i,requests:{}}),s.requests[a]||(s.requests[a]=t)}e.gmxUtil.isIE11&&/\.svg/.test(t.url)?this._checkIE11bugFix(o,i):o.resolve(i)}else n||o.reject();this.fire("requestdone",{request:t})},_imageLoaded:function(t,i,n){if(t in this.inProgress){var o=function(t){this._resolveRequest(t,i,n)};this.inProgress[t].requests.forEach(o.bind(this)),--this.curCount,delete this.inProgress[t]}e.gmxUtil.loaderStatus(t,!0),this.fire("imageloaded",{url:t}),this._nextLoad()},_nextLoad:function(){if(!(this.curCount>=i.MAX_COUNT)&&this.requests.length){var t=this.requests.shift(),n=t.url;if(n in this.inProgress)this.inProgress[n].requests.push(t);else{var o=[t];this.inProgress[n]={requests:o},++this.curCount;for(var r=this.requests.length-1;r>=0;r--)this.requests[r].url===n&&(o.push(this.requests[r]),this.requests.splice(r,1));var s=this._loadImage(t);s.width||e.gmxUtil.loaderStatus(n),this.inProgress[n]&&(this.inProgress[n].image=s)}}},_loadImage:function(t){var i=new Image,n=t.url,o=this;return t.options.crossOrigin&&(i.crossOrigin=t.options.crossOrigin),i.onload=this._imageLoaded.bind(this,n,i,!1),i.onerror=function(){o._imageLoaded(n)},e.gmxUtil.isIEOrEdge?setTimeout(function(){i.src=n},0):i.src=n,this.fire("imageloadstart",{url:n}),i},_cancelRequest:function(t){var i,n=t._id,o=t.url,r=0;if(o in this.inProgress){var s=this.inProgress[o],a=s.requests;if(i=a.length,1===i&&a[0]._id===n)s.image.onload=e.Util.falseFn,s.image.onerror=e.Util.falseFn,s.image.src=e.Util.emptyImageUrl,this._imageLoaded(o,null,!0);else for(r=0;r<i;r++)if(a[r]._id===n){a.splice(r,1);break}}else for(r=0,i=this.requests.length;r<i;r++)if(this.requests[r]._id===n){this.requests.splice(r,1);break}this.fire("requestdone",{request:t})},_removeRequestFromCache:function(t){this._cancelRequest(t),this._clearCacheItem(t.url,t._id)},_clearCacheItem:function(t,e){if(this.requestsCache[t]){var i=this.requestsCache[t];delete i.requests[e],0===Object.keys(i.requests).length&&delete this.requestsCache[t]}},_add:function(i,n,o){n=n.replace(/^http:/,e.gmxUtil.protocol);var r="id"+ ++this.uniqueID,s=new t(r,n,o);return n in this.inProgress?this.inProgress[n].requests.push(s):(i?this.requests.unshift(s):this.requests.push(s),this._nextLoad()),this.fire("request",{request:s}),s},push:function(t,e){return this._add(!1,t,e)},unshift:function(t,e){return this._add(!0,t,e)}});e.gmx.imageLoader=new i}();var o=["strokeStyle","fillStyle","lineWidth"],r=o.length,s=i,a=function(t,e,i,n){for(var a=0;a<r;a++){var l=o[a],h=n[l];h!==i[l]&&(i[l]=h)}if(n.dashArray){var u=n.dashArray,c=n.dashOffset||0;"setLineDash"in i&&(i.setLineDash(u),i.lineDashOffset!==c&&(i.lineDashOffset=c))}else"getLineDash"in i&&i.getLineDash().length>0&&i.setLineDash([]);if("round"!==i.lineCap&&(i.lineCap="round"),"round"!==i.lineJoin&&(i.lineJoin="round"),n.canvasPattern)i.fillStyle=i.createPattern(n.canvasPattern.canvas,"repeat");else if(n.fillLinearGradient){for(var d=n.fillLinearGradient,p=d.x1Function?d.x1Function(t,e):d.x1,m=d.y1Function?d.y1Function(t,e):d.y1,f=d.x2Function?d.x2Function(t,e):d.x2,_=d.y2Function?d.y2Function(t,e):d.y2,g=i.createLinearGradient(p,m,f,_),v=0,y=d.addColorStop.length;v<y;v++){var x=d.addColorStop[v],b=d.addColorStopFunctions[v],P=b[0]?b[0](t,e):x[0],L=x.length<3?100:b[2]?b[2](t,e):x[2],T=s.dec2color(b[1]?b[1](t,e):x[1],L>1?L/100:L);g.addColorStop(P,T)}i.fillStyle=n.fillStyle=g}};e.gmxUtil.drawGeoItem=function(t,n,o,r,l){var h,u,c,d,p=t.properties,m=p[0],f=o.gmx,_=o.ctx,g=p[p.length-1],v=null,y=t.dataOption,x=o.rasters||{},b=o.tbounds;if(n.currentStyle=e.extend({},r),l){if(f.styleHook){if(t.styleExtend||(t.styleExtend=f.styleHook(n,f.lastHover&&m===f.lastHover.id)),!t.styleExtend)return!1;"number"==typeof t.styleExtend.strokeStyle&&(t.styleExtend.strokeStyle=i.dec2color(t.styleExtend.strokeStyle,1)),"number"==typeof t.styleExtend.fillStyle&&(t.styleExtend.fillStyle=i.dec2color(t.styleExtend.fillStyle,1)),n.currentStyle=e.extend(n.currentStyle,t.styleExtend)}a(p,f.tileAttributeIndexes,_,n.currentStyle)}else l={};var P=g.type.toUpperCase(),L={gmx:f,item:n,style:l,styleExtend:t.styleExtend||{},ctx:_,topLeft:o.topLeft,tpx:o.tpx,tpy:o.tpy};if("POINT"===P&&(L.pointAttr=s.getPixelPoint(L,g.coordinates),!L.pointAttr))return!1;if("POINT"===P||"MULTIPOINT"===P)if(v=g.coordinates,"iconColor"in l&&l.image&&!e.gmxUtil.isIE11&&(l.lastImage!==l.image&&(l.lastImage=l.image,l.lastImageData=s.getImageData(l.image)),L.imageData=l.lastImageData),"MULTIPOINT"===P)for(h=0,u=v.length;h<u;h++)L.coords=v[h],s.pointToCanvas(L);else L.coords=v,s.pointToCanvas(L);else if("POLYGON"===P||"MULTIPOLYGON"===P)if(l.image)L.coords=[(y.bounds.min.x+y.bounds.max.x)/2,(y.bounds.min.y+y.bounds.max.y)/2],L.pointAttr=s.getPixelPoint(L,L.coords),L.pointAttr&&s.pointToCanvas(L);else{v=g.coordinates,"POLYGON"===P&&(v=[v]);var T=y.hiddenLines||[],w=y.pixels,S=!0;w&&w.z===o.topLeft.tilePoint.z||(w=y.pixels=s.getCoordsPixels({gmx:f,coords:v,topLeft:o.topLeft,tpx:o.tpx,tpy:o.tpy,hiddenLines:T}));var M=function(t,e){for(v=w.coords,T=w.hidden||[],L.flagPixels=S,h=0,u=v.length;h<u;h++){var i=v[h],n=T[h]||[];for(_.beginPath(),c=0,d=i.length;c<d;c++)L.coords=i[c],L.hiddenLines=n[c]||[],t(L);_.closePath(),e&&_.fill()}},I=n.currentStyle.strokeStyle||l.strokeStyle,k=n.currentStyle.lineWidth||l.lineWidth;I&&k&&M(s.polygonToCanvas),o.bgImage?L.bgImage=o.bgImage:x[m]&&(L.bgImage=x[m]),(L.styleExtend.skipRasters||n.skipRasters)&&delete L.bgImage,l.imagePattern?n.currentStyle.fillStyle=_.createPattern(l.imagePattern,"repeat"):L.bgImage&&b.intersectsWithDelta(y.bounds,-1,-1)&&(s.isPatternNode(L.bgImage)&&("rasterOpacity"in f&&(_.globalAlpha=f.rasterOpacity),_.fillStyle=_.createPattern(L.bgImage,"no-repeat"),l.bgImage=!0),M(s.polygonToCanvasFill,!0),_.globalAlpha=1),(n.currentStyle.fillStyle||n.currentStyle.canvasPattern)&&(_.fillStyle=n.currentStyle.canvasPattern||n.currentStyle.fillStyle,M(s.polygonToCanvasFill,!0))}else if("LINESTRING"===P||"MULTILINESTRING"===P){v=g.coordinates,"LINESTRING"===P&&(v=[v]);var C=n.currentStyle||n.parsedStyleKeys,O=C.iconPath||C.iconPath,E=(n.currentStyle.maxSize||n.currentStyle.lineWidth)/o.topLeft.mInPixel;for(h=0,u=v.length;h<u;h++)if(O){var z=b.clipPolyLine(v[h],!0,E);for(c=0,d=z.length;c<d;c++){L.coords=z[c];var A=s.lineToCanvas(L);A&&(_.save(),s.lineToCanvasAsIcon(A,L),_.restore())}}else L.coords=v[h],s.lineToCanvas(L)}return!0};var l={APIKEY_PARAM:"key",SCRIPT_REGEXP:[/\bleaflet-geomixer(-\w*)?\.js\b/,/\bgeomixer(-\w*)?\.js\b/],_scriptSearched:!1,_scriptAPIKey:null,_searchScriptAPIKey:function(){var t=this;if(this._scriptSearched)return this._scriptAPIKey;for(var e=document.getElementsByTagName("script"),i=0;i<e.length;i++){for(var n=e[i].getAttribute("src"),o=this.SCRIPT_REGEXP,r=0,s=o.length;r<s;r++)if(o[r].exec(n)){var a=n.split("?")[1];if(a)for(var l=a.split("&"),h=0;h<l.length;h++){var u=l[h].split("=");if(u[0]===t.APIKEY_PARAM){t._scriptAPIKey=u[1];break}}break}if(t._scriptAPIKey)break}return this._scriptSearched=!0,this._scriptAPIKey},requestSessionKey:function(t,i){var n=this._sessionKeys;return t in n||(i="undefined"==typeof i?this._searchScriptAPIKey():i,n[t]=new Promise(function(n,o){if(i){var r=e.gmxUtil.protocol+"//"+t+"/ApiKey.ashx?WrapStyle=None&Key="+i,s=function(e){if(e&&"ok"===e.Status){var i=l._sessionKeysRes[t]=e.Result.Key;n(i)}else o()};fetch(r,{mode:"cors"}).then(function(t){return t.json()}).then(s)}else n("")})),n[t]},getSessionKey:function(t){return this._sessionKeys[t]},getSessionKeyRes:function(t){return this._sessionKeysRes[t]},_sessionKeysRes:{},_sessionKeys:{}};e.gmx=e.gmx||{},e.gmx.gmxSessionManager=l;var h={getMap:function(t,e,i,n,o){return h.loadMapProperties({srs:o,hostName:t,apiKey:e,mapName:i,skipTiles:n})},_addMapProperties:function(t,i,n){e.gmx._maps[i]=e.gmx._maps[i]||{},e.gmx._maps[i][n]={_rawTree:t,_nodes:{}},h.iterateNode(t,function(t){if("layer"===t.type){var i=t.content.properties;i.styles&&!i.gmxStyles&&(t.content.properties.gmxStyles=e.gmx.StyleManager.decodeOldStyles(i))}}),e.gmx.mapPropertiesHook&&e.gmx.mapPropertiesHook(t)},loadMapProperties:function(t){var n=this._maps,o=t.hostName||t.serverHost||"maps.kosmosnimki.ru",r=t.mapName;if(!n[o]||!n[o][r]){var s={WrapStyle:"func",skipTiles:t.skipTiles||"None",MapName:r,srs:t.srs||3857,ftc:t.ftc||"osm",ModeKey:"map"},a=new Promise(function(n,a){e.gmx.sendCmd?e.gmx.sendCmd("mapProperties",{serverHost:o,apiKey:t.apiKey,WrapStyle:"func",skipTiles:t.skipTiles||"None",MapName:r,srs:t.srs||3857,ftc:t.ftc||"osm",ModeKey:"map"}).then(function(t){t&&t.load&&t.res?(h._addMapProperties(t.res,o,r),n(t.res)):a(t)})["catch"](a):l.requestSessionKey(o,t.apiKey).then(function(t){s.key=t,i.requestJSONP(e.gmxUtil.protocol+"//"+o+"/TileSender.ashx",s).then(function(e){e&&"ok"===e.Status&&e.Result?(e.Result.properties.hostName=o,e.Result.properties.sessionKey=t,h._addMapProperties(e.Result,o,r),n(e.Result)):a(e)},a)},a)});n[o]=n[o]||{},n[o][r]={promise:a}}return n[o][r].promise},syncParams:{},setSyncParams:function(t){this.syncParams=t},getSyncParams:function(t){var e=this.syncParams;if(t){var i=[];for(var n in e)i.push(n+"="+e[n]);e=i.join("&")}return e},findLayerInfo:function(t,i,n){var o=e.gmx._maps[t],r=null;if(o&&o[i]){var s=o[i];s._nodes[n]||h.iterateNode(s._rawTree,function(t){s._nodes[t.content.properties.name]=t}),r=s._nodes[n]}return r?r.content:null},iterateLayers:function(t,e){var i=function(t){for(var n=0,o=t.length;n<o;n++){var r=t[n];"group"===r.type?i(r.content.children):"layer"===r.type&&e(r.content)}};t&&i(t.children)},iterateNode:function(t,e){var i=function(t){for(var n=t.children,o=0,r=n.length;o<r;o++){var s=n[o];e(s),"group"===s.type&&i(s.content)}};t&&i(t)},_maps:{}};e.gmx=e.gmx||{},e.gmx._maps={},e.gmx._clientLayers={},/\bsw=1\b/.test(location.search)&&(e.gmx._sw=1,"serviceWorker"in navigator?navigator.serviceWorker.register("./gmx-sw1.js").then(function(t){console.log("ServiceWorker registration successful with scope: ",t.scope)})["catch"](function(t){console.log("ServiceWorker registration failed: ",t)}):console.error("Your browser does not support Service Workers.")),e.gmx.gmxMapManager=h;var u=e.Class.extend({includes:e.Evented?e.Evented.prototype:e.Mixin.Events,initialize:function(t,i){this.layers=[],this.layersByTitle={},this.layersByID={},this.dataManagers={};var n=this;this.properties=e.extend({},t.properties),this.properties.BaseLayers=this.properties.BaseLayers?JSON.parse(this.properties.BaseLayers):[],this.rawTree=t;var o=i.skipTiles||"All",r=i.ftc||"osm",s=i.srs||3857,a=this.properties.name;this.layersCreated=new Promise(function(l){var u={},c={};h.iterateLayers(t,function(o){var r=o.properties,s={mapID:a,sessionKey:t.properties.sessionKey,layerID:r.name};r.hostName=t.properties.hostName,t.srs&&(r.srs=t.srs);var l=r.ContentID||r.type,h=r.MetaProperties||{},d=e.extend(s,i);r.dataSource||"parentLayer"in h?(d.parentLayer=r.dataSource||"","parentLayer"in h&&(d.parentLayer=h.parentLayer.Value||""),c[s.layerID]={info:o,options:d}):l in e.gmx._layerClasses?n.addLayer(e.gmx.createLayer(o,d)):(u[l]=u[l]||[],u[l].push({info:o,options:d}))});var d=[];for(var p in u)d.push(e.gmx._loadLayerClass(p).then(function(t){for(var i=u[t],o=0,r=i.length;o<r;o++)n.addLayer(e.gmx.createLayer(i[o].info,i[o].options))}.bind(null,p)));var m,f,g,v={};for(f in c){g=c[f];var y=g.options,x=y.parentLayer,b=this.layersByID[x];b?(g.options.parentOptions=b.getGmxProperties(),
g.options.dataManager=this.dataManagers[x]||new _(g.options.parentOptions,(!0)),this.dataManagers[x]=g.options.dataManager,this.addLayer(e.gmx.createLayer(g.info,g.options))):(m=y.hostName,v[m]||(v[m]={}),v[m][x]||(v[m][x]=[]),v[m][x].push(f))}for(m in v){var P=[],L=e.gmxUtil.protocol+"//"+m;for(f in v[m])P.push({Layer:f});d.push(e.gmxUtil.requestJSONP(L+"/Layer/GetLayerJson.ashx",{WrapStyle:"func",skipTiles:o,srs:s,ftc:r,Layers:JSON.stringify(P)},{ids:v[m]}).then(function(t,i){if(t&&"ok"===t.Status&&t.Result)t.Result.forEach(function(t){var o=t.properties,a=o.name;o.tiles=[],o.srs=s,o.ftc=r;var l=n.addDataManager(t);i&&i.ids&&i.ids[a]&&i.ids[a].forEach(function(i){var o=c[i];o.options.parentOptions=t.properties,o.options.dataManager=l,o.info.properties.tiles=[],o.info.properties.srs=s,o.info.properties.ftc=r,n.addLayer(e.gmx.createLayer(o.info,o.options))})});else if(console.info("Error: loading ",L+"/Layer/GetLayerJson.ashx",t.ErrorInfo),i&&i.ids)for(var o in i.ids)i.ids[o].forEach(function(t){n.addLayer(new e.gmx.DummyLayer(c[t].info.properties))})}))}Promise.all(d).then(l)}.bind(this))},addDataManager:function(t){var e=t.properties.name;return this.dataManagers[e]||(this.dataManagers[e]=new _(t.properties)),this.dataManagers[e]},getDataManager:function(t){return this.dataManagers[t]},addLayer:function(t){var e=t.getGmxProperties();return this.layers.push(t),this.layersByTitle[e.title]=t,this.layersByID[e.name]=t,this.fire("layeradd",{layer:t}),this},removeLayer:function(t){for(var e=t.getGmxProperties(),i=0;i<this.layers.length;i++)if(this.layers[i].getGmxProperties().name===e.name){this.layers.splice(i,1);break}return delete this.layersByTitle[e.title],delete this.layersByID[e.name],this.fire("layerremove",{layer:t}),this},addLayersToMap:function(t){for(var e=this.layers.length-1;e>=0;e--){var i=this.layers[e];i.getGmxProperties().visible&&t.addLayer(i)}return this}});e.gmx=e.gmx||{},e.gmx.gmxMap=u;var c=e.Handler.extend({options:{},initialize:function(t){this._map=t,this._layers={},this._lastLayer=null,this._lastId=null,this._drawstart=null,this._lastCursor="",t.on({zoomend:function(){t._gmxMouseLatLng&&this._onmousemove({type:"mousemove",latlng:t._gmxMouseLatLng})},click:this._eventCheck,dblclick:this._eventCheck,mousedown:this._eventCheck,mouseup:this._eventCheck,mousemove:this._onmousemove,contextmenu:this._onmousemove,layeradd:function(t){var e=t.layer;if("gmxEventCheck"in e&&e.options.clickable){var i=0;if(e._container){var n,o=e._container,r=o.parentNode.childNodes;for(i=0,n=r.length;i<n&&o!==r[i];i++);}this._layers[e._leaflet_id]=i}},layerremove:function(t){var e=t.layer._leaflet_id;delete this._layers[e],this._lastLayer&&this._lastLayer._leaflet_id===e&&(this._lastLayer=null,this._lastId=0)}},this)},_onmousemove:function(t){this._map._animatingZoom||(this._onmousemoveTimer&&clearTimeout(this._onmousemoveTimer),this._onmousemoveTimer=setTimeout(this._eventCheck.bind(this,t),50))},_isDrawing:function(){var t=this._map;if(this._drawstart)return!0;if(null===this._drawstart){if(t.gmxControlsManager){var e=t.gmxControlsManager.get("drawing");e&&e.on("activechange",function(e){this._drawstart=e.activeIcon,t._container.style.cursor=this._drawstart?"pointer":""}.bind(this))}this._drawstart=!1}return!1},_clearLastHover:function(){this._lastLayer&&(this._lastLayer.gmxEventCheck({type:"mousemove"},!0),this._lastLayer=null)},_eventCheck:function(t){var i=t.type,n=this._map;if(t.originalEvent){var o=t.originalEvent.target,r=o.tagName.toLowerCase();if("svg"!==r&&o!==n._container)return;if("path"===r)return;n.gmxMouseDown=e.Browser.webkit&&!e.gmxUtil.isIEOrEdge?t.originalEvent.which:t.originalEvent.buttons}if(n._animatingZoom||!t.latlng||this._isDrawing()||"click"===i&&n._skipClick||"mousemove"===i&&n.gmxMouseDown)return this._clearLastHover(),void(n._skipClick=!1);t.layerPoint&&(n._gmxMouseLatLng=t.latlng,n.gmxMousePos=n.getPixelOrigin().add(t.layerPoint));for(var s,a=Object.keys(this._layers).sort(function(t,e){var i=n._layers[t],o=n._layers[e];if(i&&o){var r=i.options,s=o.options,a=(r.zIndexOffset||0)+(r.zIndex||0),l=(s.zIndexOffset||0)+(s.zIndex||0),h=l-a;return h?h:this._layers[e]-this._layers[t]}return 0}.bind(this)),l=null,h="",u=0,c=a.length;u<c;u++){var d=a[u];if(s=n._layers[d],s&&s._map&&!s._animating&&s.options.clickable&&s.gmxEventCheck(t)){s.hasEventListeners("mouseover")&&(h="pointer"),l=s;break}}this._lastCursor===h||this._isDrawing()||(n._container.style.cursor=h),this._lastCursor=h,"zoomend"!==i&&(l?(this._lastLayer!==l&&this._clearLastHover(),this._lastLayer=l):this._clearLastHover())}});e.Map.addInitHook(function(){this._gmxEventsManager||(this._gmxEventsManager=new c(this),this.isGmxDrawing=function(){return this._gmxEventsManager._drawstart}.bind(this),this.on("remove",function(){this._gmxEventsManager&&this._gmxEventsManager.removeHooks()},this))}),function(){var t="rus",i=function(t,e,i,n){n[t]||(n[t]={}),n[t][e]=i};e.gmxLocale={setLanguage:function(t){this._language=t},getLanguage:function(){return window.language||this._language||t}},e.gmxLocaleMixin={addText:function(){var t=arguments[0],e=arguments[1];1===arguments.length&&(e=t,t=null);for(var n in e)if(null===t)for(var o in e[n])i(n,o,e[n][o],this);else i(t,n,e[n],this);return this},getText:function(t){for(var i=e.gmxLocale.getLanguage(),n=this[i]||{},o=t?t.split(/\./):[],r=0,s=o.length;r<s&&n;r++)n=n[o[r]];return n}},e.extend(e.gmxLocale,e.gmxLocaleMixin)}(),e.extend(e.gmxLocale,{rus:{Coordinates:"Координаты",Length:"Длина",nodeLength:"Длина от начала",edgeLength:"Длина сегмента",Area:"Площадь",Perimeter:"Периметр",units:{m:"м",nm:"м.мили",km:"км",m2:"кв. м",km2:"кв. км",ha:"га",m2html:"м<sup>2",km2html:"км<sup>2"}}}),e.extend(e.gmxLocale,{eng:{Coordinates:"Coordinates",Length:"Length",nodeLength:"From start point",edgeLength:"Segment length",Area:"Area",Perimeter:"Perimeter",units:{m:"m",nm:"nmi",km:"km",m2:"sq. m",km2:"sq. km",ha:"ha",m2html:"m<sup>2",km2html:"km<sup>2"}}});var d={_loadedTiles:{},_getKey:function(t){return[t.layerID,t.x,t.y,t.z,"undefined"==typeof t.d?-1:t.d,"undefined"==typeof t.s?-1:t.s,t.v].join(":")},load:function(t,i){var n=d._getKey(i);if(!this._loadedTiles[n]){var o={ModeKey:"tile",ftc:"osm",r:"j",LayerName:i.layerID,z:i.z,x:i.x,y:i.y,v:i.v};i.srs&&(o.srs=i.srs),i.d!==-1&&(o.Level=i.d,o.Span=i.s),e.gmx._sw&&(o.sw=e.gmx._sw);var r=new Promise(function(e,i){var n=t+"&"+Object.keys(o).map(function(t){return t+"="+o[t]}).join("&");fetch(n,{mode:"cors",credentials:"include"}).then(function(t){return t.text()}).then(function(t){var n="gmxAPI._vectorTileReceiver(";if(t.substr(0,n.length)===n){t=t.replace(n,"");var o=JSON.parse(t.substr(0,t.length-1));e(o)}else i()})});this._loadedTiles[n]=r}return this._loadedTiles[n]}};window.gmxAPI=window.gmxAPI||{},window.gmxAPI._vectorTileReceiver=window.gmxAPI._vectorTileReceiver||function(t){var e=d._getKey({layerID:t.LayerName,x:t.x,y:t.y,z:t.z,d:t.level,s:t.span,v:t.v});d._loadedTiles[e]&&d._loadedTiles[e].resolve({bbox:t.bbox,srs:t.srs,isGeneralized:t.isGeneralized,values:t.values})};var p=function(t,e){this.dataProvider=t,this.x=e.x,this.y=e.y,this.z=e.z,this.v=e.v,this.s=e.s||-1,this.d=e.d||-1,this.attributes=e.attributes,this.isGeneralized=e.isGeneralized,this.isFlatten=e.isFlatten,this.bounds=i.getBoundsByTilePoint(this.z?e:{z:0,x:0,y:0}),this.gmxTilePoint={x:this.x,y:this.y,z:this.z,s:this.s,d:this.d},this.vectorTileKey=p.makeTileKey(this.x,this.y,this.z,this.v,this.s,this.d),this.s>=0&&e.dateZero&&(this.beginDate=new Date(e.dateZero.valueOf()+this.s*this.d*i.oneDay*1e3),this.endDate=new Date(e.dateZero.valueOf()+(this.s+1)*this.d*i.oneDay*1e3)),this.clear()};p.prototype={addData:function(t,e){e&&this.removeData(e,!0);for(var n=t.length,o=new Array(n),r=i.bounds(),s=0;s<n;s++){var a=this._parseItem(t[s]);o[s]=a,r.extendBounds(a.bounds)}return this.data?(this.data=this.data.concat(t),this.dataOptions=this.dataOptions.concat(o)):(this.data=t,this.dataOptions=o),this.loaded(t),r},removeData:function(t){for(var e=this.data||[],i=e.length-1;i>=0;i--)t[e[i][0]]&&(e.splice(i,1),this.dataOptions&&this.dataOptions.splice(i,1))},loaded:function(t){this.state="loaded",this._resolve(t)},load:function(){if("notLoaded"===this.state){this.state="loading";var t=this;this.dataProvider.load(t.x,t.y,t.z,t.v,t.s,t.d,function(e){t.bbox=e.bbox,t.srs=e.srs,t.isGeneralized=e.isGeneralized,t.addData(e.values)})}return this.loadDef},clear:function(){this.state="notLoaded",this.data=null,this.dataOptions=null,this.loadDef=new Promise(function(t,e){this._resolve=t,this._reject=e}.bind(this))},_parseItem:function(t){var e,n=t.length-1;for(e=1;e<n;e++)null===t[e]&&(t[e]="");var o=t[n],r=this.isFlatten,s=o.type,a=s.indexOf("POLYGON")!==-1||s.indexOf("Polygon")!==-1,l="POLYGON"===s||"Polygon"===s,h=o.coordinates,u=[],c=null,d=[];if(a){l&&(h=[h]),c=i.bounds();var p=i.bounds().extendBounds(this.bounds).addBuffer(-.05),m=!1;for(e=0,n=h.length;e<n;e++){for(var f=[],_=[],g=0,v=h[e].length;g<v;g++){r&&"number"!=typeof h[e][g][0]&&(h[e][g]=i.flattenRing(h[e][g]));var y=i.bounds(h[e][g]);f.push(y),0===g&&c.extendBounds(y);var x=i.getHidden(h[e][g],p);_.push(x),x.length&&(m=!0)}d.push(f),u.push(_)}m||(u=null),l&&(d=d[0])}else if("POINT"===s||"Point"===s)c=i.bounds([h]);else if("MULTIPOINT"===s||"MultiPoint"===s)for(c=i.bounds(),e=0,n=h.length;e<n;e++)c.extendBounds(i.bounds([h[e]]));else if("LINESTRING"===s||"LineString"===s)c=i.bounds(h);else if("MULTILINESTRING"===s||"MultiLineString"===s)for(c=i.bounds(),e=0,n=h.length;e<n;e++)c.extendBounds(i.bounds(h[e]));var b={bounds:c,boundsArr:d};return u&&(b.hiddenLines=u),b}},p.makeTileKey=function(t,e,i,n,o,r){return i+"_"+t+"_"+e+"_"+n+"_"+o+"_"+r},p.createTileKey=function(t){return[t.z,t.x,t.y,t.v,t.s,t.d].join("_")},p.parseTileKey=function(t){var e=t.split("_").map(function(t){return Number(t)});return{z:e[0],x:e[1],y:e[2],v:e[3],s:e[4],d:e[5]}},p.boundsFromTileKey=function(t){var e=p.parseTileKey(t);return i.getTileBounds(e.x,e.y,e.z)};var m=e.Class.extend({includes:e.Evented?e.Evented.prototype:e.Mixin.Events,initialize:function(t){this.type=t.type||"update",this._callback=t.callback,this.layerID=t.layerID,this.target=t.target,this.z=t.z,this.itemHook=t.itemHook,this._items=null,this.bbox=t.bbox,this.needBbox=t.needBbox,this.filters=t.filters||[],this.targetZoom=t.targetZoom||null,this.active=!("active"in t)||t.active,this.srs=t.srs||3857,t.bounds&&this.setBounds(t.bounds);var e,n=i.worldWidthMerc;this.bbox?this.bbox.max.x>n?(e=this.bbox.max.x-n,this.bbox1=i.bounds([[e-n,this.bbox.max.y],[-(e+n),this.bbox.min.y]])):this.bbox.min.x<-n&&(e=this.bbox.min.x+n,this.bbox1=i.bounds([[e+n,this.bbox.max.y],[n-e,this.bbox.min.y]])):(this.bbox=i.bounds([[-n,-n],[n,n]]),this.world=!0),t.dateInterval&&this._setDateInterval(t.dateInterval[0],t.dateInterval[1])},hasFilter:function(t){for(var e=0,i=this.filters.length;e<i;e++)if(this.filters[e]===t)return!0;return!1},activate:function(t){return this.active||(this.active=!0,t||this.fire("activate")),this},deactivate:function(t){return this.active&&(this.active=!1,t||this.fire("activate")),this},toggleActive:function(t){return t?this.activate():this.deactivate()},isActive:function(){return this.active},updateData:function(t){var e=t.length,i={count:e};if("update"===this.type){this._items||(this._items={});for(var n,o=this._items,r={},s=[],a=[],l=0;l<e;l++){var h=t[l];n=h.id+"_"+h.tileKey,r[n]=h,o[n]||s.push(h)}for(n in o)r[n]||a.push(o[n]);s.length&&(i.added=s),a.length&&(i.removed=a),this._items=r}else i.added=t;return this.fire("data",{data:this._callback(i)}),i=null,t=null,this},removeData:function(t){if("update"!==this.type||!this._items)return this;var e=this._items,i=[];for(var n in t)e[n]&&(i.push(e[n]),delete e[n]);return i.length&&this._callback({removed:i}),this},setBounds:function(t,n){var o;if(!t)return this.world||(o=i.worldWidthMerc,this.bbox=i.bounds([[-o,-o],[o,o]]),this.bbox1=null,this.world=!0,this.fire("update")),this;var r=t.min,s=t.max;if(!r||!s){var a=e.latLngBounds(t),l=a.getSouthWest(),h=a.getNorthEast();r={x:l.lng,y:l.lat},s={x:h.lng,y:h.lat}}var u=r.x,c=s.x,d=r.y,p=s.y,m=null,f=null;if(this.world=!1,o=(c-u)/2,o>=180)u=-180,c=180,this.world=!0;else if(c>180||u<-180){var _=(c+u)/2%360;_>180?_-=360:_<-180&&(_+=360),u=_-o,c=_+o,u<-180?(m=u+360,f=180,u=-180):c>180&&(m=-180,f=c-360,c=180)}var g=3857==this.srs?e.CRS.EPSG3857:e.Projection.Mercator,v=g.project(e.latLng(d,u)),y=g.project(e.latLng(p,c));return this.bbox=i.bounds([[v.x,v.y],[y.x,y.y]]),n&&this.bbox.addBuffer(n),this.bbox1=null,m&&(v=g.project(e.latLng(d,m)),y=g.project(e.latLng(p,f)),this.bbox1=i.bounds([[v.x,v.y],[y.x,y.y]]),n&&this.bbox1.addBuffer(n)),this.fire("update"),this},intersects:function(t){return this.world||this.bbox.intersects(t)||!(!this.bbox1||!this.bbox1.intersects(t))},intersectsWithTile:function(t){if(this.targetZoom&&!this.needBbox){var e=this.targetZoom+(this.targetZoom%2?1:0);if(t.isGeneralized&&t.z!==e||t.z>e)return!1}var i=this.dateInterval;return this.intersects(t.bounds)&&(!t.beginDate||i&&i.endDate>=t.beginDate&&i.beginDate<=t.endDate)},intersectsWithGeometry:function(t){var e=t.type.toUpperCase(),i=t.coordinates;if("POINT"===e)return this.world||this.bbox.contains(i)||!(!this.bbox1||!this.bbox1.contains(i));"POLYGON"===e?i=[i[0]]:"MULTIPOLYGON"===e?i=i.map(function(t){return t[0]}):"LINESTRING"===e&&(i=[i]);for(var n=0,o=i.length;n<o;n++)if(this.bbox.clipPolygon(i[n]).length||this.bbox1&&this.bbox1.clipPolygon(i[n]).length)return!0;return!1},_setDateInterval:function(t,e){t&&e?this.dateInterval={beginDate:t,endDate:e}:this.dateInterval=null},setDateInterval:function(t,e){var i=t&&e;return(!this.dateInterval!=!i||i&&(this.dateInterval.beginDate.valueOf()!==t.valueOf()||this.dateInterval.endDate.valueOf()!==e.valueOf()))&&(this._setDateInterval(t,e),this.fire("update",{temporalFilter:!0})),this}});e.gmx.observer=function(t){return new m(t)},function(){var t=function(t){var e=[],n=t.TemporalTiles||[],o=t.TemporalVers||[],r=t.TemporalPeriods||[],s=r[r.length-1],a=Number.MAX_VALUE,l=t.ZeroDate.split("."),h=new Date(l.length>2?l[2]:2008,l.length>1?l[1]-1:0,l.length>0?l[0]:1),u=new Date(h.getTime()-6e4*h.getTimezoneOffset()),c=u.getTime()/1e3;this.dateZero=u;var d,m,f=function(t,e,n){var o=t.d;if(e.d===r[o])return t.count++,void t.tiles.push(n);var s=r[o-1],a=r[o]/s;"children"in t||(t.children=new Array(a));var l=Math.floor(e.s*e.d/s),h=l-t.s*a;if(!t.children[h]){var u=s*i.oneDay,d=l*u+c;t.children[h]={d:o-1,s:l,t1:d,t2:d+u,count:0,children:[],tiles:[]}}f(t.children[h],e,n)},_=r.length-1,g=r[_]*i.oneDay;for(d=0,m=n.length;d<m;d++){l=n[d];var v=Number(l[1]),y=Number(l[0]);y===s&&(a=Math.min(a,v))}for(d=0,m=n.length;d<m;d++){l=n[d];var x={x:Number(l[2]),y:Number(l[3]),z:Number(l[4]),v:Number(o[d]),s:Number(l[1]),d:Number(l[0])};if(!(x.d<0)){var b=Math.floor(x.s*x.d/r[_])-a,P=b+a;e[b]=e[b]||{d:_,s:P,t1:P*g+c,t2:(P+1)*g+c,count:0,tiles:[]};var L=p.createTileKey(x);f(e[b],x,L)}}n=o=null,this.selectTiles=function(t,i,n){n=n||{};for(var o=t.valueOf()/1e3,s=i.valueOf()/1e3,a=0,l=(s-o)/3600/24,h=0;h<r.length;h++)if(r[h]>l){a=Math.max(0,h-1);break}r[r.length-1]<=l&&(a=r.length-1);for(var u=Math.min(r.length-1,a+Number(l>r[a])),c=function(t,e){for(var i=0,n=0;n<t.length;n++)t[n].intersects(e)&&i++;return i},d=function(t,e,i){if(e>=t.t2||i<=t.t1)return{count:0,tiles:[],nodes:[]};if(n.bounds&&!t.tileBounds&&(t.tileBounds=t.tiles.map(function(t){return p.boundsFromTileKey(t)})),t.d===a){var o=n.bounds?c(t.tileBounds,n.bounds):t.count;return{tiles:t.tiles,count:o,nodes:[t]}}var r,s=0,l=[],h=t.children?t.children.length:0;for(r=0;r<h;r++)t.children[r]?l[r]=d(t.children[r],Math.max(e,t.t1),Math.min(i,t.t2)):l[r]={count:0,tiles:[],nodes:[]},s+=l[r].count;var m=n.bounds?c(t.tileBounds,n.bounds):t.count;if(t.d>u||s<m){var f=[],_=[];for(r=0;r<l.length;r++)_.push(l[r].nodes),f.push(l[r].tiles);return{tiles:[].concat.apply([],f),count:s,nodes:[].concat.apply([],_)}}return{tiles:t.tiles,count:m,nodes:[t]}},m=[],f=0;f<e.length;f++)if(e[f]){var _=d(e[f],o,s);_.tiles.length&&(m=m.concat(_.tiles))}for(var g={},v=0;v<m.length;v++)g[m[v]]=!0;return{tiles:g}},this.getNode=function(t,i){if(t<0||i<0)return null;for(var n=function(t,e,i){if(!t)return null;if(r[t.d]===e)return t.s===i?t:null;var o=r[t.d]/r[t.d-1],s=Math.floor(i*e/r[t.d-1]),a=s-t.s*o;return t.children[a]?n(t.children[a],e,i):null},o=0;o<e.length;o++){var s=n(e[o],t,i);if(s)return s}return null}};e.gmx.tilesTree=function(e){return new t(e)}}();var f=e.Class.extend({includes:e.Evented?e.Evented.prototype:e.Mixin.Events,initialize:function(t){this._dataManager=t,this._observerData={},this._tileData={}},addObserver:function(t){return this._observerData[t.id]={observer:t,tiles:{},leftToLoad:0,loadingState:!1},t.on("update",this._updateObserver.bind(this,t)),this._updateObserver(t),this},removeObserver:function(t){var e=this._observerData[t].tiles;for(var i in e)delete this._tileData[i].observers[t];return delete this._observerData[t],this},addTile:function(t){var e="loaded"===t.state?0:1;t.loadDef.then(this._tileLoadedCallback.bind(this,t));var i={};for(var n in this._observerData){var o=this._observerData[n];o.observer.intersectsWithTile(t)&&(o.tiles[t.vectorTileKey]=!0,o.leftToLoad+=e,i[n]=!0)}return this._tileData[t.vectorTileKey]={observers:i,tile:t},this},removeTile:function(t){var e=this._tileData[t],i="loaded"===e.tile.state?0:1;for(var n in e.observers){var o=this._observerData[n];o.leftToLoad-=i,delete o.tiles[t]}return delete this._tileData[t],this},_isLeftToLoad:function(t){var e=0;for(var i in t.tiles)"loaded"!==this._tileData[i].tile.state&&e++;return e},startLoadTiles:function(t){this._dataManager._getActiveTileKeys();var e=this._observerData[t.id];if(e){if(e.leftToLoad=this._isLeftToLoad(e),e.leftToLoad<1)return this.fire("observertileload",{observer:t}),this;e.loadingState||(e.loadingState=!0,t.fire("startLoadingTiles"));for(var i in e.tiles)this._tileData[i].tile.load()}return this},getTileObservers:function(t){return this._tileData[t].observers},getObserverLoadingState:function(t){return this._observerData[t.id].loadingState},getObserverLeftToLoad:function(t){return this._observerData[t.id].leftToLoad},_updateObserver:function(t){if(this._observerData[t.id]){var e,i=this._observerData[t.id],n={},o=0;for(e in this._tileData){var r=this._tileData[e].tile;t.intersectsWithTile(r)&&(n[e]=!0,"loaded"!==r.state&&o++,this._tileData[e].observers[t.id]=!0)}for(e in i.tiles)e in n||delete this._tileData[e].observers[t.id];i.tiles=n,i.leftToLoad=o}},_tileLoadedCallback:function(t){if(this.fire("tileload",{tile:t}),t.vectorTileKey in this._tileData){var e=this._tileData[t.vectorTileKey].observers;for(var i in e){var n=this._observerData[i];n.leftToLoad--,n.leftToLoad<1&&(n.loadingState&&(n.loadingState=!1,n.observer.fire("stopLoadingTiles")),this.fire("observertileload",{observer:n.observer}))}}}}),_=e.Class.extend({includes:e.Evented?e.Evented.prototype:e.Mixin.Events,options:{name:null,srs:"",identityField:"",attributes:[],attrTypes:[],tiles:null,tilesVers:null,LayerVersion:-1,GeoProcessing:null,Temporal:!1,TemporalColumnName:"",ZeroDate:"01.01.2008",TemporalPeriods:[],TemporalTiles:[],TemporalVers:[],hostName:"maps.kosmosnimki.ru",sessionKey:"",isGeneralized:!1,needBbox:!1,isFlatten:!1},setOptions:function(t){this._clearProcessing(),t.GeoProcessing&&(this.processingTile=this.addData([]),this._chkProcessing(t.GeoProcessing)),e.setOptions(this,t),this.optionsLink=t,this._isTemporalLayer=this.options.Temporal;var i=e.gmxUtil.getTileAttributes(this.options);this.tileAttributeIndexes=i.tileAttributeIndexes,this.temporalColumnType=i.tileAttributeTypes[this.options.TemporalColumnName];var n=this.options.hostName,o=this.options.sessionKey||"";this.tileSenderPrefix=e.gmxUtil.protocol+"//"+n+"/TileSender.ashx?WrapStyle=None&key="+encodeURIComponent(o),this._needCheckActiveTiles=!0},_vectorTileDataProviderLoad:function(t,e,i,n,o,r,s){var a=this;d.load(a.tileSenderPrefix,{x:t,y:e,z:i,v:n,s:o,d:r,srs:this.options.srs,layerID:a.options.name}).then(s,function(){console.log("Error loading vector tile"),s({values:[]}),a.fire("chkLayerUpdate",{dataProvider:a})})},initialize:function(t,e){this._tilesTree=null,this._activeTileKeys={},this._endDate=null,this._beginDate=null,this._tiles={},this._filters={},this._filtersView={},this._freeSubscrID=0,this._items={},this._observers={},this._needCheckDateInterval=!1,this._needCheckActiveTiles=!0;var i=this;this._vectorTileDataProvider={load:this._vectorTileDataProviderLoad.bind(this)},this._observerTileLoader=new f(this),this._observerTileLoader.on("tileload",function(t){var e=t.tile;if(i._updateItemsFromTile(e),i._tilesTree){var n=i._tilesTree.getNode(e.d,e.s);n&&n.count--}}),this._observerTileLoader.on("observertileload",function(t){var e=t.observer;e.isActive()&&(e.needRefresh=!1,e.updateData(i.getItems(e.id)))}),this.setOptions(t),e&&(this.options.LayerVersion=-1),this._isTemporalLayer&&this.addFilter("TemporalFilter",function(t,e,i){var n=t.options.unixTimeStamp,o=i.dateInterval;return o&&n>=o.beginDate.valueOf()&&n<o.endDate.valueOf()})},_getActiveTileKeys:function(){if(this._chkMaxDateInterval(),this.options.needBbox||!this._needCheckActiveTiles)return this._activeTileKeys;if(this._needCheckActiveTiles=!1,this._isTemporalLayer){var t={};this._beginDate&&this._endDate&&(this._tilesTree||this.initTilesTree(),t=this._tilesTree.selectTiles(this._beginDate,this._endDate).tiles),this._updateActiveTilesList(t)}else this.initTilesList();return this._activeTileKeys},getViewFilters:function(t,e){var i=[];t=t||"screen";for(var n in this._filtersView[e])0===n.indexOf(t)&&i.push(n);return i},_getObserversByFilterName:function(t,e){var i={};for(var n in this._observers){var o=this._observers[n];o.hasFilter(t)?i[n]=!0:e&&e===o.target&&(o.filters.push(t),i[n]=!0)}return i},addLayerFilter:function(t,e){if(e&&e.layerID){var i=e.layerID,n=e.target||"screen",o=n;this._filtersView[i]||(this._filtersView[i]={}),e.id&&(o+="_"+e.id),this._filtersView[i][o]=t,this._triggerObservers(this._getObserversByFilterName(o,n))}return this},removeLayerFilter:function(t){if(this._filtersView[t.layerID]){var e=t.layerID,i=t.target||"screen",n=i;if(t.id&&(n+="_"+t.id),this._filtersView[e][n]){var o=this._getObserversByFilterName(n,i);delete this._filtersView[e][n],this._triggerObservers(o)}}return this},addFilter:function(t,e){return this._filters[t]=e,this._triggerObservers(this._getObserversByFilterName(t)),this},removeFilter:function(t){if(this._filters[t]){var e=this._getObserversByFilterName(t);delete this._filters[t],this._triggerObservers(e)}return this},getItems:function(t){var e=[],i=this._observers[t];if(!i)return[];if(!i.isActive()&&"hover"!==i.id)return[];var n=i.layerID,o=this._filtersView[n]||{},r=i.filters.concat("processingFilter");this._isTemporalLayer&&r.push("TemporalFilter"),r=r.filter(function(t){return t in this._filters||t in o}.bind(this));var s=this,a=function(t){var n=t.data,a=e.length,l=n.length;e.length=a+l;for(var h=0;h<l;h++){var u=t.dataOptions[h];if(i.intersects(u.bounds)){var c=n[h],d=c[c.length-1];if(i.intersectsWithGeometry(d)){for(var p=c[0],m=s.getItem(p),f=!1,_=0;_<r.length;_++){var g=r[_],v=s._filters[g]||o[g];if(v&&!v(m,t,i,d,u)){f=!0;break}}if(!f){var y={id:p,properties:c,item:m,dataOption:u,v:t.v,tileKey:t.vectorTileKey};i.itemHook?i.itemHook(y):e[a++]=y}}}}e.length=a},l=this._getActiveTileKeys();for(var h in l){var u=s._tiles[h].tile;u.data&&u.data.length>0&&(0===u.z||i.intersectsWithTile(u))&&a(u)}return e},_updateItemsFromTile:function(t){for(var e=t.vectorTileKey,i=t.data||[],n=i.length,o=i[0]&&i[0].length-1,r=0;r<n;r++){var s=i[r],a=s[o],l=s[0],h=this._items[l];if(h?(h.processing?t.data[r]=h.properties:(h.properties=s,h.type.indexOf("MULTI")===-1&&(h.type="MULTI"+h.type)),delete h.bounds,h.currentFilter=null):(h={id:l,type:a.type,properties:s,options:{fromTiles:{}}},this._items[l]=h),h.options.fromTiles[e]=r,t.isGeneralized&&(h.options.isGeneralized=!0),this.options.TemporalColumnName){var u=s[this.tileAttributeIndexes[this.options.TemporalColumnName]];h.options.unixTimeStamp=1e3*u}}return n},getMaxDateInterval:function(){return this._chkMaxDateInterval(),{beginDate:this._beginDate,endDate:this._endDate}},_chkMaxDateInterval:function(){if(this._isTemporalLayer&&this._needCheckDateInterval){this._needCheckDateInterval=!1;var t=this._observers,e=null,i=null;for(var n in t){var o=t[n],r=o.dateInterval;r&&((!e||r.beginDate<e)&&(e=r.beginDate),(!i||r.endDate>i)&&(i=r.endDate))}e&&i&&(this._beginDate!==e||this._endDate!==i)&&(this._beginDate=e,this._endDate=i,this._needCheckActiveTiles=!0)}},addObserver:function(t,i){i=i||"s"+ ++this._freeSubscrID;var n=this,o=new m(t);return o.id=i,o.needRefresh=!0,this._observerTileLoader.addObserver(o),o.on("update",function(t){o.needRefresh=!0,t.temporalFilter&&(n._needCheckDateInterval=!0),e.gmx.layersVersion.now(),n._waitCheckObservers()}).on("activate",function(){n.fire("observeractivate"),n.checkObserver(o)}),n._needCheckDateInterval=!0,this._observers[i]=o,this._waitCheckObservers(),o.isActive()&&this.fire("observeractivate"),o},getActiveObserversCount:function(){var t=0;for(var e in this._observers)this._observers[e].isActive()&&t++;return t},getObserver:function(t){return this._observers[t]},removeObserver:function(t){if(this._observers[t]){this._observerTileLoader.removeObserver(t);var e=this._observers[t].isActive();delete this._observers[t],e&&this.fire("observeractivate")}},getObserverLoadingState:function(t){return this._observerTileLoader.getObserverLoadingState(t)},getObserverLeftToLoad:function(t){return this._observerTileLoader.getObserverLeftToLoad(t)},getTileKeysToLoad:function(t,e){var i=this._tilesTree.selectTiles(t,e).tiles;return i},getItemsBounds:function(){if(!this._itemsBounds){this._itemsBounds=i.bounds();for(var t in this._items){var e=this.getItem(t);this._itemsBounds.extendBounds(e.bounds)}}return this._itemsBounds},getItem:function(t){var e=this._items[t];if(e&&!e.bounds){var n=e.options.fromTiles,o=[];for(var r in n)if(this._tiles[r]){var s=n[r],a=this._tiles[r].tile;"loaded"===a.state&&a.dataOptions[s]?o.push(a.dataOptions[s].bounds):delete n[r]}if(1===o.length)e.bounds=o[0];else{e.bounds=i.bounds();for(var l=i.worldWidthMerc,h=0,u=o.length;h<u;h++){var c=o[h];e.bounds.max.x-c.min.x>l&&(c=i.bounds([[c.min.x+2*l,c.min.y],[c.max.x+2*l,c.max.y]])),e.bounds.extendBounds(c)}}}return e},getItemMembers:function(t){var e=this._items[t].options.fromTiles,i=[];for(var n in e)if(this._tiles[n]){var o=this._tiles[n].tile;if(o.data){var r=e[n],s=o.data[r],a=o.dataOptions[r],l=a.bounds;i.push({geo:s[s.length-1],width:l.max.x-l.min.x,dataOption:a})}}return i.sort(function(t,e){return e.width-t.width})},getItemGeometries:function(t){var e=this._items[t]?this._items[t].options.fromTiles:{},n=[];for(var o in e)if(this._tiles[o]&&this._tiles[o].tile.data){var r=this._tiles[o].tile.data,s=r[e[o]];n.push(i.getUnFlattenGeo(s[s.length-1]))}return n},addTile:function(t){this._tiles[t.vectorTileKey]={tile:t},this._getActiveTileKeys()[t.vectorTileKey]=!0,this._observerTileLoader.addTile(t),this.checkObservers()},checkObserver:function(t){t.needRefresh&&t.isActive()&&this._observerTileLoader.startLoadTiles(t)},checkObservers:function(){var t=this._observers;for(var e in this._observers)this.checkObserver(t[e])},_waitCheckObservers:function(){this._checkObserversTimer&&clearTimeout(this._checkObserversTimer),this._checkObserversTimer=setTimeout(e.bind(this.checkObservers,this),25)},_triggerObservers:function(t){var e=t||this._observers;for(var i in e)this._observers[i]&&(this._observers[i].needRefresh=!0);this._waitCheckObservers()},_removeDataFromObservers:function(t){var e=this._observers;for(var i in e)this._observers[i].removeData(t);this._waitCheckObservers()},preloadTiles:function(t,e,i){var o={};this._isTemporalLayer?(this._tilesTree||this.initTilesTree(),o=this._tilesTree.selectTiles(t,e).tiles):(this._needCheckActiveTiles=!0,o=this._getActiveTileKeys());var r=[];for(var s in o){var a=this._getVectorTile(s,!0).tile;if("notLoaded"===a.state&&(!i||i.intersects(a.bounds))){var l=a.load();r.push(l)}}return n.all.apply(null,r)},_updateActiveTilesList:function(t){if(this._tileFilteringHook){var e={};for(var i in t)this._tileFilteringHook(this._getVectorTile(i,!0).tile)&&(e[i]=!0);t=e}var n,o=this._activeTileKeys||{},r={},s=this;this.processingTile&&(t[this.processingTile.vectorTileKey]=!0),this._rasterVectorTile&&(n=this._rasterVectorTile.vectorTileKey,t[n]=!0,this._tiles[n]={tile:this._rasterVectorTile});var a=function(t){var e=s._observerTileLoader.getTileObservers(t);for(var i in e)r[i]=!0};for(n in t)o[n]||(this._observerTileLoader.addTile(this._getVectorTile(n,!0).tile),a(n));for(n in o)t[n]||(a(n),this._observerTileLoader.removeTile(n));this._activeTileKeys=t,this._triggerObservers(r)},_propertiesToArray:function(t){var e=t.properties,i=this.tileAttributeIndexes,n=[];for(var o in i)n[i[o]]=e[o];return n[n.length]=t.geometry,n[0]=t.id,n},_clearProcessing:function(){if(this.processingTile){for(var t=this._items,e=this.processingTile,i=e.vectorTileKey,n=e.data||[],o=0,r=n.length;o<r;o++){var s=n[o][0];if(t[s]){var a=t[s];a.processing=null,a.currentFilter=null,delete a.options.fromTiles[i],delete a.fromServerProps,delete a.geometry}}e.clear()}},_chkProcessing:function(t){var e,i,n,o,r,s=this._items,a=!1,l={};if(t){if(t.Deleted)for(i=0,n=t.Deleted.length;i<n;i++)e=t.Deleted[i],l[e]=!0,s[e]&&(s[e].processing=!0,s[e].currentFilter=null),n>0&&(a=!0);var h={};if(t.Inserted)for(i=0,n=t.Inserted.length;i<n;i++)o=t.Inserted[i],l[o[0]]||(h[o[0]]=o);if(t.Updated){for(i=0,n=t.Updated.length;i<n;i++)o=t.Updated[i],l[o[0]]||(h[o[0]]=o);!a&&n>0&&(a=!0)}r=[];for(e in h)this._items[e]&&(this._items[e].properties=h[e],this._items[e].processing=!0,this._items[e].currentFilter=null),r.push(h[e]);r.length>0&&(this.processingTile=this.addData(r))}a?this.addFilter("processingFilter",function(t,e){return 0===e.z||!t.processing}):this.removeFilter("processingFilter")},enableGeneralization:function(){this.options.isGeneralized||(this.options.isGeneralized=!0,this._resetTilesTree())},disableGeneralization:function(){this.options.isGeneralized&&(this.options.isGeneralized=!1,this._resetTilesTree())},_resetTilesTree:function(){this._tilesTree=null,this._reCheckActiveTileKeys()},updateVersion:function(t,i){if(!e.gmx.skipLoadTiles)if(t&&this.setOptions(t),i){this._needCheckActiveTiles=!1;for(var n,o={},r={},s=0,a=0,l=i.length;s<l;s+=6,a++)n=p.createTileKey({z:Number(i[s]),x:Number(i[s+1]),y:Number(i[s+2]),v:Number(i[s+3]),d:Number(i[s+4]),s:Number(i[s+5])}),o[n]=this._getVectorTile(n,!0),r[n]=!0;this._tiles=o,this.processingTile&&(this._tiles[this.processingTile.vectorTileKey]={tile:this.processingTile}),this._updateActiveTilesList(r)}else this._resetTilesTree()},getNotLoadedVectorTiles:function(t){var e=0;if(t.tiles)for(var i=t.tiles||[],n=0,o=0,r=i.length;n<r;n+=6,o++)this._tiles[p.createTileKey({z:Number(i[n]),x:Number(i[n+1]),y:Number(i[n+2]),v:Number(i[n+3]),d:Number(i[n+4]),s:Number(i[n+5])})]||e++;return e},_getDataKeys:function(t){for(var e={},i=0,n=t.length;i<n;i++)e[t[i][0]]=!0;return e},_getProcessingTile:function(){if(!this.processingTile){var t=-.5,e=-.5,i=0,n=0,o=-1,r=-1,s=this.options.isFlatten;this.processingTile=new p({load:function(t,e,i,n,o,r,s){s({values:[]})}},{x:t,y:e,z:i,v:n,s:o,d:r,isFlatten:s}),this.addTile(this.processingTile)}return this.processingTile},addData:function(t){t||(t=[]);var e=this._getProcessingTile(),i=this._getDataKeys(t),n=e.addData(t,i);return this._itemsBounds&&this._itemsBounds.extendBounds(n),this._updateItemsFromTile(e),this._triggerObservers(),e},removeData:function(t){this._itemsBounds=null;var e=this.processingTile;if(e){var i=(t||e.data).reduce(function(t,e){var i="string"==typeof e?e:e[0];return t[i]=!0,delete this._items[i],t}.bind(this),{});this._removeDataFromObservers(i),e.removeData(i,!0),this._updateItemsFromTile(e),this._triggerObservers()}return e},initTilesTree:function(){
this._tilesTree=e.gmx.tilesTree(this.options),this.options.TemporalTiles=this.options.TemporalVers=null,"TemporalTiles"in this.optionsLink&&(this.optionsLink.TemporalVers=this.optionsLink.TemporalTiles=null),this.dateZero=this._tilesTree.dateZero,this.processingTile&&(this._tiles[this.processingTile.vectorTileKey]={tile:this.processingTile})},_getVectorTile:function(t,e){if(!this._tiles[t]&&e){var i=p.parseTileKey(t);i.dateZero=this.dateZero,this._addVectorTile(i)}return this._tiles[t]},_addVectorTile:function(t){t.isFlatten=this.options.isFlatten,t.needBbox=this.options.needBbox,t.attributes=this.options.attributes;var e=new p(this._vectorTileDataProvider,t),i=e.vectorTileKey;return this._tiles[i]={tile:e},i},_getGeneralizedTileKeys:function(t){for(var i=t.z%2?1:2,n=Math.pow(2,i),o=t.z-i,r=Math.floor(t.x/n),s=Math.floor(t.y/n),a={v:t.v,s:-1,d:-1,isGeneralized:!0},l={};o>1;){var h=[o,r,s].join("_");l[h]=e.extend({},a,{x:r,y:s,z:o}),o-=2,r=Math.floor(r/4),s=Math.floor(s/4)}return l},initTilesList:function(){var t={};if(this.options.tiles){for(var e,i,n,o,r=this.options.tiles||[],s=this.options.tilesVers,a=this.options.isGeneralized?{}:null,l={},h=0,u=0,c=r.length;h<c;h+=3,u++)if(n={x:Number(r[h]),y:Number(r[h+1]),z:Number(r[h+2]),v:Number(s[u]),s:-1,d:-1},o=this._getVectorTile(p.createTileKey(n),!0),i=o.tile.vectorTileKey,l[i]=o,t[i]=!0,a){var d=this._getGeneralizedTileKeys(n);for(e in d){var m=d[e];a[e]?a[e].v=Math.max(m.v,a[e].v):a[e]=m}}if(a)for(e in a)n=a[e],i=p.createTileKey(n),l[i]||(this._tiles[i]||this._addVectorTile(n),l[i]=this._tiles[i],t[i]=!0);this._tiles=l,this.processingTile&&(this._tiles[this.processingTile.vectorTileKey]={tile:this.processingTile})}this._updateActiveTilesList(t)},setTileFilteringHook:function(t){this._tileFilteringHook=t,this._reCheckActiveTileKeys()},removeTileFilteringHook:function(){this._tileFilteringHook=null,this._reCheckActiveTileKeys()},_reCheckActiveTileKeys:function(){this._needCheckActiveTiles=!0,this._getActiveTileKeys()}});e.gmx=e.gmx||{},e.gmx.DataManager=_;var g=e.GridLayer.extend({_animateZoom:function(t){this.options.updateWhenZooming=!1,this._setView(t.center,t.zoom,!0,!0)},_setZoomTransform:function(t,i,n){var o=t.zoom+"_"+n+"_"+t.origin.x+"_"+t.origin.y,r=e.gmx._zoomLevelsCache[o]||{},s=r.translate,a=r.scale;s||(a=this._map.getZoomScale(n,t.zoom),s=t.origin.multiplyBy(a).subtract(this._map._getNewPixelOrigin(i,n))._round(),e.gmx._zoomLevelsCache[o]={translate:s,scale:a}),e.Browser.any3d?e.DomUtil.setTransform(t.el,s,a):e.DomUtil.setPosition(t.el,s)},_clearOldLevels:function(t){if(this._map){t=t||this._map.getZoom();for(var i in this._levels){var n=this._levels[i].el,o=Number(i);o!==t&&(e.DomUtil.remove(n),this._removeTilesAtZoom(o),this._onRemoveLevel(o),delete this._levels[i])}}},_noTilesToLoad:function(){var t=this._tileZoom||this._map.getZoom();for(var e in this._tiles)if(this._tiles[e].coords.z===t&&!this._tiles[e].loaded)return!1;return!0},_tileReady:function(t,i,n){if(this._map){i&&this.fire("tileerror",{error:i,tile:n,coords:t});var o=this._tileCoordsToKey(t);n=this._tiles[o],n&&(n.loaded=+new Date,i||(e.DomUtil.addClass(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this._clearOldLevels(this._tileZoom),this.fire("load")))}},_updateLevels:function(){var t=this._tileZoom,i=this._map;if(void 0!==t){for(var n in this._levels){var o=t-n;0===o&&(this._levels[n].origin=i.project(i.unproject(i.getPixelOrigin()),t).round(),this._onUpdateLevel(t))}var r=this._levels[t];return r||(r=this._levels[t]={},r.el=e.DomUtil.create("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.origin=i.project(i.unproject(i.getPixelOrigin()),t).round(),r.zoom=t,this._setZoomTransform(r,i.getCenter(),i.getZoom()),this._onCreateLevel(r)),this._level=r,r}},_update:function(t){var i=this._map;if(i){var n=this._clampZoom(i.getZoom());if(void 0===t&&(t=i.getCenter()),void 0!==this._tileZoom){var o=this._getTiledPixelBounds(t),r=this._pxBoundsToTileRange(o),s=r.getCenter(),a=[],l=this.options.keepBuffer,h=new e.Bounds(r.getBottomLeft().subtract([l,-l]),r.getTopRight().add([l,-l]));if(!(isFinite(r.min.x)&&isFinite(r.min.y)&&isFinite(r.max.x)&&isFinite(r.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var u in this._tiles){var c=this._tiles[u].coords;c.z===this._tileZoom&&h.contains(new e.Point(c.x,c.y))||(this._tiles[u].current=!1)}if(Math.abs(n-this._tileZoom)>1)return void this._setView(t,n);for(var d=r.min.y;d<=r.max.y;d++)for(var p=r.min.x;p<=r.max.x;p++){var m=new e.Point(p,d);if(m.z=this._tileZoom,this._isValidTile(m)){var f=this._tiles[this._tileCoordsToKey(m)];f?f.current=!0:a.push(m)}}if(a.sort(function(t,e){return t.distanceTo(s)-e.distanceTo(s)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var _=document.createDocumentFragment();for(p=0;p<a.length;p++)this._addTile(a[p],_)}this.fire("update")}}}});e.gmx.VectorLayer=g.extend({options:{tilesCRS:e.CRS.EPSG3395,openPopups:[],className:"vector-tiles",minZoom:1,zIndexOffset:0,isGeneralized:!0,isFlatten:!1,useWebGL:!1,skipTiles:"All",iconsUrlReplace:[],cacheRasters:!0,cacheQuicklooks:!0,clearCacheOnLoad:!0,showScreenTiles:!1,updateWhenZooming:!1,keepBuffer:0,clickable:!0},initialize:function(t){t=e.setOptions(this,t),this._initPromise=new Promise(function(t,e){this._resolve=t,this._reject=e}.bind(this)),this.repaintObservers={},this._gmx={hostName:i.normalizeHostname(t.hostName||"maps.kosmosnimki.ru"),mapName:t.mapID,sessionKey:this.options.sessionKey,iconsUrlReplace:this.options.iconsUrlReplace,showScreenTiles:this.options.showScreenTiles,skipTiles:t.skipTiles,needBbox:"All"===t.skipTiles,useWebGL:t.useWebGL,srs:t.srs||"",layerID:t.layerID,beginDate:t.beginDate,endDate:t.endDate,sortItems:t.sortItems||null,styles:t.styles||[],shiftXlayer:0,shiftYlayer:0,renderHooks:[],preRenderHooks:[],_needPopups:{}},/\buseWebGL=1\b/.test(location.search)&&(this._gmx.useWebGL=!0),t.cacheQuicklooks&&(this._gmx.quicklooksCache={}),t.cacheRasters&&(this._gmx.rastersCache={}),t.crossOrigin&&(this._gmx.crossOrigin=t.crossOrigin)},_onCreateLevel:function(t){this._updateShiftY(t.zoom)},_initContainer:function(){if(!this._container){var t=["leaflet-layer"];this.options.className&&t.push(this.options.className),this._container=e.DomUtil.create("div",t.join(" ")),this.options.clickable===!1&&(this._container.style.pointerEvents="none"),this._updateZIndex(),this.getPane(this.options.pane).appendChild(this._container)}},_onVersionChange:function(){this._updateProperties(this._gmx.rawProperties),this._chkTiles()},_waitCheckOldLevels:function(){this._oldLevelsTimer&&clearTimeout(this._oldLevelsTimer),this._oldLevelsTimer=setTimeout(this._chkOldLevels.bind(this),250)},_chkOldLevels:function(){if(this._map){var t,e,i=this._map._zoom;for(t in this._tiles)if(e=this._tiles[t],e.coords.z===i&&!e.loaded)return;this._loading=!1,this._clearOldLevels(i),this.fire("load")}},_waitOnMoveEnd:function(){this._onmoveendTimer&&clearTimeout(this._onmoveendTimer),this._onmoveendTimer=setTimeout(this._chkTiles.bind(this),250)},_chkCurrentTiles:function(){if(this._map){var t,i,n=this._tileZoom||this._map._zoom;for(t in this._tiles)i=this._tiles[t],i.coords.z===n&&(e.DomUtil.setPosition(i.el,this._getTilePos(i.coords)),i.promise||this.__drawTile(i))}},_chkTiles:function(){this._chkCurrentTiles(),this.repaint(),this._waitCheckOldLevels()},_getEvents:function(){var t=e.GridLayer.prototype.getEvents.call(this);e.extend(t,{});var i=this._gmx,n={dateIntervalChanged:function(){if(this._chkTiles(),e.gmx.sendCmd){var t=i.dataManager.getMaxDateInterval();e.gmx.sendCmd("dateIntervalChanged",{layerID:i.layerID,mapID:i.mapName,hostName:i.hostName,dInterval:[Math.floor(t.beginDate.getTime()/1e3),Math.floor(t.endDate.getTime()/1e3)]})}},tileloadstart:function(t){var e=t.key||this._tileCoordsToKey(t.coords),i=this._tiles[e];i.loaded=0},stylechange:function(){!i.balloonEnable&&this._popup?this.unbindPopup():i.balloonEnable&&!this._popup&&this.bindPopup(""),this._map&&(this.options.minZoom===i.styleManager.minZoom&&this.options.maxZoom===i.styleManager.maxZoom||(this.options.minZoom=i.styleManager.minZoom,this.options.maxZoom=i.styleManager.maxZoom,this._map._updateZoomLevels()),i.labelsLayer?this._map._labelsLayer.add(this):i.labelsLayer||this._map._labelsLayer.remove(this),this.repaint(),this._chkTiles())},versionchange:this._onVersionChange};return t.moveend=this._waitOnMoveEnd.bind(this),t.zoomend=this._waitOnMoveEnd.bind(this),{map:t,owner:n}},beforeAdd:function(t){this._updateShiftY(t.getZoom()),e.GridLayer.prototype.beforeAdd.call(this,t),this._map=t,this._drawnObjectsCount=0},onAdd:function(t){if(t=t||this._map,t.options.crs!==e.CRS.EPSG3857&&t.options.crs!==e.CRS.EPSG3395)throw"GeoMixer-Leaflet: map projection is incompatible with GeoMixer layer";this.beforeAdd(t);var i=this._gmx;this.options.tilesCRS=3857==i.srs?e.CRS.EPSG3857:e.CRS.EPSG3395,i.shiftY=0,i.applyShift=t.options.crs===e.CRS.EPSG3857&&3857!=i.srs,i.currentZoom=t.getZoom(),this._levels={},this._tiles={},this._initContainer(),i.styleManager.initStyles().then(function(){if(i.balloonEnable&&!this._popup&&this.bindPopup(""),this._map){var n=this._getEvents();t.on(n.map,this),this.on(n.owner,this),this.once("remove",function(){t.off(n.map,this),this.off(n.owner,this)},this),e.gmx._zoomLevelsCache={},this._invalidateAll(),this._resetView(),i.dataManager.fire("moveend"),this._chkTiles(),e.gmx.layersVersion.add(this)}this.fire("add")}.bind(this))},onRemove:function(t){var i=this._gmx,n=i.dataManager;i.labelsLayer&&t._labelsLayer.remove(this),i.quicklooksCache={},i.rastersCache={},delete i.map,n&&!n.getActiveObserversCount()&&e.gmx.layersVersion.remove(this),this._map&&e.GridLayer.prototype.onRemove.call(this,t),this._map=null,this.fire("remove")},_removeTile:function(t){this._map&&!this._map._animatingZoom&&(this._gmx&&this._gmx.dataManager&&this._gmx.dataManager.removeObserver(t),e.GridLayer.prototype._removeTile.call(this,t))},_updateZIndex:function(){if(this._container){var t=this.options,e=t.zIndex||0,i=t.zIndexOffset||0;this._container.style.zIndex=i+e}this.fire("zindexupdated")},createTile:function(t,i){var n=e.DomUtil.create("canvas","leaflet-tile"),o=this.getTileSize();return n.width=n.height=0,n.style.width=o.x+"px",n.style.height=o.y+"px",n.onselectstart=e.Util.falseFn,n.onmousemove=e.Util.falseFn,e.Browser.android&&!e.Browser.android23&&(n.style.WebkitBackfaceVisibility="hidden"),n},initFromDescription:function(t){var n=this._gmx;if(n.properties=t.properties,n.geometry=t.geometry,n.properties._initDone&&delete n.properties[n.properties.Temporal?"TemporalTiles":"tiles"],n.properties._initDone=!0,!n.geometry){var o=i.tileSizes[1];n.geometry={type:"POLYGON",coordinates:[[[-o,-o],[-o,o],[o,o],[o,-o],[-o,-o]]]}}if(n.rawProperties=t.rawProperties||t.properties,this._updateProperties(t.properties),"Vector"===n.rawProperties.type&&(t.properties.srs=n.srs=3857,n.RasterSRS=Number(n.rawProperties.RasterSRS)||3857),t.properties.sessionKey=t.properties.sessionKey||n.sessionKey||"",t.properties.needBbox=n.needBbox,t.properties.isGeneralized=this.options.isGeneralized,t.properties.isFlatten=this.options.isFlatten,n.dataManager=this.options.dataManager||new _(t.properties),this.options.parentOptions&&(t.properties.styles||(t.properties.styles=this.options.parentOptions.styles),n.dataManager.on("versionchange",this._onVersionChange,this)),n.styleManager=new y(n),this.options.minZoom=n.styleManager.minZoom,this.options.maxZoom=n.styleManager.maxZoom,n.dataManager.on("observeractivate",this._chkNeedLayerVersion,this),"Vector"!==n.properties.type||"chkUpdate"in this.options||(this.options.chkUpdate=!0),"Raster"!==n.rawProperties.type&&this._objectsReorderInit&&this._objectsReorderInit(this),n.clusters&&this.bindClusters(JSON.parse(n.clusters)),n.filter){var r=e.gmx.Parsers.parseSQL(n.filter.replace(/[\[\]]/g,'"'));r&&n.dataManager.addFilter("userFilter_"+n.layerID,function(t){return n.layerID!==this._gmx.layerID||!r||r(t.properties,n.tileAttributeIndexes,n.tileAttributeTypes)?t.properties:null}.bind(this))}return n.dateBegin&&n.dateEnd&&this.setDateInterval(n.dateBegin,n.dateEnd),this._resolve(),this},getStyleIcon:function(t,e){return this._gmx.styleManager.getStyleIcon(t,e)},_chkNeedLayerVersion:function(){this._chkNeedLayerVersionTimer&&clearTimeout(this._chkNeedLayerVersionTimer),this._chkNeedLayerVersionTimer=setTimeout(function(){this._gmx.dataManager.getActiveObserversCount()?e.gmx.layersVersion.add(this):e.gmx.layersVersion.remove(this)}.bind(this),100)},getDataManager:function(){return this._gmx.dataManager},enableGeneralization:function(){this.options.isGeneralized||(this.options.isGeneralized=!0,this._gmx.dataManager&&(this._gmx.dataManager.enableGeneralization(),this.redraw(),this._chkTiles()))},disableGeneralization:function(){this.options.isGeneralized&&(this.options.isGeneralized=!1,this._gmx.dataManager&&(this._gmx.dataManager.disableGeneralization(),this.redraw(),this._chkTiles()))},setRasterOpacity:function(t){return this._gmx.rasterOpacity!==t&&(this._gmx.rasterOpacity=t,this._initPromise.then(this.repaint.bind(this))),this},getStyles:function(){return this._gmx.styleManager.getStyles()},getIcons:function(t){return this._gmx.styleManager.getIcons(t),this},setStyles:function(t){return this._initPromise.then(function(){this._gmx.styleManager.clearStyles(),t?t.forEach(function(t,e){this.setStyle(t,e,!0)}.bind(this)):this.fire("stylechange")}.bind(this)),this},getStyle:function(t){return this.getStyles()[t]},setStyle:function(t,e,i){return this._initPromise.then(function(){this._gmx.styleManager.setStyle(t,e,i).then(function(){this.fire("stylechange",{num:e||0}),this.repaint()}.bind(this))}.bind(this)),this},setStyleHook:function(t){return this._gmx.styleHook=t,this.repaint(),this},removeStyleHook:function(){return this._gmx.styleHook=null,this},setRasterHook:function(t){return this._gmx.rasterProcessingHook=t,this.repaint(),this},removeRasterHook:function(){return this._gmx.rasterProcessingHook=null,this.repaint(),this},setFilter:function(t){var e=this._gmx;return e.dataManager.addFilter("userFilter",function(i){return e.layerID!==this._gmx.layerID||!t||t(i)?i.properties:null}.bind(this)),this},removeFilter:function(){return this._gmx.dataManager.removeFilter("userFilter"),this},addLayerFilter:function(t,e){var i=this._gmx;return e=e||{},e.layerID=i.layerID,i.dataManager.addLayerFilter(function(e){return!t||t(e)?e.properties:null}.bind(this),e),this},removeLayerFilter:function(t){return t=t||{},t.layerID=this._gmx.layerID,this._gmx.dataManager.removeLayerFilter(t),this},setDateInterval:function(t,i){var n=this._gmx;if(n.dateBegin&&n.dateEnd&&(t=n.dateBegin,i=n.dateEnd),!n.beginDate!=!t||!n.endDate!=!i||t&&n.beginDate.valueOf()!==t.valueOf()||i&&n.endDate.valueOf()!==i.valueOf()){if(n.rawProperties.maxShownPeriod&&t){var o=24*n.rawProperties.maxShownPeriod*3600*1e3;t=new Date(Math.max(t.valueOf(),i.valueOf()-o))}n.beginDate=t,n.endDate=i;var r=null,s=n.dataManager;for(var a in this._tiles)this._tiles[a].loaded=0,r=this._tiles[a].observer,r&&r.setDateInterval(t,i);r=s.getObserver("_Labels"),r&&r.setDateInterval(t,i),("NotVisible"===n.skipTiles||n.needBbox||n.properties.UseTiles===!1)&&(n.needBbox||(n.properties.LayerVersion=-1,s.setOptions({LayerVersion:-1})),this._map&&e.gmx.layersVersion.now()),this.fire("dateIntervalChanged")}return this},getDateInterval:function(){return{beginDate:this._gmx.beginDate,endDate:this._gmx.endDate}},addObserver:function(t){return this._gmx.dataManager.addObserver(t)},removeObserver:function(t){return this._gmx.dataManager.removeObserver(t.id)},setPositionOffset:function(t,e){var i=this._gmx;return i.shiftXlayer=t,i.shiftYlayer=e,this._update(),this},getPositionOffset:function(){var t=this._gmx;return{shiftX:t.shiftXlayer,shiftY:t.shiftYlayer}},setZIndexOffset:function(t){return arguments.length&&(this.options.zIndexOffset=t),this._updateZIndex(),this},_clearLoaded:function(t){this._tiles[t]&&(this._tiles[t].loaded=0)},repaint:function(t){if(this._map){if(this._chkCurrentTiles(),t){if(e.Util.isArray(t)){var i=t;t={},i.forEach(function(e){t[e]=!0,this._clearLoaded(e)}.bind(this))}else if("string"==typeof t){var n=t;this._clearLoaded(n),t={},t[n]=!0}}else{var o,r,s=e.gmx._zoomStart||this._tileZoom||this._map._zoom;t={};for(o in this._tiles)r=this._tiles[o],r.coords.z===s?(t[o]=!0,this._clearLoaded(o),r.observer&&r.observer.activate(!0)):r.observer&&r.observer.deactivate(!0);e.extend(t,this.repaintObservers)}this._gmx.dataManager._triggerObservers(t)}},redrawItem:function(t){if(this._map){var e=this._gmx.dataManager.getItem(t),i=this._getTilesByBounds(e.bounds);this.repaint(i)}},appendTileToContainer:function(t){this._level&&this._level.zoom===t.coords.z&&this._level.el!==t.el.parentNode&&this._level.el.appendChild(t.el)},addData:function(t,e){return this._gmx.mapName||(this._gmx.dataManager.addData(t,e),this.repaint()),this},removeData:function(t,e){return this._gmx.mapName||(this._gmx.dataManager.removeData(t,e),this.repaint()),this},getStylesByProperties:function(t,e){return this._gmx.styleManager.getCurrentFilters(t,e)},getItemStyle:function(t){var e=this._gmx,i=e.dataManager.getItem(t);return e.styleManager.getObjStyle(i)},getTileAttributeTypes:function(){return this._gmx.tileAttributeTypes},getTileAttributeIndexes:function(){return this._gmx.tileAttributeIndexes},getItemBalloon:function(t){var i=this._gmx,n=i.dataManager.getItem(t),o=this.getStyles(),r="";if(n&&o[n.currentFilter]){var s=n.properties;r=e.gmxUtil.parseBalloonTemplate(o[n.currentFilter].Balloon,{properties:this.getItemProperties(s),geometries:[s[s.length-1]],tileAttributeTypes:i.tileAttributeTypes,unitOptions:this._map?this._map.options:{}})}return r},getItemProperties:function(t){var e={},i=this._gmx.tileAttributeIndexes;for(var n in i)e[n]=t[i[n]];return e},addPreRenderHook:function(t){this._gmx.preRenderHooks.push(t),this.repaint()},removePreRenderHook:function(t){for(var e=this._gmx.preRenderHooks,i=0,n=e.length;i<n;i++)if(e[i]===t){e.splice(i,1),this.repaint();break}},addRenderHook:function(t){this._gmx.renderHooks.push(t),this.repaint()},removeRenderHook:function(t){for(var e=this._gmx.renderHooks,i=0,n=e.length;i<n;i++)if(e[i]===t){e.splice(i,1),this.repaint();break}},getGmxProperties:function(){return this._gmx.rawProperties},getBounds:function(){var t=this._gmx.layerID?i.geoItemBounds(this._gmx.geometry).bounds:this._gmx.dataManager.getItemsBounds();return t?t.toLatLngBounds(3857==this._gmx.srs):new e.LatLngBounds},getGeometry:function(){return this._gmx.latLngGeometry||(this._gmx.latLngGeometry=e.gmxUtil.geometryToGeoJSON(this._gmx.geometry,!0,3857==this._gmx.srs)),this._gmx.latLngGeometry},getPropItem:function(t,e){return i.getPropItem(t,e,this._gmx.tileAttributeIndexes)},_getTilesByBounds:function(t){var e=this._gmx,i=this._tileZoom||this._map._zoom,n=e.shiftX||0,o=e.shiftY||0,r=t.toLatLngBounds(3857==e.srs),s=r.getSouthWest(),a=r.getNorthEast(),l=this._map.getBounds(),h=l.getSouthWest(),u=l.getNorthEast(),c=0;u.lng-h.lng<360&&(a.lng<h.lng?c=360*(1+Math.floor((h.lng-a.lng)/360)):s.lng>u.lng&&(c=360*Math.floor((u.lng-s.lng)/360))),s.lng+=c,a.lng+=c;var d,p,m,f,_=this._map.getPixelBounds(),g=this._map.project(s),v=this._map.project(a),y=this.options.tileSize;_?(d=Math.floor((Math.max(v.y,_.min.y)+o)/y),p=Math.floor((Math.min(g.y,_.max.y)+o)/y),m=s.lng<=-180?_.min.x:Math.max(g.x,_.min.x),m=Math.floor((m+n)/y),f=a.lng>=180?_.max.x:Math.min(v.x,_.max.x),f=Math.floor((f+n)/y)):(d=Math.floor((v.y+o)/y),p=Math.floor((g.y+o)/y),m=Math.floor((g.x+n)/y),f=Math.floor((v.x+n)/y));for(var x={},b=m;b<=f;b++)for(var P=d;P<=p;P++){var L=this._tileCoordsToKey({x:b,y:P,z:i});x[L]=!0}return x},_updateProperties:function(t){var i=this._gmx;i.sessionKey||(i.sessionKey=t.sessionKey=this.options.sessionKey||""),this.options.parentOptions&&(t=this.options.parentOptions),i.identityField=t.identityField,i.GeometryType=(t.GeometryType||"").toLowerCase(),i.minZoomRasters=t.RCMinZoomForRasters||1,i.minZoomQuicklooks=i.minZoomRasters;var n=t.type||"Vector";if(t.Temporal&&(n+="Temporal"),i.layerType=n,i.items={},e.extend(i,e.gmxUtil.getTileAttributes(t)),i.dataManager&&i.dataManager.setOptions(t),"ZIndexField"in t&&t.ZIndexField in i.tileAttributeIndexes&&(i.zIndexField=i.tileAttributeIndexes[t.ZIndexField]),this._objectsReorder&&this._objectsReorder.initialize(),i.filter=t.filter,i.dateBegin=t.dateBegin,i.dateEnd=t.dateEnd,i.dataSource=t.dataSource,"MetaProperties"in i.rawProperties){var o=i.rawProperties.MetaProperties;"srs"in o&&(i.srs=o.srs.Value||""),"parentLayer"in o&&(i.dataSource=o.parentLayer.Value||""),"filter"in o&&(i.filter=o.filter.Value||""),"dateBegin"in o&&(i.dateBegin=e.gmxUtil.getDateFromStr(o.dateBegin.Value||"01.01.1980")),"dateEnd"in o&&(i.dateEnd=e.gmxUtil.getDateFromStr(o.dateEnd.Value||"01.01.1980")),("shiftX"in o||"shiftY"in o)&&(i.shiftXlayer=o.shiftX?Number(o.shiftX.Value):0,i.shiftYlayer=o.shiftY?Number(o.shiftY.Value):0),("shiftXfield"in o||"shiftYfield"in o)&&(o.shiftXfield&&(i.shiftXfield=o.shiftXfield.Value),o.shiftYfield&&(i.shiftYfield=o.shiftYfield.Value)),"quicklookPlatform"in o&&(i.quicklookPlatform=o.quicklookPlatform.Value,"image"===i.quicklookPlatform&&delete i.quicklookPlatform),"quicklookX1"in o&&(i.quicklookX1=o.quicklookX1.Value),"quicklookY1"in o&&(i.quicklookY1=o.quicklookY1.Value),"quicklookX2"in o&&(i.quicklookX2=o.quicklookX2.Value),"quicklookY2"in o&&(i.quicklookY2=o.quicklookY2.Value),"quicklookX3"in o&&(i.quicklookX3=o.quicklookX3.Value),"quicklookY3"in o&&(i.quicklookY3=o.quicklookY3.Value),"quicklookX4"in o&&(i.quicklookX4=o.quicklookX4.Value),"quicklookY4"in o&&(i.quicklookY4=o.quicklookY4.Value),"gmxProxy"in o&&(i.gmxProxy="true"===o.gmxProxy.Value.toLowerCase()?e.gmx.gmxProxy:o.gmxProxy.Value),"multiFilters"in o&&(i.multiFilters="1"===o.multiFilters.Value),"isGeneralized"in o&&(this.options.isGeneralized="false"!==o.isGeneralized.Value),"isFlatten"in o&&(this.options.isFlatten="false"!==o.isFlatten.Value)}if(t.Temporal&&(this.options.isGeneralized=!1),t.IsRasterCatalog){i.IsRasterCatalog=t.IsRasterCatalog;var r=i.tileAttributeIndexes.GMX_RasterCatalogID;r&&(i.rasterBGfunc=function(t,n,o,s,a){var l=s.properties,h=e.gmxUtil.protocol+"//"+i.hostName+"/TileSender.ashx?ModeKey=tile&ftc=osm&x="+t+"&y="+n+"&z="+o;return(a||i.srs)&&(h+="&srs="+(a||i.srs)),i.crossOrigin&&(h+="&cross="+i.crossOrigin),h+="&LayerName="+l[r],i.sessionKey&&(h+="&key="+encodeURIComponent(i.sessionKey)),e.gmx._sw&&s.v&&(h+="&sw="+e.gmx._sw+"&v="+s.v),h})}if(t.Quicklook){var s;s="{"===t.Quicklook[0]?JSON.parse(t.Quicklook):{minZoom:i.minZoomRasters,template:t.Quicklook},"X1"in s&&(i.quicklookX1=s.X1),"Y1"in s&&(i.quicklookY1=s.Y1),"X2"in s&&(i.quicklookX2=s.X2),"Y2"in s&&(i.quicklookY2=s.Y2),"X3"in s&&(i.quicklookX3=s.X3),"Y3"in s&&(i.quicklookY3=s.Y3),"X4"in s&&(i.quicklookX4=s.X4),"Y4"in s&&(i.quicklookY4=s.Y4);var a=i.Quicklook=s.template;"minZoom"in s&&(i.minZoomQuicklooks=s.minZoom),i.quicklookBGfunc=function(t){for(var e=a,n=/\[([^\]]+)\]/,o=n.exec(e);o&&o.length>1;)e=e.replace(o[0],t.properties[i.tileAttributeIndexes[o[1]]]),o=n.exec(e);return e},i.imageQuicklookProcessingHook=e.gmx.gmxImageTransform}this.options.attribution=t.Copyright||""},_updateShiftY:function(t){var e=this._gmx;e.currentZoom=t,e.tileSize=i.tileSizes[t],e.mInPixel=this.options.tileSize/e.tileSize},__drawTile:function(e){var i=e.coords,n=this._tileCoordsToKey(i),o=this._tiles[n];if(o){var r=this,s=this._tileZoom,a=this._gmx;o.promise?o.resolve():(o.loaded=0,o.key=n,o.screenTile=new t(r,o),o.promise=new Promise(function(t,e){o.resolve=t,o.reject=e;var l=a.dataManager.getViewFilters("screen",a.layerID),h=function(){o.count&&(r._drawnObjectsCount+=o.count,r.appendTileToContainer(o)),r._tileReady(i,null,o.el)};o.observer=a.dataManager.addObserver({type:"resend",layerID:a.layerID,needBbox:a.needBbox,srs:a.srs,target:"screen",z:s,targetZoom:r.options.isGeneralized?s:null,dateInterval:"VectorTemporal"===a.layerType?[a.beginDate,a.endDate]:null,active:!0,bbox:a.styleManager.getStyleBounds(i),filters:["clipFilter","userFilter_"+a.layerID,"styleFilter","userFilter"].concat(l),callback:function(t){r._tiles[n]?(r._tiles[n].loaded=0,o.screenTile.drawTile(t).then(function(t){t&&(o.count=t.count),h(t)},function(t){h(t)})):h()}},n)})["catch"](function(t){console.warn("catch:",t)}))}}}),e.Map.addInitHook(function(){e.Mixin.ContextMenu&&e.gmx.VectorLayer.include(e.Mixin.ContextMenu),this.options.ftc=this.options.ftc||"osm",this.options.srs=this.options.srs||3857,this.options.skipTiles=this.options.skipTiles||"All",e.gmx.leafletMap=this,e.gmx._zoomLevelsCache={},this.on("zoomstart",function(t){e.gmx._zoomStart=t.zoom,e.gmx._zoomLevelsCache={},e.gmx._zoomLevelsCount=0;var i=0,n=this.options.maxZoomAnimGmxLayers||5;for(var o in this._layers){var r=this._layers[o];if(r._map&&r instanceof e.gmx.VectorLayer){var s=e.DomUtil.removeClass;t.zoom>this._zoom&&(0===r._drawnObjectsCount||i>n)?s=e.DomUtil.addClass:i++,s(r._container,"leaflet-zoom-hide"),r._drawnObjectsCount=0}}},this)});var v={credentials:"include"};t.prototype={_getUrlFunction:function(t,e){return this.gmx.rasterBGfunc(t.x,t.y,t.z,e)},_loadTileRecursive:function(t,i){var n=this.gmx,o={z:t.z,x:this.ntp.x,y:this.ntp.y},r=this;return this.rasterRequests={},new Promise(function(t){var s=function(o,a){var l=r._getUrlFunction(o,i);if(n.rastersCache&&n.rastersCache[l])t({gtp:o,image:n.rastersCache[l]});else{var h=function(e){e&&(n.badTiles[e]=!0),o.z>1?s({x:Math.floor(o.x/2),y:Math.floor(o.y/2),z:o.z-1},""):t({gtp:o})},u=function(t){r.layer.fire("bitmap",{id:i.id,loaded:!1,url:l,result:t}),h(l)};if(n.badTiles[l]||n.maxNativeZoom&&n.maxNativeZoom<o.z)return void h();if(e.gmx.getBitmap)e.gmx.getBitmap(l,v).then(function(e){if(e){var s=e.imageBitmap,a=document.createElement("canvas");a.width=s.width,a.height=s.height,a.getContext("2d").drawImage(s,0,0,a.width,a.width),n.rastersCache&&(n.rastersCache[l]=a),t({gtp:o,image:a}),r.layer.fire("bitmap",{id:i.id,loaded:!0,url:l,result:e})}else u()},u)["catch"](e.Util.falseFn);else{var c=r.rasterRequests[l];c?c.options.tileRastersId=r._uniqueID:(n.rasterProcessingHook&&(a="anonymous"),c=e.gmx.imageLoader.push(l,{tileRastersId:r._uniqueID,zoom:r.zoom,cache:!0,crossOrigin:n.crossOrigin||a||""}),r.rasterRequests[l]=c),c.def.then(function(e){e?(n.rastersCache&&(n.rastersCache[l]=e),t({gtp:o,image:e})):h(l)},function(){h(l)})}}};s(o)})},_rasterHook:function(t){var e=t.sourceTilePoint||t.destinationTilePoint,i={geoItem:t.geoItem,zKey:t.zKey,destination:{z:t.destinationTilePoint.z,x:t.destinationTilePoint.x,y:t.destinationTilePoint.y},source:{z:e.z,x:e.x,y:e.y}};return t.url&&(i.quicklook=t.url),(this.gmx.rasterProcessingHook||this._defaultRasterHook)(t.res,t.image,t.sx||0,t.sy||0,t.sw||256,t.sh||256,t.dx||0,t.dy||0,t.dw||256,t.dh||256,i)},_defaultRasterHook:function(t,e,i,n,o,r,s,a,l,h){if(e){var u=t.getContext("2d");u.drawImage(e,i,n,o,r,s,a,l,h)}return t},_getShiftPixels:function(t){var e=t.dx+(t.dx<0?256:0),i=t.dy+(t.dy<0?256:0),n=0,o=256-e,r=e,s=o;if(t.tx>t.x&&(n=o,o=e,r=0,s=o),256===n||o<1)return null;var a=i,l=256-i,h=0,u=l;return t.ty>t.y&&(a=0,h=l,l=i,u=l),256===a||l<1?null:{sx:n,sy:a,sw:o,sh:l,dx:r,dy:h,dw:s,dh:u}},_getShiftTilesArray:function(t,e,i){var n=this.topLeft.mInPixel,o=this.gmxTilePoint,r=e*n,s=i*n,a=Math.floor(.5+r%this.ts),l=Math.floor(.5+s%this.ts),h=this.ts/n,u=o.x-e/h,c=o.y-i/h,d=Math.floor(u),p=d+(u===d?0:1),m=Math.floor(c),f=m+(c===m?0:1),_=Math.floor((t.min.x-e)/h),g=Math.floor((t.max.x-e)/h),v=Math.floor((t.min.y-i)/h),y=Math.floor((t.max.y-i)/h);d<_&&(d=_),p>g&&(p=g),m<v&&(m=v),f>y&&(f=y);for(var x=[],b=m;b<=f;b++)for(var P=d;P<=p;P++)x.push({z:o.z,x:P,y:b,dx:a,dy:l,tx:u,ty:c});return x},_chkRastersByItemIntersect:function(t,e){var n=e.properties[e.properties.length-1],o=[];return t.forEach(function(t){var e=i.getBoundsByTilePoint(t);i.isItemIntersectBounds(n,e)&&o.push(t)}),o},getTilePosZoomDelta:function(t,e,i){var n=Math.pow(2,e-i),o=this.ts/n,r=t.x%n,s=t.y%n;return{size:o,zDelta:n,x:o*r,y:o*s}},_getItemRasters:function(t){var n=t.properties,o=n[0],r=this,s=this.gmx,a=s.tileAttributeIndexes,l=this.rasters,h=Number(s.shiftXfield?i.getPropItem(s.shiftXfield,n,a):0)%this.worldWidthMerc,u=Number(s.shiftYfield?i.getPropItem(s.shiftYfield,n,a):0),c=h||u,d=i.getPropItem("urlBG",n,a),p="",m=null,f=!1,_=s.dataManager.getItem(o),g=this.gmxTilePoint,y=this.tilePoint,x=this.ntp,b=null;return _.v=t.v,s.IsRasterCatalog&&("Raster"===s.rawProperties.type||i.getPropItem("GMX_RasterCatalogID",n,a))?f=!0:s.quicklookBGfunc?(p=s.quicklookBGfunc(_),m=s.imageQuicklookProcessingHook):d&&(p=d,m=s.imageQuicklookProcessingHook),f?new Promise(function(i){var n=t.dataOption||{},a=this._chkRastersByItemIntersect(c?this._getShiftTilesArray(n.bounds,h,u):[x],t),d=a.length,p=function(){d<1&&i()},f=function(){d--,p()},g=function(i,n,a){_.skipRasters=!1;var h=!0;m&&(a=m(a,{gmx:s,geoItem:t,item:_,gmxTilePoint:i}),h=!1);var u={geoItem:t,image:a,zKey:r.zKey,destinationTilePoint:y,sourceTilePoint:i,sx:0,sy:0,sw:r.ts,sh:r.ts,dx:0,dy:0,dw:r.ts,dh:r.ts};if(c){var g=r._getShiftPixels(n);if(null===g)return void f();e.extend(u,g),h=!1}if(i.z!==x.z){var v=r.getTilePosZoomDelta(x,x.z,i.z);if(v.size<1/256)return void p();if(h=!1,u.sx=Math.floor(v.x),u.sy=Math.floor(v.y),u.sw=u.sh=v.size,c){var P=Math.floor(u.dw/v.zDelta);u.sx=(0===u.dx?u.sw:r.ts)-P,u.sw=P;var L=Math.floor(u.dh/v.zDelta);u.sy=(0===u.dy?u.sh:r.ts)-L,u.sh=L}}if(h&&!s.rasterProcessingHook)d--,b=a,l[o]=b,p();else{b||(b=document.createElement("canvas"),b.width=b.height=r.ts),u.res=b;var T=r._rasterHook(u),w=function(){d--,l[o]=b,p()};T?T.then?T.then(w):(b=T,w()):null===T?(_.skipRasters=!0,f()):(b=a,w())}};d?a.map(function(t){var e=r._loadTileRecursive(t,_);return e.then(function(e){g(e.gtp,t,e.image)},f),e}):(_.skipRasters=!0,f())}.bind(this)):(s.sessionKey&&(p+=(p.indexOf("?")===-1?"?":"&")+"key="+encodeURIComponent(s.sessionKey)),new Promise(function(i){var n=function(t){r.layer.fire("bitmap",{id:o,loaded:!1,url:p,result:t}),_.skipRasters=!0,i()};if(!p)return void n();var a=function(e){s.quicklooksCache[p]=e;var r=e;if(this.gmx.rasterProcessingHook,m){var a={gmx:s,topLeft:this.topLeft,geoItem:t,item:_,gmxTilePoint:g};r=m(e,a)}r?(i(r),_.skipRasters=!1,l[o]=r):n()}.bind(this);if(s.quicklooksCache&&s.quicklooksCache[p])a(s.quicklooksCache[p]);else if(e.gmx.getBitmap){var h=p;s.gmxProxy&&(h=s.gmxProxy+"?WrapStyle=none&get="+encodeURIComponent(p)),e.gmx.getBitmap(h,v).then(function(t){var e=t.imageBitmap,i=document.createElement("canvas");i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(e,0,0,i.width,i.height),a(i),r.layer.fire("bitmap",{id:o,loaded:!0,url:p,result:t})},n)["catch"](n)}else{var u=this.rasterRequests[p];u?u.options.tileRastersId=this._uniqueID:(u=e.gmx.imageLoader.push(p,{tileRastersId:r._uniqueID,crossOrigin:s.crossOrigin||"anonymous"}),this.rasterRequests[p]=u),u.def.then(a,n)}}.bind(this)))},_getVisibleItems:function(t){if(t.length<2)return this.itemsView=t,t;i._tileCanvas||(i._tileCanvas=document.createElement("canvas"),i._tileCanvas.width=i._tileCanvas.height=this.ts);var n,o,r=this.gmx,s=r.dataManager,a=i._tileCanvas,l=a.getContext("2d"),h={tbounds:this.tbounds,gmx:r,topLeft:this.topLeft,tpx:this.tpx,tpy:this.tpy,ctx:l};for(l.clearRect(0,0,this.ts,this.ts),l.imageSmoothingEnabled=!1,n=0,o=t.length;n<o;n++){l.fillStyle=i.dec2rgba(n+1,1);var u=t[n];e.gmxUtil.drawGeoItem(u,s.getItem(u.properties[0]),h,{fillStyle:l.fillStyle})}var c={},d=l.getImageData(0,0,this.ts,this.ts).data;for(n=0,o=d.length;n<o;n+=4)if(255===d[n+3]){var p=d[n+2];d[n+1]&&(p+=d[n+1]<<8),d[n]&&(p+=d[n]<<16),p&&(c[p]=!0)}var m=[];for(var f in c){var _=t[Number(f)-1];_&&m.push(_)}return this.itemsView=m,m},_getNeedRasterItems:function(t){for(var e=this.gmx,n=e.tileAttributeIndexes,o=this.tbounds,r=[],s=0,a=t.length;s<a;s++){var l=t[s],h=l.properties,u=h[0],c=l.dataOption||{},d=!1;if(e.quicklookBGfunc&&!i.getPropItem("GMX_RasterCatalogID",h,n)){
if(e.minZoomQuicklooks&&this.zoom<e.minZoomQuicklooks)continue;var p=i.getPropItem(e.quicklookPlatform,h,n)||e.quicklookPlatform||"";if(!(p&&"imageMercator"!==p||i.getQuicklookPointsFromProperties(h,e)))continue}e.styleHook&&(l.styleExtend=e.styleHook(e.dataManager.getItem(u),e.lastHover&&u===e.lastHover.id),d=l.styleExtend&&l.styleExtend.skipRasters),!d&&o.intersectsWithDelta(c.bounds,-1,-1)&&r.push(l)}return this._getVisibleItems(r)},_getTileRasters:function(t){return new Promise(function(e){var i=this._getNeedRasterItems(t).map(this._getItemRasters.bind(this));Promise.all(i).then(e,function(){})}.bind(this))},_chkItems:function(t){var e=this.layer;if(!e._map)return null;var i=t&&t.added&&t.added.length?t.added:null;if(!i){var n=e._tiles[this.zKey];return n&&n.el&&n.el.getContext("2d").clearRect(0,0,this.ts,this.ts),null}return this.gmx.sortItems?e.getSortedItems(i):i},destructor:function(){this._preRenderPromise&&this._preRenderPromise.reject(),this._renderPromise&&this._renderPromise.reject(),this._cancelRastersPromise(),this._clearCache()},_cancelRastersPromise:function(){this.rastersPromise&&(this.rastersPromise.reject&&this.rastersPromise.reject(),this.rastersPromise=null)},_clearCache:function(){for(var t in this.rasterRequests)this.rasterRequests[t].remove();this.rasterRequests={}},drawTile:function(t){return this.destructor(),new Promise(function(i,n){if(e.gmx._zoomStart&&e.gmx._zoomStart!==this.zoom)return void i();var o=this._chkItems(t),r=function(){i({count:o.length})}.bind(this),s=this;if(this._uniqueID++,o){var a=s.tile,l=a.getContext("2d");if(this.layer._gridClusters&&this.layer._gridClusters.checkData({geoItems:o,tileElem:this.tileElem,layer:this.layer}))return void r();var h=this.layer.options.tileSize;this.tile.width=this.tile.height=h;var u=function(){var t=s.gmx,i={tbounds:s.tbounds,rasters:s.rasters,gmx:t,topLeft:s.topLeft,tpx:s.tpx,tpy:s.tpy,ctx:l},u="zKey:"+s.zKey+" count: "+o.length;e.DomUtil.addClass(a,u),s.layer._gridClusters||(l.clearRect(0,0,h,h),t.showScreenTiles&&(l.strokeRect(0,0,h-1,h-1),l.strokeText(s.zKey+" "+o.length,50,50)));var c,d={zKey:s.zKey,topLeft:s.topLeft,tpx:s.tpx,tpy:s.tpy,x:s.tilePoint.x,y:s.tilePoint.y,z:s.zoom},p=[];t.preRenderHooks.forEach(function(t){c||(c=document.createElement("canvas"),c.width=c.height=h||256);var e=t(c,d);e&&e.then&&p.push(e)}),Promise.all(p).then(function(){c&&(i.bgImage=c);for(var l=0,h=o.length;l<h;l++){var u=o[l],p=u.id,m=t.dataManager.getItem(p);if(m){var f=t.styleManager.getObjStyle(m,s.zoom),_=t.lastHover&&t.lastHover.id===u.id&&f;if(t.multiFilters)for(var g=0,v=m.multiFilters.length;g<v;g++){var y=m.multiFilters[g];e.gmxUtil.drawGeoItem(u,m,i,_?y.parsedStyleHover:y.parsedStyle,y.style)}else e.gmxUtil.drawGeoItem(u,m,i,_?m.parsedStyleHover:m.parsedStyleKeys,f);p in t._needPopups&&!t._needPopups[p]&&(t._needPopups[p]=!0)}}Promise.all(s._getHooksPromises(t.renderHooks,a,d)).then(r,n)},n)};this.showRaster?(this.rastersPromise=this._getTileRasters(o),this.rastersPromise.then(u,n)):u()}else i()}.bind(this))["catch"](function(){})},_getHooksPromises:function(t,e,i){var n=[];return t.forEach(function(t){var o=t(e,i);o&&o.then&&n.push(o)}),n}},function(){var t=1e6,i=function(t){this.all={},this.userSetSortFunc=!1,this.sortFunc=null,this.count=0,this.disabled=!1,this.layer=t,t.on("add",this.onAdd,this),t.on("remove",this.onRemove,this)};i.prototype={addToReorder:function(t,e){++this.count,this.all[t]=e?-this.count:this.count},clickFunc:function(t){if(!this.disabled){var e=t.gmx.id;this.addToReorder(e,t.originalEvent.ctrlKey),this.layer.redrawItem(e)}},sortItems:function(e,i){var n=this._objectsReorder;if(n.count>0){var o=n.all[e.id],r=n.all[i.id];if(o||r)return o=o?o+(o>0?t:-t):0,r=r?r+(r>0?t:-t):0,o-r}return n.sortFunc?n.sortFunc.call(this,e,i):0},resetSortFunc:function(){var t=this.layer,e=t._gmx,i=e.zIndexField;e.sortItems=this.sortItems,this.sortFunc=i&&!this.userSetSortFunc?function(t,e){var n=Number(t.properties[i])-Number(e.properties[i]);return n?n:t.id-e.id}:function(t,e){return t.id-e.id}},initialize:function(){var t=this.layer._gmx;this.userSetSortFunc||"polygon"!==t.GeometryType&&"linestring"!==t.GeometryType||this.resetSortFunc()},onAdd:function(){this.initialize(),this.layer.on("click",this.clickFunc,this)},onRemove:function(){this.layer.off("click",this.clickFunc,this)}},e.gmx.VectorLayer.include({_objectsReorder:null,_objectsReorderInit:function(){this._objectsReorder||(this._objectsReorder=new i(this))},getReorderArrays:function(){var t={top:[],bottom:[]};if(this._objectsReorder)for(var e=this._objectsReorder,i=Object.keys(e.all).sort(function(t,i){return e.all[t]-e.all[i]}),n=0,o=i.length;n<o;n++){var r=i[n];e.all[r]>0?t.top.push(r):t.bottom.push(r)}return t},bringToTopItem:function(t){return this._objectsReorderInit(),this._objectsReorder.addToReorder(t),this.redrawItem(t),this},bringToBottomItem:function(t){return this._objectsReorderInit(),this._objectsReorder.addToReorder(t,!0),this.redrawItem(t),this},clearReorderArrays:function(){if(this._objectsReorder){var t=this._objectsReorder;t.all={},t.count=0,this.repaint()}return this},setReorderArrays:function(t,e){this._objectsReorderInit();var i=this._objectsReorder;return i.all={},i.count=0,e&&e.forEach(function(t){i.addToReorder(t,!0)}),t&&t.forEach(function(t){i.addToReorder(t)}),this.repaint(),this},getSortedItems:function(t){return this._objectsReorderInit(),t.sort(e.bind(this._objectsReorder.count>0?this._gmx.sortItems:this._objectsReorder.sortFunc,this))},setSortFunc:function(t){this._objectsReorderInit();var e=this._objectsReorder;return e.sortFunc=t,e.userSetSortFunc=!!t,this._gmx.sortItems=e.sortItems,this.repaint(),this},disableFlip:function(){return this._objectsReorderInit(),this._objectsReorder.disabled=!0,this},enableFlip:function(){return this._objectsReorderInit(),this._objectsReorder.disabled=!1,this}})}();var y=function(t){this.gmx=t,this.promise=new Promise(function(t,e){this.resolve=t,this.reject=e}.bind(this)),this._maxVersion=0,this._maxStyleSize=0,this._styles=[],this._deferredIcons=[],this._parserFunctions={},this._serverStylesParsed=!1;for(var e=1/0,i=-(1/0),n=t.properties.styles||[],o=0,r=n.length;o<r;o++){var s=n[o];e=Math.min(e,s.MinZoom),i=Math.max(i,s.MaxZoom)}this.minZoom=e===1/0?0:e,this.maxZoom=i===-(1/0)?18:i};y.prototype={getStyleIcon:function(t,i){var n=this._styles[t];if(!n)return null;i=i||"";var o=this.gmx.GeometryType||"polygon",r=n.RenderStyle,s='<div class="gmx-style-legend"><span class="prefixWrapper"><span class="prefix'+(r.iconUrl?"":" style")+'">'+i+"</span></span>";if(s+='<span class="legend-block">',r.iconUrl)s+='<span class="legendIconStyleImage"><img crossorigin="" src="'+r.iconUrl+'" /></span>';else{var a="";r.fillColor&&(a="background-color: "+e.gmxUtil.dec2rgba(r.fillColor,r.fillOpacity||1)),r.color&&(a+=" border-color: "+e.gmxUtil.dec2rgba(r.color,r.opacity||1)),s+='<span class="legendIconStyle '+o+'"'+(a?' style="'+a+'"':"")+'"></span>'}var l=n.Name||n.Filter||"легенда";return s+='<span class="legendIconCell"><span class="styleName"> '+l+"</span>",s+="</span></div>"},_getMaxStyleSize:function(t){for(var e=0,i=0,n=this._styles.length;i<n;i++){var o=this._styles[i];if(!(t>o.MaxZoom||t<o.MinZoom)){var r=o.RenderStyle;if(this._needLoadIcons||!r||!("maxSize"in r)){e=y.MAX_STYLE_SIZE;break}var s=0;"iconAnchor"in r&&!r.iconCenter&&(s=Math.max(Math.abs(r.iconAnchor[0]),Math.abs(r.iconAnchor[1]))),e=Math.max(r.maxSize+s,e)}}return e},getStyleBounds:function(t){if(!t)return i.bounds();this._maxStyleSize=this._getMaxStyleSize(t.z);var e=2*this._maxStyleSize*i.tileSizes[t.z]/256;return i.getBoundsByTilePoint(t).addBuffer(e)},isVisibleAtZoom:function(t){for(var e=0,i=this._styles.length;e<i;e++){var n=this._styles[e];if(t>=n.MinZoom&&t<=n.MaxZoom)return!0}return!1},getIcons:function(t){var e=this;this.promise.then(function(){for(var i=[],n=0,o=e._styles.length;n<o;n++){var r=e._styles[n],s={};r.RenderStyle&&(s.RenderStyle={image:r.RenderStyle.image}),r.HoverStyle&&(s.HoverStyle={image:r.HoverStyle.image}),i.push(s)}t&&t(i)}),this.initStyles()},_chkReady:function(){if(this._needLoadIcons<1){var t=this;this.gmx.dataManager&&this.gmx.dataManager.addFilter("styleFilter",function(e){return t._chkStyleFilter(e)}),this.resolve()}},initStyles:function(){this._serverStylesParsed||this._parseServerStyles();for(var t=0,e=this._deferredIcons.length;t<e;t++)this._getImageSize(this._deferredIcons[t]);return this._deferredIcons=[],this._chkReady(),this.promise},getStyles:function(){this._serverStylesParsed||this._parseServerStyles();for(var t=[],i=0,n=this._styles.length;i<n;i++){var o=e.extend({},this._styles[i]);o.RenderStyle=y.getStyleKeys(o.RenderStyle),o.HoverStyle&&(o.HoverStyle=y.getStyleKeys(o.HoverStyle)),delete o.filterFunction,delete o.version,delete o.common,delete o.type,t.push(o)}return t},clearStyles:function(){this._styles=[],this.gmx.balloonEnable=!1,this.gmx.labelsLayer=!1},_changeStylesVersion:function(){var t=this;this._styles.map(function(e){e.version=++t._maxVersion})},setStyle:function(t,i,n){if(i=i||0,i<this._styles.length||n){var o=this._styles[i];if(o||(o=this._prepareItem({}),this._styles[i]=o),o.version=++this._maxVersion,"Filter"in t){o.Filter=t.Filter;var r=typeof t.Filter;o.filterFunction="string"===r?e.gmx.Parsers.parseSQL(o.Filter.replace(/[\[\]]/g,'"')):"function"===r?o.Filter:null,this._changeStylesVersion()}for(var s=0,a=y.DEFAULT_KEYS.length;s<a;s++){var l=y.DEFAULT_KEYS[s];l in t&&(o[l]=t[l])}t.RenderStyle&&(o.RenderStyle=this._parseStyle(t.RenderStyle)),t.HoverStyle&&(o.HoverStyle=this._parseStyle(t.HoverStyle,o.RenderStyle)),this._checkStyles()}return this.initStyles()},getItemBalloon:function(t){var e=this.gmx.dataManager.getItem(t),i=e?e.currentFilter:0,n=this._styles[i];return n?{DisableBalloonOnMouseMove:n.DisableBalloonOnMouseMove||!1,DisableBalloonOnClick:n.DisableBalloonOnClick||!1,templateBalloon:n.Balloon||null,isSummary:/\[SUMMARY\]/.test(n.Balloon)}:null},getObjStyle:function(t,e){this._chkStyleFilter(t,e);var i,n=this._styles[t.currentFilter];return n?n.hoverDiff&&this.gmx.lastHover&&t.id===this.gmx.lastHover.id?n.HoverStyle?(i=n.HoverStyle.version||-1,i!==t.styleVersion&&(t.parsedStyleHover=this._itemStyleParser(t,n.HoverStyle)),n.HoverStyle):(delete t.parsedStyleHover,null):(i=n.version||-1,i!==t.styleVersion&&(t.parsedStyleKeys=this._itemStyleParser(t,n.RenderStyle)),n.RenderStyle):null},_needLoadIcons:0,_getImageSize:function(t){var i=t.iconUrl||t.fillIconUrl||"",n={crossOrigin:"anonymous"},o=e.gmxUtil.isIE11&&/\.svg/.test(i),r=this;"file:"!==self.location.protocol&&(i=i.replace(/http(s*):/,"")),o&&(i+=(i.indexOf("?")===-1?"?":"&")+"crossOrigin="+n.crossOrigin),n.layerID=this.gmx.layerID,++this._needLoadIcons,e.gmx.imageLoader.unshift(i,n).def.then(function(e){if(t.version=++r._maxVersion,t.fillIconUrl)t.imagePattern=e;else{t.sx=e.width||e.offsetWidth,t.sy=e.height||e.offsetHeight,t.image=e;var i=t.iconAngle?Math.sqrt(t.sx*t.sx+t.sy*t.sy):Math.max(t.sx,t.sy);t.scaleFunction||t.rotateFunction||((t.iconScale||1===t.iconScale)&&(i*=t.iconScale),t.common=!0),t.maxSize=Number(i.toFixed())}r._needLoadIcons--,r._chkReady()},function(){t.version=++r._maxVersion,t.sx=1,t.sy=0,t.image=null,r._needLoadIcons--,r._chkReady(),console.log({url:i,func:"_getImageSize",Error:"image not found"})})},getCurrentFilters:function(t,e){var i=this.gmx,n=i.tileAttributeIndexes,o=i.tileAttributeTypes,r=e||1,s=[];this._serverStylesParsed||this._parseServerStyles();for(var a=0,l=this._styles.length;a<l;a++){var h=this._styles[a];if(!(r>h.MaxZoom||r<h.MinZoom||h.filterFunction&&!h.filterFunction(t,n,o)||(s.push(a),i.multiFilters)))break}return s},_chkStyleFilter:function(t,e){var i=this.gmx,n=i.multiFilters?-1:t.currentFilter,o=this._styles[n],r=!o||o.version!==t.styleVersion;if(e=e||i.currentZoom,r||t._lastZoom!==e){t.currentFilter=-1,t.multiFilters=[];for(var s=this.getCurrentFilters(t.properties,e),a=0,l=s.length;a<l;a++){var h=s[a],u=this._styles[h];if(t.hoverDiff=u.hoverDiff,t.currentFilter=h,r||n!==h){var c=u.common&&u.common.RenderStyle||this._itemStyleParser(t,u.RenderStyle),d=null;t.parsedStyleKeys=c,u.HoverStyle&&(d=u.common&&u.common.HoverStyle||this._itemStyleParser(t,u.HoverStyle),t.parsedStyleHover=d),i.multiFilters&&t.multiFilters.push({style:u.RenderStyle,styleHover:u.HoverStyle,parsedStyle:c,parsedStyleHover:d})}if(t.styleVersion=u.version,!i.multiFilters)break}t._lastZoom=e}return!!this._styles[t.currentFilter]||(t.currentFilter=-1,!1)},_parseServerStyles:function(){var t,e,i=this.gmx,n=i.properties,o=n.gmxStyles?n.gmxStyles.styles:null,r=o||n.styles||[{MinZoom:1,MaxZoom:21,RenderStyle:y.DEFAULT_STYLE}],s=Math.max(r.length,i.styles.length);if(o)for(t=0;t<s;t++)this._styles[t]||(e=i.styles[t]||r[t],e.RenderStyle=this._parseStyle(e.RenderStyle),e.HoverStyle=this._parseStyle(e.HoverStyle),this._styles.push(e),this._isLabel(e.RenderStyle)&&(i.labelsLayer=!0));else for(t=0;t<s;t++)if(!this._styles[t]){if(e=i.styles[t]||r[t],e.RenderStyle||(e.RenderStyle=y.DEFAULT_STYLE),void 0===e.HoverStyle){var a=JSON.parse(JSON.stringify(e.RenderStyle));a.outline&&(a.outline.thickness+=1),e.HoverStyle=a}else null===e.HoverStyle&&delete e.HoverStyle;var l=this._prepareItem(e);this._styles.push(l),this._isLabel(l.RenderStyle)&&(i.labelsLayer=!0)}this._checkStyles(),this._serverStylesParsed=!0},_iconsUrlReplace:function(t){var e=t||"";return t&&this.gmx.iconsUrlReplace&&this.gmx.iconsUrlReplace.forEach(function(t){e=e.replace(t.from,t.to)}),e},_checkStyles:function(){for(var t=1/0,e=-(1/0),i=!1,n=!1,o=0,r=this._styles.length;o<r;o++){var s=this._styles[o];s.DisableBalloonOnMouseMove=s.DisableBalloonOnMouseMove!==!1,s.DisableBalloonOnClick=s.DisableBalloonOnClick||!1,s.DisableBalloonOnMouseMove!==!1&&s.DisableBalloonOnClick!==!1||(i=!0,s.BalloonEnable=!0),s.hoverDiff=null,s.common={},s.RenderStyle&&(s.RenderStyle.iconUrl&&(s.RenderStyle.iconUrl=this._iconsUrlReplace(s.RenderStyle.iconUrl)),s.HoverStyle&&s.HoverStyle.iconUrl&&(s.HoverStyle.iconUrl=this._iconsUrlReplace(s.HoverStyle.iconUrl)),n||this._isLabel(s.RenderStyle)&&(n=!0),s.RenderStyle.common&&(s.common.RenderStyle=this._itemStyleParser({},s.RenderStyle)),s.HoverStyle&&(s.hoverDiff=y.checkDiff(s.RenderStyle,s.HoverStyle))),s.HoverStyle&&s.HoverStyle.common&&(s.common.HoverStyle=this._itemStyleParser({},s.HoverStyle)),t=Math.min(t,s.MinZoom),e=Math.max(e,s.MaxZoom)}this.minZoom!==1/0&&(this.minZoom=t),this.maxZoom!==-(1/0)&&(this.maxZoom=e),this.gmx.balloonEnable=i,this.gmx.labelsLayer=n},_parseStyle:function(t,n){if(t){t.common=!0;for(var o in t)if(i.styleFuncKeys[o]){var r=i.styleFuncKeys[o],s=t[o];"string"==typeof s?(t.common=!1,n&&n[o]===s?t[r]=n[r]:(this._parserFunctions[s]||(this._parserFunctions[s]=e.gmx.Parsers.parseExpression(s)),t[r]=this._parserFunctions[s])):"function"==typeof s&&(t.common=!1,t[r]=s)}var a="";if("iconUrl"in t)a="image",t.iconUrl&&(t.maxSize=256,this._deferredIcons.push(t));else if(t.fillIconUrl)a="square",this._deferredIcons.push(t);else if(t.fillPattern)a="square",t.common=y.parsePattern(t.fillPattern),t.canvasPattern=i.getPatternIcon(null,t);else if(t.iconCircle)a="circle","iconSize"in t||(t.iconSize=4);else if(t.iconPath){a="iconPath";var l=0,h=e.Util.isArray(t.iconPath)?t.iconPath:y.DEFAULT_ICONPATH;t.iconPath=y.DEFAULT_ICONPATH.map(function(t,e){var i=h[e]||t;return l=Math.max(l,i),i}),t.iconSize=2*l}else if(t.fillRadialGradient){a="circle","iconCenter"in t||(t.iconCenter=!0);var u=y.parseRadialGradient(t.fillRadialGradient);null===u?t.common=!1:t.iconSize=u}else t.fillLinearGradient?(a="square",t.common=y.parseLinearGradient(t.fillLinearGradient)):t.iconSize&&(a="square","iconCenter"in t||(t.iconCenter=!0));t.type=a,t.common&&!t.maxSize&&(t.maxSize=t.iconSize||0,t.maxSize+=t.weight?t.weight:0,"iconScale"in t&&(t.maxSize*=t.iconScale))}return t},_prepareItem:function(t){var i={MinZoom:t.MinZoom||0,MaxZoom:t.MaxZoom||18,Filter:t.Filter||null,Balloon:t.Balloon||"",RenderStyle:t.RenderStyle?this._parseStyle(e.gmxUtil.fromServerStyle(t.RenderStyle)):{},version:++this._maxVersion};if(i.DisableBalloonOnMouseMove=t.DisableBalloonOnMouseMove!==!1,i.DisableBalloonOnClick=t.DisableBalloonOnClick||!1,t.HoverStyle&&(i.HoverStyle=this._parseStyle(e.gmxUtil.fromServerStyle(t.HoverStyle),i.RenderStyle)),"Filter"in t){var n=e.gmx.Parsers.parseSQL(t.Filter.replace(/[\[\]]/g,'"'));n&&(i.filterFunction=n)}return i},_isLabel:function(t){var e=this.gmx.tileAttributeIndexes;return t&&(t.labelTemplate||t.labelField&&t.labelField in e)},_itemStyleParser:function(t,e){e=e||{};var n,o,r,s={},a=this.gmx.tileAttributeIndexes,l=t.properties||{},h=t.type,u=e.type,c="color"in e?e.color:255,d="opacity"in e?e.opacity:1;if(s.sx=e.sx,s.sy=e.sy,e.maxSize&&(s.maxSize=e.maxSize),e.iconAngle){var p=e.iconAngle||0;p&&"string"==typeof p&&(p=e.rotateFunction?e.rotateFunction(l,a):0),s.rotate=p||0}if("iconColor"in e&&(s.iconColor=e.iconColorFunction?e.iconColorFunction(l,a):e.iconColor),"iconScale"in e&&(s.iconScale=e.scaleFunction?e.scaleFunction(l,a):e.iconScale||1),"image"===u)s.type=u,e.iconUrl&&(s.iconUrl=e.iconUrl),e.image&&(s.image=e.image);else if(e.fillRadialGradient){var m=e.fillRadialGradient,f=m.r1Function?m.r1Function(l,a):m.r1,_=m.r2Function?m.r2Function(l,a):m.r2,g=m.x1Function?m.x1Function(l,a):m.x1,v=m.y1Function?m.y1Function(l,a):m.y1,y=m.x2Function?m.x2Function(l,a):m.x2,x=m.y2Function?m.y2Function(l,a):m.y2;m.r2max&&(_=Math.min(_,m.r2max));var b=[];for(r=m.addColorStop.length,m.addColorStopFunctions||(m.addColorStopFunctions=new Array(r)),o=0;o<r;o++){n=m.addColorStop[o];var P=m.addColorStopFunctions[o]||[],L=P[0]?P[0](l,a):n[0],T=n[3];if(n.length<4){var w=n.length<3?1:P[2]?P[2](l,a):n[2];T=i.dec2color(P[1]?P[1](l,a):n[1],w)}b.push([L,T])}s.maxSize=s.sx=s.sy=s.iconSize=_,s.fillRadialGradient={x1:g,y1:v,r1:f,x2:y,y2:x,r2:_,addColorStop:b},s._radialGradientParsed={create:[g,v,f,y,x,_],colorStop:b}}else if(e.fillLinearGradient)s.fillLinearGradient=e.fillLinearGradient;else{if(e.fillPattern&&(s.canvasPattern=e.canvasPattern?e.canvasPattern:i.getPatternIcon(t,e,a)),"iconPath"===u&&(s.type=u,s.iconPath=e.iconPath),"POLYGON"!==h&&"MULTIPOLYGON"!==h&&"polygon"!==this.gmx.GeometryType||(u="polygon"),e.iconSize){var S=e.sizeFunction?e.sizeFunction(l,a):e.iconSize;s.sx=s.sy=S,s.iconSize=S,"iconScale"in e&&(s.iconSize*=e.iconScale),s.maxSize=S}s.stroke=!0,c=e.colorFunction?e.colorFunction(l,a):c,d=e.opacityFunction?e.opacityFunction(l,a):d,s.strokeStyle=i.dec2color(c,d),s.lineWidth="weight"in e?e.weight:1}if("iconScale"in e&&(s.iconScale=e.scaleFunction?e.scaleFunction(l,a)||1:e.iconScale),"iconAnchor"in e&&(s.iconAnchor=e.iconAnchor),"iconCenter"in e&&(s.iconCenter=e.iconCenter),"square"===u||"polygon"===u||"circle"===u||"iconPath"===u){s.type=u;var M=e.fillOpacity,I=e.fillColor,k="string"==typeof I?parseInt(I.replace(/#/,""),16):I;"fillColor"in e&&(s.fillStyle=i.dec2color(k,1)),"fillColorFunction"in e||"fillOpacityFunction"in e?(c=e.fillColorFunction?e.fillColorFunction(l,a):I||255,d=e.fillOpacityFunction?e.fillOpacityFunction(l,a):M||1,s.fillStyle=i.dec2color(c,d)):"fillOpacity"in e&&"fillColor"in e&&(s.fillStyle=i.dec2color(k,M))}if("dashArray"in e&&(s.dashArray=e.dashArray),"dashOffset"in e&&(s.dashOffset=e.dashOffset),this.gmx.labelsLayer){for(n=i.styleKeys.label.client,o=0,r=n.length;o<r;o++){var C=n[o];if(C in e){if("labelField"===C){if(!a[e[C]])continue}else if("labelTemplate"===C){var O=i.getPropertiesHash(l,a);s.labelText=i.parseTemplate(e[C],O)}s[C]=e[C]}}"labelAnchor"in e&&(s.labelAnchor=e.labelAnchor)}return s}},y.MAX_STYLE_SIZE=256,y.DEFAULT_STYLE={outline:{color:255,thickness:1},marker:{size:8}},y.DEFAULT_KEYS=["Name","MinZoom","MaxZoom","Balloon","BalloonEnable","DisableBalloonOnMouseMove","DisableBalloonOnClick"],y.DEFAULT_ICONPATH=[0,10,5,-10,-5,-10,0,10],y.DEFAULT_STYLE_KEYS=["iconUrl","iconAngle","iconSize","iconScale","iconMinScale","iconMaxScale","iconCircle","iconCenter","iconAnchor","iconColor","stroke","color","weight","opacity","dashArray","fillColor","fillOpacity","fillIconUrl","fillPattern","fillRadialGradient","fillLinearGradient","labelTemplate","labelField","labelColor","labelHaloColor","labelFontSize","labelSpacing","labelAlign","labelAnchor","labelText"],y.HASH_KEYS=y.DEFAULT_KEYS.reduce(function(t,e){return t[e]=!0,t},{}),y.HASH_KEYS.RenderStyle=y.DEFAULT_STYLE_KEYS.reduce(function(t,e){return t[e]=!0,t},{}),y.parsePattern=function(t){var i=!0,n=e.gmx.Parsers;if("step"in t&&"string"==typeof t.step&&(t.patternStepFunction=n.parseExpression(t.step),i=!1),"width"in t&&"string"==typeof t.width&&(t.patternWidthFunction=n.parseExpression(t.width),i=!1),"colors"in t){for(var o=[],r=0,s=t.colors.length;r<s;r++){var a=t.colors[r];"string"==typeof a?(o.push(n.parseExpression(a)),i=!1):o.push(null)}t.patternColorsFunction=o}return i},y.getStyleKeys=function(t){var e={};for(var n in i.styleKeys)for(var o=i.styleKeys[n],r=0,s=o.client.length;r<s;r++){var a=o.client[r];a in t&&(void 0!==t[a]&&(e[a]=JSON.parse(JSON.stringify(t[a]))),"fillPattern"===a?delete e[a].patternColorsFunction:"fillLinearGradient"===a&&delete e[a].addColorStopFunctions)}return"iconAnchor"in t&&(e.iconAnchor=t.iconAnchor),"labelAnchor"in t&&(e.labelAnchor=t.labelAnchor),e},y.checkDiff=function(t,e){for(var i in t)if(t[i]!==e[i])return i;return null},y.parseRadialGradient=function(t){var n=!0,o=e.gmx.Parsers,r=0,s=["r1","x1","y1","r2","x2","y2"],a=s.length;for(r=0;r<a;r++){var l=s[r];t[l]||(t[l]=0),"string"==typeof t[l]&&(t[l+"Function"]=o.parseExpression(t[l]),n=!1)}for(t.addColorStop=t.addColorStop||[[0,16711680,.5],[1,16777215,.5]],t.addColorStopFunctions=[],r=0,a=t.addColorStop.length;r<a;r++){s=t.addColorStop[r];var h=["string"==typeof s[0]?o.parseExpression(s[0]):null,"string"==typeof s[1]?o.parseExpression(s[1]):null,"string"==typeof s[2]?o.parseExpression(s[2]):null];t.addColorStopFunctions.push(h),null===h[1]&&null===h[2]?s[3]=i.dec2color(s[1],s[2]>1?s[2]/100:s[2]):n=!1}return"r2Function"in t&&(n=!1),n?Math.max(t.r1,t.r2):null},y.parseLinearGradient=function(t){var i=!0,n=0,o=e.gmx.Parsers,r=["x1","y1","x2","y2"],s=[0,0,0,256],a=r.length;for(n=0;n<a;n++){var l=r[n];l in t?"string"==typeof t[l]&&(t[l+"Function"]=o.parseExpression(t[l]),i=!1):t[l]=s[n]}for(t.addColorStop=t.addColorStop||[[0,16711680],[1,16777215]],t.addColorStopFunctions=[],n=0,a=t.addColorStop.length;n<a;n++)r=t.addColorStop[n],t.addColorStopFunctions.push(["string"==typeof r[0]?o.parseExpression(r[0]):null,"string"==typeof r[1]?o.parseExpression(r[1]):null,"string"==typeof r[2]?o.parseExpression(r[2]):null]);return i},y.parReg=/\[([^\]]+)\]/g,y.getKeysHash=function(t,e){var i={},n=t.match(y.parReg);return n&&n.forEach(function(t){var n=t.replace(/[[\]""]/g,"");i[n]||(i[n]=e||!0)}),i},y.decodeOldStyle=function(t){var n,o,r,s,a,l={},h={},u="";for(s in i.styleKeys){var c=i.styleKeys[s];for(o=0,r=c.client.length;o<r;o++)a=c.client[o],a in t&&(l[a]=t[a]);if(n=t[s],n&&"object"==typeof n)for(o=0,r=c.server.length;o<r;o++)if(a=c.server[o],a in n){var d=c.client[o],p=n[a];if("string"==typeof p){var m=y.getKeysHash(p,d);if(Object.keys(m).length&&(l.common=!1,e.extend(h,m)),i.styleFuncKeys[d])if(null===p.match(/[^\d\.]/))p=Number(p);else{var f=e.gmx.Parsers.parseExpression(p);null===f?p=i.styleFuncError[d]():l[i.styleFuncKeys[d]]=f}}else"opacity"===a&&(p/=100);l[d]=p}}if(t.marker&&(n=t.marker,"dx"in n||"dy"in n)){var _=n.dx||0,g=n.dy||0;l.iconAnchor=[-_,-g]}for(s in t)i.styleKeys[s]||(l[s]=t[s]);return{style:l,attrKeys:h,type:u}},y.decodeOldStyles=function(t){var i=t.styles,n=i||[{MinZoom:1,MaxZoom:21,RenderStyle:y.DEFAULT_STYLE}],o=t.type.toLocaleLowerCase(),r={attrKeys:{},iconsUrl:{}};return r.styles=n.map(function(t){var i={Name:t.Name||"",type:o||"",MinZoom:t.MinZoom||0,MaxZoom:t.MaxZoom||18};if("Balloon"in t){i.Balloon=t.Balloon;var n=y.getKeysHash(t.Balloon,"Balloon");Object.keys(n).length&&e.extend(r.attrKeys,n)}if(t.RenderStyle){var s=y.decodeOldStyle(t.RenderStyle);if(e.extend(r.attrKeys,s.attrKeys),s.style.iconUrl&&(r.iconsUrl[s.style.iconUrl]=!0),i.RenderStyle=s.style,void 0===t.HoverStyle){var a=JSON.parse(JSON.stringify(i.RenderStyle));a.outline&&(a.outline.thickness+=1),i.HoverStyle=a}else if(null===t.HoverStyle)delete i.HoverStyle;else{var l=y.decodeOldStyle(t.HoverStyle);i.HoverStyle=l.style}}else"vector "===o&&(i.RenderStyle=y.DEFAULT_STYLE);if("DisableBalloonOnMouseMove"in t&&(i.DisableBalloonOnMouseMove=t.DisableBalloonOnMouseMove!==!1),"DisableBalloonOnClick"in t&&(i.DisableBalloonOnClick=t.DisableBalloonOnClick||!1),"Filter"in t){i.Filter=t.Filter;var h=e.gmx.Parsers.parseSQL(t.Filter.replace(/[\[\]]/g,'"'));h&&(i.filterFunction=h)}return i}),r},e.gmx=e.gmx||{},e.gmx.StyleManager=y,e.gmx.VectorLayer.include({bindPopup:function(t,i){var n=e.extend({maxWidth:1e4,className:"gmxPopup",layerId:this._gmx.layerID},i);return this._popup&&this.unbindPopup(),t instanceof e.Popup?this._popup=t:(this._popup&&!i||(this._popup=new e.Popup(n)),this._popup.setContent(t)),this._popup._initContent=t,this._popup._state="",this._popupHandlersAdded||(this.on("click",this._openClickPopup,this).on("mousemove",this._movePopup,this).on("mouseover",this._overPopup,this).on("mouseout",this._outPopup,this).on("doneDraw",this._chkNeedOpenPopup,this),this._popupHandlersAdded=!0),n&&n.popupopen&&(this._popupopen=n.popupopen),this._popup.updateLayout=this._popup._updateLayout,this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openClickPopup,this).off("mousemove",this._movePopup,this).off("mouseover",this._overPopup,this).off("mouseout",this._outPopup,this).off("doneDraw",this._chkNeedOpenPopup,this),this._popupopen=null,this._popupHandlersAdded=!1),this._gmx.balloonEnable=!1,this},_chkNeedOpenPopup:function(){for(var t in this._gmx._needPopups)this._gmx._needPopups[t]&&(this.addPopup(t),delete this._gmx._needPopups[t])},disablePopup:function(t){return this._popupDisabled=!0,t&&(this._cacheClickable=this.options.clickable,this.options.clickable=!1),this},enablePopup:function(t){return this._popupDisabled=!1,t&&(this.options.clickable=this._cacheClickable),this},openPopup:function(t,e){return this._popup&&(t=t||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],e=e||{},e.latlng=t,this._openPopup(e)),this},closePopup:function(t){return this._popup&&(this._popup._close(),"mouseout"!==t&&this.getPopups().forEach(this._clearPopup.bind(this)),this.fire("popupclose",{popup:this._popup})),this},_movePopup:function(t){if("mouseover"===this._popup._state){var e=this._popup.options._gmxID||-1;e!==t.gmx.id&&this._setPopupContent(t),this._popup.setLatLng(t.latlng)}},_overPopup:function(t){var e=this._popup;e._map?this.fire("popupopen",{popup:e,gmx:this._setPopupContent(t,e)}):this._openPopup(t),"mouseover"===e._state&&e.setLatLng(t.latlng)},_outPopup:function(t){"mouseover"!==this._popup._state||t.gmx.prevId||this.closePopup(t.type)},_callBalloonHook:function(t,e){var i,n,o,r=e.getElementsByTagName("span"),s={};for(i in this._balloonHook){var a=this._balloonHook[i].hookID;for(s[i]=0,n=0,o=r.length;n<o;n++)r[n].id===a&&s[i]++}for(i in this._balloonHook){var l=this._balloonHook[i],h=l.hookID,u=!0;for(n=0,o=r.length;n<o;n++){var c=r[n];c.id===h&&(u=!1,c.id+="_"+n,l.callback(t,e,c,s))}u&&l.callback(t,e,null,s)}},_setPopupContent:function(t,n){n||(n=this._popup);var o=t.gmx||{},r=o.balloonData||{},s=e.extend({},o.properties),a=o.target||{},l=a.geometry||{},h=a.offset,u=n._initContent||r.templateBalloon||"",c=t.type,d=this.options.isGeneralized&&("mouseover"===c||"mousemove"===c),p={id:o.id,type:c,nodePoint:o.nodePoint,latlng:t.latlng,properties:s,templateBalloon:u};if("POINT"===l.type){var m=e.gmxUtil.geometryToGeoJSON(l,!0,3857==o.srs);p.latlng=e.latLng(m.coordinates.reverse())}if(h){var f=e.Popup.prototype.options.offset;n.options.offset=[-f[0]-h[0],f[1]-h[1]]}else n.options.offset[1]="mouseover"===c?-7:7;if(this._popupopen)this._popupopen({popup:n,latlng:p.latlng,layerPoint:t.layerPoint,contentNode:n._contentNode,containerPoint:t.containerPoint,originalEvent:t.originalEvent,gmx:p});else if(!(u instanceof e.Popup)){if(!(u instanceof HTMLElement)){var _,g="",v=this._map?this._map.options:{};if(d||(_=a.geometry?[a.geometry]:o.geometries||this._gmx.dataManager.getItemGeometries(o.id)||[],p.summary=g=e.gmxUtil.getGeometriesSummary(_,v)),this._balloonHook){u||(u=i.getDefaultBalloonTemplate(s));for(var y in this._balloonHook)s[y]=i.parseTemplate(this._balloonHook[y].resStr,s)}u=e.gmxUtil.parseBalloonTemplate(u,{properties:s,tileAttributeTypes:this._gmx.tileAttributeTypes,unitOptions:v,summary:g,geometries:_})}var x=e.DomUtil.create("div","");x.innerHTML=u,n.setContent(x),this._balloonHook&&this._callBalloonHook(o.properties,n.getContent())}return n.options._gmxID=o.id,p},_openClickPopup:function(t){var n=t.originalEvent||{},o=!t.gmx||this._popupDisabled||n.ctrlKey||n.altKey||n.shiftKey;if(!o){var r=t.type,s=t.gmx,a=s.balloonData,l="click"===r&&a.isSummary&&!a.DisableBalloonOnClick,h=s.target;if(l&&h.options.isGeneralized&&!h.geometry){var u=s.layer.getGmxProperties();i.getLayerItemFromServer({options:t,layerID:u.name,value:h.id,field:u.identityField}).then(function(t,e){if(t&&"ok"===t.Status&&t.Result){var i=t.Result.values[0];e.options.gmx.target.fromServerProps=i,e.options.gmx.target.geometry=i[i.length-1],this._openPopup(e.options)}}.bind(this))}else h.type.indexOf("POINT")!==-1&&(t.latlng=e.latLng(e.gmxUtil.geometryToGeoJSON(h.properties[h.properties.length-1],!0,3857==this._gmx.srs).coordinates.reverse())),this._openPopup(t)}},_openPopup:function(t,i){var n=this._map,o=t.originalEvent||{},r=i?!i:this._popupDisabled||o.ctrlKey||o.altKey||o.shiftKey;if(!r){var s=t.type,a=this._popup,l=t.gmx||{},h=l.balloonData||{};if("click"===s){if(!i&&h.DisableBalloonOnClick&&!this.hasEventListeners("popupopen"))return;"_gmxPopups"in n||(n._gmxPopups=[]),"maxPopupCount"in n.options||(n.options.maxPopupCount=1),this._gmx._gmxPopupsInit||(this._gmx._gmxPopupsInit=!0,n.on({layerremove:function(t){if(t.layer instanceof e.Popup)this._clearPopup(t.layer);else if(t.layer===this){if(n._gmxPopups){var i=this._gmx.layerID;n._gmxPopups=n._gmxPopups.reduce(function(t,e){return e._map&&(e.options.layerId===i?e._map.removeLayer(e):t.push(e)),t},[])}this.closePopup()}}},this)),this._clearPopup(l.id);var u=this._popup?this._popup.options:{maxWidth:1e4,className:"gmxPopup",layerId:this._gmx.layerID};a=new e.Popup(e.extend({},u,{closeOnClick:1===n.options.maxPopupCount,autoPan:!0}))}else{if("mouseover"!==s)return;if(h.DisableBalloonOnMouseMove)return void(a._state="");a.options.autoPan=!1}a.options.objectId=l.id,a._state=s;var c=this._setPopupContent(t,a);if(a.setLatLng(c.latlng),this.fire("popupopen",{popup:a,gmx:c}),"click"===s&&(n._gmxPopups.length>=n.options.maxPopupCount&&n.removeLayer(n._gmxPopups.shift()),n._gmxPopups.push(a)),a.addTo(n),a._closeButton){var d=a._closeButton.style;"mouseover"===s&&"hidden"!==d?(d.visibility="hidden",a._container.style.marginBottom="7px",a._container.style.pointerEvents="none"):"click"===s&&"inherit"!==d&&(d.visibility="inherit",a._container.style.marginBottom="",a._container.style.pointerEvents="")}}},_clearPopup:function(t){var i=this._map;if(i&&i._gmxPopups){var n=this._gmx.layerID,o=t instanceof e.Popup;i._gmxPopups=i._gmxPopups.reduce(function(e,i){return i._map&&(o&&i===t?i._map.removeLayer(i):i.options.layerId===n&&i.options.objectId===t?i._map.removeLayer(i):e.push(i)),e},[])}},getPopups:function(t){var e=this._map,i=[];if(e&&e._gmxPopups){var n=this._gmx.layerID;e._gmxPopups.reduce(function(e,i){return i.options.layerId===n&&e.push(t?i:i.options.objectId),e},i)}return i},addPopup:function(t){var i=this._gmx,n=i.dataManager.getItem(t);if(n&&this._map){var o=n.bounds.getCenter(),r=e.latLng(e.gmxUtil.coordsFromMercator("Point",o,3857==i.srs).reverse());this._openPopup({type:"click",latlng:r,gmx:this.getHoverOption(n)},!0),delete i._needPopups[t]}else i._needPopups[t]=!1;return this},addPopupHook:function(t,i){if(this._balloonHook||(this._balloonHook={}),
!this._balloonHook[t]){var n="_"+e.stamp({});this._balloonHook[t]={key:t,hookID:n,resStr:'<span id="'+n+'"></span>',callback:i}}return this},removePopupHook:function(t){return this._balloonHook&&delete this._balloonHook[t],this}}),e.gmx.VectorLayer.include({_gmxFirstObjectsByPoint:function(t,e,n){for(var o,r,s=this._gmx,a=s.mInPixel,l=t.length-1;l>=0;l--){var h=t[l].properties,u=h[0],c=t[l].dataOption||{},d=s.dataManager.getItem(u),p=d.currentStyle||d.parsedStyleKeys||{},m=p.iconScale||1,f=p.iconCenter,_=!f&&p.iconAnchor?p.iconAnchor:null,g=s.styleManager.getObjStyle(d),v=p.lineWidth||g.lineWidth||0,y=v+(g.sx||p.sx||0),x=v+(g.sy||p.sy||0),b=[m*y/2,m*x/2],P=e,L=h[h.length-1],T=L.type;"POINT"===T&&"circle"===g.type&&(b[0]*=2,b[1]*=2);var w=b[0],S=i.bounds().extendBounds(c.bounds).addBuffer(b[0]/a,b[1]/a);if(_&&(b=[_[0]-b[0],_[1]-b[1]],P=[e[0]+b[0]/a,e[1]-b[1]/a]),S.contains(P)){var M=p.fillStyle||p.canvasPattern||g.bgImage||g.fillColor,I=g&&g.image?g.image:null,k=T,C=c.hiddenLines||[],O=c.boundsArr,E=L.coordinates,z=null,A={point:e,bounds:n,coords:E,boundsArr:O};if("MULTIPOLYGON"!==T&&"POLYGON"!==T||(I?k="POINT":M||("POLYGON"===T?(k="MULTILINESTRING",C=C[0]):k="LIKEMULTILINESTRING",A.hidden=C)),"LINESTRING"===k){if(!i.isPointInPolyLine(e,v/a,E)&&(z=i.bounds([P]).addBuffer(b[0]/a,b[1]/a).isNodeIntersect(E),null===z))continue}else if("LIKEMULTILINESTRING"===k){A.delta=v/a;var D=!1;for(o=0,r=E.length;o<r;o++)if(A.coords=E[o],A.hidden=C?C[o]:null,A.boundsArr=O[o],i.isPointInLines(A)){D=!0;break}if(!D)continue}else if("MULTILINESTRING"===k){if(A.delta=v/a,A.hidden=C,!i.isPointInLines(A)){var R=i.bounds([P]).addBuffer(b[0]/a,b[1]/a);for(o=0,r=E.length;o<r;o++)if(z=R.isNodeIntersect(E[o]),null!==z){z.ring=o;break}if(null===z)continue}}else if("MULTIPOLYGON"===k||"POLYGON"===k){var B=e;for(D=!1,"POLYGON"===k&&(E=[L.coordinates],O=[c.boundsArr]),o=0,r=E.length;o<r;o++)for(var N=E[o],F=O[o],Z=0,U=N.length;Z<U;Z++){var G=F[Z];if(G.intersects(n)&&i.isPointInPolygonWithHoles(B,N)){D=0===Z;break}}if(!D)continue}else if("POINT"===k&&"circle"===g.type){var j=(E[0]-P[0])*a,H=(E[1]-P[1])*a;if(j*j+H*H>w*w)continue}if(this.isPointInClipPolygons(e))return{id:u,properties:d.properties,geometry:L,bounds:d.bounds,nodePoint:z,offset:_?b:null,parsedStyle:g}}}return null},gmxEventCheck:function(t,n){if(!this._map)return 0;var o=this,r=o._gmx,s=t.type,a=r.lastHover,l=function(e){a&&"mousemove"===s&&(e&&o.hasEventListeners(e)&&(t.gmx=a,o.fire(e,t)),a.hoverDiff&&o.redrawItem(a.id))},h=this._map.getZoom();if((h>this.options.maxZoom||h<this.options.minZoom)&&(n=!0),n)a&&(a.prevId=null),l("mouseout"),r.lastHover=null;else if(this.hasEventListeners("mouseover")||this.hasEventListeners("mouseout")||this.hasEventListeners(s)||"mousemove"===s&&"Raster"!==r.properties.fromType){var u=t.latlng.lng%360,c=new e.LatLng(t.latlng.lat,u+(u<-180?360:u>180?-360:0)),d=3857==r.srs?e.CRS.EPSG3857:e.Projection.Mercator,p=d.project(c)._subtract({x:r.shiftXlayer||0,y:r.shiftYlayer||0}),m=Math.max(5,r.styleManager._getMaxStyleSize(h))/r.mInPixel,f=[p.x,p.y],_=r.dataManager.getViewFilters("screen",r.layerID),g={type:"resend",layerID:r.layerID,needBbox:r.needBbox,bbox:i.bounds([f]).addBuffer(m),dateInterval:"VectorTemporal"===r.layerType?[r.beginDate,r.endDate]:null,filters:["clipFilter","userFilter_"+r.layerID,"styleFilter","userFilter"].concat(_),active:!1};this.options.isGeneralized&&(g.targetZoom=h),r.dataManager.addObserver(g,"hover");var v=r.dataManager.getItems("hover");if(r.dataManager.removeObserver("hover"),v&&v.length){v.length>1&&r.sortItems&&(v=this.getSortedItems(v));var y=this._gmxFirstObjectsByPoint(v,f,g.bbox);if(y){var x=y.id,b=r.dataManager.getItem(x),P=a?a.id:null,L=!a||a.id!==x;if("mousemove"===s&&a){if(!L)return t.gmx=a,this.fire(s,t),x;t.gmx=a,this.fire("mouseout",t),l(b.currentFilter!==a.currentFilter?"mouseout":""),r.lastHover=null}return t.gmx=e.extend(this.getHoverOption(b),{targets:v,nodePoint:y.nodePoint,prevId:P,hoverDiff:b.hoverDiff}),this.hasEventListeners(s)&&this.fire(s,t),"mousemove"===s&&L&&(a=r.lastHover=t.gmx,l("mouseover"),r.lastMouseover=r.lastHover),this._map.doubleClickZoom.disable(),x}this._map&&this._map.doubleClickZoom.enable()}}return 0},getHoverOption:function(t){return{layer:this,target:t,balloonData:this._gmx.styleManager.getItemBalloon(t.id),properties:this.getItemProperties(t.properties),currentFilter:t.currentFilter||0,id:t.id}}}),function(){var t=2e4,i={},n={},o="/Layer/CheckVersion.ashx",r=null,s=null,a={},l=function(t){var e=t.Temporal?"TemporalTiles":"tiles";return e in t||t.currentTiles},h=function(t,e,i){var n={Name:t.name,Version:l(t)?t.LayerVersion:-1};if(e&&(t.UseTiles===!1||"NotVisible"===i.skipTiles||i.needBbox||i.options.needBbox)){var o=e.getMaxDateInterval(),r=o.beginDate||i.beginDate,s=o.endDate||i.endDate;r&&(n.dateBegin=Math.floor(r.getTime()/1e3)),s&&(n.dateEnd=Math.floor(s.getTime()/1e3))}return n},u=function(t){var n,o,r,s,a={};if(t&&t._gmx)t.target instanceof e.gmx.DataManager&&(t=t.target),t instanceof e.gmx.DataManager?(r=t,n=r.options):(n=t._gmx.properties,r=t._gmx.dataManager,s=t._gmx),o=n.hostName||t._gmx.hostName,a[o]=[h(n,r,s)];else{var l={};for(var u in i){var c=i[u],d=c instanceof e.gmx.DataManager;if(c.options.chkUpdate||d){r=d?c:c._gmx.dataManager,n=d?c.options:c._gmx.properties,s=d?c:c._gmx,o=n.hostName||c._gmx.hostName;var p=h(n,r,s),m=p.Name+p.Version,f=!l[m]&&(!n.Temporal||p.dateBegin);f&&(a[o]?a[o].push(p):a[o]=[p]),l[m]=!0}}}return a},c=function(t,n){"string"==typeof t&&(t=i[t]);var r=d._map,s=function(o){if(o&&"ok"===o.Status&&o.Result){var s,a,l,h,u,c=o.Result,p=c.length,m=0;if(d.needBbox){for(s=0;s<p;s++){if(u=c[s],h=u.name||u.properties.name,l=null,t&&t._gmx.properties.name===h)l=t;else for(a in i)if(l=i[a],!(t&&t===l&&"updateVersion"in t)){if(l._gmx&&l._gmx.properties.name===h&&"updateVersion"in l)break;if(l instanceof e.gmx.DataManager&&l.options.name===h)break}l&&(m+=(l.getDataManager?l.getDataManager():l).getNotLoadedVectorTiles(u))}if(r.fire("needLoadTiles",{count:m}),e.gmx.skipLoadTiles)return void console.log("Skiped tiles: ",e.gmx.needLoadTiles)}for(s=0;s<p;s++){u=c[s],h=u.name||u.properties.name,t&&t._gmx.properties.name===h&&"updateVersion"in t&&t.updateVersion(u);for(a in i)l=i[a],t&&t===l||(l._gmx&&l._gmx.properties.name===h&&"updateVersion"in l?l.updateVersion(u):l instanceof e.gmx.DataManager&&l.options.name===h&&l.updateVersion(u.properties,u.tiles))}}n&&n(o)};if(document.body&&!e.gmxUtil.isPageHidden()){var l=u(t),h=function(n){var h=e.gmxUtil.protocol+"//"+n+o,u=JSON.stringify(l[n]),c="WrapStyle=None&ftc=osm";if(d.needBbox){var p=e.Projection.Mercator;3857==r.options.srs&&(c+="&srs=3857",p=e.CRS.EPSG3857);var m=r.getZoom(),f=r.getBounds(),_=p.project(f.getSouthWest()),g=p.project(f.getNorthEast()),v=[_.x,_.y,g.x,g.y].join(",");c+="&zoom="+m,c+="&bbox=["+v+"]"}if(c+="&layers="+encodeURIComponent(u),t||!a[n]||a[n]!==c){"FormData"in window&&e.gmxUtil.request({url:h,async:!0,headers:{"Content-type":"application/x-www-form-urlencoded"},type:"POST",params:c,withCredentials:!0,callback:function(t){a[n]=c,s(JSON.parse(t))},onError:function(t){console.log("Error: LayerVersion ",t)}});var y=Date.now();for(var x in i){var b=i[x],P=b._gmx||b.options;P.hostName===n&&(P._stampVersionRequest=y)}}};for(var c in l)h(c)}},d={needBbox:!1,addDataManager:function(t){var e=t.options,n=e.name;n in i||(e.needBbox&&!d.needBbox&&(d.needBbox=e.needBbox),t.on("chkLayerUpdate",c.bind(t)),i[n]=t)},removeDataManager:function(t){var e=t.options.name;e in i&&(t.off("chkLayerUpdate",c.bind(t)),delete i[e])},remove:function(t){e.gmx.sendCmd&&e.gmx.sendCmd("toggleDataSource",{active:!1,hostName:t.options.hostName,mapID:t.options.mapID,layerID:t.options.layerID}),delete i[t._gmx.layerID];var o=t._gmx,r=t.options.parentOptions;if(r){var s=r.name;n[s]&&(delete n[s][o.properties.name],Object.keys(n[s]).length||(d.removeDataManager(o.dataManager),delete n[s]))}else o.dataManager.off("chkLayerUpdate",o._chkVersion)},add:function(t){var o=t._gmx.layerID;if(e.gmx.sendCmd){var r={active:!0,hostName:t.options.hostName,mapID:t.options.mapID,layerID:t.options.layerID},s=t._gmx.dataManager.getMaxDateInterval();s.beginDate&&s.endDate&&(r.dInterval=[Math.floor(s.beginDate.getTime()/1e3),Math.floor(s.endDate.getTime()/1e3)]),e.gmx.sendCmd("toggleDataSource",r)}if(!(o in i)){var a=t._gmx,l=a.properties;if("LayerVersion"in l){i[o]=t,a._chkVersion=function(){c(t)},a.dataManager.on("chkLayerUpdate",a._chkVersion);var h=t.options.parentOptions;if(h){var u=h.name;d.addDataManager(a.dataManager),n[u]||(n[u]={}),n[u][l.name]=t}a.needBbox&&!d.needBbox&&(d.needBbox=a.needBbox),d.start(),d.now()}}},chkVersion:c,now:function(){s&&clearTimeout(s),s=setTimeout(c,0)},stop:function(){r&&clearInterval(r),r=null},start:function(e){e&&(t=e),d.stop(),r=setInterval(c,t)}};e.gmx||(e.gmx={}),e.gmx.layersVersion=d,e.gmx.VectorLayer.include({updateVersion:function(t){if(t){var i=this._gmx;t.geometry&&(i.geometry=t.geometry),t.properties&&(e.extend(i.properties,t.properties),i.properties.currentTiles=t.tiles,i.properties.GeoProcessing=t.properties.GeoProcessing,i.rawProperties=i.properties,this.fire("versionchange")),!i.dataSource&&i.dataManager&&i.dataManager.updateVersion(i.rawProperties,t.tiles)}}}),e.Map.addInitHook(function(){d._map=this;var t=this,i={};this.on("moveend",function(){var n=t.getZoom(),o=t.getPixelBounds().getCenter();if((n!==i.z||i.center.distanceTo(o)>128)&&(c(),i.z=n,i.center=o,e.gmx.sendCmd)){var r=t.getBounds(),s=e.CRS.EPSG3857,a=s.project(r.getSouthWest()),l=s.project(r.getNorthEast()),h=[a.x,a.y,l.x,l.y];e.gmx.sendCmd("onmoveend",{zoom:n,bbox:h})}})})}(),e.gmx.RasterLayer=e.gmx.VectorLayer.extend({options:{isGeneralized:!1,zIndexOffset:0},initFromDescription:function(t){this._gmx.srs=this._gmx.srs||3857;var n=t.properties,o=n.styles[0]||{MinZoom:n.MinZoom||0,MaxZoom:n.MaxZoom||21},r={type:"Vector",fromType:n.type,identityField:"ogc_fid",GeometryType:"POLYGON",IsRasterCatalog:!0,RasterSRS:Number(n.RasterSRS)||3857,Copyright:n.Copyright||"",RCMinZoomForRasters:o.MinZoom,visible:n.visible,styles:[{DisableBalloonOnClick:!0,MinZoom:o.MinZoom,MaxZoom:o.MaxZoom,RenderStyle:{outline:{thickness:0},fill:{opacity:100}},HoverStyle:null}]},s=this._gmx,a=i.tileSizes[1];return n.MaxZoom&&(s.maxNativeZoom=n.MaxZoom),n.sessionKey=n.sessionKey||e.gmx.gmxSessionManager.getSessionKeyRes(n.hostName),n.sessionKey&&(s.sessionKey=n.sessionKey),t.geometry?3857==s.srs&&s.srs!=r.RasterSRS&&(t.geometry=i.convertGeometry(i.convertGeometry(t.geometry,!0,!0),!1,!0)):t.geometry={type:"POLYGON",coordinates:[[[-a,-a],[-a,a],[a,a],[a,-a],[-a,-a]]]},e.gmx.VectorLayer.prototype.initFromDescription.call(this,{geometry:t.geometry,properties:r,rawProperties:t.properties}),s.rasterBGfunc=function(t,i,n){var o=e.gmxUtil.protocol+"//"+s.hostName+"/TileSender.ashx?ModeKey=tile&ftc=osm&z="+n+"&x="+t+"&y="+i;return s.srs&&(o+="&srs="+s.srs),s.crossOrigin&&(o+="&cross="+s.crossOrigin),o+="&LayerName="+s.layerID,s.sessionKey&&(o+="&key="+encodeURIComponent(s.sessionKey)),o},s.dataManager._rasterVectorTile=new p({load:function(e,n,o,r,l,h,u){var c=[[777,t.geometry]],d=i.geoItemBounds(t.geometry),p=d.bounds;if(p.max.x>a){var m=2*a,f=777,_=t.geometry.coordinates,g=d.boundsArr;c=[],"POLYGON"===t.geometry.type&&(_=[_],g=[g]);for(var v=0,y=_.length;v<y;v++){var x=_[v],b=g[v][0],P=x;if(c.push([f++,{type:"POLYGON",coordinates:P}]),b.max.x>a){P=[];for(var L=0,T=x.length;L<T;L++){for(var w=x[L],S=0,M=[],I=w.length;S<I;S++){var k=w[S];M.push([k[0]-m,k[1]])}P.push(M)}c.push([f++,{type:"POLYGON",coordinates:P}])}}}u({bbox:[p.min.x,p.min.y,p.max.x,p.max.y],srs:s.srs,isGeneralized:!1,changeState:!0,values:c}),s.dataManager._updateItemsFromTile(s.dataManager._rasterVectorTile)}},{x:0,y:0,z:0,v:0,s:-2,d:-2}),s.dataManager.addTile(s.dataManager._rasterVectorTile),this},setZoomBounds:function(t,i){var n=this.getStyles().slice(0);n[0]=e.extend({},n[0]),n[0].MinZoom=t,n[0].MaxZoom=i,this.setStyles(n)}}),e.Map.addInitHook(function(){if(this.options.multiRasterLayers){var t=this,i={},n=0,o=e.gmx.createLayer({properties:{type:"Vector",GeometryType:"polygon",identityField:"gmx_id",ZIndexField:"_zIndex",attributes:["gmx_id","_zIndex","MinZoom","MaxZoom","GMX_RasterCatalogID"],attrTypes:["integer","integer","integer","integer","string"],IsRasterCatalog:!0,RCMinZoomForRasters:1}},{_vectorType:"multiRasterLayer"}).setFilter(function(e){var n=t.getZoom(),o=e.properties;return i[o[5]]&&n>=o[3]&&n<=o[4]}).setStyles([{MinZoom:1,MaxZoom:21,DisableBalloonOnClick:!0,DisableBalloonOnMouseMove:!0,RenderStyle:{weight:0},HoverStyle:{weight:0}}]).once("update",function(){requestIdleCallback(o.repaint.bind(o),{timeout:0})}),r=function(e,r){var s=e.getGmxProperties(),a=s.name,l=function(t){var e=t.target.options,n=i[e.layerID];n&&(n[2]=(e.zIndexOffset?e.zIndexOffset:0)+(e.zIndex?e.zIndex:0)),o.repaint()};if(r){n++;var h=e.options,u=(h.zIndexOffset?h.zIndexOffset:0)+(h.zIndex?h.zIndex:0),c=n,d=[c,c,u,s.styles[0].MinZoom||1,s.styles[0].MaxZoom||21,a,e._gmx.geometry];o.addData([d]),i[a]=d,e.onRemove(t),e.on("zindexupdated",l)}else e.off("zindexupdated",l),o.removeData([i[a]]),i[a]=null;o.repaint()};t.on("layeradd",function(t){var i=t.layer;i instanceof e.gmx.RasterLayer&&r(i,!0)}).on("layerremove",function(t){var i=t.layer;i instanceof e.gmx.RasterLayer&&r(i,!1)}).addLayer(o)}}),e.LabelsLayer=(e.Layer||e.Class).extend({options:{animate:!1,labels:"default",pane:"overlayPane"},initialize:function(t,n){e.setOptions(this,e.extend(this.options,n)),this._observers={},this._styleManagers={},this._labels={},this._labelsIndex={};var o=this;this.bbox=i.bounds();var r=function(n,r){if(n.added||n.removed){for(var s=r.options,a=t._zoom>=s.minZoom&&t._zoom<=s.maxZoom?n.added:[],l="_"+r._leaflet_id,h=r._gmx,u={},c=0,d=a.length;c<d;c++){var p=a[c].item,m="POINT"===p.type||"MULTIPOINT"===p.type,f=p.parsedStyleKeys||p.currentStyle||{};if(h.styleHook){var _=h.styleHook(p,h.lastHover&&p.id===h.lastHover.id);if(!_)continue;f=e.extend({},f,_)}if(p.multiFilters)for(var g=0,v=p.multiFilters.length;g<v;g++){var y=p.multiFilters[g].parsedStyle;if("labelField"in y||"labelText"in y){f=y;break}}var x=h.styleManager.getObjStyle(p)||{},b=f.labelText||x.labelText,P=f.labelField||x.labelField,L=h.tileAttributeTypes[P],T=String(b||e.gmxUtil.attrToString(L,r.getPropItem(P,p.properties)));if(x.labelTemplate){var w,S=/\[([^\]]*)\]/g;for(T=x.labelTemplate;w=S.exec(x.labelTemplate);)if(2===w.length){P=w[1],L=h.tileAttributeTypes[P];var M=e.gmxUtil.attrToString(L,r.getPropItem(P,p.properties));T=T.replace(w[0],M)}}if(T||0===T){var I,k=x.labelFontSize||f.labelFontSize||12,C="_"+p.id,O=!0,E=0,z=p.options,A={font:k+'px "Arial"',labelHaloColor:"labelHaloColor"in f?f.labelHaloColor:"labelHaloColor"in x?x.labelHaloColor:16777215,labelColor:f.labelColor||x.labelColor,labelAlign:f.labelAlign||x.labelAlign,labelAnchor:f.labelAnchor||x.labelAnchor,labelFontSize:k};if(z){if(!("center"in z)){var D=i.getItemCenter(p,h.dataManager.getItemMembers(p.id));if(!D)continue;z.center=D}if(z.label){E=z.label.width,I=z.label.arrTxtWidth;var R=z.label.style;O=z.label.txt!==T||R.labelHaloColor!==A.labelHaloColor||R.labelColor!==A.labelColor||R.labelAlign!==A.labelAlign||R.labelAnchor!==A.labelAnchor||R.labelFontSize!==A.labelFontSize}}if(O){if(E=0,I=i.getLabelWidth(T,A),I&&I.forEach(function(t){E=Math.max(E,t[1])}),!E){delete u[C];continue}E+=4,p.options.labelStyle=null}z.label={isPoint:m,width:E,sx:x.sx||0,txt:T,arrTxtWidth:I,style:A},u[C]=p}}o._labelsIndex[l]=r.options.zIndex,o._labels[l]=u}},s=function(t,e){var i=t._gmx,n=["clipFilter","clipPointsFilter","styleFilter","userFilter"],s={type:"resend",bbox:o.bbox,filters:n,callback:function(e){r(e,t),o.redraw()}};return i.beginDate&&i.endDate&&(s.dateInterval=[i.beginDate,i.endDate]),i.dataManager.addObserver(s,"_Labels_"+e)};this.add=function(t){var e=t._leaflet_id,i=t._gmx;!o._observers[e]&&i&&i.labelsLayer&&e&&i.styleManager.promise.then(function(){var n=s(t,e),r=o._map._zoom;t.options.isGeneralized&&(n.targetZoom=r),n.dateInterval&&t.on("dateIntervalChanged",function(t){var e=t.target.getDateInterval();this.setDateInterval(e.beginDate,e.endDate)},n),i.styleManager.isVisibleAtZoom(r)||n.deactivate(),o._observers[e]=n,o._styleManagers[e]=i.styleManager,o._labels["_"+e]={},o._labelsIndex["_"+e]={},o._updateBbox()})},this.remove=function(t){var e=t._leaflet_id;if(o._observers[e]){var i=t._gmx,n=i.dataManager;n.removeObserver(o._observers[e].id),delete o._observers[e],delete o._styleManagers[e],delete o._labels["_"+e],delete o._labelsIndex["_"+e],o.redraw()}},this._layeradd=function(t){o.add(t.layer)},this._layerremove=function(t){o.remove(t.layer)}},redraw:function(){return this._frame||this._map._animating||(this._frame=e.Util.requestAnimFrame(this._redraw,this)),this},_addToPane:function(){var t=this._map.getPanes()[this.options.pane];t&&t.insertBefore(this._canvas,t.firstChild)},onAdd:function(t){this._map=t,this._canvas||this._initCanvas();var e=window.location.search.match("labels=([^&]+)");e&&(this.options.labels=e[1]),t.on({moveend:this._reset,zoomstart:this._hideMe,layeradd:this._layeradd,layerremove:this._layerremove},this),this._reset()},_hideMe:function(){this._canvas.style.visibility="hidden"},onRemove:function(t){this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),t.off({moveend:this._reset,zoomstart:this._hideMe,layeradd:this._layeradd,layerremove:this._layerremove},this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=e.DomUtil.create("canvas","leaflet-labels-layer leaflet-layer leaflet-zoom-hide"),i=this._map.getSize();t.width=i.x,t.height=i.y,t.style.pointerEvents="none",this._canvas=t},_updateBbox:function(){var t=this._map,n=t.getBounds(),o=n.getSouthWest(),r=n.getNorthEast(),s=3857==t.options.srs?e.CRS.EPSG3857:e.Projection.Mercator,a=s.project(o),l=s.project(r),h=t.getZoom();this.mInPixel=i.getPixelScale(h),this._ctxShift=[a.x*this.mInPixel,l.y*this.mInPixel];for(var u in this._observers){var c=this._observers[u];c.targetZoom&&(c.targetZoom=h),c.setBounds({min:{x:o.lng,y:o.lat},max:{x:r.lng,y:r.lat}})}},_reset:function(){this._updateBbox();for(var t in this._observers){var e=this._observers[t];!e.isActive()&&this._styleManagers[t].isVisibleAtZoom(this._map.getZoom())&&e.activate(),e.fire("update")}setTimeout(function(){this._canvas.style.visibility=""}.bind(this),200)},_redraw:function(){var t=[],n=this._map,o=n.getSize(),r=this._canvas,s=this.options.labels,a=n.latLngToContainerPoint(n.getBounds().getNorthWest()),l=n.containerPointToLayerPoint(a);r.width=o.x,r.height=o.y,e.DomUtil.setPosition(r,l);var h,u,c,d=2*this.mInPixel*i.worldWidthMerc,p=d*Math.floor(n.getPixelBounds().min.x/d),m=r.getContext("2d"),f=Object.keys(this._labels).sort(function(t,e){return this._labelsIndex[e]-this._labelsIndex[t]}.bind(this));if(f.forEach(function(e){var n=this._labels[e];for(var r in n){c=n[r];var a=c.options,l=a.label,m=l.style,f=m.labelAlign||"center",_=l.arrTxtWidth,g=_.length||1,v=l.width,y=v/2,x=m.labelFontFamily||"Arial",b=m.labelFontSize||12,P=b/2,L=a.center,T=[L[0]*this.mInPixel,L[1]*this.mInPixel],w=!1;if(l.isPoint){var S=l.sx;"left"===f?T[0]+=y+S:"right"===f&&(T[0]-=v+S)}T[0]-=y+this._ctxShift[0],T[1]=-P-T[1]+this._ctxShift[1],P*=g,m.labelAnchor&&(T[0]+=m.labelAnchor[0],T[1]+=m.labelAnchor[1]);for(var M=T[0]+p;M<o.x;M+=d){var I=[Math.floor(M),Math.floor(T[1])],k=i.bounds([[I[0],I[1]-P],[I[0]+v,I[1]+P]]);if("All"!==s){for(h=0,u=t.length;h<u;h++)if(k.intersects(t[h].bbox)){w=!0;break}if(w)continue}a.labelStyle||(a.labelStyle={font:b+'px "'+x+'"',fillStyle:i.dec2color(m.labelColor||0,1),shadowBlur:4},m.labelHaloColor!==-1&&(a.labelStyle.strokeStyle=a.labelStyle.shadowColor=i.dec2color(m.labelHaloColor,1))),t.push({arr:c.properties,bbox:k,arrTxtWidth:_,width2:"center"===f?y:0,txt:l.txt,style:a.labelStyle,size:b,coord:I})}}}.bind(this)),t.length){for(m.clearRect(0,0,r.width,r.height),h=0,u=t.length;h<u;h++)c=t[h],c.arrTxtWidth.forEach(function(t,e){var n=[c.coord[0],c.coord[1]+(e+1)*c.size];i.setLabel(m,t[0],n,c.style)});r.parentNode||this._addToPane()}else r.parentNode&&r.parentNode.removeChild(r);this._frame=null},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._map.getBounds(),t.zoom,t.center).min;e.DomUtil.setTransform(this._canvas,n,i)}}),e.labelsLayer=function(t,i){return new e.LabelsLayer(t,i)},e.Map.addInitHook(function(){this._labelsLayer||(this._labelsLayer=new e.LabelsLayer(this,this.options),this._labelsLayer.addTo(this))}),function(){var t=function(t,e){for(var i in e)for(var n=e[i],o=0,r=n.length;o<r;o++)for(var s=n[o],a=s.geometry.type,l=s.boundsArr,h=0,u=l.length;h<u;h++){var c=l[h];"Polygon"===a&&(c=[c]);for(var d=0,p=c.length;d<p;d++)if(c[d].intersects(t))return!0}return!1},n=function(t,e){for(var i in e)for(var n=e[i],o=0,r=n.length;o<r;o++)for(var s=n[o],a=s.geometry.type,l=s.boundsArr,h=0,u=l.length;h<u;h++){var c=l[h];"Polygon"===a&&(c=[c]);for(var d=0,p=c.length;d<p;d++)if(t.intersects(c[d]))return!0}return!1},o=function(t,e){if(!e||0===Object.keys(e).length)return!0;for(var n in e)for(var o=e[n],r=0,s=o.length;r<s;r++)for(var a=o[r],l=a.geometry.type,h=a.boundsArr,u=0,c=h.length;u<c;u++){var d=h[u];"Polygon"===l&&(d=[d]);for(var p=0,m=d.length;p<m;p++)if(d[p].contains(t)){var f=a.geometry.coordinates,_=!1;"Polygon"===l&&(f=[f]);for(var g=0,v=f.length;g<v;g++)if(i.isPointInPolygonWithHoles(t,f[g])){_=!0;break}if(_)return!0}}return!1},r=function(t){var e=i.convertGeometry(t,!1,!0),n=i.geoItemBounds(e);return n.geometry=e,n},s=function(t){var e=document.createElement("canvas");e.width=e.height=256;var n=e.getContext("2d"),o=t.clipPolygons;t.ctx=n,n.fillStyle=n.createPattern(t.tile,"no-repeat");for(var r in o)for(var s=o[r],a=0,l=s.length;a<l;a++){var h=s[a].geometry,u=h.coordinates;"Polygon"===h.type&&(u=[u]);for(var c=0,d=u.length;c<d;c++){var p=u[c];n.beginPath();for(var m=0,f=p.length;m<f;m++){t.coords=p[m];var _=i.getRingPixels(t);t.coords=_.coords,i.polygonToCanvasFill(t)}n.closePath(),n.fill()}}n=t.tile.getContext("2d"),n.clearRect(0,0,256,256),n.drawImage(e,0,0)};e.gmx.VectorLayer.include({isPointInClipPolygons:function(t){return o(t,this._gmx._clipPolygons)},addClipPolygon:function(i){var a,l,h=[];if("coordinates"in i&&"type"in i)h.push(r(i));else if(i instanceof e.Polygon)h.push(r(i.toGeoJSON().geometry));else if(i instanceof e.GeoJSON){var u=i.getLayers();for(a=0,l=u.length;a<l;a++){var c=u[a];c instanceof e.Polygon&&c.feature?h.push(r(c.feature.geometry)):c instanceof e.MultiPolygon&&c.feature&&h.push(r(c.feature.geometry))}}if(h.length){var d=this._gmx,p=d.dataManager,m=this,f=e.stamp(i);this._gmx._clipPolygons||(this._gmx._clipPolygons={}),this._gmx._clipPolygons[f]=h,p.setTileFilteringHook(function(e){return t(e.bounds,m._gmx._clipPolygons)}),p.addFilter("clipFilter",function(t,e,i){return n(i,m._gmx._clipPolygons)}),p.addFilter("clipPointsFilter",function(t){if("POINT"===t.type){var e=t.properties,i=e[e.length-1];return o(i.coordinates,m._gmx._clipPolygons)}return!0}),1===Object.keys(this._gmx._clipPolygons).length&&d.renderHooks.unshift(function(t,e){t&&Object.keys(m._gmx._clipPolygons).length>0&&s({tile:t,topLeft:e.topLeft,tpx:e.tpx,tpy:e.tpy,gmx:{mInPixel:d.mInPixel},clipPolygons:m._gmx._clipPolygons})})}return this},removeClipPolygon:function(t){var i=e.stamp(t);return this._gmx._clipPolygons&&(delete this._gmx._clipPolygons[i],0===Object.keys(this._gmx._clipPolygons).length&&(this._gmx.dataManager.removeTileFilteringHook(),this._gmx.dataManager.removeFilter("clipFilter"))),this}})}(),e.gmx.gmxImageTransform=function(t,n){var o=n.gmx,r=n.topLeft,s=r.mInPixel,a=n.gmxTilePoint,l=n.geoItem,h=l.properties,u=l.dataOption||{},c=o.tileAttributeIndexes,d=h[c[o.quicklookPlatform]]||o.quicklookPlatform||"",p={};"LANDSAT8"===d?(p.x1=u.bounds.min.x,p.y1=u.bounds.max.y,p.x2=u.bounds.max.x,p.y2=u.bounds.max.y,p.x3=u.bounds.max.x,p.y3=u.bounds.min.y,p.x4=u.bounds.min.x,p.y4=u.bounds.min.y):p=i.getQuicklookPointsFromProperties(h,o);var m=s*p.x1,f=s*p.y1,_=s*p.x2,g=s*p.y2,v=s*p.x3,y=s*p.y3,x=s*p.x4,b=s*p.y4,P=i.bounds([[m,f],[_,g],[v,y],[x,b]]),L=Math.round(P.max.x-P.min.x),T=Math.round(P.max.y-P.min.y),w=256-P.max.y+256*a.y,S=l.item.bounds,M=Number(i.worldWidthMerc.toFixed(2)),I=a.x;I<0&&S.max.x>=M&&S.min.x<=-M&&(I+=Math.round(M*s/128));var k=P.min.x-256*I;m-=P.min.x,f=P.max.y-f,_-=P.min.x,g=P.max.y-g,v-=P.min.x,y=P.max.y-y,x-=P.min.x,b=P.max.y-b;var C=[[m,f],[_,g],[v,y],[x,b]];o.ProjectiveImage||(o.ProjectiveImage=(o.useWebGL?e.gmx.projectiveImageWebGL():null)||e.gmx.projectiveImage());var O=o.ProjectiveImage.getCanvas({imageObj:t,points:C,wView:L,hView:T,deltaX:k,deltaY:w});return O.canvas},function(){function t(t){return[t[4]*t[8]-t[5]*t[7],t[2]*t[7]-t[1]*t[8],t[1]*t[5]-t[2]*t[4],t[5]*t[6]-t[3]*t[8],t[0]*t[8]-t[2]*t[6],t[2]*t[3]-t[0]*t[5],t[3]*t[7]-t[4]*t[6],t[1]*t[6]-t[0]*t[7],t[0]*t[4]-t[1]*t[3]]}function i(t,e){for(var i=Array(9),n=0;3!==n;++n)for(var o=0;3!==o;++o){for(var r=0,s=0;3!==s;++s)r+=t[3*n+s]*e[3*s+o];i[3*n+o]=r}return i}function n(t,e){return[t[0]*e[0]+t[1]*e[1]+t[2]*e[2],t[3]*e[0]+t[4]*e[1]+t[5]*e[2],t[6]*e[0]+t[7]*e[1]+t[8]*e[2]]}function o(e){var o=[e[0],e[2],e[4],e[1],e[3],e[5],1,1,1],r=n(t(o),[e[6],e[7],1]);return i(o,[r[0],0,0,0,r[1],0,0,0,r[2]])}var r=e.Class.extend({options:{antialias:!0,depth:!1,preserveDrawingBuffer:!0,shaderVS:"attribute vec2 aVertCoord;            uniform mat4 uTransformMatrix;            varying vec2 vTextureCoord;            void main(void) {                vTextureCoord = aVertCoord;                gl_Position = uTransformMatrix * vec4(aVertCoord, 0.0, 1.0);            }        ",shaderFS:"precision mediump float;            varying vec2 vTextureCoord;            uniform sampler2D uSampler;            void main(void) {                gl_FragColor = texture2D(uSampler, vTextureCoord);            }        "},setOptions:function(t){e.setOptions(this,t)},initialize:function(t){this.setOptions(t);var e=document.createElement("canvas"),i={antialias:this.options.antialias,depth:this.options.depth,preserveDrawingBuffer:this.options.preserveDrawingBuffer},n=e.getContext("webgl",i)||e.getContext("experimental-webgl",i);if(n){var o=this._setupGlContext(n);o&&(e.width=e.height=256,o.canvas=e,this.glResources=o,this.canvas=e,this.gl=n)}},_getShader:function(t,e,i){var n=i.createShader(t);return i.shaderSource(n,e),i.compileShader(n),i.getShaderParameter(n,i.COMPILE_STATUS)?n:(i.deleteShader(n),null)},_setupGlContext:function(t){var e=this._getShader(t.VERTEX_SHADER,this.options.shaderVS,t),i=this._getShader(t.FRAGMENT_SHADER,this.options.shaderFS,t);if(e&&i){var n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)){t.useProgram(n),this.vertices=new Float32Array([0,0,1,0,0,1,1,1]);var o=t.createBuffer(),r=t.getAttribLocation(n,"aVertCoord");return t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),{transMatUniform:t.getUniformLocation(n,"uTransformMatrix"),samplerUniform:t.getUniformLocation(n,"uSampler"),screenTexture:t.createTexture()}}}return null},_bindTexture:function(t,e,i){t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)},getCanvas:function(t){var e=t.points,i=t.deltaX,n=t.deltaY,o=new Float32Array([(e[0][0]+i)/128-1,1-(e[0][1]+n)/128,(e[1][0]+i)/128-1,1-(e[1][1]+n)/128,(e[3][0]+i)/128-1,1-(e[3][1]+n)/128,(e[2][0]+i)/128-1,1-(e[2][1]+n)/128]),s=r.Utils.general2DProjection(this.vertices,o),a=this.gl,l=this.glResources;return this._bindTexture(a,t.imageObj,l.screenTexture),a.viewport(0,0,256,256),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.uniformMatrix4fv(l.transMatUniform,!1,[s[0],s[3],0,s[6],s[1],s[4],0,s[7],0,0,1,0,s[2],s[5],0,1]),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,l.screenTexture),a.uniform1i(l.samplerUniform,0),a.drawArrays(a.TRIANGLE_STRIP,0,4),this}});r.Utils={general2DProjection:function(e,n){var r=i(o(n),t(o(e)));if(r[8])for(var s=0;9!==s;++s)r[s]=r[s]/r[8];return r},getWebGlResources:function(t){var e=new r(t);return e.gl?e:null}},e.gmx.projectiveImageWebGL=function(t){var e=new r(t);return e.gl?e:null}}(),function(){var t=function(){var t=0,e=4,n=64,o=null,r=function(t,e){for(var i=[],n=0;n<e;++n){i[n]=[];for(var o=0;o<t;++o)i[n][o]=0}return i},s=function(t,e,i){this.w=t,this.h=e,this.values=i||r(e)},a=function(t){for(var e=[],i=0;i<t.length;++i)e[i]=[].concat(t[i]);return e};s.prototype={add:function(t){if(t.w!==this.w||t.h!==this.h)throw new Error("Matrix add size mismatch");for(var e=r(this.w,this.h),i=0;i<this.h;++i)for(var n=0;n<this.w;++n)e[i][n]=this.values[i][n]+t.values[i][n];return new s(this.w,this.h,e)},transformProjectiveVector:function(t){var e,i,n=[];for(i=0;i<this.h;++i)for(n[i]=0,e=0;e<this.w;++e)n[i]+=this.values[i][e]*t[e];var o=n[n.length-1];if(o){var r=1/n[n.length-1];for(i=0;i<this.h;++i)n[i]*=r}return n},multiply:function(t){var e,i,n;if(+t!==t){if(t.h!==this.w)throw new Error("Matrix mult size mismatch");for(e=r(this.w,this.h),n=0;n<this.h;++n)for(i=0;i<t.w;++i){for(var o=0,a=0;a<this.w;a++)o+=this.values[n][a]*t.values[a][i];e[n][i]=o}return new s(t.w,this.h,e)}for(e=r(this.w,this.h),n=0;n<this.h;++n)for(i=0;i<this.w;++i)e[n][i]=this.values[n][i]*t;return new s(this.w,this.h,e)},rowEchelon:function(){if(this.w<=this.h)throw new Error("Matrix rowEchelon size mismatch");for(var t=a(this.values),e=0;e<this.h;++e){for(var i=t[e][e];0===i;){for(var n=e+1;n<this.h;++n)if(0!==t[n][e]){var o=t[n];t[n]=t[e],t[e]=o;break}if(n===this.h)return new s(this.w,this.h,t);i=t[e][e]}for(var r=1/i,l=e;l<this.w;++l)t[e][l]*=r;for(var h=0;h<this.h;++h)if(h!==e){var u=t[h][e];for(t[h][e]=0,l=e+1;l<this.w;++l)t[h][l]-=u*t[e][l]}}return new s(this.w,this.h,t)},invert:function(){var t,e;if(this.w!==this.h)throw new Error("Matrix invert size mismatch");var i=r(2*this.w,this.h);for(e=0;e<this.h;++e)for(t=0;t<this.w;++t)i[e][t]=this.values[e][t],i[e][t+this.w]=t===e?1:0;i=new s(2*this.w,this.h,i),i=i.rowEchelon();var n=r(this.w,this.h);for(e=0;e<this.w;++e)for(t=0;t<this.w;++t)n[e][t]=i.values[e][t+this.w];return new s(this.w,this.h,n)}};var l=function(t){var e=new s(9,8,[[1,1,1,0,0,0,-t[2][0],-t[2][0],-t[2][0]],[0,1,1,0,0,0,0,-t[3][0],-t[3][0]],[1,0,1,0,0,0,-t[1][0],0,-t[1][0]],[0,0,1,0,0,0,0,0,-t[0][0]],[0,0,0,-1,-1,-1,t[2][1],t[2][1],t[2][1]],[0,0,0,0,-1,-1,0,t[3][1],t[3][1]],[0,0,0,-1,0,-1,t[1][1],0,t[1][1]],[0,0,0,0,0,-1,0,0,t[0][1]]]),i=e.rowEchelon().values,n=new s(3,3,[[-i[0][8],-i[1][8],-i[2][8]],[-i[3][8],-i[4][8],-i[5][8]],[-i[6][8],-i[7][8],1]]);return n},h=function(e,i,r,s,a,l,u,c,d,p){if(d){var m=[l[0]+u[0]-2*a[0],l[1]+u[1]-2*a[1]],f=[l[0]+u[0]-2*c[0],l[1]+u[1]-2*c[1]],_=[m[0]+f[0],m[1]+f[1]],g=Math.abs((_[0]*_[0]+_[1]*_[1])/(m[0]*f[0]+m[1]*f[1]));m=[l[0]-a[0]+c[0]-u[0],l[1]-a[1]+c[1]-u[1]],f=[u[0]-a[0]+c[0]-l[0],u[1]-a[1]+c[1]-l[1]];var v=Math.abs(m[0]*f[1]-m[1]*f[0]);if(0===e&&1===r||(.25+5*g)*v>n*n){var y=(e+r)/2,x=(i+s)/2,b=o.transformProjectiveVector([y,x,1]),P=o.transformProjectiveVector([y,i,1]),L=o.transformProjectiveVector([y,s,1]),T=o.transformProjectiveVector([e,x,1]),w=o.transformProjectiveVector([r,x,1]);return d--,h.call(this,e,i,y,x,a,P,T,b,d,p),h.call(this,y,i,r,x,P,l,b,w,d,p),h.call(this,e,x,y,s,T,b,u,L,d,p),void h.call(this,y,x,r,s,b,w,L,c,d,p)}}var S=p.ctx,M=[l[0]-a[0],l[1]-a[1]],I=[c[0]-l[0],c[1]-l[1]],k=[u[0]-c[0],u[1]-c[1]],C=[a[0]-u[0],a[1]-u[1]],O=Math.abs(M[0]*C[1]-M[1]*C[0]),E=Math.abs(I[0]*M[1]-I[1]*M[0]),z=Math.abs(k[0]*I[1]-k[1]*I[0]),A=Math.abs(C[0]*k[1]-C[1]*k[0]),D=Math.max(Math.max(O,E),Math.max(A,z)),R=0,B=0,N=0,F=0;D===O?(S.setTransform(M[0],M[1],-C[0],-C[1],a[0]+p.deltaX,a[1]+p.deltaY),
1!==r&&(N=1.05/Math.sqrt(M[0]*M[0]+M[1]*M[1])),1!==s&&(F=1.05/Math.sqrt(C[0]*C[0]+C[1]*C[1]))):D===E?(S.setTransform(M[0],M[1],I[0],I[1],l[0]+p.deltaX,l[1]+p.deltaY),1!==r&&(N=1.05/Math.sqrt(M[0]*M[0]+M[1]*M[1])),1!==s&&(F=1.05/Math.sqrt(I[0]*I[0]+I[1]*I[1])),R=-1):D===z?(S.setTransform(-k[0],-k[1],I[0],I[1],c[0]+p.deltaX,c[1]+p.deltaY),1!==r&&(N=1.05/Math.sqrt(k[0]*k[0]+k[1]*k[1])),1!==s&&(F=1.05/Math.sqrt(I[0]*I[0]+I[1]*I[1])),R=-1,B=-1):D===A&&(S.setTransform(-k[0],-k[1],-C[0],-C[1],u[0]+p.deltaX,u[1]+p.deltaY),1!==r&&(N=1.05/Math.sqrt(k[0]*k[0]+k[1]*k[1])),1!==s&&(F=1.05/Math.sqrt(C[0]*C[0]+C[1]*C[1])),B=-1);var Z=r-e,U=s-i;N++,F++;var G=p.imageObj.width,j=p.imageObj.height,H=Math.floor(e*G),V=Math.floor(i*j),q=Math.floor(Math.min(N*Z,1)*G),W=Math.floor(Math.min(F*U,1)*j);t++,S.drawImage(p.imageObj,H,V,q,W,R,B,N,F)};this.getCanvas=function(r){t=0,o=l(r.points);var s=o.transformProjectiveVector([0,0,1]),a=o.transformProjectiveVector([1,0,1]),u=o.transformProjectiveVector([0,1,1]),c=o.transformProjectiveVector([1,1,1]),d=document.createElement("canvas");d.width=d.height=256,r.canvas=d,r.ctx=d.getContext("2d");var p=i.bounds([s,a,c,u]),m=Math.max(p.max.x-p.min.x,p.max.y-p.min.y);e="limit"in r?r.limit:m<200?1:4,n="patchSize"in r?r.patchSize:m/8;try{h(0,0,1,1,s,a,u,c,e,r)}catch(f){console.log("Error: ProjectiveImage event:",f),d=null}return{canvas:d,ptl:s,ptr:a,pbl:u,pbr:c,cnt:t}}};e.gmx.projectiveImage=function(){return new t}}(),e.RotatedMarker=e.Marker.extend({options:{angle:0},statics:{TRANSFORM_ORIGIN:e.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"])},_initIcon:function(){e.Marker.prototype._initIcon.call(this),this._icon.style[e.RotatedMarker.TRANSFORM_ORIGIN]=this._getTransformOrigin()},_getTransformOrigin:function(){var t=this.options.icon.options.iconAnchor;return t?t[0]+"px "+t[1]+"px":"50% 50%"},_setPos:function(t){if(e.Marker.prototype._setPos.call(this,t),e.DomUtil.TRANSFORM)this._icon.style[e.DomUtil.TRANSFORM]+=" rotate("+this.options.angle+"deg)";else if(e.Browser.ie){var i=this.options.angle*(Math.PI/180),n=Math.cos(i),o=Math.sin(i);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+n+", M12="+-o+", M21="+o+", M22="+n+")"}},setAngle:function(t){this.options.angle=t}}),e.rotatedMarker=function(t,i){return new e.RotatedMarker(t,i)},e.gmx.ExternalLayer=e.Class.extend({createExternalLayer:function(){return null},isExternalVisible:function(){return!0},updateData:function(){},setDateInterval:function(){if(this._observer){var t=this.parentLayer._gmx;this._observer.setDateInterval(t.beginDate,t.endDate)}},options:{useDataManager:!0,observerOptions:{delta:0,filters:["clipFilter","userFilter","clipPointsFilter"]}},initialize:function(t,i){e.setOptions(this,t),this.parentLayer=i,i.on("add",this._addEvent,this).on("dateIntervalChanged",this.setDateInterval,this),this.options.useDataManager&&this._addObserver(this.options.observerOptions),this.externalLayer=this.createExternalLayer(),i._map&&(this._addEvent({target:{_map:i._map}}),this._updateBbox())},_addObserver:function(t){this._items={},this._observer=this.parentLayer.addObserver(e.extend({bbox:i.bounds([[Number.MAX_VALUE,Number.MAX_VALUE]]),callback:e.bind(this.updateData,this)},t)).deactivate()},unbindLayer:function(){this.parentLayer.off("add",this._addEvent,this).off("dateIntervalChanged",this.setDateInterval,this),this._observer&&delete this.parentLayer.repaintObservers[this._observer.id];var t=this._map||this.parentLayer._map;this._onRemove(!t),this._removeMapHandlers()},_addMapHandlers:function(t){t&&(this._map=t,this._map.on({moveend:this._updateBbox,zoomend:this._chkZoom,layeradd:this._layeradd,layerremove:this._layerremove},this))},_removeMapHandlers:function(){this._map&&this._map.off({moveend:this._updateBbox,zoomend:this._chkZoom,layeradd:this._layeradd,layerremove:this._layerremove},this),this._map=null},_addEvent:function(t){this._addMapHandlers(t.target._map),this._updateBbox(),this._chkZoom()},_isParentLayer:function(t){var e=t.layer;return e._gmx&&e._gmx.layerID===this.parentLayer.options.layerID},_layeradd:function(t){this._isParentLayer(t)&&this._chkZoom()},_layerremove:function(t){this._isParentLayer(t)&&(this._onRemove(!0),this._removeMapHandlers())},_onRemove:function(t){this._observer&&this._observer.deactivate();var e=this._map;e&&(e.hasLayer(this.externalLayer)&&(this._chkZoom(),e.removeLayer(this.externalLayer)),t||this.parentLayer.onAdd(e))},_chkZoom:function(){if(this._map){var t=this.parentLayer,e=this._observer,i=this._map,n=i.hasLayer(this.externalLayer);t.setCurrentZoom&&t.setCurrentZoom(i),this.isExternalVisible(i.getZoom())?t._map&&(t.onRemove(i),n||i.addLayer(this.externalLayer),this.setDateInterval(),e&&t.getIcons(function(){e.activate()}.bind(this)),t.disablePopup()):(e&&e.deactivate(),t._map||(n&&i.removeLayer(this.externalLayer),t.onAdd(i)),t.enablePopup())}},_updateBbox:function(){if(this._map&&this._observer){var t=this._map,i=t.getBounds(),n=i.getNorthWest(),o=i.getSouthEast(),r=e.gmxUtil.bounds([[n.lng,n.lat],[o.lng,o.lat]]),s=this.options.observerOptions.delta,a=s?s*e.gmxUtil.tileSizes[t.getZoom()]/256:0;this._observer.setBounds(r,a)}}}),function(){var t=e.gmx.ExternalLayer.extend({options:{minZoom:1,maxZoom:6,useDataManager:!1,format:"png",transparent:!0},createExternalLayer:function(){var t=this.parentLayer.options,i={map:t.mapID,layers:t.layerID,format:this.options.format,transparent:this.options.transparent},n=this.parentLayer.getGmxProperties();return n&&n.Temporal&&this._extendOptionsByDateInterval(i),this.options.apikey&&(i.apikey=this.options.apikey),e.tileLayer.wms(e.gmxUtil.protocol+"//"+t.hostName+"/TileService.ashx",i)},_extendOptionsByDateInterval:function(t){var i=this.parentLayer.getDateInterval(),n=i.beginDate,o=i.endDate;e.extend(t,{StartDate:n&&n.toLocaleDateString(),EndDate:o&&o.toLocaleDateString()})},setDateInterval:function(){this._extendOptionsByDateInterval(this.externalLayer.wmsParams),this.externalLayer.redraw()},isExternalVisible:function(t){return!(t<this.options.minZoom||t>this.options.maxZoom)}});e.gmx.VectorLayer.include({bindWMS:function(e){return this._layerWMS&&this._layerWMS.unbindLayer(),this._layerWMS=new t(e,this),this.isExternalVisible=this._layerWMS.isExternalVisible,this},unbindWMS:function(){return this._layerWMS&&(this._layerWMS.unbindLayer(),this._layerWMS=null,this.isExternalVisible=null,this.enablePopup()),this}})}(),function(){var t=e.gmx.ExternalLayer.extend({options:{minHeatMapZoom:1,maxHeatMapZoom:6,intensityField:"",intensityScale:1,observerOptions:{type:"resend"}},createExternalLayer:function(){return e.heatLayer([],e.extend({},this.options))},isExternalVisible:function(t){return!(t<this.options.minHeatMapZoom||t>this.options.maxHeatMapZoom)},updateData:function(t){if(t.added){var i=[],n=this.parentLayer.getTileAttributeIndexes(),o=null,r=this.options.intensityField||"",s=this.options.intensityScale||1;r&&r in n&&(o=n[r]);for(var a=0,l=t.added.length;a<l;a++){var h=t.added[a].properties,u=null!==o?h[o]:1,c=h[h.length-1],d=c.coordinates,p=e.Projection.Mercator.unproject({x:d[0],y:d[1]});i.push([p.lat,p.lng,"function"==typeof s?s(u):s*u])}this.externalLayer.setLatLngs(i)}}});e.gmx.VectorLayer.include({bindHeatMap:function(i){return e.heatLayer&&(this._heatmap&&this._heatmap.unbindLayer(),this._heatmap=new t(i,this)),this},unbindHeatMap:function(){return e.heatLayer&&this._heatmap&&(this._heatmap.unbindLayer(),this._heatmap=null,this.enablePopup()),this}})}(),function(){var t={radiusFunc:function(t){var e=Math.floor(t/15);return e>40?e=40:e<20&&(e=20),e},text:{stroke:"black","stroke-width":1,"text-anchor":"middle",fill:"white"}},i=e.gmx.ExternalLayer.extend({options:{observerOptions:{delta:256,filters:["clipFilter","styleFilter","userFilter","clipPointsFilter"]},spiderfyOnMaxZoom:!0,animate:!1,minZoom:1,maxZoom:6},createExternalLayer:function(){var i=e.extend({showCoverageOnHover:!1,disableClusteringAtZoom:1+Number(this.options.maxZoom)},this.options);if("clusterIconOptions"in this.options){var n=this.options.clusterIconOptions;if("radialGradient"in n){var o=n.radialGradient,r=n.text||t.text;i.iconCreateFunction=function(i){var n=i.getChildCount();return r.count=n,e.gmxUtil.getSVGIcon({type:"circle",iconSize:2*(o.radiusFunc||t.radiusFunc)(n),text:r,fillRadialGradient:o})}}}this.options.clusterclick&&(i.clusterclick=this.options.clusterclick,i.clusterclick===!0&&(i.zoomToBoundsOnClick=!1)),this._popup=new e.Popup({maxWidth:1e4,className:"gmxPopup"});var s=new e.MarkerClusterGroup(i),a=null;return s.on("click",function(t){var i=t.layer.options.properties,n=this.parentLayer.getItemProperties(i),o=[i[i.length-1]],r=i[0];!a||a.getAllChildMarkers().indexOf(t.layer)+1?this._openPopup(i,t.latlng):(a.unspiderfy(),s.once("unspiderfied",function(){this._openPopup(i,t.latlng)},this)),this.parentLayer.fire("click",e.extend(t,{eventFrom:"markerClusters",originalEventType:"click",gmx:{id:r,layer:this.parentLayer,properties:n,target:{id:r,properties:i,geometry:o}}}))},this).on("animationend",function(){this._popup&&this._popup._map&&this._popup._map.removeLayer(this._popup)},this).on("clusterclick",function(t){this.parentLayer.fire("clusterclick",e.extend(t,{eventFrom:"markerClusters",originalEventType:"clusterclick"}))},this).on("spiderfied",function(t){a=t.cluster},this).on("unspiderfied",function(){a=null},this),i.clusterclick&&s.on("clusterclick",i.clusterclick instanceof Function?i.clusterclick:function(t){t.layer.spiderfy()}),s},isExternalVisible:function(t){return!(t<this.options.minZoom||t>this.options.maxZoom)},updateData:function(t){var i,n,o,r,s,a=[];if(t.removed){for(i=0,n=t.removed.length;i<n;i++)o=t.removed[i],r=o.id,s=this._items[r],s&&a.push(s),delete this._items[r];this.externalLayer.removeLayers(a),a=[]}if(t.added){var l=this.parentLayer.options.tilesCRS||e.Projection.Mercator;for(i=0,n=t.added.length;i<n;i++){o=t.added[i],r=o.id,s=this._items[r];var h=o.properties;if(s&&h.processing&&(this.externalLayer.removeLayer(s),s=null),!s){o.item.parsedStyleKeys||(o.item.parsedStyleKeys=this.parentLayer.getItemStyle(r));var u=h[h.length-1],c=o.item.parsedStyleKeys,d=u.coordinates,p=l.unproject({x:d[0],y:d[1]}),m={properties:o.properties,mPoint:d};if(this.options.notClusteredIcon){var f=this.options.notClusteredIcon;f instanceof e.Icon?m.icon=f:m.icon=e.icon(f)}else if(c)if(c.iconUrl){var _=c.iconAnchor;if(!_){var g=this.parentLayer.getItemStyle(r);_=g.image?[g.sx/2,g.sy/2]:[8,10]}m.icon=e.icon({iconAnchor:_,iconUrl:c.iconUrl})}else m.icon=e.gmxUtil.getSVGIcon(c);s=c.rotate?e.rotatedMarker(p,e.extend(m,{angle:c.rotate})):e.marker(p,e.extend(m,{angle:c.rotate})),this._items[r]=s}a.push(s)}this.externalLayer.addLayers(a)}},_openPopup:function(t,i){var n=this.parentLayer._gmx,o=t[0],r=n.styleManager.getItemBalloon(o),s=this.parentLayer.getItemProperties(t),a=[t[t.length-1]];if(r&&!r.DisableBalloonOnClick){var l=this.parentLayer.getItemStyle(o);if(l&&l.iconAnchor){var h=e.Popup.prototype.options.offset;this._popup.options.offset=[-h[0]-l.iconAnchor[0]+l.sx/2,h[1]-l.iconAnchor[1]+l.sy/2]}if(this.parentLayer._balloonHook)for(var u in this.parentLayer._balloonHook)s[u]=e.gmxUtil.parseTemplate(this.parentLayer._balloonHook[u].resStr,s);var c=e.gmxUtil.parseBalloonTemplate(r.templateBalloon,{properties:s,tileAttributeTypes:n.tileAttributeTypes,unitOptions:this._map.options||{},geometries:a}),d=e.DomUtil.create("div","");d.innerHTML=c,this._popup.setLatLng(i).setContent(d).openOn(this._map),this.parentLayer._balloonHook&&this.parentLayer._callBalloonHook(s,this._popup.getContent())}}});e.gmx.VectorLayer.include({bindClusters:function(t){return e.MarkerClusterGroup&&(this._clusters&&this._clusters.unbindLayer(),this._clusters=new i(t,this)),this},unbindClusters:function(){return e.MarkerClusterGroup&&this._clusters&&(this._clusters.unbindLayer(),this._clusters=null,this.enablePopup()),this}})}(),function(){var t=e.Evented.extend({options:{skipItems:!0,pixelDelta:0,styleHook:function(t,e,i){t.setLineDash([2,4])},minZoom:1,maxZoom:6},_layer:null,_markers:null,initialize:function(t,i){this._layer=i,t=e.Util.setOptions(this,t),this._markers=new e.FeatureGroup(t),this._layer.on("load",this.checkLoad,this)},checkLoad:function(){var t=this._layer._tiles,e=0,i=0;for(var n in t){var o=t[n];o.count&&(i+=o.count),o._gridData&&o._gridData.forEach(function(t){t.count&&(e=Math.max(e,t.count))})}i&&this._drawMe(e,i)},_drawMe:function(t,e){var i=this._layer._tiles,n=this._layer.options.tileSize;for(var o in i){var r=i[o];if(!r._drawDone&&r._gridData){r.el.height!=n&&(r.el.width=r.el.height=n);var s=r.el.getContext("2d");r._gridData.forEach(function(e){if(e.count){this.options.styleHook&&this.options.styleHook(s,e,t);var i=e.pixelBox;s.strokeRect(i[0],i[1],i[2],i[3])}}.bind(this))}}},_zoomClear:null,checkData:function(t){var e=this._layer._gmx.currentZoom;return e<this.options.minZoom||e>this.options.maxZoom?(this._layer.enablePopup(!0),!1):(this._layer.disablePopup(!0),this._parseData(t),this._layer._map&&e===t.tileElem.coords.z&&(this._layer._map.addLayer(this._markers),this._zoomClear||(this._layer._map.on("zoomstart",function(t){this._markers.clearLayers()},this),this._zoomClear=!0)),this.options.skipItems&&!0)},_parseData:function(t){var i=t.tileElem,n=i.screenTile.tbounds,o=n.getCenter(),r=this._layer._tileCoordsToNwSe(i.coords),s=e.latLngBounds(r[0],r[1]),a=s.getCenter(),l=[{bounds:e.gmxUtil.bounds([[n.min.x,o[1]],[o[0],n.max.y]]),center:e.latLngBounds(s.getNorthWest(),a).getCenter()},{bounds:e.gmxUtil.bounds([o,[n.max.x,n.max.y]]),center:e.latLngBounds(s.getNorthEast(),a).getCenter()},{bounds:e.gmxUtil.bounds([[n.min.x,n.min.y],o]),center:e.latLngBounds(s.getSouthWest(),a).getCenter()},{bounds:e.gmxUtil.bounds([[o[0],n.min.y],[n.max.x,o[1]]]),center:e.latLngBounds(s.getSouthEast(),a).getCenter()}],h=2,u=256/h-this.options.pixelDelta;t.geoItems.forEach(function(t){for(var e=t.item,i=e.bounds,n=0;n<4;n++){var o=l[n];if(o.bounds.intersects(i)){var r=e.currentFilter;o.counts||(o.counts={}),o.counts[r]?o.counts[r]++:o.counts[r]=1;break}}}),l.forEach(function(e,i){if(e.counts){var n=0;for(var o in e.counts)n+=e.counts[o];e.count=n,e.data=t,e.pixelBox=[128*(i%2)+this.options.pixelDelta,(i>1?128:0)+this.options.pixelDelta,u,u],e.marker=this.addMarker(e,n),e.marker.addTo(this._markers)}}.bind(this)),i._gridData=l},clearLayers:function(){this._markers&&(this._markers.clearLayers(),this._markers._map&&this._markers._map.removeLayer(this._markers))},addMarker:function(t,i){var n=t.bounds.toLatLngBounds().getCenter(),o=e.marker(e.latLng(n.lat,t.center.lng),e.extend({icon:e.divIcon({className:"gmx-style-legend-icon",html:i})},this.options)).bindPopup(Object.keys(t.counts).sort(function(e,i){return t.counts[i]-t.counts[e]}).map(function(e){return this._layer.getStyleIcon(e,t.counts[e])}.bind(this)).join(""),{minWidth:150});return o}});e.gmx.VectorLayer.include({bindGridClusters:function(e){return this._gridClusters&&this._gridClusters.clearLayers(),this._gridClusters=new t(e,this),this.redraw().repaint(),this},unbindGridClusters:function(){return this._gridClusters&&(this._gridClusters.clearLayers(),this._gridClusters=null,this.redraw().repaint()),this}})}(),function(){function t(t,e,n){n=n||2;var r=e&&e.length,s=r?e[0]*n:t.length,a=i(t,0,s,n,!0),l=[];if(!a)return l;var u,c,d,p,m,f,_;if(r&&(a=h(t,e,a,n)),t.length>80*n){u=d=t[0],c=p=t[1];for(var g=n;g<s;g+=n)m=t[g],f=t[g+1],m<u&&(u=m),f<c&&(c=f),m>d&&(d=m),f>p&&(p=f);_=Math.max(d-u,p-c),_=0!==_?1/_:0}return o(a,l,n,u,c,_),l}function i(t,e,i,n,o){var r,s;if(o===k(t,e,i,n)>0)for(r=e;r<i;r+=n)s=S(r,t[r],t[r+1],s);else for(r=i-n;r>=e;r-=n)s=S(r,t[r],t[r+1],s);return s&&x(s,s.next)&&(M(s),s=s.next),s}function n(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!x(n,n.next)&&0!==y(n.prev,n,n.next))n=n.next;else{if(M(n),n=e=n.prev,n===n.next)break;i=!0}while(i||n!==e);return e}function o(t,e,i,h,u,c,d){if(t){!d&&c&&p(t,h,u,c);for(var m,f,_=t;t.prev!==t.next;)if(m=t.prev,f=t.next,c?s(t,h,u,c):r(t))e.push(m.i/i),e.push(t.i/i),e.push(f.i/i),M(t),t=f.next,_=f.next;else if(t=f,t===_){d?1===d?(t=a(t,e,i),o(t,e,i,h,u,c,2)):2===d&&l(t,e,i,h,u,c):o(n(t),e,i,h,u,c,1);break}}}function r(t){var e=t.prev,i=t,n=t.next;if(y(e,i,n)>=0)return!1;for(var o=t.next.next;o!==t.prev;){if(g(e.x,e.y,i.x,i.y,n.x,n.y,o.x,o.y)&&y(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function s(t,e,i,n){var o=t.prev,r=t,s=t.next;if(y(o,r,s)>=0)return!1;for(var a=o.x<r.x?o.x<s.x?o.x:s.x:r.x<s.x?r.x:s.x,l=o.y<r.y?o.y<s.y?o.y:s.y:r.y<s.y?r.y:s.y,h=o.x>r.x?o.x>s.x?o.x:s.x:r.x>s.x?r.x:s.x,u=o.y>r.y?o.y>s.y?o.y:s.y:r.y>s.y?r.y:s.y,c=f(a,l,e,i,n),d=f(h,u,e,i,n),p=t.prevZ,m=t.nextZ;p&&p.z>=c&&m&&m.z<=d;){if(p!==t.prev&&p!==t.next&&g(o.x,o.y,r.x,r.y,s.x,s.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&g(o.x,o.y,r.x,r.y,s.x,s.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&g(o.x,o.y,r.x,r.y,s.x,s.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&g(o.x,o.y,r.x,r.y,s.x,s.y,m.x,m.y)&&y(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function a(t,e,i){var n=t;do{var o=n.prev,r=n.next.next;!x(o,r)&&b(o,n,n.next,r)&&L(o,r)&&L(r,o)&&(e.push(o.i/i),e.push(n.i/i),e.push(r.i/i),M(n),M(n.next),n=t=r),n=n.next}while(n!==t);return n}function l(t,e,i,r,s,a){var l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&v(l,h)){var u=w(l,h);return l=n(l,l.next),u=n(u,u.next),o(l,e,i,r,s,a),void o(u,e,i,r,s,a)}h=h.next}l=l.next}while(l!==t)}function h(t,e,o,r){var s,a,l,h,d,p=[];for(s=0,a=e.length;s<a;s++)l=e[s]*r,h=s<a-1?e[s+1]*r:t.length,d=i(t,l,h,r,!1),d===d.next&&(d.steiner=!0),p.push(_(d));for(p.sort(u),s=0;s<p.length;s++)c(p[s],o),o=n(o,o.next);return o}function u(t,e){return t.x-e.x}function c(t,e){if(e=d(t,e)){var i=w(e,t);n(i,i.next)}}function d(t,e){var i,n=e,o=t.x,r=t.y,s=-(1/0);do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=o&&a>s){if(s=a,a===o){if(r===n.y)return n;if(r===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(o===s)return i.prev;var l,h=i,u=i.x,c=i.y,d=1/0;for(n=i.next;n!==h;)o>=n.x&&n.x>=u&&o!==n.x&&g(r<c?o:s,r,u,c,r<c?s:o,r,n.x,n.y)&&(l=Math.abs(r-n.y)/(o-n.x),(l<d||l===d&&n.x>i.x)&&L(n,t)&&(i=n,d=l)),n=n.next;return i}function p(t,e,i,n){var o=t;do null===o.z&&(o.z=f(o.x,o.y,e,i,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,m(o)}function m(t){var e,i,n,o,r,s,a,l,h=1;do{for(i=t,t=null,r=null,s=0;i;){for(s++,n=i,a=0,e=0;e<h&&(a++,n=n.nextZ,n);e++);for(l=h;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(o=i,i=i.nextZ,a--):(o=n,n=n.nextZ,l--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;i=n}r.nextZ=null,h*=2}while(s>1);return t}function f(t,e,i,n,o){return t=32767*(t-i)*o,e=32767*(e-n)*o,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function _(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i}function g(t,e,i,n,o,r,s,a){return(o-s)*(e-a)-(t-s)*(r-a)>=0&&(t-s)*(n-a)-(i-s)*(e-a)>=0&&(i-s)*(r-a)-(o-s)*(n-a)>=0}function v(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!P(t,e)&&L(t,e)&&L(e,t)&&T(t,e)}function y(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function x(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,i,n){return!!(x(t,e)&&x(i,n)||x(t,n)&&x(i,e))||y(t,e,i)>0!=y(t,e,n)>0&&y(i,n,t)>0!=y(i,n,e)>0}function P(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&b(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function L(t,e){return y(t.prev,t,t.next)<0?y(t,e,t.next)>=0&&y(t,t.prev,e)>=0:y(t,e,t.prev)<0||y(t,t.next,e)<0}function T(t,e){var i=t,n=!1,o=(t.x+e.x)/2,r=(t.y+e.y)/2;do i.y>r!=i.next.y>r&&i.next.y!==i.y&&o<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function w(t,e){var i=new I(t.i,t.x,t.y),n=new I(e.i,e.x,e.y),o=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function S(t,e,i,n){var o=new I(t,e,i);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function M(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function I(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(t,e,i,n){for(var o=0,r=e,s=i-n;r<i;r+=n)o+=(t[s]-t[r])*(t[r+1]+t[s+1]),s=r;return o}t.deviation=function(t,e,i,n){var o=e&&e.length,r=o?e[0]*i:t.length,s=Math.abs(k(t,0,r,i));if(o)for(var a=0,l=e.length;a<l;a++){var h=e[a]*i,u=a<l-1?e[a+1]*i:t.length;s-=Math.abs(k(t,h,u,i))}var c=0;for(a=0;a<n.length;a+=3){var d=n[a]*i,p=n[a+1]*i,m=n[a+2]*i;c+=Math.abs((t[d]-t[m])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[m+1]-t[d+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},t.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var r=0;r<t[o].length;r++)for(var s=0;s<e;s++)i.vertices.push(t[o][r][s]);o>0&&(n+=t[o-1].length,i.holes.push(n))}return i},e.gmx=e.gmx||{},e.gmx.WebGL=e.gmx.WebGL||{},e.gmx.WebGL.earcut=t}(),e.gmx=e.gmx||{};var x="maps.kosmosnimki.ru",b=2e6;e.gmx._layerClasses={Raster:e.gmx.RasterLayer,Vector:e.gmx.VectorLayer,VectorView:e.gmx.DummyLayer},e.gmx._loadingLayerClasses={},e.gmx.addLayerClass=function(t,i){e.gmx._layerClasses[t]=i},e.gmx._layerClassLoaders=[],e.gmx.addLayerClassLoader=function(t){e.gmx._layerClassLoaders.push(t),e.gmx._loadingLayerClasses={}},e.gmx._loadLayerClass=function(t){if(!e.gmx._loadingLayerClasses[t]){var i=new e.gmx.Deferred;i.resolve(),e.gmx._layerClassLoaders.forEach(function(n){i=i.then(function(i){return i?(e.gmx._layerClasses[t]=i,i):n(t)},function(){})}),i=i.then(function(i){if(i)return e.gmx._layerClasses[t]=i,i},function(){}),e.gmx._loadingLayerClasses[t]=i}return e.gmx._loadingLayerClasses[t]},e.gmx.loadLayer=function(t,n,o){return new Promise(function(r,s){var a={mapID:t,layerID:n};o=o||{},o.skipTiles||(o.skipTiles="All");for(var l in o)a[l]=o[l];var u=i.normalizeHostname(o.hostName||x);a.hostName=u,h.loadMapProperties({srs:o.srs||"3857",hostName:u,apiKey:o.apiKey,mapName:t,skipTiles:o.skipTiles}).then(function(){var i=h.findLayerInfo(u,t,n);if(!i)return void s("There is no layer "+n+" in map "+t);i.properties.hostName=u;var o=i.properties.ContentID||i.properties.type,l=function(){var t=e.gmx.createLayer(i,a);t?r(t):s("Unknown type of layer "+n)};o in e.gmx._layerClasses?l():e.gmx._loadLayerClass(o).then(l)},function(e){s("Can't load layer "+n+" from map "+t+": "+e.error)})})},e.gmx.loadLayers=function(t,i){return new Promise(function(n){Promise.all(t.map(function(t){var n=e.extend({},i,t);return e.gmx.loadLayer(t.mapID,t.layerID,n)})).then(function(t){n(t)})})},e.gmx.loadMap=function(t,n){return e.gmxUtil.debug&&console.warn("L.gmx.loadMap:",t,n),n=e.extend({},n),n.hostName=i.normalizeHostname(n.hostName||x),n.mapName=t,n.skipTiles||(n.skipTiles="All"),n.srs||(n.srs=3857),n.ftc||(n.ftc="osm"),new Promise(function(i,o){h.loadMapProperties(n).then(function(o){var r=e.gmx._maps[n.hostName][t];if(r.loaded)i(r.loaded);else{var s=new e.gmx.gmxMap(o,n);r.loaded=s,s.layersCreated.then(function(){if(n.leafletMap||n.setZIndex)for(var t,e,r=0,a=s.layers.length-1;a>=0;a--)t=s.layers[a],e=t.getGmxProperties(),"VectorOnTop"===o.properties.LayerOrder&&t.setZIndexOffset&&"Raster"!==e.type&&t.setZIndexOffset(b),n.setZIndex&&t.setZIndex&&t.setZIndex(++r),n.leafletMap&&e.visible&&t.addTo(n.leafletMap);i(s)})}},function(e){var i=e&&e.ErrorInfo&&e.ErrorInfo.ErrorMessage||"Server error";o("Can't load map "+t+" from "+n.hostName+": "+i)})["catch"](console.log)})},e.gmx.DummyLayer=function(t){this.onAdd=this.onRemove=function(){},this.getGmxProperties=function(){return t}},e.gmx.createLayer=function(t,i){t||(t={}),t.properties||(t.properties={type:"Vector"});var n,o=t.properties,r=o.ContentID||o.type||"Vector";if(i||(i=o),r in e.gmx._layerClasses)try{n=new e.gmx._layerClasses[r](i||t.properties),n=n.initFromDescription(t)}catch(s){n=new e.gmx.DummyLayer(o)}else n=new e.gmx.DummyLayer(o);return n}}();
}());
