{"version":3,"sources":["webpack:///webpack/bootstrap 0dad82d497c714d023c1","webpack:///./src1/entry.js","webpack:///./src1/all.css","webpack:///./src1/Views/AisView.css","webpack:///./src1/locale.js","webpack:///./src1/aisPluginPanel.js","webpack:///./src1/ViewsFactory.js","webpack:///./src1/Views/ScreenSearchView.js","webpack:///./src1/Views/BaseView.js","webpack:///./src1/Models/ScreenSearchModel.js","webpack:///./src1/Views/MyFleetView.js","webpack:///./src1/Models/MyFleetModel.js","webpack:///./src1/Polyfill.js","webpack:///./src1/Views/DbSearchView.js","webpack:///./src1/Views/DbSearch.css","webpack:///./src1/Models/DbSearchModel.js","webpack:///./src1/Views/InfoDialogView.js","webpack:///./src1/Views/infodialog.js","webpack:///./src1/Views/infodialog.css","webpack:///./src1/Views/VesselInfoScreen.js","webpack:///./src1/Search/Searcher.js","webpack:///./src1/Toolbox.js"],"names":["NOSIDEBAR","PRODUCTION","SIDEBAR2","require","Handlebars","registerHelper","context","mmsi","imo","JSON","stringify","pluginName","menuId","toolbarIconId","cssTable","modulePath","gmxCore","getModulePath","highlight","L","marker","icon","className","iconAnchor","iconSize","iconUrl","zIndexOffset","AisPluginPanel","ViewsFactory","publicInterface","afterViewer","params","map","options","aisLayerID","screenSearchLayer","searchLayer","aisLastPoint","historyLayer","tracksLayerID","key","toLowerCase","myFleetLayers","split","id","replace","viewFactory","layersByID","nsGmx","gmxMap","setLayerClickHandler","layer","removeEventListener","addEventListener","e","gmx","properties","hasOwnProperty","infoDialogView","show","forLayers","layersId","i","length","aisPluginPanel","lmap","leafletMap","iconOpt_mf","togglable","title","_gtxt","text","icon_mf","control","gmxIcon","on","ev","target","isActive","$","width","css","hide","addControl","sidebar","window","iconSidebarWidget","sidebarControl","sidebarPane","setPane","createTab","createTabFunction","active","inactive","hint","location","search","a","substr","x","filter","c","indexOf","y","vessel","setLatLng","addTo","fitBounds","maxZoom","animate","addModule","_translationsHash","addtext","module","exports","_leftMenuBlock","_canvas","_div","_activeView","_views","create","_isReady","_createTabs","tabsTemplate","workCanvas","append","compile","v","frame","tabs","_this","forEach","tab","eq","resize","is","each","addClass","removeClass","click","_returnInstance","parentWorkCanvas","removeLayer","attr","insertAfter","blockItem","leftPanelItem","blockTitle","panelCanvas","toggleTitle","isCollapsed","leftMenu","createWorkCanvas","gmxControlIconManager","get","_iconClick","path","call","ScreenSearchView","ScreenSearchModel","MyFleetView","MyFleetModel","DbSearchView","DbSearchModel","InfoDialogView","Searcher","Toolbox","_tools","_searcher","_mfm","aisLayerSearcher","_ssm","myFleetModel","_dbsm","_dbsv","model","tools","_ssv","_mfv","_idv","aisView","myFleetMembersView","BaseView","apply","arguments","topOffset","gifLoader","container","find","tableTemplate","cleanFilter","filterReady","filterInput","delay","doFilter","setFilter","repaint","filterString","val","clearTimeout","bind","keyup","input","keyCode","setTimeout","needUpdate","isDirty","update","widgets","commonCalendar","getDateInterval","prototype","Object","_clean","inProgress","state","progress","data","vessels","focus","_calcHeight","template","h","getBoundingClientRect","height","H","view","off","scrollCont","empty","clean","content","mCustomScrollbar","parse","xmin","xmax","longitude","ymin","ymax","latitude","ts_pos_utc","ts_pos_org","dt_pos_utc","closest","html","stopPropagation","showPosition","_actualUpdate","load","actualUpdate","Promise","resolve","all","reject","searchScreen","dateInterval","border","group","json","Status","dataSrc","Result","values","d","vessel_name","mf_member","formatDate","Math","floor","getTime","maxid","RegExp","Date","then","markMembers","console","log","ErrorInfo","some","r","msg","txt","Polyfill","_parseFilter","attributes","myRe","myArray","exec","push","findIndex","layers","errors","promises","lid","sendCrossDomainJSONRequest","baseUrl","response","layerId","parentLayerId","ParentLayer","Filter","l","searchNames","reduce","p","fields","lat","lon","formatDateTime","sort","b","member","vv","changeFilter","add","temp","join","today","getFullYear","getMonth","slice","getDate","run","TaskID","Completed","ErorInfo","layersVersion","chkVersion","predicate","list","thisArg","value","undefined","_searchString","_setSearchInputValue","s","searchIc","removeBut","searchInput","_highlight","calendar","mapDateInterval","DateInterval","set","historyInterval","dateBegin","dateEnd","CalendarWidget","name","dateMin","dateMax","dateFormat","minimized","showSwitcher","td","after","classList","toString","reset","suggestions","trg","currentTarget","suggestionsCount","suggestionsFrame","first","current","last","found","searchDone","doSearch","searcher","searchString","vessel_type","suggestion","cr","offset","left","top","bottom","outerWidth","innerHeight","keydown","prev","next","scrollInertia","_vi_template","open_pos","ind","elm","vi_cont","siblings","parent","positions","parseInt","positionMap","showTrack","defineProperty","db","getUTCDayBoundary","dlg","interval","setDateInterval","_round","isNeg","power","pow","round","_addUnit","u","_toDd","D","lng","dir","deg","toFixed","_formatPosition","cog_sog","cog","sog","heading_rot","heading","rot","x_y","eta","ts_eta","tm_pos_utc","_formatTime","tm_pos_loc","_formatDate","dt_pos_loc","eta_utc","eta_loc","icon_rot","draught","source","local","setMinutes","getMinutes","getTimezoneOffset","toLocaleTimeString","toLocaleDateString","searchPositionsAgg","parseResponse","position","groups","dt","t","obj","j","count","counter","k","ErrorMessage","createInfoDialog","VesselInfoScreen","infoDialogCascade","allIinfoDialogs","vesselInfoScreen","aisServices","_showPosition","getmore","dialog","displaingTrack","closeFunc","event","splice","openVesselInfoScreen","open","pos","ui","addUnit","formatVessel","ts_pos_loc","toDd","ddToDms","dms","min","sec","commands","myFleetMembersModel","canvas","menu","appendTo","photo","moreinfo","buttons","showDialog","vessel2","moreInfo","smallShipIcon","vesselPropTempl","registry_name","swap","mi","resizable","extend","titlebar","scheme","document","href","replaceWith","menubuttons","openpage","showpos","showtrack","templ","activateTrackBut","addremoveIcon","addremove","filterUpdating","info","onDone","_ais","_galery","_register","_regcap","_leftPanel","_minh","menuAction","preview","showPicture","remove","errmsg","change","submit","$img","jQuery","imgURL","prop","$svg","removeAttr","querySelector","style","offsetHeight","parentElement","mia","querySelectorAll","panel","display","theme","div","w","innerWidth","documentElement","clientWidth","body","clientHeight","offsetWidth","drawGallery","gallery","galcontent","drawAis","ledokol","aiscontent","innerHTML","flag_country","callsign","nav_status","destination","drawRegister","regcontent","drawTable","article","pn","pv","version","onFail","error","wait","ship","registerServerUrl","fetch","RS","catch","_baseUrl","serverBase","_aisServices","_serverScript","_aisLastPoint","_screenSearchLayer","_aisLayerID","_historyLayer","getBorder","dFeatures","gmxDrawing","getFeatures","toGeoJSON","latLngBounds","getBounds","sw","getSouthWest","ne","getNorthEast","max","minX","maxX","geo","type","coordinates","center","formatTime","isNaN","toLocaleString","formatDate2","dd","m","mm","getHours","getUTCHours","getUTCMinutes","getUTCDate","getUTCMonth","getUTCFullYear","ldd","lm","ly","lh","lmm","callback","request","WrapStyle","orderdirection","orderby","columns","query","toISOString","gmxUtil","sendCrossDomainPostRequest","searchPositions","searchById","aid","isfuzzy","toUpperCase","arr","pagesize","avessels","dt1","dt2","toJSON","minx","miny","maxx","maxy","_layersByID","_aisLayer","_tracksLayer","_displaingTrack","mmsiArr","bbox","filterFunc","args","len","_map","addLayer","removeFilter"],"mappings":"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","file":"AISSearch2.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0dad82d497c714d023c1","let NOSIDEBAR = false,\r\n    PRODUCTION = false,\r\n    SIDEBAR2 = false;\r\nif (has('NOSIDEBAR'))\r\n    NOSIDEBAR = true;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\n\r\nrequire(\"./all.css\")\r\nrequire(\"./Views/AisView.css\")\r\nrequire(\"./locale.js\")\r\n\r\nHandlebars.registerHelper('aisinfoid', function (context) {\r\n    return context.mmsi + \" \" + context.imo;\r\n});\r\n\r\nHandlebars.registerHelper('aisjson', function (context) {\r\n    return JSON.stringify(context);\r\n});\r\n\r\nconst pluginName = PRODUCTION ? 'AISSearch2' : 'AISSearch2Test',\r\n    menuId = 'AISSearch',\r\n    toolbarIconId = null, //'AISSearch2',\r\n    cssTable = 'AISSearch2',\r\n    modulePath = gmxCore.getModulePath(pluginName);\r\n\r\nconst highlight = L.marker([0, 0], {icon:L.icon({\r\n    className:\"ais_highlight-icon\", \r\n    iconAnchor:[12, 12], \r\n    iconSize:[25,25], \r\n    iconUrl:'plugins/ais/aissearch/highlight.png'}), zIndexOffset:1000});\r\n\r\nconst AisPluginPanel = require('./aisPluginPanel.js'),\r\n      ViewsFactory = require('./ViewsFactory');\r\nconst publicInterface = {\r\n    pluginName: pluginName,\r\n    afterViewer: function (params, map) {\r\n        const options = {\r\n            aisLayerID: params.aisLayerID,// || '8EE2C7996800458AAF70BABB43321FA4',\t// searchById\t\t\t\r\n            screenSearchLayer: params.searchLayer,// || '8EE2C7996800458AAF70BABB43321FA4', // screen search\t\t\t\t\r\n            aisLastPoint: params.aisLastPoint || '303F8834DEE2449DAF1DA9CD64B748FE', // db search\r\n            historyLayer: params.historyLayer,\t\r\n            tracksLayerID: params.tracksLayerID || '13E2051DFEE04EEF997DC5733BD69A15',\r\n\r\n            modulePath: modulePath,\r\n            highlight: highlight\r\n        };\r\n        for (var key in params) \r\n            if (key.toLowerCase() == \"myfleet\") {\r\n                options.myFleetLayers = params[key].split(\",\").map(function (id) {\r\n                    return id.replace(/\\s/, \"\");\r\n                });\r\n                break;\r\n            }\r\n        const viewFactory = new ViewsFactory(options);\r\n        // const setLocaleDate = function (layer) {\r\n        //     if (layer)\r\n        //         layer.bindPopup('').on('popupopen', function (e) {\r\n        //             //console.log(e);\r\n\r\n        //             var result, re = /\\[([^\\[\\]]+)\\]/g, lastIndex = 0, template = \"\",\r\n        //                 str = e.gmx.templateBalloon, props = e.gmx.properties;\r\n        //             while ((result = re.exec(str)) !== null) {\r\n        //                 template += str.substring(lastIndex, result.index);\r\n        //                 if (props.hasOwnProperty(result[1]))\r\n        //                     if (result[1].search(/^ts_pos_utc/i) != -1) {\r\n        //                         template += aisLayerSearcher.formatDate(new Date(props[result[1]] * 1000))\r\n        //                     }\r\n        //                     else if (result[1].search(/^Date/i) != -1) {\r\n        //                         template += aisLayerSearcher.formatDate(new Date(props[result[1]] * 1000)).replace(/ .+/, \"\")\r\n        //                     }\r\n        //                     else\r\n        //                         template += props[result[1]]\r\n        //                 if (result[1].search(/summary/i) != -1) {\r\n        //                     template += e.gmx.summary\r\n        //                 }\r\n        //                 //console.log(lastIndex+\", \"+result.index+\" \"+str.substring(lastIndex, result.index)+\" \"+props[result[1]]+\" \"+result[1])\r\n        //                 lastIndex = re.lastIndex;\r\n        //             }\r\n        //             template += str.substring(lastIndex);\r\n        //             //console.log(lastIndex+\", \"+re.lastIndex+\" \"+str.substring(lastIndex))\r\n        //             e.popup.setContent(template);\r\n        //         })\r\n        //     },\r\n        const   layersByID = nsGmx.gmxMap.layersByID,\r\n                setLayerClickHandler = function (layer) {\r\n                layer.removeEventListener('click')\r\n                layer.addEventListener('click', function (e) {\r\n                    //console.log(e)\r\n                    if (e.gmx && e.gmx.properties.hasOwnProperty(\"imo\"))\r\n                        viewFactory.infoDialogView.show(e.gmx.properties)\r\n                })\r\n                },\r\n                forLayers = function (layer) {\r\n                    if (layer) {\r\n                        //setLocaleDate(layer)\r\n                        setLayerClickHandler(layer)\r\n                    }\r\n                }\r\n\r\n        for (var key in params) {\r\n            let layersId = params[key].split(\",\").map(function (id) {\r\n                return id.replace(/\\s/, \"\");\r\n            });\r\n            for (var i = 0; i < layersId.length; ++i) {\r\n//console.log(layersId[i])\r\n                forLayers(layersByID[layersId[i]]);\r\n            }\r\n        }\r\n        \r\n        const aisPluginPanel = new AisPluginPanel(viewFactory);\r\n        aisPluginPanel.menuId = menuId;\r\n\r\n        if (NOSIDEBAR) {            \r\n            let lmap = nsGmx.leafletMap,    \r\n                iconOpt_mf = {\r\n                id: menuId, //toolbarIconId,\r\n                className: \"VesselSearchTool\",\r\n                togglable: true,\r\n                title: _gtxt('AISSearch2.caption')\r\n            };\r\n            if (toolbarIconId)\r\n                iconOpt_mf.id = toolbarIconId;\r\n            else\r\n                iconOpt_mf.text = _gtxt('AISSearch2.capShort');            \r\n            let icon_mf = L.control.gmxIcon(iconOpt_mf).on('statechange', function (ev) {\r\n                if (ev.target.options.isActive) {\r\n                    aisPluginPanel.show();\r\n                    $('.ais_view .instruments').width(340);\r\n                    $('.ais_tab div').css('font-size', '12px');\r\n                }\r\n                else {\r\n                    aisPluginPanel.hide();\r\n                }\r\n            });\r\n            lmap.addControl(icon_mf);\r\n        }\r\n        else {\r\n            let sidebar = SIDEBAR2 ? window.iconSidebarWidget : window.sidebarControl;\r\n            aisPluginPanel.sidebarPane =  sidebar.setPane(\r\n                    menuId, { createTab: window.createTabFunction({\r\n                            icon: menuId,\r\n                            active: \"ais_sidebar-icon-active\",\r\n                            inactive: \"ais_sidebar-icon\",\r\n                            hint: _gtxt('AISSearch2.caption')\r\n                        })\r\n                    }\r\n                )\r\n            sidebar.on('opened', function (e) {\r\n                if (e.id == menuId)\r\n                    aisPluginPanel.show();\r\n            })\r\n        }\r\n\r\n        if (location.search.search(/x=[^y=]+y=/i) != -1) {\r\n            var a = location.search.toLowerCase().substr(1).split('&'),\r\n                x = a.filter(function (c) { return !c.indexOf(\"x=\") })[0].substr(2),\r\n                y = a.filter(function (c) { return !c.indexOf(\"y=\") })[0].substr(2)\r\n            highlight.vessel = null;\r\n            highlight.setLatLng([y, x]).addTo(nsGmx.leafletMap);    \r\n            nsGmx.leafletMap.fitBounds([\r\n                [y, x],\r\n                [y, x]\r\n            ], {\r\n                    maxZoom: 9,//config.user.searchZoom,\r\n                    animate: false\r\n            }) \r\n        }\r\n    }\r\n};\r\n\r\ngmxCore.addModule(pluginName, publicInterface, {\r\n    css: cssTable + '.css'\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src1/entry.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src1/all.css\n// module id = 1\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src1/Views/AisView.css\n// module id = 3\n// module chunks = 0","\r\n    _translationsHash.addtext('rus', {\r\n        'AISSearch2.title': 'Поиск судов',\r\n        'AISSearch2.title1': 'Найдено судов',\r\n        'AISSearch2.title2': '<b>Данных не найдено!</b>',\r\n        'AISSearch2.error': '<b>Ошибка при получении данных!</b>',\r\n        'AISSearch2.iconTitle': 'Поиск судов по экрану',\r\n        'AISSearch2.placeholder_0': 'Поиск по адресам, координатам',\r\n        'AISSearch2.placeholder_1': 'Поиск судна по названию / MMSI',\r\n        // 'AISSearch2.placeholder_1': 'Поиск судна по названию / MMSI. Поиск по адресам, координатам, кадастровым номерам'\r\n        'AISSearch2.myFleetDialog': 'Мой флот',\r\n        'AISSearch2.vesselName': 'название',\r\n        'AISSearch2.vesselAdd': 'добавить',\r\n        'AISSearch2.vesselRemove': 'удалить',\r\n        'AISSearch2.myFleetMembers': 'Состав',\r\n        'AISSearch2.myFleetMember': 'мой флот',\r\n        'AISSearch2.info': 'информация',\r\n        'AISSearch2.found':'Найдено: ',\r\n        'AISSearch2.filter':'Введите название или mmsi или imo судна',\r\n        'AISSearch2.filterName':'Введите название судна',\r\n        'AISSearch2.screen':'По экрану',\r\n        'AISSearch2.database':'По базе данных',\r\n        'AISSearch2.capShort': 'Поиск судов',\r\n        'AISSearch2.caption': 'Поиск судов и \"Мой флот\"',\r\n        'AISSearch2.refresh': 'обновить',\r\n        'AISSearch2.refreshing': 'обновляется',\r\n        'AISSearch2.nomyfleet': 'Сервис не доступен',\r\n        'AISSearch2.auth': 'Требуется авторизация',\r\n        'AISSearch2.vessel_name': 'Название',\r\n        'AISSearch2.mmsi': 'MMSI',\r\n        'AISSearch2.imo': 'IMO',\r\n        'AISSearch2.flag_country': 'Страна',\r\n        'AISSearch2.vessel_type': 'Тип судна',\r\n        'AISSearch2.draught': 'Осадка',\r\n        'AISSearch2.destination': 'Назначение',\r\n        'AISSearch2.nav_status': 'Статус',\r\n        'AISSearch2.last_sig': 'Последний сигнал',\r\n        'AISSearch2.show_track': 'трек за сутки',\r\n        'AISSearch2.hide_track': 'скрыть трек',\r\n\t\t'AISSearch2.source': 'Источник данных',\r\n\t\t'AISSearch2.sais': 'спутниковый AIS',\r\n\t\t'AISSearch2.tais': 'береговой AIS',\r\n\t\t'AISSearch2.lon': 'Долгота',\r\n\t\t'AISSearch2.lat': 'Широта',\r\n\t\t'AISSearch2.historyTab': 'История',\r\n        'AISSearch2.voyageInfo': 'Параметры движения',\r\n        'AISSearch2.DbSearchTab':'БАЗА ДАННЫХ',\r\n        'AISSearch2.ScreenSearchTab':'СУДА НА ЭКРАНЕ',\r\n        'AISSearch2.MyFleetTab':'МОЙ ФЛОТ'\r\n    });\r\n    _translationsHash.addtext('eng', {\r\n        'AISSearch2.title': 'Searching vessels',\r\n        'AISSearch2.title1': 'Vessels found',\r\n        'AISSearch2.title2': '<b>Vessels not found!</b>',\r\n        'AISSearch2.error': '<b>Vessels not found!</b>',\r\n        'AISSearch2.iconTitle': 'Search vessels within the view area',\r\n        'AISSearch2.placeholder_0': 'Search for addresses, coordinates',\r\n        'AISSearch2.placeholder_1': 'Search by vessel name / MMSI',\r\n        // 'AISSearch2.placeholder_1' : 'Search by vessel name / MMSI. Search by addresses, coordinates, cadastre number'\r\n        'AISSearch2.myFleetDialog': 'My fleet',\r\n        'AISSearch2.vesselName': 'name',\r\n        'AISSearch2.vesselAdd': 'add',\r\n        'AISSearch2.vesselRemove': 'remove',\r\n        'AISSearch2.myFleetMembers': 'Members',\r\n        'AISSearch2.myFleetMember': 'my fleet',\r\n        'AISSearch2.info': 'info',\r\n        'AISSearch2.found':'Found ',\r\n        'AISSearch2.filter':'Insert vessel name or mmsi or imo',\r\n        'AISSearch2.filterName':'Insert vessel name',\r\n        'AISSearch2.screen':'On screen',\r\n        'AISSearch2.database':'In database',\r\n        'AISSearch2.capShort': 'Vessel Search',\r\n        'AISSearch2.caption': 'Vessel Search & My Fleet',\r\n        'AISSearch2.refresh': 'refresh',\r\n        'AISSearch2.refreshing': 'refreshing',\r\n        'AISSearch2.nomyfleet': 'Service is unavailable',\r\n        'AISSearch2.auth': 'Authorization required',\r\n        'AISSearch2.vessel_name': 'Name',\r\n        'AISSearch2.mmsi': 'MMSI',\r\n        'AISSearch2.imo': 'IMO',\r\n        'AISSearch2.flag_country': 'Flag',\r\n        'AISSearch2.vessel_type': 'Vessel type',\r\n        'AISSearch2.draught': 'Draught',\r\n        'AISSearch2.destination': 'Destination',\r\n        'AISSearch2.nav_status': 'Navigation status',\r\n        'AISSearch2.last_sig': 'Last signal',\r\n        'AISSearch2.show_track': 'show track',\r\n        'AISSearch2.hide_track': 'hide track',\r\n\t\t'AISSearch2.source': 'Source',\r\n\t\t'AISSearch2.sais': 'S-AIS',\r\n\t\t'AISSearch2.tais': 'T-AIS',\r\n\t\t'AISSearch2.lon': 'Longitude',\r\n\t\t'AISSearch2.lat': 'Latitude',\r\n\t\t'AISSearch2.historyTab': 'History',\r\n\t\t'AISSearch2.voyageInfo': 'Voyage info',\r\n        'AISSearch2.DbSearchTab':'DATA BASE',\r\n        'AISSearch2.ScreenSearchTab':'VESSELS ON SCREEN',\r\n        'AISSearch2.MyFleetTab':'MY FLEET'\r\n    });\r\n\n\n\n// WEBPACK FOOTER //\n// ./src1/locale.js","let NOSIDEBAR = false,\r\n    PRODUCTION = false,\r\n    SIDEBAR2 = false;\r\nif (has('NOSIDEBAR'))\r\n    NOSIDEBAR = true;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\n\r\n\r\nmodule.exports = function (viewFactory) {\r\n    let _leftMenuBlock,\r\n        _canvas = _div(null),\r\n        _activeView,\r\n        _views = viewFactory.create(),\r\n        // _aisSearchView,\r\n        // _myFleetMembersView,\r\n        // _historyView,\r\n        //_gifLoader = '<img src=\"img/progress.gif\">',\r\n        _isReady = false,\r\n        _createTabs = function () {\r\n            let tabsTemplate = '<table class=\"ais_tabs\" border=0><tr>' +\r\n                '<td class=\"ais_tab dbsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.DbSearchTab\"}}</div>' +\r\n                '</td><td class=\"ais_tab scrsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.ScreenSearchTab\"}}</div>' +\r\n                '</td><td class=\"ais_tab myfleet_tab unselectable\" unselectable=\"on\">' + // ACTIVE\r\n                '<div>{{i \"AISSearch2.MyFleetTab\"}}</div>' +\r\n                '</td></tr></table>'\r\n\r\n            if (NOSIDEBAR)\r\n                $(_leftMenuBlock.workCanvas).append(_canvas);\r\n            else\r\n                $(this.sidebarPane).append(_canvas);\r\n\r\n            $(_canvas).append(Handlebars.compile(tabsTemplate));\r\n            $(_canvas).append(_views.map(v => v.frame));\r\n    \r\n            let tabs = $('.ais_tab', _canvas),\r\n                _this = this;           \r\n            _views.forEach((v,i) =>{\r\n                v.tab = tabs.eq(i);\r\n                v.resize(true);\r\n            }); \r\n            tabs.on('click', function () {\r\n                if (!$(this).is('.active')) {\r\n                    let target = this;\r\n                    tabs.each(function (i, tab) {\r\n                        if (!$(tab).is('.active') && target == tab) {\r\n                            $(tab).addClass('active');\r\n                            _views[i].show();\r\n                            _activeView = _views[i];\r\n                        }\r\n                        else {\r\n                            $(tab).removeClass('active');\r\n                            _views[i].hide();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            // Show the first tab\r\n            tabs.eq(0).removeClass('active').click();\r\n\r\n            if (NOSIDEBAR) {\r\n                _returnInstance.hide = function () {\r\n                    $(_leftMenuBlock.parentWorkCanvas).hide();\r\n                    nsGmx.leafletMap.removeLayer(highlight);\r\n                }\r\n\r\n                $(_leftMenuBlock.parentWorkCanvas)\r\n                    .attr('class', 'left_aispanel')\r\n                    .insertAfter('.layers-before');\r\n                var blockItem = _leftMenuBlock.leftPanelItem,\r\n                    blockTitle = $('.leftmenu-path', blockItem.panelCanvas);\r\n                var toggleTitle = function () {\r\n                    if (blockItem.isCollapsed())\r\n                        blockTitle.show();\r\n                    else\r\n                        blockTitle.hide();\r\n                }\r\n                $(blockItem).on('changeVisibility', toggleTitle);\r\n                toggleTitle();\r\n            }\r\n\r\n            // All has been done at first time\r\n            _isReady = true;\r\n        },\r\n\r\n    _returnInstance = {\r\n        show: function () {\r\n            let lmap = nsGmx.leafletMap;\r\n            if (NOSIDEBAR && !_leftMenuBlock)\r\n                _leftMenuBlock = new leftMenu();\r\n\r\n            if ((NOSIDEBAR && (!_leftMenuBlock.createWorkCanvas(\"aispanel\",\r\n                function () { lmap.gmxControlIconManager.get(this.menuId)._iconClick() },\r\n                { path: [_gtxt('AISSearch2.caption')] })\r\n            )) || (!_isReady)) // SIDEBAR\r\n            {\r\n                _createTabs.call(this);\r\n            }\r\n            else{\r\n                if (NOSIDEBAR){\r\n                    $(_leftMenuBlock.parentWorkCanvas)\r\n                    .insertAfter('.layers-before');\r\n                }            \r\n                _activeView && _activeView.show();\r\n            }\r\n        }\r\n    };\r\n    return _returnInstance;\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src1/aisPluginPanel.js","const ScreenSearchView = require('./Views/ScreenSearchView'),\r\n    ScreenSearchModel = require('./Models/ScreenSearchModel'),\r\n    MyFleetView = require('./Views/MyFleetView'),\r\n    MyFleetModel = require('./Models/MyFleetModel'),\r\n    DbSearchView = require('./Views/DbSearchView'),\r\n    DbSearchModel = require('./Models/DbSearchModel'),\r\n    InfoDialogView = require('./Views/InfoDialogView'),\r\n    Searcher = require('./Search/Searcher'),\r\n    Toolbox = require('./Toolbox.js');\r\n\r\nmodule.exports = function (options) {\r\n    const _tools = new Toolbox(options),\r\n        //_layersByID = nsGmx.gmxMap.layersByID,\r\n        _searcher = new Searcher(options),\r\n        _mfm = new MyFleetModel({ aisLayerSearcher: _searcher, myFleetLayers: options.myFleetLayers }),\r\n        _ssm = new ScreenSearchModel({ aisLayerSearcher: _searcher, myFleetModel: _mfm }),\r\n        _dbsm = new DbSearchModel(_searcher),\r\n        _dbsv = new DbSearchView({model:_dbsm, highlight:options.highlight, tools:_tools}),\r\n        _ssv = new ScreenSearchView(_ssm),\r\n        _mfv = new MyFleetView(_mfm),\r\n        _idv = new InfoDialogView({\r\n            //aisLayer: _layersByID[options.aisLayerID],\r\n            //tracksLayer: _layersByID[options.tracksLayerID],\r\n            tools:_tools,\r\n            aisLayerSearcher: _searcher, \r\n            modulePath: options.modulePath, \r\n            //aisPluginPanel: aisPluginPanel,\r\n            aisView: _dbsv, \r\n            myFleetMembersView: _mfv\r\n        });\r\n        _ssv.infoDialogView = _idv;\r\n        _mfv.infoDialogView = _idv;\r\n    return {\r\n        get infoDialogView(){\r\n            return _idv;\r\n        },\r\n        create: function () {\r\n            return [ _dbsv, _ssv, _mfv ];\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src1/ViewsFactory.js","const BaseView = require('./BaseView.js');\r\nconst ScreenSearchView = function (model) {\r\n    BaseView.apply(this, arguments);\r\n    this.topOffset = 180;\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view search_view\">' +\r\n\r\n        '<table border=0 class=\"instruments\">' +\r\n        //'<tr><td colspan=\"2\"><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filter\"}}\"/><i class=\"icon-flclose clicable\"></div></td></tr>'+\r\n        '<tr><td><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filterName\"}}\"/>' +\r\n        '<div><img class=\"search clicable\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        '<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\">' +\r\n        '</div></div>' +\r\n        '<div>&nbsp;</div>'+\r\n        '</td></tr>' + \r\n        '</table>' +\r\n\r\n        '<table class=\"results\">'+\r\n        '<tr><td class=\"count\"></td>' +\r\n        '<td><div class=\"refresh clicable\" title=\"{{i \"AISSearch2.refresh\"}}\"><div>' + this.gifLoader + '</div></div></td></tr>' +\r\n        '</table>'+\r\n\r\n        '<div class=\"ais_vessels\">'+\r\n        '<div class=\"ais_vessel\">' +\r\n        '<table border=0><tr><td><div class=\"position\">NO VESSELS</div><div>mmsi: 0 imo: 0</div></td>' +\r\n        '<td><i class=\"icon-ship\" vessel=\"\" title=\"\"></i></td>' +\r\n        '<td><span class=\"date\"></span></td>'+\r\n        '<td><div class=\"info\" vessel=\"aisjson this\" title=\"i AISSearch2.info\">' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n        '</div></td></tr></table>' +\r\n        '</div>' +       \r\n        '</div>' +\r\n\r\n        '</div>'\r\n    )());\r\n    this.container = this.frame.find('.ais_vessels');\r\n    this.tableTemplate = '{{#each vessels}}' +\r\n        '<div class=\"ais_vessel\">' +\r\n        '<table border=0><tr><td><div class=\"position\">{{vessel_name}}</div><div>mmsi: {{mmsi}} imo: {{imo}}</div></td>' +\r\n        '<td><i class=\"icon-ship\" vessel=\"{{aisinfoid this}}\" style=\"{{mf_member}}\" title=\"{{i \"AISSearch2.myFleetMember\"}}\"></i></td>' +\r\n        '<td><span class=\"date\">{{ts_pos_utc}}</span></td>'+\r\n        '<td><div class=\"info\" vessel=\"{{aisjson this}}\" title=\"{{i \"AISSearch2.info\"}}\">' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n        '</div></td></tr></table>' +\r\n        '</div>' +\r\n        '{{/each}}' +\r\n        '{{#each msg}}<div class=\"msg\">{{txt}}</div>{{/each}}';\r\n\r\n    let cleanFilter = this.frame.find('.remove'),\r\n        filterReady = this.frame.find('.search'),\r\n        filterInput = this.frame.find('input'),\r\n        delay,\r\n        doFilter = function(){\r\n            this.model.setFilter();             \r\n            this.repaint();\r\n//console.log(\"doFilter\")\r\n        };\r\n        cleanFilter.click(function(e){\r\n            if (this.model.filterString === '')\r\n                return;\r\n            filterInput.val('');\r\n            this.model.filterString = '';  \r\n            clearTimeout(delay)\r\n            doFilter.call(this);\r\n            //nsGmx.leafletMap.removeLayer(highlight);\r\n        }.bind(this))\r\n        filterInput.keyup(function(e){            \r\n            let input = filterInput.val() || \"\";\r\n            input = input.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n            if (input===\"\"){\r\n                filterReady.show();\r\n                cleanFilter.hide();\r\n            }\r\n            else{\r\n                cleanFilter.show();\r\n                filterReady.hide();\r\n            }\r\n\r\n            if (input==this.model.filterString && e.keyCode!=13)\r\n                return;\r\n            this.model.filterString = input; \r\n            if (e.keyCode==13)\r\n                this.model.filterString += '\\r' ;  \r\n            clearTimeout(delay)\r\n            delay = setTimeout((() => { doFilter.call(this) }).bind(this), 500);\r\n            //nsGmx.leafletMap.removeLayer(highlight);\r\n        }.bind(this))\r\n    \r\n    let needUpdate = function(){\r\n        this.model.isDirty = true;\r\n        if (this.container.is(':visible')) {\r\n \r\n            clearTimeout(delay)\r\n            delay = setTimeout((() => { this.model.update() }).bind(this), 300);  \r\n        }\r\n    };\r\n    nsGmx.leafletMap.on('moveend', needUpdate.bind(this));\r\n    nsGmx.widgets.commonCalendar.getDateInterval().on('change', needUpdate.bind(this));\r\n};\r\n\r\nScreenSearchView.prototype = Object.create(BaseView.prototype);\r\n\r\nlet _clean = function () {\r\n    this.frame.find('.count').text(_gtxt('AISSearch2.found') + 0); \r\n    // let scrollCont = this.container.find('.mCSB_container')\r\n    // if (scrollCont[0])\r\n    //     scrollCont.empty();\r\n    // else\r\n    //     this.container.empty();\r\n};\r\n\r\nScreenSearchView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div');\r\n    if (state)\r\n        progress.show();\r\n    else\r\n        progress.hide();\r\n};\r\n\r\nScreenSearchView.prototype.repaint = function () {\r\n    _clean.call(this);\r\n    this.frame.find('.count').text(_gtxt('AISSearch2.found')+this.model.data.vessels.length);   \r\n    BaseView.prototype.repaint.apply(this, arguments);\r\n};\r\n\r\nScreenSearchView.prototype.show = function () {\r\n    BaseView.prototype.show.apply(this, arguments);\r\n    this.frame.find('.filter input').focus();\r\n};\r\n\r\n/*\r\nScreenSearchView.prototype.hide = function () {\r\n//console.log('hide ScreenSearchView')\r\n    BaseView.prototype.hide.apply(this, arguments);\r\n};\r\n*/\r\nmodule.exports = ScreenSearchView;\n\n\n// WEBPACK FOOTER //\n// ./src1/Views/ScreenSearchView.js","let NOSIDEBAR = false,\r\n    PRODUCTION = false,\r\n    SIDEBAR2 = false;\r\nif (has('NOSIDEBAR'))\r\n    NOSIDEBAR = true;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\n\r\nlet _calcHeight = function () {\r\n    let template = this.frame.find('.ais_vessel')[0] || this.frame.find('.ais_positions_date')[0],\r\n        h = template.getBoundingClientRect().height\r\n    if (NOSIDEBAR)\r\n        return h * 5;\r\n    else {\r\n        let H = $('.gmx-sidebar-pane').height() - this.topOffset;\r\n// console.log(template.getBoundingClientRect())\r\n// console.log(H)\r\n        return (H - H%h);\r\n    }\r\n};\r\n\r\nconst BaseView = function (model) {\r\n    model.view = this;\r\n    this.model = model;\r\n    this.gifLoader = '<img src=\"img/progress.gif\">';\r\n};\r\n\r\nlet _clean = function(){ \r\n    this.container.find('.info').off('click');\r\n    this.container.find('.position', ).off('click');   \r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n};\r\n\r\nBaseView.prototype = function () {\r\n    return {\r\n        get isActive(){\r\n            return this.frame.is(\":visible\");\r\n        },\r\n        resize: function (clean) {\r\n            this.container.height(_calcHeight.call(this));\r\n            if (clean)\r\n                this.container.empty()\r\n/*\r\n            // if (this.bindControlEvents)\r\n            //     this.bindControlEvents();\r\n            if (NOSIDEBAR) {\r\n                if ($('.icon-down-dir', this.frame)[0] && $('.icon-down-dir', this.frame).height() == 34)\r\n                    $('.icon-down-dir', this.frame).css({ position: 'relative', top: '2px' })\r\n            }\r\n            else {\r\n                if (SIDEBAR2) {\r\n                    if ($('.icon-down-dir', this.frame)[0] && $('.icon-down-dir', this.frame).height() == 34)\r\n                        $('.icon-down-dir', this.frame).css({ position: 'relative', top: '2px' })\r\n                    $('.ais_tab').css({ 'border-top': 'none' })\r\n                }\r\n                else\r\n                    $('.icon-down-dir', this.frame).css({ position: 'relative', top: '1px' })\r\n            }\r\n            */\r\n        },\r\n        repaint: function(){\r\n            _clean.call(this);\r\n            if (!this.model.data)\r\n                return;\r\n            let scrollCont = this.container.find('.mCSB_container'),\r\n            content = $(Handlebars.compile(this.tableTemplate)(this.model.data));\r\n            if (!scrollCont[0]) {\r\n                this.container.append(content).mCustomScrollbar();\r\n            }\r\n            else {\r\n                $(scrollCont).append(content);\r\n            }\r\n\r\n            var _this = this;\r\n            this.container.find('.info', ).on('click', function (e) {\r\n                let target = $(this),\r\n                    vessel = JSON.parse(target.attr('vessel'))\r\n//console.log(vessel)\r\n                _this.infoDialogView && _this.infoDialogView.show(vessel, (v) => {\r\n//console.log(v)\r\n                    vessel.xmin = vessel.xmax = v.longitude\r\n                    vessel.ymin = vessel.ymax = v.latitude\r\n                    if (vessel.hasOwnProperty('ts_pos_utc')) {\r\n                         vessel.ts_pos_utc = v.ts_pos_utc;\r\n                         vessel.ts_pos_org = v.ts_pos_org;\r\n                         v.dt_pos_utc && $(this).closest('tr').find('.date').html(v.dt_pos_utc);\r\n                    }\r\n                    target.attr('vessel', JSON.stringify(vessel))\r\n                });\r\n                e.stopPropagation();\r\n            });\r\n            this.container.find('.ais_vessel').on('click', function () {\r\n//console.log(JSON.parse($(this).find('.info').attr('vessel')))\r\n                _this.infoDialogView.showPosition(JSON.parse($(this).find('.info').attr('vessel')))\r\n            });      \r\n        },\r\n        show: function () {\r\n            this.frame.show();\r\n            this.model.update();\r\n        },\r\n        hide: function () {\r\n            this.frame.hide();\r\n        }\r\n    }\r\n}();\r\n\r\nmodule.exports = BaseView;\n\n\n// WEBPACK FOOTER //\n// ./src1/Views/BaseView.js","module.exports = function ({aisLayerSearcher, myFleetModel}) {\r\n    let _actualUpdate;\r\n    return {\r\n        filterString: \"\",\r\n        isDirty: true,\r\n        load: function (actualUpdate) {\r\n            if (!this.isDirty) {\r\n                return Promise.resolve();\r\n            }\r\n            let _this = this;\r\n            return Promise.all([new Promise(function (resolve, reject) {\r\n                aisLayerSearcher.searchScreen({\r\n                    dateInterval: nsGmx.widgets.commonCalendar.getDateInterval(),\r\n                    border: true,\r\n                    group: true\r\n                }, function (json) {\r\n                    //console.log(json)\r\n                    if (json.Status.toLowerCase() == \"ok\") {\r\n                        _this.dataSrc = {\r\n                            vessels: json.Result.values.map(function (v) {\r\n                                let d = nsGmx.widgets.commonCalendar.getDateInterval().get('dateBegin');\r\n                                return {\r\n                                    vessel_name: v[0], mmsi: v[1], imo: v[2], mf_member: 'visibility:hidden', \r\n                                    ts_pos_utc: aisLayerSearcher.formatDate(d), ts_pos_org: Math.floor(d.getTime()/1000),\r\n                                    xmin: v[4], xmax: v[5], ymin: v[6], ymax: v[7], maxid: v[3]\r\n                                }\r\n                            })\r\n                        };\r\n                        if (_actualUpdate == actualUpdate) {\r\n                            //console.log(\"ALL CLEAN\")\r\n                            //console.log(\"1>\"+new Date(_this._actualUpdate))\r\n                            //console.log(\"2>\"+new Date(actualUpdate))\r\n                            _this.isDirty = false;\r\n                        }\r\n                        resolve();\r\n                    }\r\n                    else {\r\n                        reject(json);\r\n                    }\r\n                });\r\n            })\r\n                ,myFleetModel.load()\r\n            ]);\r\n        },\r\n        setFilter: function () {\r\n            this.filterString = this.filterString.replace(/\\r+$/, \"\");\r\n            if (this.dataSrc)\r\n                if (this.filterString != \"\") {\r\n                    this.data = {\r\n                        vessels: this.dataSrc.vessels.filter(((v)=>{\r\n                            return v.vessel_name.search(new RegExp(\"\\\\b\" + this.filterString, \"ig\")) != -1;\r\n                        }).bind(this))\r\n                    };\r\n                }\r\n                else {\r\n                    this.data = { vessels: this.dataSrc.vessels.map((v)=>v) };\r\n                }\r\n        },\r\n        update: function () {\r\n\r\n            if (!this.isDirty)\r\n                return;\r\n            _actualUpdate = new Date().getTime();\r\n            let _this = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);\r\n            //this.filterString&&console.log(this.filterString+\" \"+this.filterString.search(/\\r$/))\r\n            //this.filterString&&console.log(this.filterString.replace(/^\\s+/, \"\").replace(/\\s+\\r*$/, \"\")!=\"\")            \r\n\r\n            this.load(actualUpdate).then(function () {\r\n                //console.log(\"LOADED \"+(new Date().getTime()-_this._actualUpdate)+\"ms\")\r\n                //console.log(\"3>\"+new Date(_this._actualUpdate))\r\n                //console.log(\"4>\"+new Date(actualUpdate))\r\n                if (_actualUpdate == actualUpdate) {\r\n                    _this.setFilter();\r\n                    if (_this.data)\r\n                        myFleetModel.markMembers(_this.data.vessels);\r\n                    _this.view.inProgress(false);\r\n                    _this.view.repaint();\r\n                }\r\n            }, function (json) {\r\n                _this.dataSrc = null;\r\n                console.log(json)\r\n                if (json.Status.toLowerCase() == \"auth\" ||\r\n                    (json.ErrorInfo && json.ErrorInfo.some && json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })))\r\n                    _this.data = { msg: [{ txt: _gtxt(\"AISSearch2.auth\") }], vessels: [] };\r\n                else {\r\n                    //_this.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                    console.log(json);\r\n                }\r\n                _this.view.inProgress(false);\r\n                _this.view.repaint();\r\n            });\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src1/Models/ScreenSearchModel.js","const BaseView = require('./BaseView.js');\r\nconst MyFleetView = function (model){\r\n    BaseView.apply(this, arguments);\r\n    this.topOffset = 80;\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view myfleet_view\">' +\r\n    '<table class=\"results\">'+\r\n    '<tr><td class=\"count\"></td>' +\r\n    '<td><div class=\"refresh clicable\" title=\"{{i \"AISSearch2.refresh\"}}\"><div>' + this.gifLoader + '</div></div></td></tr>' +\r\n    '</table>'+\r\n\r\n    '<div class=\"ais_vessels\">'+\r\n    '<div class=\"ais_vessel\">' +\r\n    '<table border=0><tr><td><div class=\"position\">vessel_name</div><div>mmsi: mmsi imo: imo</div></td>' +\r\n    '<td><i class=\"icon-ship\" vessel=\"aisinfoid this\" style=\"visibility:hidden\" title=\"AISSearch2\"></i></td>' +\r\n    '<td><span class=\"date\">ts_pos_utc</span></td>'+\r\n    '<td><div class=\"info\" vessel=\"aisjson this\" title=\"i AISSearch2.info\">' +\r\n    '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n    '<div></td></tr></table>' +\r\n    '</div>' +      \r\n    '</div>' +\r\n    '</div>')());\r\n    this.container = this.frame.find('.ais_vessels');    \r\n    this.tableTemplate = '{{#each vessels}}' +\r\n    '<div class=\"ais_vessel\">' +\r\n    '<table border=0><tr><td><div class=\"position\">{{vessel_name}}</div><div>mmsi: {{mmsi}} imo: {{imo}}</div></td>' +\r\n    '<td><i class=\"icon-ship\" vessel=\"{{aisinfoid this}}\" style=\"visibility:hidden\" title=\"{{i \"AISSearch2.myFleetMember\"}}\"></i></td>' +\r\n    '<td><span class=\"date\">{{dt_pos_utc}}</span></td>'+\r\n    '<td><div class=\"info\" vessel=\"{{aisjson this}}\" title=\"{{i \"AISSearch2.info\"}}\">' +\r\n    '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n    '<div></td></tr></table>' +\r\n    '</div>' +\r\n    '{{/each}}' +\r\n    '{{#each msg}}<div class=\"msg\">{{txt}}</div>{{/each}}';\r\n};\r\n\r\nMyFleetView.prototype = Object.create(BaseView.prototype);\r\n\r\n// let _clean = function(){ \r\n//     //this.frame.find('.count').text(_gtxt('AISSearch2.found') + 0); \r\n//     let scrollCont = this.container.find('.mCSB_container')\r\n//     if (scrollCont[0])\r\n//         scrollCont.empty();\r\n//     else\r\n//         this.container.empty();\r\n// };\r\n\r\nMyFleetView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div');\r\n    if (state)\r\n        progress.show();\r\n    else\r\n        progress.hide();\r\n};\r\n\r\n/*\r\nMyFleetView.prototype.repaint = function () {\r\n    _clean.call(this);  \r\n    BaseView.prototype.repaint.apply(this, arguments);\r\n};\r\n\r\nMyFleetView.prototype.show = function (){ \r\n//console.log('show MyFleetView')\r\n    BaseView.prototype.show.apply(this, arguments);\r\n};\r\nMyFleetView.prototype.hide = function (){   \r\n//console.log('hide MyFleetView')\r\n    BaseView.prototype.hide.apply(this, arguments);\r\n};\r\n*/\r\nmodule.exports = MyFleetView;\n\n\n// WEBPACK FOOTER //\n// ./src1/Views/MyFleetView.js","const Polyfill = require('../Polyfill');\r\nmodule.exports = function ({aisLayerSearcher, myFleetLayers}) {\r\n    let _actualUpdate,\r\n    _parseFilter = function(filter){\r\n        var vessels = [];\r\n        var attributes = filter.toLowerCase().replace(/and \\[ts_pos_utc\\].+$/, \"\").split(\"or\");\r\n//console.log(attributes);\r\n        var myRe = /\\[*([^\\[\\]=]+)\\]*=([^ \\)]+)\\)? *\\)?( |$)/ig;\r\n        var myArray;\r\n        for (var i=0; i<attributes.length; ++i){\r\n            var vessel = null;\r\n            while ((myArray = myRe.exec(attributes[i])) !== null) {\r\n                if (!vessel) vessel = {};\r\n                vessel[myArray[1]] = myArray[2];\r\n            }\r\n            if (vessel)\r\n                vessels.push(vessel);\r\n        }  \r\n//console.log(vessels);   \r\n        return vessels;  \r\n    };\r\n    return {\r\n        isDirty: true,\t\t\r\n\t\tfindIndex: function(vessel){\r\n\t\t\tif (!this.data)\r\n\t\t\t\treturn -1;\r\n\t\t\treturn Polyfill.findIndex(this.data.vessels, function(v){\r\n                return v.mmsi==vessel.mmsi && v.imo==vessel.imo;\r\n            })\r\n\t\t},\r\n        load: function (actualUpdate) {\r\n            var _this = this;\r\n\r\n            if (myFleetLayers.length==0)\r\n                this.data = {msg:[{txt:_gtxt(\"AISSearch2.nomyfleet\")}]};\r\n\r\n            if (myFleetLayers.length==0 || !this.isDirty)\r\n                return Promise.resolve();\r\n\r\n            this.layers = [];\r\n            var errors = [],\r\n                promises = myFleetLayers.map(function(lid){\r\n                    return new Promise(function(resolve, reject) {\r\n//console.log(lid)\r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl + \"Layer/GetLayerInfo.ashx?NeedAttrValues=false&LayerName=\" +\r\n                        lid, function(response){   \r\n//console.log(response);                         \r\n                            if (response.Status.toLowerCase()==\"ok\")\r\n                                _this.layers.push({layerId:lid, parentLayerId:response.Result.ParentLayer, filter:response.Result.Filter});\r\n                            else\r\n                                errors.push(response);\r\n                            resolve(response); \r\n                        }); \r\n                    })})\r\n                \r\n            return Promise.all(promises)\r\n            .then(function() { \r\n//console.log(_this.layers)                                    \r\n                            if (_this.layers.length>0){\r\n                                var layer = Polyfill.find(_this.layers, \r\n                                    function(l){\r\n                                        return l.parentLayerId!='13E2051DFEE04EEF997DC5733BD69A15' && l.filter!=\"([mmsi]=-1000)\";\r\n                                    })// NOT TRACKS\r\n//console.log(layer)      \r\n                                if (!layer)\r\n                                    return Promise.resolve({Status:\"ok\", Result:{values:[]}});\r\n//console.log(layer.filter)                                    \r\n                                var vessels = _parseFilter(layer.filter);\r\n                                return new Promise(function(resolve, reject) {\r\n                                    aisLayerSearcher.searchNames(\r\n                                        vessels,\r\n                                        //vessels.map(function(v){return v.mmsi}), \r\n                                        //vessels.map(function(v){return v.imo}),\r\n                                        function(response){ \r\n                                            resolve(response);\r\n                                        });\r\n                                });\r\n                            }\r\n                            else{\r\n                                return Promise.resolve({Status:\"error\", ErrorInfo:errors});\r\n                            }\r\n                        }\r\n            )\r\n            .then(function(response) {  \r\n//console.log(response)  \r\n//console.log(\"LOAD MY FLEET FINISH\")               \r\n                        if (response.Status.toLowerCase()==\"ok\"){                          \r\n                            _this.data = {vessels:response.Result.values.reduce(function(p,c){\r\n\t\t\t\t\t\t\t\tvar mmsi = response.Result.fields.indexOf(\"mmsi\"), \r\n\t\t\t\t\t\t\t\tvessel_name = response.Result.fields.indexOf(\"vessel_name\"), \r\n\t\t\t\t\t\t\t\tts_pos_utc = response.Result.fields.indexOf(\"ts_pos_utc\"),\r\n\t\t\t\t\t\t\t\timo = response.Result.fields.indexOf(\"imo\"),\r\n\t\t\t\t\t\t\t\tlat = response.Result.fields.indexOf(\"longitude\"),\r\n\t\t\t\t\t\t\t\tlon = response.Result.fields.indexOf(\"latitude\");\r\n                                if (!p.some(function(v){return v.mmsi==c[mmsi]})) {\r\n                                    var d = new Date(c[ts_pos_utc]*1000);\r\n                                    p.push({vessel_name:c[vessel_name], mmsi:c[mmsi], imo:c[imo], \r\n                                    ts_pos_utc: aisLayerSearcher.formatDateTime(d), dt_pos_utc: aisLayerSearcher.formatDate(d),\r\n                                    ts_pos_org:c[ts_pos_utc],\r\n                                    xmin:c[lat], xmax:c[lat], ymin:c[lon], ymax:c[lon]}); \r\n                                }\r\n                                return p;\r\n                            }, [])}; \r\n\t\t\t\t\t\t\t_this.data.vessels.sort(function(a,b){return +(a.vessel_name > b.vessel_name) || +(a.vessel_name === b.vessel_name) - 1;})\r\n                            _this.isDirty = false;                         \r\n                            return Promise.resolve(); \r\n                        }\r\n                        else{                                           \r\n                            return Promise.reject(response); \r\n                        }\r\n                    });\r\n        },\r\n        update: function () {            \r\n            //if (!this.isDirty)\r\n            //    return;\r\n            _actualUpdate = new Date().getTime();\r\n            let _this = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);          \r\n\r\n            this.load(actualUpdate).then(function () {\r\n                if (_actualUpdate == actualUpdate) {\r\n                    _this.view.inProgress(false);\r\n                    _this.view.repaint();\r\n                }\r\n            }, function (json) {\r\n                _this.dataSrc = null;\r\n                console.log(json)\r\n                if (json.Status.toLowerCase() == \"auth\" ||\r\n                    (json.ErrorInfo && json.ErrorInfo.some && json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })))\r\n                    _this.data = { msg: [{ txt: _gtxt(\"AISSearch2.auth\") }], vessels: [] };\r\n                else {\r\n                    //_this.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                    console.log(json);\r\n                }\r\n                _this.view.inProgress(false);\r\n                _this.view.repaint();\r\n            });\r\n        },\r\n        markMembers:function(vessels){\r\n            if (this.data && this.data.vessels)\r\n            this.data.vessels.forEach(function(v){\r\n                var member = Polyfill.find(vessels, function(vv){return v.mmsi==vv.mmsi && v.imo==v.imo});\r\n                if (member)\r\n                    member.mf_member = \"visibilty:visible\";\r\n            });\r\n        },\r\n        // Layer filter example \"(([mmsi]=273452320 and [imo]=8971059) or ([mmsi]=273349220 and [imo]=8811015)) and [ts_pos_utc]>=2017-07-08\"\r\n        changeFilter: function (vessel) {\r\n//console.log(this.data);\r\n            var add = true, temp = { vessels: [] }, vessels = this.data.vessels;\r\n            for (var i = 0; i < this.data.vessels.length; ++i) {\r\n                if (this.data.vessels[i].imo == vessel.imo && this.data.vessels[i].mmsi == vessel.mmsi)\r\n                    add = false;\r\n                else\r\n                    temp.vessels.push(this.data.vessels[i]);\r\n            }\r\n            if (add)\r\n                temp.vessels.push(vessel);\r\n            this.data = temp;\r\n            var _this = this;\r\n            this.layers.forEach(function (layer) {\r\n                layer.filter = _this.data.vessels.length == 0 ?\r\n                    \"([mmsi]=-1000)\" :\r\n                    _this.data.vessels.map(function (v) {\r\n                        return layer.parentLayerId != '13E2051DFEE04EEF997DC5733BD69A15' ? // IS TRACKS\r\n                            \"([mmsi]=\" + v.mmsi + \" and [imo]=\" + v.imo + \")\" :\r\n                            \"([mmsi]=\" + v.mmsi + \")\";\r\n                    }).join(\" or \");\r\n\r\n                var today = new Date(new Date() - 3600 * 24 * 7 * 1000);\r\n                today = today.getFullYear() + \"-\" + (\"0\" + (today.getMonth() + 1)).slice(-2) + \"-\" + (\"0\" + today.getDate()).slice(-2);\r\n                if (layer.filter != \"([mmsi]=-1000)\") {\r\n                    if (layer.parentLayerId != '13E2051DFEE04EEF997DC5733BD69A15')\r\n                        layer.filter = \"(\" + layer.filter + \") and [ts_pos_utc]>='\" + today + \"'\";\r\n                    else\r\n                        layer.filter = \"(\" + layer.filter + \") and [Date]>='\" + today + \"'\";\r\n                }\r\n                //console.log(layer.filter)\r\n            });\r\n            return Promise.all(this.layers.map(function (l) {\r\n                return new Promise(function (resolve, reject) {\r\n                    sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                        \"VectorLayer/Update.ashx?VectorLayerID=\" + l.layerId + \"&filter=\" +\r\n                        l.filter, function (response) {\r\n                            if (response.Status.toLowerCase() == \"ok\")\r\n                                setTimeout(function run() {\r\n\r\n                                    sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                                        \"AsyncTask.ashx?TaskID=\" + response.Result.TaskID, function (response) {\r\n                                            if (response.Status.toLowerCase() == \"ok\")\r\n                                                if (!response.Result.Completed)\r\n                                                    setTimeout(run, 1000);\r\n                                                else {\r\n                                                    if (response.Result.ErorInfo) {\r\n                                                        console.log(response)\r\n                                                        reject();\r\n                                                    }\r\n                                                    else\r\n                                                        resolve();\r\n                                                }\r\n                                            else {\r\n                                                console.log(response)\r\n                                                reject();\r\n                                            }\r\n\r\n                                        });\r\n                                }, 1000);\r\n                            else {\r\n                                console.log(response);\r\n                                reject();\r\n                            }\r\n                        });\r\n                });\r\n\r\n            })\r\n            ).then(\r\n                //return Promise.resolve().then(\r\n                function () {\r\n                    this.isDirty = true;\r\n                    //console.log(this.data);\r\n                    L.gmx.layersVersion.chkVersion();\r\n                    return Promise.resolve();\r\n                }.bind(this),\r\n                function () {\r\n                    return Promise.reject();\r\n            });\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src1/Models/MyFleetModel.js","module.exports = { \r\n\tfind: function(a, predicate) {\r\n\t\tvar list = Object(a);\r\n\t\tvar length = list.length >>> 0;\r\n\t\tvar thisArg = arguments[2];\r\n\t\tvar value;\r\n\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t  value = list[i];\r\n\t\t  if (predicate.call(thisArg, value, i, list)) {\r\n\t\t\treturn value;\r\n\t\t  }\r\n\t\t}\r\n\t\treturn undefined;\r\n\t},\r\n\tfindIndex: function(a, predicate) {\r\n\t\tvar list = Object(a);\r\n\t\tvar length = list.length >>> 0;\r\n\t\tvar thisArg = arguments[2];\r\n\t\tvar value;\r\n\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t  value = list[i];\r\n\t\t  if (predicate.call(thisArg, value, i, list)) {\r\n\t\t\treturn i;\r\n\t\t  }\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src1/Polyfill.js","require(\"./DbSearch.css\")\r\nconst BaseView = require('./BaseView.js');\r\n\r\nlet _searchString = \"\",\r\n    _setSearchInputValue = function(s){   \r\n        let searchIc = this.frame.find('.filter .search'),\r\n            removeBut = this.frame.find('.filter .remove'),\r\n        _searchString = s;\r\n        this.searchInput.val(_searchString);\r\n        if (s!=\"\"){\r\n            removeBut.show();\r\n            searchIc.hide();\r\n        }\r\n        else\r\n            removeBut.click();\r\n    },\r\n    _highlight,\r\n    _tools;\r\n\r\nconst DbSearchView = function ({model, highlight, tools}) {\r\n    BaseView.call(this, model);\r\n    _highlight = highlight;\r\n    _tools = tools;\r\n    this.topOffset = 240;\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view search_view\">' +\r\n        '<table border=0 class=\"instruments\">' +\r\n        '<tr><td colspan=\"2\"><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filter\"}}\"/>' +\r\n        '<div><img class=\"search clicable\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        '<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\">' +\r\n        '</div></div>' +\r\n\r\n        '</td></tr>' +\r\n        '<tr><td class=\"time\"><span class=\"label\">Время:</span>' +\r\n        '<span class=\"utc on unselectable\" unselectable=\"on\">UTC</span><span class=\"local unselectable\" unselectable=\"on\">Местное</span></td>' +\r\n        '<tr><td><div class=\"calendar\"></div></td>' +\r\n        '<td><div class=\"refresh clicable\" title=\"{{i \"AISSearch2.refresh\"}}\"><div>' + this.gifLoader + '</div></div></td></tr>' +\r\n        '</table>' +\r\n\r\n        '<div class=\"ais_history\">' +\r\n        '<table class=\"ais_positions_date\"><tr><td>NO HISTORY FOUND</td></tr></table>' +\r\n        '</div>' +\r\n        '<div class=\"suggestions\"><div class=\"suggestion\">SOME VESSEL<br><span>mmsi:0, imo:0</span></div></div>' +\r\n        '</div>'\r\n    )());\r\n    this.container = this.frame.find('.ais_history');\r\n    this.tableTemplate = '{{#if msg}}<div class=\"message\">{{msg}}</div>{{/if}}' +\r\n        '{{#each vessels}}' +\r\n        '<table class=\"ais_positions_date\" border=0><tr>' +\r\n        '<td><div class=\"open_positions ui-helper-noselect icon-right-open\" title=\"{{i \"AISSearch2.voyageInfo\"}}\"></div></td>' +\r\n        '<td><span class=\"date\">{{{ts_pos_utc}}}</span></td><td><span class=\"count\">{{count}}</span></td></tr></table>' +\r\n        '<div id=\"voyage_info{{n}}\"></div>' +\r\n        '{{/each}}';\r\n\r\n    let calendar = this.frame.find('.calendar');\r\n\r\n    // walkaround with focus at first input in ui-dialog\r\n    calendar.append('<span class=\"ui-helper-hidden-accessible\"><input type=\"text\"/></span>')\r\n    let mapDateInterval = nsGmx.widgets.commonCalendar.getDateInterval(),\r\n        dateInterval = new nsGmx.DateInterval();\r\n    dateInterval\r\n        .set('dateBegin', mapDateInterval.get('dateBegin'))\r\n        .set('dateEnd', mapDateInterval.get('dateEnd'))\r\n        .on('change', function (e) {\r\n//console.log(this.model.historyInterval) \r\n//console.log('CHANGE ' + dateInterval.get('dateBegin').toUTCString() + ' ' + dateInterval.get('dateEnd').toUTCString()) \r\n            this.model.historyInterval = { dateBegin: dateInterval.get('dateBegin'), dateEnd: dateInterval.get('dateEnd') };\r\n            this.model.isDirty = true;\r\n            this.show();\t\r\n        }.bind(this));\r\n\r\n    this.calendar = new nsGmx.CalendarWidget({\r\n        dateInterval: dateInterval,\r\n        name: 'searchInterval',\r\n        container: calendar,\r\n        dateMin: new Date(0, 0, 0),\r\n        dateMax: new Date(3015, 1, 1),\r\n        dateFormat: 'dd.mm.yy',\r\n        minimized: false,\r\n        showSwitcher: false,\r\n        dateBegin: new Date(),\r\n        dateEnd: new Date(2000, 10, 10),\r\n        //buttonImage: 'img/calendar.png'\r\n    })\r\n\r\n    let td = calendar.find('tr:nth-of-type(1) td');\r\n    td.eq(1).after('<td style=\"font-weight:bold\">&nbsp;&nbsp;&ndash;&nbsp;&nbsp;</td>');\r\n    td.eq(td.length-1).after('<td>&nbsp;&nbsp;<img src=\"plugins/AIS/AISSearch/svg/calendar.svg\"></td>');\r\n\r\n    //sidebarControl && sidebarControl.on('closing', ()=>calendar.reset())\r\n    this.frame.on('click', ((e) => {\r\n        if (e.target.classList.toString().search(/CalendarWidget/) < 0) {\r\n            this.calendar.reset()\r\n        }\r\n        suggestions.hide();\r\n    }).bind(this));\r\n\r\n    this.frame.find('.time .utc,.local').click((e => {\r\n        let trg = $(e.currentTarget);\r\n        if (!trg.is('.on')) {\r\n            this.frame.find('.time span').removeClass(\"on\");\r\n            trg.addClass('on')\r\n            if (trg.is('.utc')) {\r\n                this.frame.find('.utc_time').show();\r\n                this.frame.find('.local_time').hide();\r\n                this.frame.find('.utc_date').show();\r\n                this.frame.find('.local_date').hide();\r\n            }\r\n            else {\r\n                this.frame.find('.utc_time').hide();\r\n                this.frame.find('.local_time').show();\r\n                this.frame.find('.utc_date').hide();\r\n                this.frame.find('.local_date').show();\r\n            }\r\n        }\r\n\r\n    }).bind(this));\r\n\r\n    this.searchInput = this.frame.find('.filter input');\r\n\r\n    let searchIc = this.frame.find('.filter .search'),\r\n        removeBut = this.frame.find('.filter .remove'),\r\n        delay,\r\n        suggestions = this.frame.find('.suggestions'),\r\n        suggestionsCount = 5,\r\n        suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 },\r\n        found = { values: [] },\r\n        searchDone = function () {\r\n            if (found.values.length > 0) {\r\n                _searchString = found.values[suggestionsFrame.current].vessel_name;\r\n                this.searchInput.val(_searchString);\r\n                let v = found.values[suggestionsFrame.current];\r\n                if (!this.vessel || this.vessel.mmsi!=v.mmsi){\r\n                    this.vessel = v;\r\n                    this.show();\r\n                }\r\n            }\r\n            else {\r\n                _clean.call(this);\r\n            }\r\n        },\r\n        doSearch = function () {\r\n            //console.log(_searchString)\r\n            new Promise(function (resolve, reject) {\r\n                this.model.searcher.searchString(_searchString, true, function (response) {\r\n                    if (response.Status.toLowerCase() == \"ok\") {\r\n                        found = {\r\n                            values: response.Result.values.map(function (v) {\r\n                                return { vessel_name: v[0], mmsi: v[1], imo: v[2], ts_pos_utc: v[3], ts_pos_org: v[3], vessel_type: v[4] }\r\n                            })\r\n                        };\r\n                        resolve();\r\n                    }\r\n                    else {\r\n                        reject(response);\r\n                    }\r\n                })\r\n            }.bind(this))\r\n                .then(function () { // SUCCEEDED\r\n                    if (found.values.length == 0) {\r\n                        suggestions.hide();\r\n                        return;\r\n                    }\r\n\r\n                    let scrollCont = suggestions.find('.mCSB_container'),\r\n                        content = $(Handlebars.compile(\r\n                            '{{#each values}}<div class=\"suggestion\" id=\"{{@index}}\">{{vessel_name}}<br><span>mmsi:{{mmsi}}, imo:{{imo}}</span></div>{{/each}}'\r\n                        )(found));\r\n                    if (!scrollCont[0])\r\n                        suggestions.html(content).mCustomScrollbar();\r\n                    else\r\n                        $(scrollCont).html(content);\r\n\r\n                    let suggestion = suggestions.find('.suggestion');\r\n                    if (!suggestions.is(':visible')) {\r\n                        let cr = this.frame.find('.filter')[0].getBoundingClientRect();\r\n                        suggestions.show();\r\n                        suggestions.offset({ left: cr.left, top: cr.bottom - 3 });\r\n                        suggestions.outerWidth(cr.width)\r\n                    }\r\n\r\n                    suggestions.innerHeight(suggestion[0].getBoundingClientRect().height *\r\n                        (found.values.length > suggestionsCount ? suggestionsCount : found.values.length));\r\n                    suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 };\r\n                    suggestion.eq(suggestionsFrame.current).addClass('selected');\r\n                    suggestion.click(e => {\r\n                        suggestionsFrame.current = e.currentTarget.id;\r\n                        searchDone.call(this);\r\n                    });\r\n                    //console.log(\"doFilter2 \"+_searchString)\r\n                }.bind(this),\r\n                function (response) { // FAILED\r\n                    console.log(response);\r\n                });\r\n        };\r\n    removeBut.click(function (e) {\r\n        this.searchInput.val('');\r\n        clearTimeout(delay)\r\n        removeBut.hide();\r\n        searchIc.show();\r\n        suggestions.hide();\r\n        _clean.call(this);\r\n        //nsGmx.leafletMap.removeLayer(highlight);\r\n    }.bind(this));\r\n    this.searchInput.keydown(function (e) {\r\n        let suggestion = suggestions.find('.suggestion.selected');\r\n        if (suggestions.is(':visible')) {\r\n            if (e.keyCode == 38) {\r\n                if (suggestionsFrame.current > 0) {\r\n                    suggestionsFrame.current--;\r\n                    suggestion.removeClass('selected').prev().addClass('selected');\r\n                }\r\n            }\r\n            else if (e.keyCode == 40) {\r\n                if (suggestionsFrame.current < found.values.length - 1) {\r\n                    suggestionsFrame.current++;\r\n                    suggestion.removeClass('selected').next().addClass('selected');\r\n                }\r\n            }\r\n            if (suggestionsFrame.last < suggestionsFrame.current) {\r\n                suggestionsFrame.last = suggestionsFrame.current;\r\n                suggestionsFrame.first = suggestionsFrame.last - (suggestionsCount - 1);\r\n            }\r\n            if (suggestionsFrame.first > suggestionsFrame.current) {\r\n                suggestionsFrame.first = suggestionsFrame.current;\r\n                suggestionsFrame.last = suggestionsFrame.first + (suggestionsCount - 1);\r\n            }\r\n            suggestions.mCustomScrollbar(\"scrollTo\", \"#\" + suggestionsFrame.first, { scrollInertia: 0 });\r\n        }\r\n    });\r\n    this.searchInput.keyup(function (e) {\r\n        let temp = (this.searchInput.val() || \"\")\r\n            .replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n            \r\n        if (_searchString == temp && e.keyCode != 13)\r\n            return;\r\n\r\n        _searchString = temp;\r\n        clearTimeout(delay);\r\n\r\n        if (_searchString == \"\") {\r\n            removeBut.click();\r\n            return;\r\n        }\r\n\r\n        removeBut.show();\r\n        searchIc.hide();\r\n        if (e.keyCode == 13) {\r\n            suggestions.hide();\r\n            searchDone.call(this);\r\n        }\r\n        else\r\n            delay = setTimeout((() => {\r\n                doSearch.call(this)\r\n            }).bind(this), 200);\r\n        //nsGmx.leafletMap.removeLayer(highlight);\r\n    }.bind(this))\r\n};\r\n\r\nDbSearchView.prototype = Object.create(BaseView.prototype);\r\n\r\nlet _clean = function () {\r\n    this.frame.find('.open_positions').off('click');\r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n};\r\n\r\nDbSearchView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div');\r\n    if (state)\r\n        progress.show();\r\n    else\r\n        progress.hide();\r\n};\r\n\r\nlet _vi_template = '<table class=\"ais_positions\">' +\r\n    '{{#each positions}}' +\r\n    '<tr>' +\r\n    '<td><span class=\"utc_time\">{{tm_pos_utc}}</span><span class=\"local_time\">{{tm_pos_loc}}</span></td>' +\r\n    '<td><span class=\"utc_date\">{{dt_pos_utc}}</span><span class=\"local_date\">{{dt_pos_loc}}</span></td>' +\r\n    '<td><img src=\"{{icon}}\" class=\"rotateimg{{icon_rot}}\"></td>' +\r\n    '<td><img src=\"{{source}}\"></td>' +\r\n    '<td>{{longitude}}&nbsp;&nbsp;{{latitude}}</td>' +\r\n    '<td><div class=\"show_pos\" id=\"show_pos{{@index}}\"><img src=\"plugins/AIS/AISSearch/svg/center.svg\"></div></td>' +\r\n    '</tr>' +\r\n    '<tr><td colspan=\"6\" class=\"more\"><hr><div class=\"vi_more\">' +\r\n\r\n    '<div class=\"c1\">COG | SOG:</div><div class=\"c2\">&nbsp;{{cog}} {{#if cog_sog}}&nbsp;{{/if}} {{sog}}</div>' +\r\n    '<div class=\"c1\">HDG | ROT:</div><div class=\"c2\">&nbsp;{{heading}} {{#if heading_rot}}&nbsp;{{/if}} {{rot}}</div>' +\r\n    '<div class=\"c1\">Осадка:</div><div class=\"c2\">&nbsp;{{draught}}</div>' +\r\n    '<div class=\"c1\">Назначение:</div><div class=\"c2\">&nbsp;{{destination}}</div>' +\r\n    '<div class=\"c1\">Статус:</div><div class=\"c2\">&nbsp;{{nav_status}}</div>' +\r\n    '<div class=\"c1\">ETA:</div><div class=\"c2\">&nbsp;<span class=\"utc_time\">{{eta_utc}}</span><span class=\"local_time\">{{eta_loc}}</span></div>' +\r\n\r\n    '</div></td></tr>' +\r\n    '{{/each}}' +\r\n    '</table>';\r\nDbSearchView.prototype.repaint = function () {\r\n    _clean.call(this);\r\n    BaseView.prototype.repaint.apply(this, arguments);\r\n\r\n    let open_pos = this.frame.find('.open_positions');\r\n    open_pos.each((ind, elm) => {\r\n        $(elm).click(((e) => {\r\n            let icon = $(e.target),\r\n                vi_cont = this.frame.find('#voyage_info' + ind);\r\n\r\n            if (icon.is('.icon-down-open')) {\r\n                icon.removeClass('icon-down-open').addClass('.icon-right-open');\r\n                vi_cont.find('.ais_positions td[class!=\"more\"]').off('click')\r\n                vi_cont.empty();\r\n            }\r\n            else {\r\n                icon.addClass('icon-down-open').removeClass('.icon-right-open');\r\n                vi_cont.html(Handlebars.compile(_vi_template)(this.model.data.vessels[ind]));\r\n                if (this.frame.find('.time .local').is('.on')) {\r\n                    vi_cont.find('.utc_time').hide();\r\n                    vi_cont.find('.local_time').show();\r\n                    vi_cont.find('.utc_date').hide();\r\n                    vi_cont.find('.local_date').show();\r\n                }\r\n                vi_cont.find('.ais_positions td[class!=\"more\"]').click((e) => {\r\n                    let td = $(e.currentTarget);\r\n                    if (td.is('.active')) {\r\n                        td.removeClass('active')\r\n                        td.siblings().removeClass('active')\r\n                        td.parent().next().find('td').removeClass('active')\r\n                    }\r\n                    else {\r\n                        td.addClass('active')\r\n                        td.siblings().addClass('active')\r\n                        td.parent().next().find('td').addClass('active')\r\n                    }\r\n                });\r\n                vi_cont.find('.ais_positions .show_pos').click(((e) => {\r\n                    //showPosition\r\n                    let i = e.currentTarget.id.replace(/show_pos/, \"\"),\r\n                    vessel = this.model.data.vessels[ind].positions[parseInt(i)];\r\n                    \r\n                    this.positionMap(vessel);\r\n                    this.showTrack(vessel);\r\n\r\n                    e.stopPropagation();\r\n                }).bind(this));\r\n            }\r\n        }).bind(this))\r\n    })\r\n\r\n    if (this.model.data.vessels.length == 1)\r\n        open_pos.eq(0).click();\r\n};\r\n\r\n\r\nObject.defineProperty(DbSearchView.prototype, \"vessel\", {\r\n    get() {\r\n        return this.model.vessel;\r\n    },\r\n    set(v) {\r\n        _setSearchInputValue.call(this, v.vessel_name);\r\n\r\n        let db = nsGmx.DateInterval.getUTCDayBoundary(new Date(v.ts_pos_org * 1000));\r\n        this.model.vessel = null;\r\n        this.calendar.getDateInterval().set('dateBegin', db.dateBegin);\r\n        this.calendar.getDateInterval().set('dateEnd', db.dateEnd);\r\n        this.model.historyInterval = { dateBegin: db.dateBegin, dateEnd: db.dateEnd };\r\n        this.model.vessel = v;  \r\n        this.model.isDirty = true;      \r\n    }\r\n});\r\n\r\nDbSearchView.prototype.show = function () {\r\n\r\n    this.frame.show();\r\n    this.searchInput.focus();\r\n    if (!this.vessel)\r\n        return;\r\n\r\nconsole.log(this.vessel.vessel_name + \" \" + this.vessel.mmsi + \" \" + this.vessel.vessel_type)\r\n//console.log(this.model.historyInterval.dateBegin + \" \" + this.model.historyInterval.dateEnd)\r\n    BaseView.prototype.show.apply(this, arguments);\r\n};\r\n\r\nDbSearchView.prototype.hide = function () {\r\n    //console.log('hide DbSearchView')\r\n    BaseView.prototype.hide.apply(this, arguments);\r\n};\r\n\r\nDbSearchView.prototype.showTrack = function(vessel){\r\n    let dlg = $('.ui-dialog:contains(\"' + vessel.mmsi + '\")');\r\n    if (dlg[0]) {\r\n        dlg.find('.showtrack:not(.active)').click();\r\n    }\r\n    else {\r\n        _tools.showTrack([vessel.mmsi]);\r\n        $('.showtrack').attr('title', _gtxt('AISSearch2.show_track'))\r\n            .removeClass('active');\r\n    }\r\n};\r\n\r\nDbSearchView.prototype.positionMap = function(vessel){\r\n    //console.log(vessel);\r\n    let interval = nsGmx.DateInterval.getUTCDayBoundary(new Date(vessel.ts_pos_org*1000));\r\n    nsGmx.widgets.commonCalendar.setDateInterval(interval.dateBegin, interval.dateEnd);\r\n    let xmin = vessel.xmin ? vessel.xmin : vessel.longitude,\r\n    xmax = vessel.xmax ? vessel.xmax : vessel.longitude,\r\n    ymin = vessel.ymin ? vessel.ymin : vessel.latitude,\r\n    ymax = vessel.ymax ? vessel.ymax : vessel.latitude;\r\n    nsGmx.leafletMap.fitBounds([\r\n        [ymin, xmin],\r\n        [ymax, xmax]\r\n    ], {\r\n            maxZoom: 9,//config.user.searchZoom,\r\n            animate: false\r\n    })    \r\n    nsGmx.leafletMap.removeLayer(_highlight); \r\n    _highlight.vessel = vessel;\r\n    _highlight.setLatLng([ymax, xmax]).addTo(nsGmx.leafletMap);\r\n};\r\n\r\nmodule.exports = DbSearchView;\n\n\n// WEBPACK FOOTER //\n// ./src1/Views/DbSearchView.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src1/Views/DbSearch.css\n// module id = 14\n// module chunks = 0","module.exports = function (aisLayerSearcher) {\r\n    let _actualUpdate,\r\n        _round = function (d, p) {\r\n            let isNeg = d < 0,\r\n                power = Math.pow(10, p)\r\n            return d ? ((isNeg ? -1 : 1) * (Math.round((isNeg ? d = -d : d) * power) / power)) : d\r\n        },\r\n        _addUnit = function (v, u) {\r\n            return v != null && v != \"\" ? v + u : \"\";\r\n        },\r\n        _toDd = function (D, lng) {\r\n            let dir = D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n                deg = Math.round((D < 0 ? D = -D : D) * 1000000) / 1000000\r\n            return deg.toFixed(2) + \" \"//\"°\"\r\n                + dir\r\n        },\r\n        _formatPosition = function (vessel) {\r\n            vessel.cog_sog = vessel.cog && vessel.sog\r\n            vessel.heading_rot = vessel.heading && vessel.rot\r\n            vessel.x_y = vessel.longitude && vessel.latitude\r\n            let d = new Date(vessel.ts_pos_utc * 1000)\r\n            let eta = new Date(vessel.ts_eta * 1000)\r\n            vessel.tm_pos_utc = _formatTime(d);\r\n            vessel.tm_pos_loc = _formatTime(d, true);\r\n            vessel.dt_pos_utc = _formatDate(d);\r\n            vessel.dt_pos_loc = _formatDate(d, true);\r\n            vessel.eta_utc = aisLayerSearcher.formatDateTime(eta);\r\n            vessel.eta_loc = aisLayerSearcher.formatDateTime(eta, true);\r\n            vessel.icon_rot = Math.round(vessel.cog/15)*15;\r\n            vessel.cog = _addUnit(_round(vessel.cog, 5), \"°\");\r\n            vessel.rot = _addUnit(_round(vessel.rot, 5), \"°/мин\");\r\n            vessel.heading = _addUnit(_round(vessel.heading, 5), \"°\");\r\n            vessel.draught = _addUnit(_round(vessel.draught, 5), \" м\");\r\n            //vessel.length = _addUnit(vessel.length, \" м\");\r\n            //vessel.width = _addUnit(vessel.width, \" м\");\r\n            vessel.source = 'plugins/AIS/AISSearch/svg/satellite-ais.svg'//vessel.source=='T-AIS'?_gtxt('AISSearch2.tais'):_gtxt('AISSearch2.sais');\r\n            \r\n            vessel.xmin = vessel.longitude;\r\n            vessel.xmax = vessel.longitude;           \r\n            vessel.ymin = vessel.latitude;\r\n            vessel.ymax = vessel.latitude; \r\n\r\n            vessel.longitude = _toDd(vessel.longitude, true)\r\n            vessel.latitude = _toDd(vessel.latitude)\r\n            switch (vessel.vessel_type.toLowerCase()) {\r\n                case \"cargo\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Ccargo-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"tanker\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Ctanker-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"fishing\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cfishing-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"passenger\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cpassenger-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;                \r\n                case \"hsc\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Chighspeed-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"pleasure craft\":\r\n                case \"sailing\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cpleasure-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"unknown\": \r\n                case \"reserved\": \r\n                case \"other\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cother-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                default:\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cspecialcraft-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n            }\r\n            vessel.sog = _addUnit(_round(vessel.sog, 5), \" уз\");\r\n\r\n            return vessel;\r\n        },\r\n        _formatTime = function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleTimeString();\r\n        },\r\n        _formatDate = function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleDateString();\r\n        }\r\n    return {\r\n        searcher: aisLayerSearcher,\r\n        filterString: \"\",\r\n        isDirty: false,\r\n        load: function (actualUpdate) {\r\n            if (!this.isDirty)\r\n                return Promise.resolve();\r\n            //return new Promise((resolve)=>setTimeout(resolve, 1000))\r\n            //console.log('LOAD ' + _historyInterval['dateBegin'].toUTCString() + ' ' + _historyInterval['dateEnd'].toUTCString())     \r\n            var _this = this;\r\n            return new Promise((resolve) => {\r\n                aisLayerSearcher.searchPositionsAgg([_this.vessel.mmsi], _this.historyInterval, function (response) {\r\n                    if (parseResponse(response)) {\r\n                        let position, positions = [],\r\n                            fields = response.Result.fields,\r\n                            groups = response.Result.values.reduce((p, c) => {\r\n                                let dt = c[1], t = dt - dt % (24 * 3600), d = new Date(t * 1000), obj = {  };\r\n                                for (var j = 0; j < fields.length; ++j) {\r\n                                    obj[fields[j]] = c[j];\r\n                                    if (fields[j] == 'ts_pos_utc')\r\n                                        obj['ts_pos_org'] = c[j];\r\n                                }\r\n                                if (p[d]) {\r\n                                    p[d].positions.push(_formatPosition(obj));\r\n                                    p[d].count = p[d].count + 1;\r\n                                }\r\n                                else\r\n                                    p[d] = { ts_pos_utc: _formatDate(d), positions: [_formatPosition(obj)], count: 1 };\r\n                                return p;\r\n                            }, {});\r\n                        let counter = 0;\r\n                        for (var k in groups) {\r\n                            groups[k][\"n\"] = counter++;\r\n                            positions.push(groups[k]);\r\n                        }\r\n                        /*\r\n                        positions.sort((a, b) => {\r\n                            if (a.ts_pos_org > b.ts_pos_org) return -1\r\n                            if (a.ts_pos_org < b.ts_pos_org) return 1;\r\n                            return 0;\r\n                        })\r\n                        */\r\n                        resolve({ Status: \"ok\", Result: { values: positions } });\r\n                    }\r\n                    else\r\n                        resolve(response)\r\n                })\r\n            })\r\n                .then(function (response) {\r\n                    //console.log(response)       \r\n                    _this.isDirty = false;\r\n                    if (response.Status.toLowerCase() == \"ok\") {\r\n                        _this.data = { vessels: response.Result.values }\r\n                        return Promise.resolve();\r\n                    }\r\n                    else {\r\n                        return Promise.reject(response);\r\n                    }\r\n                });\r\n        },\r\n        update: function () {\r\n            if (!this.isDirty)\r\n                return;\r\n\r\n            _actualUpdate = new Date().getTime();\r\n            let _this = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);\r\n            //this.filterString&&console.log(this.filterString+\" \"+this.filterString.search(/\\r$/))\r\n            //this.filterString&&console.log(this.filterString.replace(/^\\s+/, \"\").replace(/\\s+\\r*$/, \"\")!=\"\")            \r\n\r\n            this.load(actualUpdate).then(function () {\r\n                //console.log(\"LOADED \"+(new Date().getTime()-_this._actualUpdate)+\"ms\")\r\n                //console.log(\"3>\"+new Date(_this._actualUpdate))\r\n                //console.log(\"4>\"+new Date(actualUpdate))\r\n                if (_actualUpdate == actualUpdate) {\r\n//_this.data.vessels && (_this.data.vessels.length>0) && console.log(_this.data.vessels[0].positions[0])                    \r\n                    _this.view.inProgress(false);\r\n                    _this.view.repaint();\r\n                }\r\n            }, function (json) {\r\n                _this.dataSrc = null;\r\n                console.log(json)\r\n                if (json.Status.toLowerCase() == \"auth\" ||\r\n                    (json.ErrorInfo && json.ErrorInfo.some &&\r\n                        json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })) ||\r\n                    (json.ErrorInfo && json.ErrorInfo.ErrorMessage.search(/not access/i) != -1))\r\n                    _this.data = { msg: _gtxt(\"AISSearch2.auth\"), vessels: [] };\r\n                else {\r\n                    //_this.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                    console.log(json);\r\n                }\r\n                _this.view.inProgress(false);\r\n                _this.view.repaint();\r\n            });\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src1/Models/DbSearchModel.js","const createInfoDialog = require('./infodialog.js'),\r\n      Polyfill = require('../Polyfill'),\r\n      VesselInfoScreen = require('./VesselInfoScreen');\r\n\r\nlet infoDialogCascade = [],\r\n    allIinfoDialogs = [],\r\n    vesselInfoScreen;\r\n\r\nmodule.exports = function ({\r\n    tools,\r\n    aisLayerSearcher: aisLayerSearcher,\r\n    modulePath: modulePath,\r\n    aisView: aisView, myFleetMembersView: myFleetMembersView }) {\r\n\r\n    vesselInfoScreen  = new VesselInfoScreen({modulePath: modulePath, aisServices: aisLayerSearcher.aisServices});\r\n    const _showPosition = function(vessel){   \r\n        aisView.vessel = vessel;\r\n        if (aisView.tab)\r\n        if (aisView.tab.is('.active'))\r\n            aisView.show();\r\n        else\r\n            aisView.tab.click();               \r\n        aisView.positionMap(vessel);\r\n    };\r\n    return {\r\n        showPosition: function(vessel){   \r\n            _showPosition(vessel);\r\n            aisView.showTrack(vessel);\r\n        },\r\n        show: function (vessel, getmore) {\r\n            var ind = Polyfill.findIndex(allIinfoDialogs, function (d) { \r\n                return d.vessel.imo == vessel.imo && d.vessel.mmsi == vessel.mmsi \r\n            });\r\n            if (ind >= 0) {\r\n                $(allIinfoDialogs[ind].dialog).parent().insertAfter($('.ui-dialog').eq($('.ui-dialog').length - 1));\r\n                return;\r\n            }\r\n\r\n            var dialog = createInfoDialog({\r\n                vessel: vessel,\r\n                getmore: getmore,\r\n                displaingTrack: tools.displaingTrack,\r\n                closeFunc: function (event) {\r\n                    var ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == dialog.id });\r\n                    if (ind >= 0)\r\n                        infoDialogCascade.splice(ind, 1);\r\n                    ind = Polyfill.findIndex(allIinfoDialogs, function (d) { return d.dialog.id == dialog.id });\r\n                    if (ind >= 0)\r\n                        allIinfoDialogs.splice(ind, 1);\r\n                },\r\n                aisLayerSearcher: aisLayerSearcher,\r\n                modulePath:modulePath, \r\n                aisView: aisView,\r\n                myFleetMembersView: myFleetMembersView\r\n            },\r\n                {\r\n                    openVesselInfoScreen: vesselInfoScreen.open,\r\n                    showTrack: tools.showTrack,\r\n                    showPosition: _showPosition\r\n                })\r\n\r\n            if (infoDialogCascade.length > 0) {\r\n                var pos = $(infoDialogCascade[infoDialogCascade.length - 1]).parent().position();\r\n                $(dialog).dialog(\"option\", \"position\", [pos.left + 10, pos.top + 10]);\r\n            }\r\n\r\n            infoDialogCascade.push(dialog);\r\n            allIinfoDialogs.push({ vessel: vessel, dialog: dialog });\r\n            $(dialog).on(\"dialogdragstop\", function (event, ui) {\r\n                var ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == dialog.id });\r\n                if (ind >= 0)\r\n                    infoDialogCascade.splice(ind, 1);\r\n            });\r\n\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src1/Views/InfoDialogView.js","require(\"./infodialog.css\")\r\n\r\nlet addUnit = function (v, u) {\r\n\treturn v != null && v != \"\" ? v + u : \"\";\r\n},\r\n\tformatDate,\r\n\tformatDateTime,\r\n\tround = function (d, p) {\r\n\t\tlet isNeg = d < 0,\r\n\t\t\tpower = Math.pow(10, p)\r\n\t\treturn d ? ((isNeg ? -1 : 1) * (Math.round((isNeg ? d = -d : d) * power) / power)) : d\r\n\t},\r\n\tformatVessel = function (vessel) {\r\n\t\tlet d = new Date(vessel.ts_pos_utc * 1000);\r\n\t\tvessel.ts_pos_org = vessel.ts_pos_utc;\r\n\t\tvessel.dt_pos_utc = formatDate(d);\r\n\t\tvessel.ts_pos_utc = formatDateTime(d);\r\n\t\tvessel.ts_pos_loc = \"<br><span class='local'>\" + formatDateTime(d, true) + \"</span>\";\r\n\t\tvessel.ts_eta = formatDateTime(new Date(vessel.ts_eta * 1000));\r\n\t\tvessel.cog = addUnit(round(vessel.cog, 5), \"°\");\r\n\t\tvessel.sog = addUnit(round(vessel.sog, 5), \" уз\");\r\n\t\tvessel.rot = addUnit(round(vessel.rot, 5), \"°/мин\");\r\n\t\tvessel.heading = addUnit(round(vessel.heading, 5), \"°\");\r\n\t\tvessel.draught = addUnit(round(vessel.draught, 5), \" м\");\r\n\t\tvessel.length = addUnit(vessel.length, \" м\");\r\n\t\tvessel.width = addUnit(vessel.width, \" м\");\r\n\t\tvessel.source = vessel.source == 'T-AIS' ? _gtxt('AISSearch2.tais') : _gtxt('AISSearch2.sais');\r\n\t\treturn vessel;\r\n\t},\r\n\ttoDd = function (D, lng) {\r\n\t\tlet dir = D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n\t\t\tdeg = Math.round((D < 0 ? D = -D : D) * 1000000) / 1000000\r\n\t\treturn deg + \"°\" + dir\r\n\t},\r\n\tddToDms = function (D, lng) {\r\n\t\tlet dms = {\r\n\t\t\tdir: D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n\t\t\tdeg: 0 | (D < 0 ? D = -D : D),\r\n\t\t\tmin: 0 | D % 1 * 60,\r\n\t\t\tsec: (0 | D * 60 % 1 * 6000) / 100\r\n\t\t};\r\n\t\treturn dms.deg + \"°\" + dms.min + \"'\" + dms.sec + \"\\\" \" + dms.dir\r\n\t}\r\n\r\nmodule.exports = function ({ vessel, closeFunc, aisLayerSearcher, getmore,\r\n\tmodulePath,\r\n\taisView,\r\n\tdisplaingTrack,\r\n\tmyFleetMembersView, aisPluginPanel }, commands) {\r\n\r\n\tformatDate = aisLayerSearcher.formatDate;\r\n\tformatDateTime = aisLayerSearcher.formatDateTime;\r\n\r\n\tlet myFleetMembersModel = myFleetMembersView.model,\r\n\t\tadd = myFleetMembersModel && myFleetMembersModel.findIndex(vessel) < 0\r\n\r\n\tlet canvas = $('<div class=\"ais_myfleet_dialog\"/>'),\r\n\t\tmenu = $('<div class=\"column1 menu\"></div>').appendTo(canvas),\r\n\t\tphoto = $('<div class=\"photo\"><div></div></div>').appendTo(menu),\r\n\t\tmoreinfo = $('<div class=\"moreinfo\"><div></div></div>').appendTo(menu),\r\n\t\tcontent = Handlebars.compile(\r\n\t\t\t'<div class=\"column2 content\">' +\r\n\t\t\t'</div>')(vessel),\r\n\t\tbuttons = $('<div class=\"column3 buttons\"></div>'),\r\n\t\tgifLoader = '<img src=\"img/progress.gif\">'\r\n\t//console.log(content);\r\n\r\n\tcanvas.append(content).append(buttons)\r\n\r\n\tlet dialog = showDialog(vessel.vessel_name, canvas[0], { width: 610, height: 230, closeFunc: closeFunc }),\r\n\t\tvessel2,\r\n\t\tmoreInfo = function (v) {\r\n\t\t\tlet smallShipIcon = '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"14px\" height=\"14px\" viewBox=\"0 0 14 14\" style=\"margin-left: 10px\" xml:space=\"preserve\">' +\r\n\t\t\t\t'<g style=\"fill: #48aff1;\">' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M13.4,11H0.6c-0.2,0-0.4,0.1-0.5,0.3c-0.1,0.2-0.1,0.4,0,0.6l1.2,1.8C1.4,13.9,1.6,14,1.8,14h9.9   c0.2,0,0.3-0.1,0.4-0.2l1.7-1.8c0.2-0.2,0.2-0.4,0.1-0.7C13.9,11.1,13.7,11,13.4,11z\"/>' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M9.3,9.7h2.9c0.2,0,0.4-0.1,0.5-0.3c0.1-0.2,0.1-0.4,0-0.6L9.8,4.5C9.7,4.3,9.4,4.2,9.2,4.3   C8.9,4.4,8.7,4.6,8.7,4.9v4.3C8.7,9.5,9,9.7,9.3,9.7z\"/>' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M1.2,9.7H7c0.3,0,0.6-0.3,0.6-0.6V0.6c0-0.3-0.2-0.5-0.4-0.6C6.9-0.1,6.7,0,6.5,0.3L0.7,8.8   C0.6,9,0.5,9.2,0.6,9.4C0.7,9.6,0.9,9.7,1.2,9.7z\"/>' +\r\n\t\t\t\t'</g>' +\r\n\t\t\t\t'</svg>',\r\n\t\t\t\tvesselPropTempl = '<div class=\"vessel_prop vname\"><b>{{vessel_name}}</b>' + smallShipIcon + '</div>' +\r\n\t\t\t\t\t'<div class=\"vessel_prop altvname\"><b>' + (vessel2.registry_name && vessel2.registry_name != vessel2.vessel_name ? vessel2.registry_name : '') + '&nbsp;</b></div>'\r\n\r\n\t\t\t$('.content', canvas).append(Handlebars.compile(\r\n\t\t\t\t'<div class=\"vessel_props1\">' + vesselPropTempl +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">Тип судна: </div></td><td><div class=\"vessel_prop value\">{{vessel_type}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">Флаг: </div></td><td><div class=\"vessel_prop value\">{{flag_country}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">IMO: </div></td><td><div class=\"vessel_prop value\">{{imo}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">MMSI: </div></td><td><div class=\"vessel_prop value mmsi\">{{mmsi}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.source\"}}: </div></td><td><div class=\"vessel_prop value\">{{source}}</div></td></tr>' +\r\n\t\t\t\t'</table>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t)(v));\r\n\r\n\t\t\t$('.content', canvas).append(Handlebars.compile(\r\n\t\t\t\t'<div class=\"vessel_props2\">' + vesselPropTempl +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">COG | SOG: </div></td><td><div class=\"vessel_prop value\">{{cog}}&nbsp;&nbsp;&nbsp;{{sog}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">HDG | ROT: </div></td><td><div class=\"vessel_prop value\">{{heading}}&nbsp;&nbsp;&nbsp;{{rot}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.draught\"}}: </div></td><td><div class=\"vessel_prop value\">{{draught}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.destination\"}}: </div></td><td><div class=\"vessel_prop value\">{{destination}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.nav_status\"}}: </div></td><td><div class=\"vessel_prop value\">{{nav_status}}</div></td></tr>' +\r\n\t\t\t\t'</table>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t)(v));\r\n\r\n\t\t\t$(moreinfo).append('<table><tr>' +\r\n\t\t\t\t'<td class=\"ais_refresh\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" height=\"16\" width=\"16\"><g class=\"nc-icon-wrapper\" fill=\"#444444\"><polyline data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 15,16 7,16 7,13 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 15,18 17,16 15,14 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" data-stroke=\"none\" fill=\"#444444\" points=\"15,18 17,16 15,14 \" stroke-linejoin=\"miter\" stroke-linecap=\"square\" style=\"stroke: currentColor;fill: currentColor;\"/> <polyline data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 9,8 17,8 17,11 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\"9,6 7,8 9,10 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" data-stroke=\"none\" fill=\"#444444\" points=\"9,6 7,8 9,10 \" stroke-linejoin=\"miter\" stroke-linecap=\"square\" style=\"stroke: currentColor;fill: currentColor;\"/> <rect x=\"2\" y=\"1\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" width=\"20\" height=\"22\" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/></g></svg></td>' +\r\n\t\t\t\t'<td><div class=\"vessel_prop coordinates\"><span class=\"small\">' +\r\n\t\t\t\ttoDd(v.latitude, false) + ' ' + toDd(v.longitude, true) +\r\n\t\t\t\t'</small></div></td>' +\r\n\t\t\t\t'</tr></table>'\r\n\t\t\t);\r\n\r\n\t\t\tlet swap = \"<span class='small'>\" + ddToDms(v.latitude, false) + \" \" + ddToDms(v.longitude, true) + \"</span>\"\r\n\t\t\t$('.ais_refresh', moreinfo).click((e) => {\r\n\t\t\t\tlet mi = $('.coordinates', moreinfo),\r\n\t\t\t\t\tt = mi.html()\r\n\t\t\t\tmi.html(swap)\r\n\t\t\t\tswap = t\r\n\t\t\t})\r\n\r\n\t\t\t$('.vessel_props2', canvas).hide()\r\n\t\t\t$('.vessel_prop.vname svg', canvas).css('visibility', add ? 'hidden' : 'visible')\r\n\r\n\t\t}\r\n\r\n\t$(dialog).dialog({ resizable: false });\r\n\r\n\tif (!getmore) {\r\n\t\tvessel2 = $.extend({}, vessel);\r\n\t\tmoreInfo(formatVessel(vessel2));\r\n\t}\r\n\telse\r\n\t\taisLayerSearcher.searchNames([{ mmsi: vessel.mmsi, imo: vessel.imo }], function (response) {\r\n\t\t\tif (parseResponse(response)) {\r\n\t\t\t\tvessel2 = {};\r\n\t\t\t\tfor (var i = 0; i < response.Result.fields.length; ++i)\r\n\t\t\t\t\tvessel2[response.Result.fields[i]] = response.Result.values[0][i];\r\n\t\t\t\tmoreInfo(formatVessel(vessel2));\r\n\t\t\t\t$('.date', titlebar).html('<span class=\"utc\">' + vessel2.ts_pos_utc + ' UTC</span>' + vessel2.ts_pos_loc);\r\n\t\t\t\tif (typeof (getmore) == \"function\")\r\n\t\t\t\t\tgetmore(vessel2)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tconsole.log(response)\r\n\t\t})\r\n\r\n\t// IMAGE\t\r\n\tlet scheme = document.location.href.replace(/^(https?:).+/, \"$1\");\r\n\t$('<img src=\"' + scheme + '//photos.marinetraffic.com/ais/showphoto.aspx?size=thumb&mmsi=' + vessel.mmsi + '\">').load(function () {\r\n\t\tif (this)\r\n\t\t\t$('div', photo).replaceWith(this);\r\n\t});\r\n\r\n\t// BUTTONS\r\n\tlet menubuttons = $('<div class=\"menubuttons\"></div>').appendTo(buttons)\r\n\r\n\tlet openpage = $('<div class=\"button openpage\" title=\"информация о судне\">' +\r\n\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">' +\r\n\t\t'<g class=\"nc-icon-wrapper\" style=\"fill:currentColor\">' +\r\n\t\t'<path d=\"M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z\"/>' +\r\n\t\t'</g>' +\r\n\t\t'</svg>'\r\n\t\t+ '</div>')\r\n\t\t.appendTo(menubuttons)\r\n\t\t.on('click', () => commands.openVesselInfoScreen.call(null, vessel, vessel2));\r\n\r\n\tlet showpos = $('<div class=\"button showpos\" title=\"показать положение\">' +\r\n\t\t'<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" width=\"20\" height=\"20\"><g class=\"nc-icon-wrapper\" fill=\"#444444\"><polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 1,7 1,1 7,1 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 17,1 23,1 23,7 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 23,17 23,23 17,23 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 7,23 1,23 1,17 \" stroke-linejoin=\"miter\"/> <rect style=\"stroke:currentColor\" x=\"8\" y=\"8\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" width=\"8\" height=\"8\" stroke-linejoin=\"miter\"/></g></svg>' +\r\n\t\t'</div>')\r\n\t\t.appendTo(menubuttons)\r\n\t\t.on('click', function () {\r\n\t\t\tif (!vessel.ts_pos_org)\r\n\t\t\t\tvessel.ts_pos_org = vessel.ts_pos_utc;\r\n\t\t\tcommands.showPosition(vessel);\r\n\t\t\tif(!showtrack.is('.active'))\r\n\t\t\t\tshowtrack.click();\r\n\t\t});\r\n\t//if (tracksLayer){\r\n\tlet templ = '<div class=\"button showtrack\" title=\"' + _gtxt('AISSearch2.show_track') + '\">' +\r\n\t\t'<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" width=\"20\" height=\"20\"><g class=\"nc-icon-wrapper\" fill=\"#444444\"><path style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" d=\"M4,13V5 c0-2.209,1.791-4,4-4h0c2.209,0,4,1.791,4,4v14c0,2.209,1.791,4,4,4h0c2.209,0,4-1.791,4-4v-8\" stroke-linejoin=\"miter\"/> <circle style=\"stroke:currentColor\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" cx=\"20\" cy=\"4\" r=\"3\" stroke-linejoin=\"miter\"/> <circle style=\"stroke:currentColor\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" cx=\"4\" cy=\"20\" r=\"3\" stroke-linejoin=\"miter\"/></g></svg>' +\r\n\t\t'</div>',\r\n\t\tactivateTrackBut = function () {\r\n\t\t\t$('.showtrack').attr('title', _gtxt('AISSearch2.show_track'))\r\n\t\t\t\t.removeClass('active');\r\n\t\t\tshowtrack.attr('title', _gtxt('AISSearch2.hide_track'))\r\n\t\t\t\t.addClass('ais active');\r\n\t\t},\r\n\t\tshowtrack = $(templ)\r\n\t\t\t.appendTo(menubuttons)\r\n\t\t\t.on('click', function () {\r\n\t\t\t\tif (showtrack.attr('title') != _gtxt('AISSearch2.hide_track')) {\r\n\t\t\t\t\tcommands.showTrack.call(null, [vessel.mmsi])\r\n\t\t\t\t\tactivateTrackBut();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t$('.showtrack').attr('title', _gtxt('AISSearch2.show_track'))\r\n\t\t\t\t\t\t.removeClass('ais active');\r\n\t\t\t\t\tcommands.showTrack.call(null, [])\r\n\t\t\t\t}\r\n\t\t\t});\r\n\tif (!displaingTrack.mmsi || displaingTrack.mmsi != vessel.mmsi) {\r\n\t\tshowtrack.attr('title', _gtxt('AISSearch2.show_track'))\r\n\t}\r\n\telse {\r\n\t\tshowtrack.attr('title', _gtxt('AISSearch2.hide_track'))\r\n\t\t\t.addClass('ais active');\r\n\t}\r\n\t//}\r\n\r\n\tlet addremoveIcon = function (add) {\r\n\t\treturn (add ? '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><g class=\"nc-icon-wrapper\" fill=\"#444444\" style=\"fill: currentColor;\"><path d=\"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z\"/></g></svg>'\r\n\t\t\t: '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"24px\" height=\"24px\" viewBox=\"0 0 24 24\" style=\"enable-background:new 0 0 24 24;fill: currentColor;\" xml:space=\"preserve\"><g><path class=\"st0\" d=\"M4,6H2v14c0,1.1,0.9,2,2,2h14v-2H4V6z M20,2H8C6.9,2,6,2.9,6,4v12c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V4    C22,2.9,21.1,2,20,2z M19,11h-4v4h-2v-4H9V9h4V5h2v4h4V11z\"/></g><rect x=\"9\" y=\"5\" class=\"st0\" width=\"10\" height=\"4\"/><rect x=\"9\" y=\"11\" class=\"st0\" width=\"10\" height=\"4\"/></g></svg>')\r\n\t}\r\n\tif (myFleetMembersModel && myFleetMembersModel.data && myFleetMembersModel.data.vessels) {\r\n\t\tlet addremove = $('<div class=\"button addremove\">' + addremoveIcon(add) + '</div>')\r\n\t\t\t//.css('background-image','url('+modulePath+'svg/'+(add?'add':'rem')+'-my-fleet.svg)')\r\n\t\t\t.attr('title', add ? 'добавить в мой флот' : 'удалить из моего флота')\r\n\t\t\t.appendTo(menubuttons)\r\n\t\tif (myFleetMembersModel.filterUpdating)\r\n\t\t\taddremove.addClass('disabled');\r\n\t\taddremove.on('click', function () {\r\n\t\t\tif (addremove.is('.disabled'))\r\n\t\t\t\treturn;\r\n\r\n\t\t\t$('.addremove').addClass('disabled')\r\n\t\t\taddremove.hide()\r\n\t\t\tprogress.append(gifLoader)\r\n\r\n\t\t\tmyFleetMembersModel.changeFilter(vessel).then(function () {\r\n\t\t\t\tadd = myFleetMembersModel.findIndex(vessel) < 0;\r\n\t\t\t\tvar info = $('.icon-ship[vessel=\"' + vessel.mmsi + ' ' + vessel.imo + '\"]');\r\n\t\t\t\tinfo.css('visibility', !add ? 'visible' : 'hidden');\r\n\t\t\t\t$('.vessel_prop.vname svg', canvas).css('visibility', add ? 'hidden' : 'visible')\r\n\r\n\t\t\t\taddremove.attr('title', add ? 'добавить в мой флот' : 'удалить из моего флота')\r\n\t\t\t\t\t.html(addremoveIcon(add))\r\n\t\t\t\t//.css('background-image','url('+modulePath+'svg/'+(add?'add':'rem')+'-my-fleet.svg)')\r\n\r\n\t\t\t\tprogress.text('');\r\n\t\t\t\t$('.addremove').removeClass('disabled').show()\r\n\t\t\t\tif (myFleetMembersView.isActive)\r\n\t\t\t\t\tmyFleetMembersView.show();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tlet progress = $('<div class=\"progress\"></div>')\r\n\t\t.appendTo(menubuttons);\r\n\r\n\t// TITLEBAR\t\r\n\tcanvas.parent('div').css({ 'margin': '0', 'overflow': 'hidden' })\r\n\tlet titlebar = $(dialog).parent().find('.ui-dialog-titlebar').css('padding', '0')\r\n\t\t.html('<table class=\"ais_info_dialog_titlebar\">' +\r\n\t\t'<tr><td><div class=\"date\">' +\r\n\t\t(!getmore ? Handlebars.compile('<span class=\"utc\">{{{ts_pos_utc}}} UTC</span>{{{ts_pos_loc}}}')(vessel2 ? vessel2 : vessel) : '') +\r\n\t\t'</div></td>' +\r\n\t\t'<td><div class=\"choose done\"><span unselectable=\"on\" class=\"chooser\">Общие сведения</span></div></td>' +\r\n\t\t'<td><div class=\"choose\"><span unselectable=\"on\" class=\"chooser\">Параметры движении</span></div></td>' +\r\n\t\t'<td id=\"closebut\"><div class=\"ais_info_dialog_close-button\" title=\"закрыть\"></div></td></tr>' +\r\n\t\t'</table>'),\r\n\t\tonDone = function (e) { e.stopPropagation(); $('.choose', titlebar).removeClass('done'); $(e.currentTarget).parent().addClass('done'); }\r\n\r\n\t$('.ais_info_dialog_close-button', titlebar).on('click', () => $(dialog).dialog(\"close\"))\r\n\t$('.chooser', titlebar).eq(0).on('mousedown', (e) => { onDone(e); $('.vessel_props1', canvas).show(); $('.vessel_props2', canvas).hide() })\r\n\t$('.chooser', titlebar).eq(1).on('mousedown', (e) => { onDone(e); $('.vessel_props2', canvas).show(); $('.vessel_props1', canvas).hide() })\r\n\t$('.date span', titlebar).on('mousedown', (e) => { e.stopPropagation(); })\r\n\r\n\t//$( dialog ).on( \"dialogdragstart\", function( e, ui ) {console.log(e);console.log(ui)} );\r\n\r\n\treturn dialog\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src1/Views/infodialog.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src1/Views/infodialog.css\n// module id = 18\n// module chunks = 0","//************************************\r\n// VESSEL INFO VIEW\r\n//************************************  \r\n\r\nmodule.exports = function ({modulePath, aisServices}){\r\n        var _ais,  \r\n        _galery, \r\n        _register, \r\n        _regcap,    \r\n        _leftPanel,  \r\n        _minh,\r\n        resize,\r\n        menuAction,       \r\n\t    scheme = document.location.href.replace(/^(https?:).+/, \"$1\"),\r\n        show = function(vessel){\r\n//console.log(vessel) \r\n            $(\"body\").append(''+  \r\n'<table class=\"vessel-info-page overlay\">' +\r\n        '<tr>' +\r\n            '<td>' +\r\n'<table class=\"vessel-info-page container\">' +\r\n    '<tr>' +\r\n        '<td class=\"column1\">' +\r\n                '<table>' +\r\n                    '<tr>' +\r\n                        '<td>' +\r\n                            '<div>' +\r\n                                '<div class=\"title\">' +\r\n                                   '<div class=\"cell\">'+vessel.vessel_name+'<div class=\"timestamp\">'+vessel.ts_pos_utc+'</div></div>  ' +                  \r\n                                '</div>' +\r\n                                '<div class=\"menu\">' +\r\n                                '<div class=\"ais cell menu-item active\"><img src=\"'+modulePath+'svg/info_gen.svg\" class=\"icon\">Основные сведения</div>' +\r\n                                '<div class=\"register cell menu-item\"><img src=\"'+modulePath+'svg/info.svg\" class=\"icon\">Регистр</div>' +\r\n                                '<div class=\"galery cell menu-item\"><img src=\"'+modulePath+'svg/photogallery.svg\" class=\"icon\">Фотогалерея <div class=\"counter\">0</div></div>' +\r\n                               '</div>' +\r\n                            '</div>  ' +\r\n                        '</td>' +\r\n                    '</tr>' +\r\n                    '<tr>' +\r\n                        '<td class=\"frame\">' +\r\n                                '<div class=\"photo\">' +\r\n                                    '<img src=\"'+modulePath+'svg/no-image.svg\" class=\"no-image\">' +\r\n                                '</div>  ' +  \r\n                        '</td>' +\r\n                    '</tr>' +\r\n                '</table>' +\r\n    '</td>' +\r\n    '<td class=\"column2\">' +\r\n        '<div class=\"close-button-holder\">' +\r\n            '<div class=\"close-button\" title=\"закрыть\"></div>' +\r\n        '</div>' +\r\n        '<div class=\"register panel\">' +\r\n            '<div class=\"caption\"></div>' +\r\n            '<div class=\"menu\">' +\r\n                '<div>' +\r\n                    '<table>' +\r\n                        '<tr>' +\r\n                            '<td><div class=\"general menu-item active\">Общие сведения</div></td>' +\r\n                            '<td><div class=\"build menu-item\">Сведения о постройке</div></td>' +\r\n                            '<td><div class=\"dimensions menu-item\">Размеры и скорость</div></td>' +\r\n                            '<td><div class=\"gears menu-item\">Оборудование</div></td>' +\r\n                        '</tr>' +\r\n                    '</table>' +\r\n                '</div>' +\r\n            '</div>' +\r\n            '<div class=\"content\">' +\r\n                '<div class=\"placeholder\"></div>' +\r\n            '</div>' +\r\n        '</div>' +\r\n\r\n        '<div class=\"galery panel\">' +   \r\n'<form action=\"' + aisServices + 'Upload.ashx\" class=\"uploadFile\" method=\"post\" enctype=\"multipart/form-data\" target=\"upload_target\" style=\"display:none\" >' +\r\n    '<input name=\"Filedata\" class=\"chooseFile\" type=\"file\">' +    \r\n    '<input name=\"imo\" type=\"hidden\" value=\"'+vessel.imo+'\">' +    \r\n    '<input name=\"mmsi\" type=\"hidden\" value=\"'+vessel.mmsi+'\">' +\r\n          //'<input type=\"submit\" name=\"submitBtn\" value=\"Upload\" />' +\r\n'</form>' + \r\n'<iframe id=\"upload_target\" name=\"upload_target\" src=\"#\" style=\"width:0;height:0;border:0px solid #fff;\"></iframe>' + \r\n            '<div class=\"placeholder\">' +\r\n                '<div class=\"photo\" onclick=\"document.querySelector(\\'.vessel-info-page .chooseFile\\').click();\"'+\r\n                ' style=\"background-image: url('+modulePath+'svg/add-image.svg);background-size: 50px;\"></div>' +                \r\n            '</div>' +\r\n        '</div>' +\r\n\r\n        '<div class=\"ais panel\">' +\r\n            '<div class=\"placeholder\"></div>' +\r\n        '</div>' +\r\n    '</td>' +\r\n    '</tr>' +\r\n'</table>' +\r\n            '</td>' +\r\n        '</tr>' +\r\n    '</table>'           \r\n            );\r\n        window.addEventListener(\"message\", function(e){\r\n            if (e.data.search(/\"uploaded\"\\:/)<0)\r\n                return;\r\n            var data = JSON.parse(e.data);    \r\n            if (data.id && parseInt(data.id)) { //uploaded:\r\n//console.log('UPLOADED '+id)\r\n                var counter = $('.vessel-info-page .menu-item .counter'), \r\n                count = parseInt(counter.text())+1;\r\n                counter.text(count).css('display', 'inline');\r\n                var preview = $(\"<div class='photo preview' id='\"+data.id+\"' style='background-image: url(\"+aisServices+\"getphoto.ashx?id=\"+data.id+\")'/>\");\r\n                $('.vessel-info-page .uploader').replaceWith(preview);\r\n                preview.click(showPicture);\r\n//console.log(preview)\r\n            }\r\n            else {//uploadError:            \r\n                $('.vessel-info-page .uploader').remove();\r\n                console.log(data.errmsg)\r\n            }  \r\n        }, false);\r\n\r\n        $('<img src=\"'+scheme+'//photos.marinetraffic.com/ais/showphoto.aspx?mmsi='+vessel.mmsi+'\">').load(function() {\r\n            if (this){\r\n                $('.column1 .photo img.no-image').replaceWith(this);\r\n            }\r\n        });\r\n        $('.vessel-info-page .chooseFile').change(function(){            \r\n            $('<div class=\"photo uploader\" style=\"background-image:url(img/progress.gif);background-size:20px;\"></div>')\r\n            .insertAfter($('.vessel-info-page .galery .placeholder .photo').eq(0));\r\n            $('.vessel-info-page .uploadFile')[0].submit();\r\n        })\r\n        $('.vessel-info-page .close-button').click(function(){\r\n            $('.vessel-info-page.overlay').remove();\r\n        });\r\n/**/\r\n        $('.vessel-info-page .menu img[src$=\".svg\"]').each(function() {\r\n            var $img = jQuery(this);\r\n            var imgURL = $img.attr('src');\r\n            var attributes = $img.prop(\"attributes\");\r\n\r\n            $.get(imgURL, function(data) {\r\n                // Get the SVG tag, ignore the rest\r\n                var $svg = jQuery(data).find('svg');\r\n\r\n                // Remove any invalid XML tags\r\n                $svg = $svg.removeAttr('xmlns:a');\r\n\r\n                // Loop through IMG attributes and apply on SVG\r\n                $.each(attributes, function() {\r\n                    $svg.attr(this.name, this.value);\r\n                });\r\n\r\n                // Replace IMG with SVG\r\n                $img.replaceWith($svg);\r\n            }, 'xml');\r\n        });\r\n\r\n        _ais = document.querySelector('.vessel-info-page .column2 .ais') \r\n        _galery = document.querySelector('.vessel-info-page .column2 .galery')\r\n        _register = document.querySelector('.vessel-info-page .column2 .register .content')\r\n        _regcap = document.querySelector('.vessel-info-page .column2 .register .caption')    \r\n        _leftPanel = document.querySelector('.vessel-info-page .column1 table')      \r\n        _minh = 420\r\n        resize = function(){\r\n            var h = Math.floor(window.innerHeight*0.8);\r\n            if (h>_minh){\r\n                _leftPanel.style.height = _ais.style.height = _galery.style.height = h + \"px\";\r\n                _register.style.height = h - _regcap.offsetHeight + \"px\";\r\n            }\r\n            else{\r\n                _leftPanel.style.height = _ais.style.height = _galery.style.height = _minh + \"px\";\r\n                _register.style.height = _minh - _regcap.offsetHeight + \"px\";\r\n            }      \r\n        }\r\n        menuAction = function(e){\r\n            var target = e.currentTarget, p = target.parentElement, mia;\r\n            while(!(mia = p.querySelectorAll('.menu-item')) || mia.length<2){\r\n                p = p.parentElement;\r\n            }\r\n            for (var j=0; j<mia.length; ++j){\r\n                    //console.log( mia[j])\r\n                mia[j].className = mia[j].className.replace(/ active/, \"\");\r\n                var panel = document.querySelector('.panel.' + mia[j].classList[0]);\r\n                if (panel){\r\n                    if (mia[j]!=target)\r\n                    panel.style.display = \"none\";\r\n                    else{\r\n                    panel.style.display = \"block\";\r\n                    }\r\n                }\r\n            }\r\n            target.className += \" active\"\r\n            resize(); \r\n        }\r\n\r\n        window.addEventListener(\"resize\", resize, false); \r\n    \r\n        var mia = document.querySelectorAll('.column1 .menu-item');\r\n        for (var i=0; i<mia.length; ++i){\r\n            mia[i].addEventListener('click', menuAction)\r\n        }\r\n    \r\n        resize();    \r\n        $(_ais).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        $(_galery).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        $(_register).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        document.querySelector('.vessel-info-page .container').style.display = \"table\";  \r\n    },\r\n    showPicture = function(){\r\n//console.log($(this))\r\n            $('.vessel-info-page .picture').remove();\r\n            var div = $('<div class=\"picture\" style=\"display:none;position:absolute;\"></div>')\r\n            .insertAfter('.vessel-info-page.container').click(function(){this.remove()});\r\n            $('<img src=\"'+aisServices+'getphoto.ashx?id='+this.id+'\">').load(function() {\r\n                    if (this){\r\n                        var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,\r\n                        h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n                        div.append(this)\r\n                        .css('display', 'table')\r\n                        .offset({\r\n                            left:(w-this.offsetWidth)/2,\r\n                            top:(h-this.offsetHeight)/2})\r\n//console.log($(this))\r\n//console.log(window.screen.width+\"-\"+$(this)[0].offsetWidth)\r\n//console.log((window.screen.width-$(this)[0].offsetWidth)/2)\r\n                    }\r\n            });\r\n        },\r\n    drawGallery = function(gallery){\r\n        if (gallery.length>0)\r\n            $('.vessel-info-page .menu-item .counter').text(gallery.length).css('display', 'inline');   \r\n        var galcontent = $(\".vessel-info-page .galery .placeholder\")\r\n        for (var i=0; i<gallery.length; ++i)\r\n            galcontent.append(\"<div class='photo preview' id='\"+gallery[i]+\"' style='background-image: url(\"+aisServices+\"getphoto.ashx?id=\"+gallery[i]+\")'/>\" )             \r\n        $('.photo.preview').click(showPicture)\r\n        resize();     \r\n    },\r\n    drawAis = function(ledokol){\r\n    var aiscontent = document.querySelector(\".vessel-info-page .ais .placeholder\")\r\n    aiscontent.innerHTML = \"\" +                \r\n    \"<div class='caption'><div>ИНФОРМАЦИЯ О СУДНЕ</div></div>\" +\r\n    \"<table>\" +\r\n        \"<tr><td>Название судна</td><td><b>\"+ledokol.vessel_name+(ledokol.registry_name?\" (\"+ledokol.registry_name+\")\":\"\")+\"</b></td></tr>\" +\r\n        \"<tr><td>IMO</td><td>\"+ledokol.imo+\"</td></tr>\" +\r\n        \"<tr><td>MMSI</td><td>\"+ledokol.mmsi+\"</td></tr>\" +\r\n        \"<tr><td>Тип</td><td>\"+ledokol.vessel_type+\"</td></tr>\" +\r\n        \"<tr><td>Флаг</td><td>\"+ledokol.flag_country+\"</td></tr>\" +\r\n        \"<tr><td>Позывной</td><td>\"+ledokol.callsign+\"</td></tr>\" +\r\n        \"<tr><td>Длина</td><td>\"+ledokol.length+\"</td></tr>\" +\r\n        \"<tr><td>Ширина</td><td>\"+ledokol.width+\"</td></tr>\" +\r\n    \"</table>\" +\r\n    \"<div class='caption'><div>СВЕДЕНИЯ О ДВИЖЕНИИ</div></div>\" +\r\n    \"<table>\" +\r\n        \"<tr><td>Навигационный статус</td><td>\"+ledokol.nav_status+\"</td></tr>\" +\r\n        \"<tr><td>COG</td><td>\"+ledokol.cog+\"</td></tr>\" +\r\n        \"<tr><td>SOG</td><td>\"+ledokol.sog+\"</td></tr>\" +\r\n        \"<tr><td>HDG</td><td>\"+ledokol.heading+\"</td></tr>\" +\r\n        \"<tr><td>ROT</td><td>\"+ledokol.rot+\"</td></tr>\" +\r\n        \"<tr><td>Осадка</td><td>\"+ledokol.draught+\"</td></tr>\" +\r\n        \"<tr><td>Назначение</td><td>\"+ledokol.destination+\"</td></tr>\" +\r\n        \"<tr><td>Расчетное время прибытия</td><td>\"+ledokol.ts_eta+\"</td></tr>\" +\r\n    \"</table>\";     \r\n        resize();        \r\n    },\r\n    drawRegister = function(ledokol){\r\n        var regcontent = _register.querySelector(\".placeholder\"),\r\n        drawTable = function(groups, article, display){\r\n            var s = \"<div class='panel \"+article+\" article' style='display:\"+display+\"'>\";\r\n            for(var i=0; i<groups.length; ++i){\r\n                s += \"<div class='group'>\"+groups[i].name+\"</div><table>\"\r\n                for(var j=0; j<groups[i].properties.length; ++j){\r\n                    var pn = groups[i].properties[j].name,\r\n                    pv = groups[i].properties[j].value\r\n                    s+= \"<tr><td>\"+pn+\"</td><td>\"+(pn==\"Название судна\"||pn==\"Латинское название\"?\"<b>\"+pv+\"</b>\":pv)+\"</td></tr>\"\r\n                }\r\n                s += \"</table>\"\r\n            }\r\n            s += \"</div>\"\r\n            return s;\r\n        }\r\n        regcontent.innerHTML = \r\n        drawTable([ledokol.data[0], ledokol.data[1], ledokol.data[9]], \"general\", \"block\") + \r\n        drawTable([ledokol.data[2]], \"build\", \"none\") + \r\n        drawTable([ledokol.data[3]], \"dimensions\", \"none\") + \r\n        drawTable([ledokol.data[4], ledokol.data[5], ledokol.data[6], ledokol.data[7], ledokol.data[8]], \"gears\", \"none\");\r\n\t\t\r\n        _regcap.innerHTML = \"<table><tr><td>Обновление базы данных \"+ledokol.version.replace(/ \\S+$/g, '')+\"</td></tr></table>\"\r\n\r\n        var mia = document.querySelectorAll('.column2 .menu-item');\r\n        for (var i=0; i<mia.length; ++i){\r\n            mia[i].addEventListener('click', menuAction)\r\n        }\r\n             \r\n        resize();        \r\n    }\r\n\t\r\n\tlet open = function(vessel, vessel2){\r\n                    show(vessel2);\r\n                    var onFail = function(error){\r\n                        if (error!='register_no_data')\r\n                        console.log(error)\r\n                    } \r\n                    new Promise(function(resolve, reject){\r\n                        (function wait(){\r\n                            if(!vessel2)\r\n                                setTimeout(wait, 100);\r\n                        })();\r\n                        resolve(vessel2)\r\n                    })\r\n                    .then(function(ship){\r\n//console.log(ship)\r\n                        drawAis(ship)\r\n                    }, \r\n                    onFail);\r\n                    var registerServerUrl = scheme + \"//kosmosnimki.ru/demo/register/api/v1/\";\r\n                    if(vessel.imo && vessel.imo!=0 && vessel.imo!=-1)\r\n                        fetch(registerServerUrl+\"Ship/Search/\"+vessel.imo+\"/ru\")\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            if (ship.length>0)\r\n                                return fetch(registerServerUrl+\"Ship/Get/\"+ship[0].RS+\"/ru\")\r\n                            else\r\n                                return Promise.reject('register_no_data');\r\n                        })\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            //console.log(ship)\r\n                            drawRegister(ship)\r\n                        })\r\n                        .catch( onFail );\r\n\r\n                    new Promise(function(resolve, reject){\r\n                        sendCrossDomainJSONRequest(aisServices + \r\n                            \"gallery.ashx?mmsi=\"+vessel.mmsi+\"&imo=\"+vessel.imo, function(response){\r\n                            if (response.Status==\"ok\") \r\n                                resolve(response.Result);\r\n                            else\r\n                                reject(response)\r\n                        });\r\n                    })\r\n                    .then(function(gallery){\r\n                        drawGallery(gallery)\r\n                    }, \r\n                    onFail);\r\n                }\r\n        \r\n    return {\r\n\t\topen:open,\r\n            show: show,\r\n            drawRegister: drawRegister,\r\n            drawAis: drawAis,\r\n            drawGallery:drawGallery\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src1/Views/VesselInfoScreen.js","module.exports = function (options) {\r\n    const _baseUrl = window.serverBase || document.location.href.replace(/^(https?:).+/, \"$1\") + '//maps.kosmosnimki.ru/',\r\n        _aisServices = _baseUrl + \"Plugins/AIS/\",\r\n        _serverScript = _baseUrl + 'VectorLayer/Search.ashx';\r\n    const { aisLastPoint:_aisLastPoint, \r\n        screenSearchLayer:_screenSearchLayer, \r\n        aisLayerID:_aisLayerID, \r\n        historyLayer:_historyLayer \r\n    } = options;\r\n\r\n    return {\r\n        baseUrl: _baseUrl,\r\n        aisServices: _aisServices,\r\n        getBorder: function () {\r\n            var lmap = nsGmx.leafletMap;\r\n            var dFeatures = lmap.gmxDrawing.getFeatures();\r\n            if (dFeatures.length) { return dFeatures[dFeatures.length - 1].toGeoJSON(); }\r\n            var latLngBounds = lmap.getBounds(),\r\n                sw = latLngBounds.getSouthWest(),\r\n                ne = latLngBounds.getNorthEast(),\r\n                min = { x: sw.lng, y: sw.lat },\r\n                max = { x: ne.lng, y: ne.lat },\r\n                minX = min.x,\r\n                maxX = max.x,\r\n                geo = { type: 'Polygon', coordinates: [[[minX, min.y], [minX, max.y], [maxX, max.y], [maxX, min.y], [minX, min.y]]] },\r\n                w = (maxX - minX) / 2;\r\n\r\n            if (w >= 180) {\r\n                geo = { type: 'Polygon', coordinates: [[[-180, min.y], [-180, max.y], [180, max.y], [180, min.y], [-180, min.y]]] };\r\n            }\r\n            else if (maxX > 180 || minX < -180) {\r\n                var center = ((maxX + minX) / 2) % 360;\r\n                if (center > 180) { center -= 360; }\r\n                else if (center < -180) { center += 360; }\r\n                minX = center - w; maxX = center + w;\r\n                if (minX < -180) {\r\n                    geo = {\r\n                        type: 'MultiPolygon', coordinates: [\r\n                            [[[-180, min.y], [-180, max.y], [maxX, max.y], [maxX, min.y], [-180, min.y]]],\r\n                            [[[minX + 360, min.y], [minX + 360, max.y], [180, max.y], [180, min.y], [minX + 360, min.y]]]\r\n                        ]\r\n                    };\r\n                } else if (maxX > 180) {\r\n                    geo = {\r\n                        type: 'MultiPolygon', coordinates: [\r\n                            [[[minX, min.y], [minX, max.y], [180, max.y], [180, min.y], [minX, min.y]]],\r\n                            [[[-180, min.y], [-180, max.y], [maxX - 360, max.y], [maxX - 360, min.y], [-180, min.y]]]\r\n                        ]\r\n                    };\r\n                }\r\n            }\r\n            return geo;\r\n        },\r\n\r\n        formatTime: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleTimeString();\r\n        },\r\n        formatDate: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleDateString();\r\n        },\r\n        formatDateTime: function (d, local) {\r\n            if (d.isNaN)\r\n                return \"\";\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleString().replace(/,/, \"\");\r\n        },\r\n\r\n        formatDate2: function (d, local) {\r\n            var dd, m, y, h, mm;\r\n            if (local) {\r\n                dd = (\"0\" + d.getDate()).slice(-2);\r\n                m = (\"0\" + (d.getMonth() + 1)).slice(-2);\r\n                y = d.getFullYear();\r\n                h = (\"0\" + d.getHours()).slice(-2);\r\n                mm = (\"0\" + d.getMinutes()).slice(-2);\r\n                return dd + \".\" + m + \".\" + y + \" \" + h + \":\" + mm +\r\n                    \" (\" + (\"0\" + d.getUTCHours()).slice(-2) + \":\" + (\"0\" + d.getUTCMinutes()).slice(-2) + \" UTC)\";\r\n            }\r\n            else {\r\n                dd = (\"0\" + d.getUTCDate()).slice(-2);\r\n                m = (\"0\" + (d.getUTCMonth() + 1)).slice(-2);\r\n                y = d.getUTCFullYear();\r\n                h = (\"0\" + d.getUTCHours()).slice(-2);\r\n                mm = (\"0\" + d.getUTCMinutes()).slice(-2);\r\n                var\r\n                    ldd = (\"0\" + d.getDate()).slice(-2),\r\n                    lm = (\"0\" + (d.getMonth() + 1)).slice(-2),\r\n                    ly = d.getFullYear(),\r\n                    lh = (\"0\" + d.getHours()).slice(-2),\r\n                    lmm = (\"0\" + d.getMinutes()).slice(-2),\r\n                    offset = -d.getTimezoneOffset() / 60;\r\n                return dd + \".\" + m + \".\" + y + \" <span class='utc'>\" + h + \":\" + mm + \" UTC</span> (\" + lh + \":\" + lmm + \")\"\r\n                //return dd+\".\"+m+\".\"+y+\" \"+h+\":\"+mm+\" UTC <br>\"+\r\n                //\"<span class='small'>(\"+ldd+\".\"+lm+\".\"+ly+\" \"+lh+\":\"+lmm+\" UTC\"+(offset>0?\"+\":\"\")+offset+\")</span>\";\r\n            }\r\n        },\r\n        searchPositionsAgg: function (vessels, dateInterval, callback) {\r\n            //console.log(\"searchById\");\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _historyLayer, //'8EE2C7996800458AAF70BABB43321FA4',//\r\n                orderdirection: 'desc',\r\n                orderby: 'ts_pos_utc',\r\n                columns:'[{\"Value\":\"mmsi\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"cog\"},{\"Value\":\"sog\"},{\"Value\":\"draught\"},{\"Value\":\"vessel_type\"},'+\r\n                '{\"Value\":\"destination\"},{\"Value\":\"ts_eta\"},{\"Value\":\"nav_status\"},{\"Value\":\"heading\"},{\"Value\":\"rot\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"}]',\r\n                \r\n                query: \"([mmsi] IN (\" + vessels.join(',') + \")) and '\" + dateInterval.dateBegin.toISOString() + \"'<=[ts_pos_utc] and [ts_pos_utc]<'\" + dateInterval.dateEnd.toISOString() + \"'\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchPositions: function (vessels, dateInterval, callback) {\r\n            //console.log(\"searchById\");\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _historyLayer, //'8EE2C7996800458AAF70BABB43321FA4',//\r\n                //orderdirection: 'desc',\r\n                //orderby: 'ts_pos_utc',\r\n                query: \"([mmsi] IN (\" + vessels.join(',') + \")) and '\" + dateInterval.dateBegin.toISOString() + \"'<=[ts_pos_utc] and [ts_pos_utc]<'\" + dateInterval.dateEnd.toISOString() + \"'\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchById: function (aid, callback) {\r\n            //console.log(\"searchById\");\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLayerID, //'8EE2C7996800458AAF70BABB43321FA4'\r\n                columns: '[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"}]',\r\n                query: \"([id] IN (\" + aid.join(',') + \"))\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchString: function (searchString, isfuzzy, callback) {\r\n            //console.log(_aisLastPoint+\", \"+_aisLayerID)\r\n            var query = \"\";\r\n            if (searchString) {\r\n                searchString = searchString.toUpperCase();\r\n                if (searchString.search(/[^\\d, ]/) === -1) {\r\n                    var arr = searchString.replace(/ /g, '').split(/,/);\r\n                    query = \"([mmsi] IN (\" + arr.join(',') + \"))\" +\r\n                        \"OR ([imo] IN (\" + arr.join(',') + \"))\"\r\n                } else {\r\n                    if (isfuzzy)\r\n                        query = '([vessel_name] startswith \\'' + searchString + '\\') OR ([vessel_name] contains \\' ' + searchString + '\\')';\r\n                    else\r\n                        query = '([vessel_name] startswith \\'' + searchString + '\\') OR ([vessel_name] contains \\' ' + searchString + '\\')';\r\n                }\r\n            }\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLastPoint,\r\n                columns: '[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"vessel_type\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"}]',\r\n                //orderdirection: 'desc',\r\n                orderby: 'vessel_name',\r\n                query: query\r\n            };\r\n            if (isfuzzy)\r\n                request.pagesize = 1000;\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchNames: function (avessels, callback) {\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLastPoint,\r\n                orderdirection: 'desc',\r\n                orderby: 'ts_pos_utc',\r\n                query: avessels.map(function (v) { return \"([mmsi]=\" + v.mmsi + (v.imo && v.imo != \"\" ? (\" and [imo]=\" + v.imo) : \"\") + \")\" }).join(\" or \")\r\n                //([mmsi] IN (\" + ammsi.join(',') + \"))\"+\r\n                //\"and ([imo] IN (\" + aimo.join(',') + \"))\"\r\n            };\r\n            //console.log(request)\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchScreen: function (options, callback) {\r\n            var lmap = nsGmx.leafletMap;\r\n            var dt1 = options.dateInterval.get('dateBegin'),\r\n                dt2 = options.dateInterval.get('dateEnd');\r\n            //query += '([' + TemporalColumnName + '] >= \\'' + dt1.toJSON() + '\\')';\r\n            //query += ' and ([' + TemporalColumnName + '] < \\'' + dt2.toJSON() + '\\')';\r\n            var latLngBounds = lmap.getBounds(),\r\n                sw = latLngBounds.getSouthWest(),\r\n                ne = latLngBounds.getNorthEast(),\r\n                min = { x: sw.lng, y: sw.lat },\r\n                max = { x: ne.lng, y: ne.lat };\r\n            //console.log(min);\r\n            //console.log(max);\r\n            L.gmxUtil.sendCrossDomainPostRequest(_aisServices + \"SearchScreen.ashx\",\r\n                { WrapStyle: 'window', s: dt1.toJSON(), e: dt2.toJSON(), minx: min.x, miny: min.y, maxx: max.x, maxy: max.y, layer: _screenSearchLayer },\r\n                callback);\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src1/Search/Searcher.js","module.exports = function (options) {\r\n    const _layersByID = nsGmx.gmxMap.layersByID,\r\n          _aisLayer = _layersByID[options.aisLayerID],\r\n          _tracksLayer = _layersByID[options.tracksLayerID];\r\n    let _displaingTrack = {mmsi:null};\r\n\r\n    return {\r\n        displaingTrack: _displaingTrack,\r\n        showTrack: function (mmsiArr, bbox) {\r\n            var lmap = nsGmx.leafletMap;\r\n            var filterFunc = function (args) {\r\n                var mmsi = args.properties[1],\r\n                    i, len;\r\n                for (i = 0, len = mmsiArr.length; i < len; i++) {\r\n                    if (mmsi === mmsiArr[i]) { return true; }\r\n                }\r\n                return false;\r\n            };\r\n            if (bbox) { lmap.fitBounds(bbox, { maxZoom: 11 }); }\r\n    // console.log(_aisLayer._gmx.layerID)\r\n    // console.log(_tracksLayer._gmx.layerID)\r\n            if (_aisLayer) {\r\n                if (mmsiArr.length) {\r\n                    _displaingTrack.mmsi = mmsiArr[0];\r\n                    _aisLayer.setFilter(filterFunc);\r\n                    if (!_aisLayer._map) {\r\n                        lmap.addLayer(_aisLayer);\r\n                    }\r\n                } else {\r\n                    _displaingTrack.mmsi = null;\r\n                    _aisLayer.removeFilter();\r\n                    lmap.removeLayer(_aisLayer);\r\n                }\r\n            }\r\n            if (_tracksLayer) {\r\n                if (mmsiArr.length) {\r\n                    _tracksLayer.setFilter(filterFunc);\r\n                    if (!_tracksLayer._map) {\r\n                        lmap.addLayer(_tracksLayer);\r\n                    }\r\n                } else {\r\n                    _tracksLayer.removeFilter();\r\n                    lmap.removeLayer(_tracksLayer);\r\n                }\r\n            }\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src1/Toolbox.js"],"sourceRoot":""}