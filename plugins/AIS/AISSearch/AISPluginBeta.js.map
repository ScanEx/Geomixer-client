{"version":3,"sources":["webpack:///webpack/bootstrap e6f5dee450b2433a3ae6","webpack:///./src/entry.js","webpack:///./src/all.css","webpack:///./src/Views/AisView.css","webpack:///./src/locale.js","webpack:///./src/aisPluginPanel.js","webpack:///./src/ViewsFactory.js","webpack:///./src/Views/ScreenSearchView.js","webpack:///./src/Views/BaseView.js","webpack:///./src/Models/ScreenSearchModel.js","webpack:///./src/Views/MyFleetView.js","webpack:///./src/Views/MyFleet.css","webpack:///./src/Controls/GroupList.js","webpack:///./src/Controls/GroupWidget.js","webpack:///./src/Models/MyFleetModel.js","webpack:///./src/Polyfill.js","webpack:///./src/Views/DbSearchView.js","webpack:///./src/Views/DbSearch.css","webpack:///./src/Models/DbSearchModel.js","webpack:///./src/Views/InfoDialogView.js","webpack:///./src/Views/infodialog.js","webpack:///./src/Views/infodialog.css","webpack:///./src/Views/VesselInfoScreen.js","webpack:///./src/Views/VesselInfoScreen.css","webpack:///./src/Search/Searcher.js","webpack:///./src/Toolbox.js"],"names":["NOSIDEBAR","PRODUCTION","SIDEBAR2","BETA","require","Handlebars","registerHelper","context","mmsi","imo","JSON","stringify","pluginName","menuId","toolbarIconId","cssTable","modulePath","gmxCore","getModulePath","highlight","L","marker","icon","className","iconAnchor","iconSize","iconUrl","zIndexOffset","AisPluginPanel","ViewsFactory","publicInterface","afterViewer","params","map","options","aisLayerID","screenSearchLayer","searchLayer","aisLastPoint","historyLayer","tracksLayerID","key","toLowerCase","myFleetLayers","split","id","replace","viewFactory","layersByID","nsGmx","gmxMap","setLayerClickHandler","layer","removeEventListener","addEventListener","e","gmx","properties","hasOwnProperty","infoDialogView","show","forLayers","layersId","i","length","aisPluginPanel","lmap","leafletMap","iconOpt_mf","togglable","title","_gtxt","text","icon_mf","control","gmxIcon","on","ev","target","isActive","$","width","css","hide","addControl","sidebar","window","iconSidebarWidget","sidebarControl","sidebarPane","setPane","position","showOnTop","createTab","createTabFunction","active","inactive","hint","_activeTabId","removeClass","_renderTabs","activeTabId","setTimeout","open","location","search","a","substr","x","filter","c","indexOf","y","vessel","setLatLng","addTo","fitBounds","maxZoom","animate","addModule","_translationsHash","addtext","module","exports","_leftMenuBlock","_canvas","_div","_activeView","_views","create","_isReady","_createTabs","tabsTemplate","workCanvas","append","compile","v","frame","tabs","_this","forEach","tab","eq","resize","is","each","addClass","click","_returnInstance","parentWorkCanvas","removeLayer","attr","insertAfter","blockItem","leftPanelItem","blockTitle","panelCanvas","toggleTitle","isCollapsed","leftMenu","createWorkCanvas","gmxControlIconManager","get","_iconClick","path","call","ScreenSearchView","ScreenSearchModel","MyFleetView","MyFleetModel","DbSearchView","DbSearchModel","InfoDialogView","Searcher","Toolbox","_tools","_searcher","_mfm","aisLayerSearcher","toolbox","_ssm","myFleetModel","_dbsm","_dbsv","model","tools","_ssv","_mfv","_idv","aisView","myFleetView","BaseView","apply","arguments","gifLoader","Object","defineProperty","rv","getBoundingClientRect","height","find","container","tableTemplate","cleanFilter","filterReady","filterInput","delay","doFilter","setFilter","repaint","filterString","val","clearTimeout","bind","keyup","input","keyCode","needUpdate","isDirty","update","widgets","commonCalendar","getDateInterval","prototype","_clean","inProgress","state","progress","_firstRowsPos","_firstRowsNum","_firstRowsShift","_setEventHandlers","thisInst","off","parse","xmin","xmax","longitude","ymin","ymax","latitude","ts_pos_utc","ts_pos_org","dt_pos_utc","closest","html","stopPropagation","lastPosition","showPosition","data","vessels","start","Date","scrollCont","empty","tempFirst","slice","content","msg","mcsTopPctPrev","rowH","mCustomScrollbar","callbacks","onBeforeUpdate","console","log","onUpdate","whileScrolling","mcs","topPct","end","scrollInertia","timeout","focus","_calcHeight","template","h","topOffset","view","clean","startScreen","bb","left","top","_actualUpdate","_myFleetModel","_aisLayerSearcher","thisInstance","onChanged","load","actualUpdate","Promise","resolve","all","reject","searchScreen","dateInterval","border","group","json","Status","dataSrc","Result","values","d","vessel_name","mf_member","formatDate","Math","floor","getTime","maxid","vessel_type","sog","cog","heading","icon_rot","round","placeVesselTypeIcon","RegExp","then","markMembers","ErrorInfo","some","r","txt","GroupList","visibility","settings","markerTemplate","newGroupNameValid","ngn","isValid","groups","g","createGroup","groupList","appendGroup","error","value","display","checked","drawMarkers","showOnlyMyfleet","onRepaintItem","elm","querySelector","isMemberShown","innerText","onDeleteGroup","deleteGroup","toString","onlyMyfleet","showOnlyMyFleet","onCheckItem","showMembers","onChangeGroup","changeGroup","catch","err","onExcludeItem","prepare","dlg","change","onGroupMenuShow","parseInt","marker_style","label_color","label_shadow","color","onChangeGroupStyle","colors","changeGroupStyle","onSaveGroupStyle","saveGroupStyle","freeMember","showNotOnlyMyfleet","GroupWidget","_onRepaintItemHandler","_onCheckItem","_onExcludeItem","_onChangeGroup","_onDeleteGroup","_onGroupMenuShow","_onChangeGroupStyle","_rolledupGroups","_cp1","_cp2","_cp3","_getFiltered","filtered","selectAll","selectOne","j","push","_setCheckBoxes","check","querySelectorAll","_setGroupCommands","preventDefault","currentTarget","classList","cssClass","done","next","ctxMenu","contextMenu","evnt","remove","colorChangeHandler","cs","_groupStyleChanged","style","backgroundColor","c1","cp1","c2","cp2","c3","cp3","Utils","rgb2hex","Controls","createColorPicker","document","relatedTarget","_hideContextMenu","ColorPickerHide","div","offset","clientX","clientY","offsetHeight","innerHeight","bottom","arrow","cl","contains","add","el","_onSaveGroupStyle","_saveStylePromise","groupblock","previousSibling","set","callback","index","parent","Polyfill","emptyGroup","isDefault","ms","lsc","ls","eg","label_shadow_color","default","lc","VesselData","_isDirty","_myFleetLayers","_defaultGroup","_vessels","_mapID","_prepared","_markerTemplate","_filteredState","_displayngState","_data","_view","_onChangedHandlers","_fireChanged","_loadVoyageInfo","findIndex","_parseVoyageInfo","fields","searchNames","response","_compareGroups","l","lat","lon","vt","gmx_id","sort","member","formatDateTime","gn","_repaintMap","repaintOtherMarkers","String","_queryMapLayers","buildedTree","gmxProperties","MapID","addGroupField","lid","sendCrossDomainJSONRequest","baseUrl","run","TaskID","Completed","ErorInfo","addDefaultGroup","f","fetchMyFleet","rs","rj","nickname","Nickname","count","layers","LayerID","rejectedResponse","myfleet","reduce","p","thisModel","drawMarker","membCounter","vv","splice","name","objects","action","found","temp","form","FormData","fetch","credentials","method","body","highlightMarker","hideVesselMarkers","m","predicate","list","thisArg","undefined","_searchString","_setSearchInputValue","s","searchBut","removeBut","searchInput","_highlight","_displayedOnly","calendar","mapDateInterval","DateInterval","historyInterval","dateBegin","dateEnd","CalendarWidget","dateMin","dateMax","dateFormat","minimized","showSwitcher","td","after","db","getUTCDayBoundary","setDateInterval","reset","suggestions","positions","showOtherMarkers","trg","suggestionsCount","suggestionsFrame","first","current","last","searchDone","_cleanMap","doSearch","actualId","searcher","searchString","suggestion","cr","outerWidth","keydown","prev","prepareSearchInput","originalEvent","clipboardData","getData","reload","_vi_template","_prepare_history","displayedTrack","dates","modelDate","setUTCHours","trackDate","open_pos","ind","vi_cont","siblings","infoDialog","source","source_orig","positionMap","getDates","showTrack","calendarInterval","interval","positionDate","checkInterval","zoom","getZoom","setView","_round","isNeg","power","pow","_addUnit","u","_toDd","D","lng","dir","deg","toFixed","_formatPosition","cog_sog","heading_rot","rot","x_y","eta","ts_eta","tm_pos_utc","_formatTime","tm_pos_loc","_formatDate","dt_pos_loc","eta_utc","eta_loc","draught","local","setMinutes","getMinutes","getTimezoneOffset","toLocaleTimeString","toLocaleDateString","searchPositionsAgg","parseResponse","obj","dt","t","counter","k","ErrorMessage","displayInfoDialog","VesselInfoScreen","infoDialogCascade","allIinfoDialogs","vesselInfoScreen","aisServices","_showPosition","_updateView","displayed","getmore","dialog","isNew","dialogOffset","closeFunc","event","openVesselInfoScreen","pos","ui","addUnit","formatVessel","ts_pos_loc","isNaN","Translations","getLanguage","toDd","ddToDms","dms","min","sec","commands","canvas","menu","appendTo","photo","underphoto","buttons","dialogW","dialogH","posX","posY","showDialog","vessel2","moreInfo","smallShipIcon","vesselPropTempl","registry_name","swap","mi","resizable","extend","titlebar","scheme","href","serverBase","replaceWith","menubuttons","openpage","showpos","addremoveIcon","addremove","filterUpdating","info","ex","onDone","_ais","_galery","_register","_regcap","_leftPanel","_minh","_lloyds","menuAction","preview","showPicture","errmsg","submit","$img","jQuery","imgURL","attributes","prop","$svg","removeAttr","parentElement","mia","panel","theme","w","innerWidth","documentElement","clientWidth","clientHeight","offsetWidth","drawGallery","gallery","galcontent","drawAis","ledokol","aiscontent","innerHTML","flag_country","callsign","nav_status","destination","drawRegister","regcontent","drawTable","article","pn","desc","description","pv","drawRMR","version","drawLloyds","regSwitches","item","onFail","wait","ship","registerServerUrl","lloydsServerUrl","rmr","RS","_baseUrl","_aisServices","_serverScript","_aisLastPoint","_screenSearchLayer","_aisLayerID","_historyLayer","getBorder","dFeatures","gmxDrawing","getFeatures","toGeoJSON","latLngBounds","getBounds","sw","getSouthWest","ne","getNorthEast","max","minX","maxX","geo","type","coordinates","center","formatTime","toLocaleString","formatDate2","dd","mm","getDate","getMonth","getFullYear","getHours","getUTCHours","getUTCMinutes","getUTCDate","getUTCMonth","getUTCFullYear","ldd","lm","ly","lh","lmm","request","WrapStyle","orderdirection","orderby","columns","query","join","toISOString","gmxUtil","sendCrossDomainPostRequest","searchPositions","searchById","aid","isfuzzy","toUpperCase","arr","pagesize","avessels","queryParams","minx","miny","maxx","maxy","toJSON","_layersByID","_aisLayer","_tracksLayer","_almmsi","_tlmmsi","_aldt","_tldt","getGmxProperties","_displayedTrack","_filterFunc","args","displayedVessel","mmsiArr","len","_setTrackFilter","_map","addLayer","removeFilter","_setVesselFilter","_markers","_visibleMarkers","_markerMustBeShown","_repaintOtherMarkers","di","layerGroup","clearLayers","label_line","label","text_shadow","type_color","group_name","divIcon","onlyThis","fire","paths","fill"],"mappings":"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","file":"AISPluginBeta.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e6f5dee450b2433a3ae6","let NOSIDEBAR = false,\r\n    PRODUCTION = false,\r\n    SIDEBAR2 = false,\r\n    BETA = false;\r\nif (has('NOSIDEBAR'))\r\n    NOSIDEBAR = true;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\nif (has('BETA'))\r\n    BETA = true;\r\n\r\nrequire(\"./all.css\")\r\nrequire(\"./Views/AisView.css\")\r\nrequire(\"./locale.js\")\r\n\r\nHandlebars.registerHelper('aisinfoid', function (context) {\r\n    return context.mmsi + \" \" + context.imo;\r\n});\r\n\r\nHandlebars.registerHelper('aisjson', function (context) {\r\n    return JSON.stringify(context);\r\n});\r\n\r\nconst pluginName = PRODUCTION ? (BETA ? 'AISPluginBeta' : 'AISPlugin') : 'AISSearch2Test',\r\n    menuId = 'AISSearch',\r\n    toolbarIconId = null, \r\n    cssTable = PRODUCTION ? (BETA ? 'AISPluginBeta' : 'AISPlugin') : 'AISSearch2',\r\n    modulePath = gmxCore.getModulePath(pluginName);\r\n\r\nconst highlight = L.marker([0, 0], {icon:L.icon({\r\n    className:\"ais_highlight-icon\", \r\n    iconAnchor:[12, 12], \r\n    iconSize:[25,25], \r\n    iconUrl:'plugins/ais/aissearch/highlight.png'}), zIndexOffset:1000});\r\n\r\nconst AisPluginPanel = require('./aisPluginPanel.js'),\r\n      ViewsFactory = require('./ViewsFactory');\r\nconst publicInterface = {\r\n    pluginName: pluginName,\r\n    afterViewer: function (params, map) {\r\n        const options = {\r\n            aisLayerID: params.aisLayerID,// || '8EE2C7996800458AAF70BABB43321FA4',\t// searchById\t\t\t\r\n            screenSearchLayer: params.searchLayer,// || '8EE2C7996800458AAF70BABB43321FA4', // screen search\t\t\t\t\r\n            aisLastPoint: params.aisLastPoint || '303F8834DEE2449DAF1DA9CD64B748FE', // db search\r\n            historyLayer: params.historyLayer,\t\r\n            tracksLayerID: params.tracksLayerID || '13E2051DFEE04EEF997DC5733BD69A15',\r\n\r\n            modulePath: modulePath,\r\n            highlight: highlight,\r\n            menuId: menuId\r\n        };\r\n        for (var key in params) \r\n            if (key.toLowerCase() == \"myfleet\") {\r\n                options.myFleetLayers = params[key].split(\",\").map(function (id) {\r\n                    return id.replace(/\\s/, \"\");\r\n                });\r\n                break;\r\n            }\r\n        const viewFactory = new ViewsFactory(options);\r\n        const   layersByID = nsGmx.gmxMap.layersByID,\r\n                setLayerClickHandler = function (layer) {\r\n                layer.removeEventListener('click')\r\n                layer.addEventListener('click', function (e) {\r\n                    //console.log(e)\r\n                    if (e.gmx && e.gmx.properties.hasOwnProperty(\"imo\"))\r\n                        viewFactory.infoDialogView.show(e.gmx.properties)\r\n                })\r\n                },\r\n                forLayers = function (layer) {\r\n                    try {\r\n                    if (layer) {\r\n                        //setLocaleDate(layer)\r\n                        setLayerClickHandler(layer)\r\n                    }\r\n                    }\r\n                    catch(e){}\r\n                }\r\n\r\n        for (var key in params) {\r\n            let layersId = params[key].split(\",\").map(function (id) {\r\n                return id.replace(/\\s/, \"\");\r\n            });\r\n            for (var i = 0; i < layersId.length; ++i) {\r\n//console.log(layersId[i])\r\n                forLayers(layersByID[layersId[i]]);\r\n            }\r\n        }\r\n        \r\n        const aisPluginPanel = new AisPluginPanel(viewFactory);\r\n        aisPluginPanel.menuId = menuId;\r\n\r\n        if (NOSIDEBAR) {            \r\n            let lmap = nsGmx.leafletMap,    \r\n                iconOpt_mf = {\r\n                id: menuId, //toolbarIconId,\r\n                className: \"VesselSearchTool\",\r\n                togglable: true,\r\n                title: _gtxt('AISSearch2.caption')\r\n            };\r\n            if (toolbarIconId)\r\n                iconOpt_mf.id = toolbarIconId;\r\n            else\r\n                iconOpt_mf.text = _gtxt('AISSearch2.capShort');            \r\n            let icon_mf = L.control.gmxIcon(iconOpt_mf).on('statechange', function (ev) {\r\n                if (ev.target.options.isActive) {\r\n                    aisPluginPanel.show();\r\n                    $('.ais_view .instruments').width('100%');\r\n                    $('.ais_tab div').css('font-size', '12px');\r\n                }\r\n                else {\r\n                    aisPluginPanel.hide();\r\n                }\r\n            });\r\n            lmap.addControl(icon_mf);\r\n        }\r\n        else {\r\n            let sidebar = SIDEBAR2 ? window.iconSidebarWidget : window.sidebarControl;\r\n            aisPluginPanel.sidebarPane =  sidebar.setPane(\r\n                    menuId, { \r\n                        position: params.showOnTop ? -100 : 0,\r\n                        createTab: window.createTabFunction({\r\n                            icon: menuId,\r\n                            active: \"ais_sidebar-icon-active\",\r\n                            inactive: \"ais_sidebar-icon\",\r\n                            hint: _gtxt('AISSearch2.caption')\r\n                        })\r\n                    }\r\n                )\r\n            sidebar.addEventListener('opened', function (e) {\r\n                if (sidebar._activeTabId==menuId)                \r\n                    aisPluginPanel.show();\r\n            });\r\n            if (params.showOnTop) { // hack\r\n                $('div[data-pane-id]').removeClass('iconSidebarControl-pane-active')\r\n                sidebar._renderTabs({ activeTabId: menuId });\r\n                setTimeout(() => sidebar.open(menuId), 50);\r\n            }\r\n        }\r\n\r\n        if (location.search.search(/x=[^y=]+y=/i) != -1) {\r\n            var a = location.search.toLowerCase().substr(1).split('&'),\r\n                x = a.filter(function (c) { return !c.indexOf(\"x=\") })[0].substr(2),\r\n                y = a.filter(function (c) { return !c.indexOf(\"y=\") })[0].substr(2)\r\n            highlight.vessel = null;\r\n            highlight.setLatLng([y, x]).addTo(nsGmx.leafletMap);    \r\n            nsGmx.leafletMap.fitBounds([\r\n                [y, x],\r\n                [y, x]\r\n            ], {\r\n                    maxZoom: 9,//config.user.searchZoom,\r\n                    animate: false\r\n            }) \r\n        }\r\n    }\r\n};\r\n\r\ngmxCore.addModule(pluginName, publicInterface, {\r\n    css: cssTable + '.css'\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/entry.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/all.css\n// module id = 1\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/AisView.css\n// module id = 3\n// module chunks = 0","\r\n    _translationsHash.addtext('rus', {\r\n        'AISSearch2.title': 'Поиск судов',\r\n        'AISSearch2.title1': 'Найдено судов',\r\n        'AISSearch2.title2': '<b>Данных не найдено!</b>',\r\n        'AISSearch2.error': '<b>Ошибка при получении данных!</b>',\r\n        'AISSearch2.iconTitle': 'Поиск судов по экрану',\r\n        'AISSearch2.placeholder_0': 'Поиск по адресам, координатам',\r\n        'AISSearch2.placeholder_1': 'Поиск судна по названию / MMSI',\r\n        // 'AISSearch2.placeholder_1': 'Поиск судна по названию / MMSI. Поиск по адресам, координатам, кадастровым номерам'\r\n        'AISSearch2.myFleetDialog': 'Мой флот',\r\n        'AISSearch2.vesselName': 'название',\r\n        'AISSearch2.vesselAdd': 'добавить',\r\n        'AISSearch2.vesselRemove': 'удалить',\r\n        'AISSearch2.vesselExclude': 'исключить',\r\n        'AISSearch2.myFleetMembers': 'Состав',\r\n        'AISSearch2.myFleetMember': 'мой флот',\r\n        'AISSearch2.info': 'информация',\r\n        'AISSearch2.position': 'положение',\r\n        'AISSearch2.found':'Найдено: ',\r\n        'AISSearch2.filter':'Введите название или mmsi или imo судна',\r\n        'AISSearch2.filterName':'Введите название судна',\r\n        'AISSearch2.screen':'По экрану',\r\n        'AISSearch2.database':'По базе данных',\r\n        'AISSearch2.capShort': 'Поиск судов',\r\n        'AISSearch2.caption': 'Поиск судов и \"Мой флот\"',\r\n        'AISSearch2.refresh': 'обновить',\r\n        'AISSearch2.refreshing': 'обновляется',\r\n        'AISSearch2.nomyfleet': 'Сервис не доступен',\r\n        'AISSearch2.auth': 'Требуется авторизация',\r\n        'AISSearch2.vessel_info':'ИНФОРМАЦИЯ О СУДНЕ',\r\n        'AISSearch2.vessel_voyage':'СВЕДЕНИЯ О ДВИЖЕНИИ',\r\n        'AISSearch2.vessel_name': 'Название',\r\n        'AISSearch2.mmsi': 'MMSI',\r\n        'AISSearch2.imo': 'IMO',\r\n        'AISSearch2.flag_country': 'Страна',\r\n        'AISSearch2.vessel_type': 'Тип судна',\r\n        'AISSearch2.flag': 'Флаг',\r\n        'AISSearch2.callsign': 'Позывной',\r\n        'AISSearch2.length': 'Длина',\r\n        'AISSearch2.width': 'Ширина',\r\n        'AISSearch2.draught': 'Осадка',\r\n        'AISSearch2.destination': 'Назначение',\r\n        'AISSearch2.eta': 'Расчетное время прибытия',\r\n        'AISSearch2.nav_status': 'Статус',\r\n        'AISSearch2.last_sig': 'Последний сигнал',\r\n        'AISSearch2.show_track': 'трек за сутки',\r\n        'AISSearch2.hide_track': 'скрыть трек',\r\n\t\t'AISSearch2.source': 'Источник данных',\r\n\t\t'AISSearch2.sais': 'спутниковый AIS',\r\n\t\t'AISSearch2.tais': 'береговой AIS',\r\n\t\t'AISSearch2.lon': 'Долгота',\r\n\t\t'AISSearch2.lat': 'Широта',\r\n\t\t'AISSearch2.historyTab': 'История',\r\n        'AISSearch2.voyageInfo': 'Параметры движения',\r\n        'AISSearch2.DbSearchTab':'БАЗА ДАННЫХ',\r\n        'AISSearch2.ScreenSearchTab':'СУДА НА ЭКРАНЕ',\r\n        'AISSearch2.MyFleetTab':'МОЙ ФЛОТ',\r\n        'AISSearch2.dailyTrack':'трек за сутки',\r\n        'AISSearch2.myFleetOnly':'только мой флот',\r\n        'AISSearch2.show_pos':'показать положение и историю',\r\n        'AISSearch2.show_info':'информация о судне',\r\n        'AISSearch2.time_switch':'Время',\r\n        'AISSearch2.time_local':'Местное',\r\n        'AISSearch2.calendar_today':'сегодня',\r\n        'AISSearh2.searchresults_view':'Здесь будут отображаться<br>результаты поиска по названию,<br>IMO илм MMSI судна',\r\n        'AISSearh2.myfleet_view':'Здесь будут отображаться<br>выбранные суда<br>',\r\n        'AISSearch2.dialog_tab_general':'Общие сведения',\r\n        'AISSearch2.dialog_tab_params':'Параметры движения',\r\n        'AISSearch2.close_but':'закрыть',\r\n        'AISSearch2.myfleet_add':'добавить в мой флот',\r\n        'AISSearch2.myfleet_remove':'удалить из моего флота',\r\n        'AISSearch2.infoscreen_gen':'Основные сведения',\r\n        'AISSearch2.infoscreen_reg':'Регистр',\r\n        'AISSearch2.infoscreen_gal':'Фотогалерея',\r\n        'AISSearch2.last_update':'Обновление базы данных',\r\n        'AISSearch2.reg_general_tab':'Общие сведения',\r\n        'AISSearch2.reg_build_tab':'Сведения о постройке',\r\n        'AISSearch2.reg_chars_tab':'Размеры и скорость',\r\n        'AISSearch2.reg_devs_tab':'Оборудование',\r\n        'AISSearch2.rmrs':'РМРС',\r\n        'AISSearch2.AddIntoGroup':'Добавить в группу:',\r\n        'AISSearch2.RemoveFromGroup':'Удалить из группы',        \r\n        'AISSearch2.AllGroup':'Все',        \r\n        'AISSearch2.NewGroup':'Новая группа',        \r\n        'AISSearch2.NewGroupName':'название',        \r\n        'AISSearch2.CreateGroup':'создать',        \r\n        'AISSearch2.DeleteGroup':'удалить группу',       \r\n        'AISSearch2.DeleteGroupCommand':'Удалить группу',      \r\n        'AISSearch2.DisplaySection':'Показать на карте:',    \r\n        'AISSearch2.DisplayVesselName':'название судна',    \r\n        'AISSearch2.DisplayGroupName':'название группы',    \r\n        'AISSearch2.DisplayCog':'курс',    \r\n        'AISSearch2.DisplaySog':'скорость',   \r\n        'AISSearch2.KnotShort':' уз',\r\n        'AISSearch2.thisVesselOnly':'Только это судно: ',\r\n        'AISSearch2.markerShadow':'Цвет обводки маркера',\r\n        'AISSearch2.labelColor':'Цвет подписи маркера',\r\n        'AISSearch2.labelShadow':'Цвет обводки подписи',\r\n\r\n    });\r\n    _translationsHash.addtext('eng', {\r\n        'AISSearch2.title': 'Searching vessels',\r\n        'AISSearch2.title1': 'Vessels found',\r\n        'AISSearch2.title2': '<b>Vessels not found!</b>',\r\n        'AISSearch2.error': '<b>Vessels not found!</b>',\r\n        'AISSearch2.iconTitle': 'Search vessels within the view area',\r\n        'AISSearch2.placeholder_0': 'Search for addresses, coordinates',\r\n        'AISSearch2.placeholder_1': 'Search by vessel name / MMSI',\r\n        // 'AISSearch2.placeholder_1' : 'Search by vessel name / MMSI. Search by addresses, coordinates, cadastre number'\r\n        'AISSearch2.myFleetDialog': 'My fleet',\r\n        'AISSearch2.vesselName': 'name',\r\n        'AISSearch2.vesselAdd': 'add',\r\n        'AISSearch2.vesselRemove': 'remove',\r\n        'AISSearch2.vesselExclude': 'exclude',\r\n        'AISSearch2.myFleetMembers': 'Members',\r\n        'AISSearch2.myFleetMember': 'my fleet',\r\n        'AISSearch2.info': 'info',\r\n        'AISSearch2.position': 'position',\r\n        'AISSearch2.found':'Found ',\r\n        'AISSearch2.filter':'Insert vessel name or mmsi or imo',\r\n        'AISSearch2.filterName':'Insert vessel name',\r\n        'AISSearch2.screen':'On screen',\r\n        'AISSearch2.database':'In database',\r\n        'AISSearch2.capShort': 'Vessel Search',\r\n        'AISSearch2.caption': 'Vessel Search & My Fleet',\r\n        'AISSearch2.refresh': 'refresh',\r\n        'AISSearch2.refreshing': 'refreshing',\r\n        'AISSearch2.nomyfleet': 'Service is unavailable',\r\n        'AISSearch2.auth': 'Authorization required',\r\n        'AISSearch2.vessel_info':'VESSEL INFORMATION',\r\n        'AISSearch2.vessel_voyage':'VOYAGE INFORMATION',\r\n        'AISSearch2.vessel_name': 'Name',\r\n        'AISSearch2.mmsi': 'MMSI',\r\n        'AISSearch2.imo': 'IMO',\r\n        'AISSearch2.flag_country': 'Flag',\r\n        'AISSearch2.vessel_type': 'Vessel type',\r\n        'AISSearch2.flag': 'Flag',\r\n        'AISSearch2.callsign': 'Callsign',\r\n        'AISSearch2.length': 'Length',\r\n        'AISSearch2.width': 'Width',\r\n        'AISSearch2.draught': 'Draught',\r\n        'AISSearch2.destination': 'Destination',\r\n        'AISSearch2.eta': 'ETA',\r\n        'AISSearch2.nav_status': 'Navigation status',\r\n        'AISSearch2.last_sig': 'Last signal',\r\n        'AISSearch2.show_track': 'show track',\r\n        'AISSearch2.hide_track': 'hide track',\r\n\t\t'AISSearch2.source': 'Source',\r\n\t\t'AISSearch2.sais': 'S-AIS',\r\n\t\t'AISSearch2.tais': 'T-AIS',\r\n\t\t'AISSearch2.lon': 'Longitude',\r\n\t\t'AISSearch2.lat': 'Latitude',\r\n\t\t'AISSearch2.historyTab': 'History',\r\n\t\t'AISSearch2.voyageInfo': 'Voyage Info',\r\n        'AISSearch2.DbSearchTab':'DATA BASE',\r\n        'AISSearch2.ScreenSearchTab':'VESSELS ON SCREEN',\r\n        'AISSearch2.MyFleetTab':'MY FLEET',\r\n        'AISSearch2.dailyTrack':'Daily Track',\r\n        'AISSearch2.myFleetOnly':'my fleet only',\r\n        'AISSearch2.show_pos':'position and history',\r\n        'AISSearch2.show_info':'vessel data',\r\n        'AISSearch2.time_switch':'Time',\r\n        'AISSearch2.time_local':'Local',\r\n        'AISSearch2.calendar_today':'today',\r\n        'AISSearh2.searchresults_view':'Results View of Vessel Search<br>by Name,IMO or MMSI',\r\n        'AISSearh2.myfleet_view':'List of Special Selected<br>Vessels<br>',       \r\n        'AISSearch2.dialog_tab_general':'General',\r\n        'AISSearch2.dialog_tab_params':'Parameters',\r\n        'AISSearch2.close_but':'close',\r\n        'AISSearch2.myfleet_add':'include in my fleet',\r\n        'AISSearch2.myfleet_remove':'exclude from my fleet' ,\r\n        'AISSearch2.infoscreen_gen':'General',\r\n        'AISSearch2.infoscreen_reg':'Register',\r\n        'AISSearch2.infoscreen_gal':'Gallery',\r\n        'AISSearch2.last_update':'Last update',   \r\n        'AISSearch2.reg_general_tab':'General',\r\n        'AISSearch2.reg_build_tab':'Building',\r\n        'AISSearch2.reg_chars_tab':'Specification',\r\n        'AISSearch2.reg_devs_tab':'Equipment',        \r\n        'AISSearch2.rmrs':'RMRS',\r\n        'AISSearch2.AddIntoGroup':'Add into group',\r\n        'AISSearch2.RemoveFromGroup':'Remove from group',        \r\n        'AISSearch2.AllGroup':'All',        \r\n        'AISSearch2.NewGroup':'New group',        \r\n        'AISSearch2.NewGroupName':'name',        \r\n        'AISSearch2.CreateGroup':'create',        \r\n        'AISSearch2.DeleteGroup':'delete group',       \r\n        'AISSearch2.DeleteGroupCommand':'Delete group',      \r\n        'AISSearch2.DisplaySection':'Display on map:',    \r\n        'AISSearch2.DisplayVesselName':'vessel name',    \r\n        'AISSearch2.DisplayGroupName':'group name',    \r\n        'AISSearch2.DisplayCog':'cog',    \r\n        'AISSearch2.DisplaySog':'sog',   \r\n        'AISSearch2.KnotShort':' kn',\r\n        'AISSearch2.thisVesselOnly':'Only this ship ',\r\n        'AISSearch2.markerShadow':'Marker highlight',\r\n        'AISSearch2.labelColor':'Label color',\r\n        'AISSearch2.labelShadow':'Label highlight',\r\n\r\n    });\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/locale.js","let NOSIDEBAR = false,\r\n    PRODUCTION = false,\r\n    SIDEBAR2 = false;\r\nif (has('NOSIDEBAR'))\r\n    NOSIDEBAR = true;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\n\r\n\r\nmodule.exports = function (viewFactory) {\r\n    let _leftMenuBlock,\r\n        _canvas = _div(null),\r\n        _activeView,\r\n        _views = viewFactory.create(),\r\n        _isReady = false,\r\n        _createTabs = function () {\r\n            let tabsTemplate = '<table class=\"ais_tabs\" border=0><tr>' +\r\n\r\n                '</td><td class=\"ais_tab myfleet_tab unselectable\" unselectable=\"on\">' + // ACTIVE\r\n                '<div>{{i \"AISSearch2.MyFleetTab\"}}</div>' +\r\n              \r\n                '<td class=\"ais_tab dbsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.DbSearchTab\"}}</div>' +\r\n                '</td><td class=\"ais_tab scrsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.ScreenSearchTab\"}}</div>' +\r\n              \r\n                '</td></tr></table>'\r\n\r\n            if (NOSIDEBAR)\r\n                $(_leftMenuBlock.workCanvas).append(_canvas);\r\n            else\r\n                $(this.sidebarPane).append(_canvas);\r\n\r\n            $(_canvas).append(Handlebars.compile(tabsTemplate));\r\n            $(_canvas).append(_views.map(v => v.frame));\r\n    \r\n            let tabs = $('.ais_tab', _canvas),\r\n                _this = this;           \r\n            _views.forEach((v,i) =>{\r\n                v.tab = tabs.eq(i);\r\n                v.resize(true);\r\n            }); \r\n            tabs.on('click', function () {\r\n                if (!$(this).is('.active')) {\r\n                    let target = this;\r\n                    tabs.each(function (i, tab) {\r\n                        if (!$(tab).is('.active') && target == tab) {\r\n                            $(tab).addClass('active');\r\n                            _views[i].show();\r\n                            _activeView = _views[i];\r\n                        }\r\n                        else {\r\n                            $(tab).removeClass('active');\r\n                            _views[i].hide();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n\r\n            // Show the first tab\r\n            tabs.eq(0).removeClass('active').click();\r\n\r\n            if (NOSIDEBAR) {\r\n                _returnInstance.hide = function () {\r\n                    $(_leftMenuBlock.parentWorkCanvas).hide();\r\n                    nsGmx.leafletMap.removeLayer(highlight);\r\n                }\r\n\r\n                $(_leftMenuBlock.parentWorkCanvas)\r\n                    .attr('class', 'left_aispanel')\r\n                    .insertAfter('.layers-before');\r\n                var blockItem = _leftMenuBlock.leftPanelItem,\r\n                    blockTitle = $('.leftmenu-path', blockItem.panelCanvas);\r\n                var toggleTitle = function () {\r\n                    if (blockItem.isCollapsed())\r\n                        blockTitle.show();\r\n                    else\r\n                        blockTitle.hide();\r\n                }\r\n                $(blockItem).on('changeVisibility', toggleTitle);\r\n                toggleTitle();\r\n            }\r\n\r\n            // All has been done at first time\r\n            _isReady = true;\r\n        },\r\n\r\n    _returnInstance = {\r\n        show: function () {\r\n            let lmap = nsGmx.leafletMap;\r\n            if (NOSIDEBAR && !_leftMenuBlock)\r\n                _leftMenuBlock = new leftMenu();\r\n\r\n            if ((NOSIDEBAR && (!_leftMenuBlock.createWorkCanvas(\"aispanel\",\r\n                function () { lmap.gmxControlIconManager.get(this.menuId)._iconClick() },\r\n                { path: [_gtxt('AISSearch2.caption')] })\r\n            )) || (!_isReady)) // SIDEBAR\r\n            {\r\n                _createTabs.call(this);\r\n            }\r\n            else{\r\n                if (NOSIDEBAR){\r\n                    $(_leftMenuBlock.parentWorkCanvas)\r\n                    .insertAfter('.layers-before');\r\n                }            \r\n                _activeView && _activeView.show();\r\n            }\r\n        }\r\n    };\r\n    return _returnInstance;\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/aisPluginPanel.js","const ScreenSearchView = require('./Views/ScreenSearchView'),\r\n    ScreenSearchModel = require('./Models/ScreenSearchModel'),\r\n    MyFleetView = require('./Views/MyFleetView'),\r\n    MyFleetModel = require('./Models/MyFleetModel'),\r\n    DbSearchView = require('./Views/DbSearchView'),\r\n    DbSearchModel = require('./Models/DbSearchModel'),\r\n    InfoDialogView = require('./Views/InfoDialogView'),\r\n    Searcher = require('./Search/Searcher'),\r\n    Toolbox = require('./Toolbox.js');\r\n\r\nmodule.exports = function (options) {\r\n    const _tools = new Toolbox(options),\r\n        //_layersByID = nsGmx.gmxMap.layersByID,\r\n        _searcher = new Searcher(options),\r\n        _mfm = new MyFleetModel({aisLayerSearcher:_searcher, toolbox:_tools}),\r\n        _ssm = new ScreenSearchModel({ aisLayerSearcher: _searcher, myFleetModel: _mfm }),\r\n        _dbsm = new DbSearchModel(_searcher),\r\n        _dbsv = new DbSearchView({model:_dbsm, highlight:options.highlight, tools:_tools}),\r\n        _ssv = new ScreenSearchView(_ssm),\r\n        _mfv = new MyFleetView(_mfm),\r\n        _idv = new InfoDialogView({\r\n            tools:_tools,\r\n            aisLayerSearcher: _searcher, \r\n            modulePath: options.modulePath,\r\n            aisView: _dbsv, \r\n            myFleetView: _mfv,\r\n            menuId: options.menuId\r\n        });\r\n        _ssv.infoDialogView = _idv;\r\n        _mfv.infoDialogView = _idv;\r\n        _dbsv.infoDialogView = _idv;\r\n    return {\r\n        get infoDialogView(){\r\n            return _idv;\r\n        },\r\n        create: function () {\r\n            return [ _mfv, _dbsv, _ssv ];\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/ViewsFactory.js","const BaseView = require('./BaseView.js');\r\nconst ScreenSearchView = function (model) {\r\n    BaseView.apply(this, arguments);\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view search_view\">' +\r\n\r\n        '<table border=0 class=\"instruments\">' +\r\n        //'<tr><td colspan=\"2\"><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filter\"}}\"/><i class=\"icon-flclose clicable\"></div></td></tr>'+\r\n        '<tr><td><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filterName\"}}\"/>' +\r\n        '<div><img class=\"search clicable\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        '<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\">' +\r\n        '</div></div>' +\r\n        '<div>&nbsp;</div>'+\r\n        '</td></tr>' + \r\n        '</table>' +\r\n\r\n        '<table class=\"results\">'+\r\n        '<tr><td class=\"count\"></td>' +\r\n        '<td><div class=\"refresh clicable\" title=\"{{i \"AISSearch2.refresh\"}}\"><div>' + this.gifLoader + '</div></div></td></tr>' +\r\n        '</table>'+\r\n        // '<table class=\"start_screen\"><tr><td>'+\r\n        // '<img src=\"plugins/AIS/AISSearch/svg/steer-weel.svg\">'+\r\n        // '<div>Здесь будут отображаться<br>результаты поиска</div></td></tr></table>'+\r\n        '<div class=\"ais_vessels\">'+\r\n        '<div class=\"ais_vessel\">' +\r\n        '<table border=0><tr><td><div class=\"position\">NO VESSELS</div><div>mmsi: 0 imo: 0</div></td>' +\r\n        '<td><i class=\"icon-ship\" vessel=\"\" title=\"\"></i></td>' +\r\n        '<td><span class=\"date\"></span></td>'+\r\n        '<td><div class=\"info\" vessel=\"aisjson this\" title=\"i AISSearch2.info\">' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n        '</div></td></tr></table>' +\r\n        '</div>' +       \r\n        '</div>' +\r\n        \r\n        '</div>'\r\n    )());\r\n    Object.defineProperty(this, \"topOffset\", {\r\n        get: function () {\r\n            let rv = $('.ais_tabs')[0].getBoundingClientRect().height + \r\n            this.frame.find('.instruments')[0].getBoundingClientRect().height + \r\n            this.frame.find('.results')[0].getBoundingClientRect().height;\r\n            return rv;\r\n        }\r\n    });    \r\n    this.container = this.frame.find('.ais_vessels');\r\n    //this.startScreen = this.frame.find('.start_screen');\r\n    this.tableTemplate = '{{#each vessels}}' +\r\n        '<div class=\"ais_vessel\">' +\r\n        '<table border=0><tr><td><div class=\"position\">{{vessel_name}}</div><div>mmsi: {{mmsi}} imo: {{imo}}</div></td>' +       \r\n        '<td><img src=\"{{icon}}\" class=\"rotateimg{{icon_rot}}\"></td>' +\r\n        \r\n        //'<td><i class=\"icon-ship\" vessel=\"{{aisinfoid this}}\" style=\"{{mf_member}}\" title=\"{{i \"AISSearch2.myFleetMember\"}}\"></i></td>' +\r\n        '<td><span vessel=\"{{aisinfoid this}}\" style=\"{{mf_member}}\" title=\"{{i \"AISSearch2.myFleetMember\"}}\">'+        \r\n        '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"14px\" height=\"14px\" viewBox=\"0 0 14 14\" xml:space=\"preserve\">' +\r\n        '<g style=\"fill: #48aff1;\">' +\r\n        '<path class=\"st0\" d=\"M13.4,11H0.6c-0.2,0-0.4,0.1-0.5,0.3c-0.1,0.2-0.1,0.4,0,0.6l1.2,1.8C1.4,13.9,1.6,14,1.8,14h9.9   c0.2,0,0.3-0.1,0.4-0.2l1.7-1.8c0.2-0.2,0.2-0.4,0.1-0.7C13.9,11.1,13.7,11,13.4,11z\"/>' +\r\n        '<path class=\"st0\" d=\"M9.3,9.7h2.9c0.2,0,0.4-0.1,0.5-0.3c0.1-0.2,0.1-0.4,0-0.6L9.8,4.5C9.7,4.3,9.4,4.2,9.2,4.3   C8.9,4.4,8.7,4.6,8.7,4.9v4.3C8.7,9.5,9,9.7,9.3,9.7z\"/>' +\r\n        '<path class=\"st0\" d=\"M1.2,9.7H7c0.3,0,0.6-0.3,0.6-0.6V0.6c0-0.3-0.2-0.5-0.4-0.6C6.9-0.1,6.7,0,6.5,0.3L0.7,8.8   C0.6,9,0.5,9.2,0.6,9.4C0.7,9.6,0.9,9.7,1.2,9.7z\"/>' +\r\n        '</g>' +\r\n        '</svg></span></td>'+\r\n        \r\n        '<td><span class=\"date\">{{ts_pos_utc}}</span></td>'+\r\n        '<td><div class=\"info\" vessel=\"{{aisjson this}}\" title=\"{{i \"AISSearch2.info\"}}\">' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n        '</div></td></tr></table>' +\r\n        '</div>' +\r\n        '{{/each}}' +\r\n        '{{#each msg}}<div class=\"msg\">{{txt}}</div>{{/each}}';\r\n\r\n    let cleanFilter = this.frame.find('.remove'),\r\n        filterReady = this.frame.find('.search'),\r\n        filterInput = this.frame.find('input'),\r\n        delay,\r\n        doFilter = function(){\r\n            this.model.setFilter();             \r\n            this.repaint();\r\n//console.log(\"doFilter\")\r\n        };\r\n        cleanFilter.click(function(e){\r\n            if (this.model.filterString === '')\r\n                return;\r\n            filterInput.val('');\r\n            this.model.filterString = '';  \r\n            clearTimeout(delay)\r\n            doFilter.call(this);\r\n            //nsGmx.leafletMap.removeLayer(highlight);\r\n        }.bind(this))\r\n        filterInput.keyup(function(e){            \r\n            let input = filterInput.val() || \"\";\r\n            input = input.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n            if (input===\"\"){\r\n                filterReady.show();\r\n                cleanFilter.hide();\r\n            }\r\n            else{\r\n                cleanFilter.show();\r\n                filterReady.hide();\r\n            }\r\n\r\n            if (input==this.model.filterString && e.keyCode!=13)\r\n                return;\r\n            this.model.filterString = input; \r\n            if (e.keyCode==13)\r\n                this.model.filterString += '\\r' ;  \r\n            clearTimeout(delay)\r\n            delay = setTimeout((() => { doFilter.call(this) }).bind(this), 500);\r\n            //nsGmx.leafletMap.removeLayer(highlight);\r\n        }.bind(this))\r\n    \r\n    let needUpdate = function(){\r\n        this.model.isDirty = true;\r\n        if (this.container.is(':visible')) {\r\n \r\n            clearTimeout(delay)\r\n            delay = setTimeout((() => { this.model.update() }).bind(this), 300);  \r\n        }\r\n    };\r\n    nsGmx.leafletMap.on('moveend', needUpdate.bind(this));\r\n    nsGmx.widgets.commonCalendar.getDateInterval().on('change', needUpdate.bind(this));\r\n};\r\n\r\nScreenSearchView.prototype = Object.create(BaseView.prototype);\r\n\r\nlet _clean = function () {\r\n    this.frame.find('.count').text(_gtxt('AISSearch2.found') + 0); \r\n};\r\n\r\nScreenSearchView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div');\r\n    if (state)\r\n        progress.show();\r\n    else\r\n        progress.hide();\r\n};\r\n\r\nlet\r\n_firstRowsPos = 0,\r\n_firstRowsNum = 40,\r\n_firstRowsShift = 20,\r\n_setEventHandlers = function(){\r\n    let thisInst = this;\r\n    this.container.find('.info', ).off('click').on('click', function (e) {\r\n        let target = $(this),\r\n            vessel = JSON.parse(target.attr('vessel'))\r\n//console.log(vessel)\r\n        thisInst.infoDialogView && thisInst.infoDialogView.show(vessel, (v) => {\r\n//console.log(v)\r\n            vessel.xmin = vessel.xmax = v.longitude\r\n            vessel.ymin = vessel.ymax = v.latitude\r\n            if (vessel.hasOwnProperty('ts_pos_utc')) {\r\n                 vessel.ts_pos_utc = v.ts_pos_utc;\r\n                 vessel.ts_pos_org = v.ts_pos_org;\r\n                 v.dt_pos_utc && $(this).closest('tr').find('.date').html(v.dt_pos_utc);\r\n            }\r\n            target.attr('vessel', JSON.stringify(vessel))\r\n        });\r\n        e.stopPropagation();\r\n    });\r\n    this.container.find('.ais_vessel').off('click').on('click', function () {\r\n//console.log(JSON.parse($(this).find('.info').attr('vessel')))\r\n        let v = JSON.parse($(this).find('.info').attr('vessel'));                \r\n        v.lastPosition = true;\r\n        thisInst.infoDialogView.showPosition(v);\r\n    }); \r\n//console.log(\"repaint \"+(new Date()-start)+\"ms\" )      \r\n}\r\n\r\nScreenSearchView.prototype.repaint = function () {\r\n    _clean.call(this);\r\n    this.frame.find('.count').text(_gtxt('AISSearch2.found')+this.model.data.vessels.length);   \r\n    //BaseView.prototype.repaint.apply(this, arguments);\r\n    ////////////////////////////////////////////////////\r\n    let start = new Date();\r\n\r\n    //_clean.call(this);\r\n    this.container.find('.info').off('click');\r\n    this.container.find('.ais_vessel', ).off('click');   \r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n    if (!this.model.data)\r\n        return;\r\n    let thisInst = this,\r\n        tempFirst = this.model.data.vessels.slice(0, _firstRowsNum),\r\n        content = $(Handlebars.compile(this.tableTemplate)({msg:this.model.data.msg, vessels:tempFirst})),\r\n        mcsTopPctPrev = 0,\r\n        rowH;\r\n    _firstRowsPos = _firstRowsNum;\r\n\r\n    if (!scrollCont[0]) {\r\n        this.container.mCustomScrollbar(\"destroy\").append(content).mCustomScrollbar({\r\n            //scrollInertia: 0,//this.model.data.vessels.length > _firstRowsNum ? 0 : 600,\r\n            callbacks:{\r\n                onBeforeUpdate: function(){console.log(\"onBeforeUpdate\")},\r\n                onUpdate: function(){console.log(\"onUpdate\")},\r\n                //onScroll:function(){\r\n                whileScrolling: /*scrollingHandler*/function(){                    \r\n//console.log(\"% \" + this.mcs.topPct + \" pos\" + _firstRowsPos)\r\n                    if (this.mcs.topPct==100 && mcsTopPctPrev != 100 && thisInst.model.data.vessels.length > _firstRowsPos){\r\n                        let start = _firstRowsPos - _firstRowsNum + _firstRowsShift,\r\n                            end = _firstRowsPos + _firstRowsShift;\r\n                        if (thisInst.model.data.vessels.length-start <= thisInst.container.height()/rowH)\r\n                            start = thisInst.model.data.vessels.length - _firstRowsNum;\r\n///console.log(\">\"+start+\", \"+end)\r\n                        tempFirst = thisInst.model.data.vessels.slice(start, end),\r\n                        _firstRowsPos += _firstRowsShift;                       \r\n                        let scrollCont = thisInst.container.find('.mCSB_container');\r\n                        scrollCont.html(Handlebars.compile(thisInst.tableTemplate)({vessels:tempFirst}));  \r\n//console.log(\"h=\"+rowH) \r\n                        setTimeout(()=>{\r\n                            thisInst.container.mCustomScrollbar(\"scrollTo\",\r\n                                -rowH * _firstRowsShift + thisInst.container.height(), {\r\n                                    scrollInertia: 0,\r\n                                    callbacks: false\r\n                                });\r\n                            _setEventHandlers.call(thisInst);\r\n                        }, 200);\r\n                    }\r\n                    if (this.mcs.topPct == 0 && mcsTopPctPrev != 0 && _firstRowsPos > _firstRowsNum) {\r\n//console.log(_firstRowsPos)\r\n                        let start = _firstRowsPos - _firstRowsShift - _firstRowsNum,\r\n                            end = _firstRowsPos - _firstRowsShift;\r\n//console.log(\"<\"+start + \", \" + end)\r\n                        tempFirst = thisInst.model.data.vessels.slice(start, end),\r\n                        _firstRowsPos -= _firstRowsShift;                       \r\n                        let scrollCont = thisInst.container.find('.mCSB_container');\r\n                        scrollCont.html(Handlebars.compile(thisInst.tableTemplate)({ vessels: tempFirst })); \r\n//console.log(\"h=\"+rowH)\r\n                        setTimeout(() => {\r\n                            thisInst.container.mCustomScrollbar(\"scrollTo\",\r\n                                rowH * _firstRowsShift, {\r\n                                    scrollInertia: 0,\r\n                                    callbacks: false\r\n                                })\r\n                            _setEventHandlers.call(thisInst);\r\n                        }, 200);\r\n                    }\r\n                    mcsTopPctPrev = this.mcs.topPct;\r\n                }\r\n            }\r\n        });\r\n        scrollCont = this.container.find('.mCSB_container');\r\n        rowH = scrollCont.height()/$('.ais_vessel', scrollCont).length;\r\n    }\r\n    else {\r\n        scrollCont.append(content);\r\n        this.container.mCustomScrollbar(\"scrollTo\", \"top\", {scrollInertia:0, callbacks:false, timeout:200});\r\n    }\r\n    _setEventHandlers.call(this);\r\n\r\n};\r\n\r\nScreenSearchView.prototype.show = function () {\r\n    BaseView.prototype.show.apply(this, arguments);\r\n    this.frame.find('.filter input').focus();\r\n};\r\n\r\nmodule.exports = ScreenSearchView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/ScreenSearchView.js","let NOSIDEBAR = false,\r\n    PRODUCTION = false,\r\n    SIDEBAR2 = false;\r\nif (has('NOSIDEBAR'))\r\n    NOSIDEBAR = true;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\n\r\nlet _calcHeight = function () {  \r\n    if (NOSIDEBAR){\r\n        let template = this.frame.find('.ais_vessel')[0] || this.frame.find('.ais_positions_date')[0],\r\n            h = template.getBoundingClientRect().height;  \r\n        return h * 5;\r\n    }\r\n    else {\r\n        return $('.iconSidebarControl-pane').height() - this.topOffset;\r\n    }\r\n};\r\n\r\nconst BaseView = function (model) {\r\n    model.view = this;\r\n    this.model = model;\r\n    this.gifLoader = '<img src=\"img/progress.gif\">';\r\n};\r\n\r\nlet _clean = function(){ \r\n    this.container.find('.info').off('click');\r\n    this.container.find('.position', ).off('click');   \r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n//console.log(\"EMPTY ON BASE.CLEAN\")\r\n};\r\n\r\nBaseView.prototype = function () {\r\n    return {\r\n        get isActive(){\r\n            return this.frame.is(\":visible\");\r\n        },\r\n        resize: function (clean) {\r\n            let h = _calcHeight.call(this);\r\n            if (this.startScreen){\r\n                let bb = $('.iconSidebarControl-pane:visible')[0].getBoundingClientRect();\r\n                this.startScreen.css({ position:\"absolute\", left: bb.left+\"px\", top: (bb.height/2-100)+\"px\", \r\n                width: bb.width+\"px\"});\r\n            }\r\n            this.container.height(h);\r\n\r\n            if (clean){\r\n                this.container.empty()\r\n            }\r\n        },\r\n        repaint: function(){\r\n            _clean.call(this);            \r\n//console.log(this.model.data)\r\n            if (!this.model.data)\r\n                return;\r\n            let scrollCont = this.container.find('.mCSB_container'),\r\n            content = $(Handlebars.compile(this.tableTemplate)(this.model.data));\r\n            if (!scrollCont[0]) {\r\n                this.container.append(content).mCustomScrollbar();\r\n            }\r\n            else {\r\n                $(scrollCont).append(content);\r\n            }\r\n\r\n            var _this = this;\r\n            this.container.find('.info', ).on('click', function (e) {\r\n                let target = $(this),\r\n                    vessel = JSON.parse(target.attr('vessel'))\r\n//console.log(vessel)\r\n                _this.infoDialogView && _this.infoDialogView.show(vessel, (v) => {\r\n//console.log(v)\r\n                    vessel.xmin = vessel.xmax = v.longitude\r\n                    vessel.ymin = vessel.ymax = v.latitude\r\n                    if (vessel.hasOwnProperty('ts_pos_utc')) {\r\n                         vessel.ts_pos_utc = v.ts_pos_utc;\r\n                         vessel.ts_pos_org = v.ts_pos_org;\r\n                         v.dt_pos_utc && $(this).closest('tr').find('.date').html(v.dt_pos_utc);\r\n                    }\r\n                    target.attr('vessel', JSON.stringify(vessel))\r\n                });\r\n                e.stopPropagation();\r\n            });\r\n            this.container.find('.ais_vessel').on('click', function () {\r\n//console.log(JSON.parse($(this).find('.info').attr('vessel')))\r\n                let v = JSON.parse($(this).find('.info').attr('vessel'));                \r\n                v.lastPosition = true;\r\n                _this.infoDialogView.showPosition(v);\r\n            });      \r\n        },\r\n        show: function () {\r\n            this.frame.show();\r\n            this.model.update();\r\n        },\r\n        hide: function () {\r\n            this.frame.hide();\r\n        }\r\n    }\r\n}();\r\n\r\nmodule.exports = BaseView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/BaseView.js","let _actualUpdate,\r\n_myFleetModel,\r\n_aisLayerSearcher;\r\n\r\nconst ScreenSearchModel = function ({aisLayerSearcher, myFleetModel}) {\r\n\r\n    let thisInstance = this;\r\n    myFleetModel.onChanged = function(){\r\n        thisInstance.isDirty = true;\r\n        if (thisInstance.view.isActive)\r\n            thisInstance.update();\r\n    };\r\n    _aisLayerSearcher = aisLayerSearcher;\r\n    _myFleetModel = myFleetModel;\r\n    this.filterString = \"\";\r\n    this.isDirty = true;\r\n    /*\r\n    return {\r\n        filterString: \"\",\r\n        isDirty: true,\r\n        load: function (actualUpdate) {\r\n            if (!this.isDirty) {\r\n                return Promise.resolve();\r\n            }\r\n            let thisInst = this;\r\n            return Promise.all([new Promise(function (resolve, reject) {\r\n                aisLayerSearcher.searchScreen({\r\n                    dateInterval: nsGmx.widgets.commonCalendar.getDateInterval(),\r\n                    border: true,\r\n                    group: true\r\n                }, function (json) {\r\n//console.log(json.Result.values[0][12])\r\n                    if (json.Status.toLowerCase() == \"ok\") {\r\n                        thisInst.dataSrc = {\r\n                            vessels: json.Result.values.map(function (v) {\r\n                                let d = new Date(v[12]),//nsGmx.widgets.commonCalendar.getDateInterval().get('dateBegin'),\r\n                                vessel = {\r\n                                    vessel_name: v[0], mmsi: v[1], imo: v[2], mf_member: 'visibility:hidden', \r\n                                    ts_pos_utc: aisLayerSearcher.formatDate(d), ts_pos_org: Math.floor(d.getTime()/1000),\r\n                                    xmin: v[4], xmax: v[5], ymin: v[6], ymax: v[7], maxid: v[3],\r\n                                    vessel_type: v[8], sog: v[9], cog: v[10], heading: v[11]\r\n                                };\r\n                                vessel.icon_rot = Math.round(vessel.cog/15)*15;\r\n                                aisLayerSearcher.placeVesselTypeIcon(vessel);\r\n                                return vessel;\r\n                            })\r\n                        };\r\n                        if (_actualUpdate == actualUpdate) {\r\n                            //console.log(\"ALL CLEAN\")\r\n                            //console.log(\"1>\"+new Date(thisInst._actualUpdate))\r\n                            //console.log(\"2>\"+new Date(actualUpdate))\r\n                            thisInst.isDirty = false;\r\n                        }\r\n                        resolve();\r\n                    }\r\n                    else {\r\n                        reject(json);\r\n                    }\r\n                });\r\n            })\r\n                ,myFleetModel.load()\r\n            ]);\r\n        },\r\n        setFilter: function () {\r\n            this.filterString = this.filterString.replace(/\\r+$/, \"\");\r\n            if (this.dataSrc){\r\n                if (this.filterString != \"\") {\r\n                    this.data = {\r\n                        vessels: this.dataSrc.vessels.filter(((v)=>{\r\n                            return v.vessel_name.search(new RegExp(\"\\\\b\" + this.filterString, \"ig\")) != -1;\r\n                        }).bind(this))\r\n                    };\r\n                }\r\n                else {\r\n                    this.data = { vessels: this.dataSrc.vessels.map((v)=>v) };\r\n                }\r\n            }\r\n        },\r\n        update: function () {\r\n//let start = new Date();\r\n            if (!this.isDirty)\r\n                return;\r\n            _actualUpdate = new Date().getTime();\r\n            let thisInst = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);\r\n            //this.filterString&&console.log(this.filterString+\" \"+this.filterString.search(/\\r$/))\r\n            //this.filterString&&console.log(this.filterString.replace(/^\\s+/, \"\").replace(/\\s+\\r*$/, \"\")!=\"\")            \r\n\r\n            this.load(actualUpdate).then(function () {\r\n                if (_actualUpdate == actualUpdate) {\r\n//console.log(thisInst.dataSrc)\r\n                    if (thisInst.dataSrc)\r\n                        myFleetModel.markMembers(thisInst.dataSrc.vessels);\r\n                    thisInst.setFilter();                 \r\n                    thisInst.view.inProgress(false);\r\n                    thisInst.view.repaint();\r\n                }\r\n            }, function (json) {\r\n                thisInst.dataSrc = null;\r\n//console.logconsole.log(json)\r\n                if (json.Status.toLowerCase() == \"auth\" ||\r\n                    (json.ErrorInfo && json.ErrorInfo.some && json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })))\r\n                    thisInst.data = { msg: [{ txt: _gtxt(\"AISSearch2.auth\") }], vessels: [] };\r\n                else {\r\n                    //thisInst.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                    console.log(json);\r\n                }\r\n                thisInst.view.inProgress(false);\r\n                thisInst.view.repaint();\r\n            });\r\n        }\r\n    };\r\n    */\r\n};\r\n\r\nScreenSearchModel.prototype.load = function (actualUpdate) {\r\n    if (!this.isDirty)\r\n        return Promise.resolve();\r\n\r\n    let thisInst = this;\r\n    return Promise.all([\r\n        new Promise(function (resolve, reject) {\r\n            _aisLayerSearcher.searchScreen({\r\n                dateInterval: nsGmx.widgets.commonCalendar.getDateInterval(),\r\n                border: true,\r\n                group: true\r\n            }, function (json) {\r\n                if (json.Status.toLowerCase() == \"ok\") {\r\n                    thisInst.dataSrc = {\r\n                        vessels: json.Result.values.map(function (v) {\r\n                            let d = new Date(v[12]),//nsGmx.widgets.commonCalendar.getDateInterval().get('dateBegin'),\r\n                            vessel = {\r\n                                vessel_name: v[0], mmsi: v[1], imo: v[2], mf_member: 'visibility:hidden', \r\n                                ts_pos_utc: _aisLayerSearcher.formatDate(d), ts_pos_org: Math.floor(d.getTime()/1000),\r\n                                xmin: v[4], xmax: v[5], ymin: v[6], ymax: v[7], maxid: v[3],\r\n                                vessel_type: v[8], sog: v[9], cog: v[10], heading: v[11]\r\n                            };\r\n                            vessel.icon_rot = Math.round(vessel.cog/15)*15;\r\n                            _aisLayerSearcher.placeVesselTypeIcon(vessel);\r\n                            return vessel;\r\n                        })\r\n                    };\r\n                    if (_actualUpdate == actualUpdate) {\r\n                        //console.log(\"ALL CLEAN\")\r\n                        //console.log(\"1>\"+new Date(thisInst._actualUpdate))\r\n                        //console.log(\"2>\"+new Date(actualUpdate))\r\n                        thisInst.isDirty = false;\r\n                    }\r\n                    resolve();\r\n                }\r\n                else {\r\n                    reject(json);\r\n                }\r\n            });\r\n        })\r\n        , _myFleetModel.load()\r\n    ]);\r\n};\r\nScreenSearchModel.prototype.setFilter = function () {\r\n    this.filterString = this.filterString.replace(/\\r+$/, \"\");\r\n    if (this.dataSrc){\r\n        if (this.filterString != \"\") {\r\n            this.data = {\r\n                vessels: this.dataSrc.vessels.filter(((v)=>{\r\n                    return v.vessel_name.search(new RegExp(\"\\\\b\" + this.filterString, \"ig\")) != -1;\r\n                }).bind(this))\r\n            };\r\n        }\r\n        else {\r\n            this.data = { vessels: this.dataSrc.vessels.map((v)=>v) };\r\n        }\r\n    }\r\n};\r\nScreenSearchModel.prototype.update = function () {\r\n    if (!this.isDirty)\r\n        return;\r\n    _actualUpdate = new Date().getTime();\r\n    let thisInst = this,\r\n        actualUpdate = _actualUpdate;\r\n    this.view.inProgress(true);       \r\n\r\n    this.load(actualUpdate).then(function () {\r\n        if (_actualUpdate == actualUpdate) {\r\n//console.log(thisInst.dataSrc)\r\n            if (thisInst.dataSrc)\r\n                _myFleetModel.markMembers(thisInst.dataSrc.vessels);\r\n            thisInst.setFilter();                 \r\n            thisInst.view.inProgress(false);\r\n            thisInst.view.repaint();\r\n        }\r\n    }, function (json) {\r\n        thisInst.dataSrc = null;\r\n//console.logconsole.log(json)\r\n        if (json.Status.toLowerCase() == \"auth\" ||\r\n            (json.ErrorInfo && json.ErrorInfo.some && json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })))\r\n            thisInst.data = { msg: [{ txt: _gtxt(\"AISSearch2.auth\") }], vessels: [] };\r\n        else {\r\n            //thisInst.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n            console.log(json);\r\n        }\r\n        thisInst.view.inProgress(false);\r\n        thisInst.view.repaint();\r\n    });\r\n};\r\n\r\nmodule.exports = ScreenSearchModel;\n\n\n// WEBPACK FOOTER //\n// ./src/Models/ScreenSearchModel.js","require(\"./MyFleet.css\")\r\nconst BaseView = require('./BaseView.js');\r\nconst GroupList = require('../Controls/GroupList.js');\r\n\r\nlet _clean = function(){  \r\n    this.frame.find('.ais_vessels input[type=\"checkbox\"]').off('click');    \r\n    this.startScreen.css({ visibility: \"hidden\" });\r\n};\r\n\r\nconst MyFleetView = function (model){\r\n    BaseView.call(this, model);\r\n    let settings = []; //DEFAULT SETTINGS\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view myfleet_view\">' +\r\n    '<table class=\"instruments\">'+\r\n    '<tr><td style=\"vertical-align:top; padding-right:0\">'+\r\n    '<div style=\"width:140px; margin-bottom: 8px;\">{{i \"AISSearch2.DisplaySection\"}}</div>' +\r\n    '<label class=\"sync-switch switch\"><input type=\"checkbox\">'+\r\n    '<div class=\"sync-switch-slider switch-slider round\"></div></label>' +\r\n    '<span class=\"sync-switch-slider-description\">{{i \"AISSearch2.myFleetOnly\"}}</span>'+    \r\n    '</td>' +\r\n    '<td style=\"padding-right:0\">' +\r\n    '<div style=\"width:120px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"group_name\" ' + (settings.indexOf('group_name')<0?'':'checked') + '>{{i \"AISSearch2.DisplayGroupName\"}}</div>' +\r\n    '<div style=\"width:120px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"vessel_name\" ' + (settings.indexOf('vessel_name')<0?'':'checked') + '>{{i \"AISSearch2.DisplayVesselName\"}}</label></div>' +\r\n    '<div style=\"width:70px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"sog\" ' + (settings.indexOf('sog')<0?'':'checked') + '>{{i \"AISSearch2.DisplaySog\"}}</label></div>' +\r\n    '<div style=\"width:45px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"cog\" ' + (settings.indexOf('cog')<0?'':'checked') + '>{{i \"AISSearch2.DisplayCog\"}}</label></div>' +\r\n    '</td>' +\r\n    '<td><div class=\"refresh\"><div>' + this.gifLoader + '</div></div></td></tr>' +\r\n\r\n    '<tr><td colspan=\"3\" style=\"padding-top:0\">' +\r\n    '<table><tr><td>{{i \"AISSearch2.NewGroup\"}}</td>' +\r\n    '<td><div class=\"newgroupname\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.NewGroupName\"}}\"/></div></td>' +\r\n    '<td><img class=\"create clicable\" title=\"{{i \"AISSearch2.CreateGroup\"}}\" src=\"plugins/AIS/AISSearch/svg/add.svg\"></td>' +\r\n    '</tr></table>' +\r\n    '</td></tr>' +\r\n    '</table>'+ \r\n\r\n    '<div class=\"ais_vessels\">'+\r\n    '<table class=\"results\">'+\r\n    '<td><input type=\"checkbox\" checked></td>' +\r\n    '<td class=\"count\"></td></tr></table>'+\r\n    '<div class=\"ais_vessel\">' +\r\n    '<table border=0><tr>' +\r\n    '<td><input type=\"checkbox\" checked></td>' +\r\n    '<td><div class=\"position\">vessel_name</div><div>mmsi: mmsi imo: imo</div></td>' +\r\n    '<td></td>' +  \r\n    '<td><span class=\"date\">ts_pos_utc</span></td>'+\r\n    //'<td><div class=\"info\" vessel=\"aisjson this\" title=\"i AISSearch2.info\">' +\r\n    //'<img src=\"plugins/AIS/AISSearch/svg/info.svg\"><div></td>' +\r\n    '</tr></table>' +\r\n    '</div>' +      \r\n    '</div>' +\r\n\r\n    '<table class=\"start_screen\"><tr><td>' +\r\n    '<img src=\"plugins/AIS/AISSearch/svg/steer-weel.svg\">' +\r\n    '<div>{{{i \"AISSearh2.myfleet_view\"}}}' +\r\n    '</div></td></tr></table>' +\r\n\r\n    '</div>')());    \r\n\r\n    Object.defineProperty(this, \"topOffset\", {\r\n        get: function () {\r\n            let rv = $('.ais_tabs')[0].getBoundingClientRect().height + \r\n            this.frame.find('.instruments')[0].getBoundingClientRect().height;\r\n            return rv;\r\n        }\r\n    });  \r\n\r\n    this.container = this.frame.find('.ais_vessels');     \r\n    this.startScreen = this.frame.find('.start_screen');\r\n    // DEFAULT SETTINGS\r\n    this.model.markerTemplate =  '<div><table><tr>' +\r\n        '<td style=\"vertical-align:top\">' +\r\n        //'<svg width=\"12\" height=\"11\" fill=\"#00f\" style=\"{{marker_style}}\" viewBox=\"0 0 260 245\"><use xlink:href=\"#mf_label_icon\"/></svg>' +\r\n        '{{{marker}}}' +\r\n        '</td><td>{{{foo}}}</td></tr></table></div>'; \r\n    \r\n    // craete group controller\r\n    let newGroupNameValid = function(ngn){\r\n        let isValid = ngn.search(/\\S/)!=-1;\r\n        this.model.data.groups.forEach(g=>{\r\n            if (isValid)\r\n                isValid = g.title!=ngn;\r\n        });\r\n        return isValid;\r\n    },\r\n    createGroup = function(ngn){\r\n        if (newGroupNameValid.call(this, ngn)){\r\n            this.inProgress(true);\r\n            this.model.createGroup(ngn)\r\n            .then((group)=>{\r\n                this.groupList.appendGroup(group, this.model.data.groups.length-1);\r\n                this.inProgress(false);\r\n            },\r\n            (error)=>{\r\n                this.inProgress(false);\r\n                console.log(error)\r\n            }\r\n            );\r\n        }        \r\n    };\r\n    this.frame.find('.instruments .create').on(\"click\", (e=>{\r\n        let input = this.frame.find('.instruments .newgroupname input'),\r\n        ngn = input.val();\r\n        input.val('');\r\n        createGroup.call(this, ngn);\r\n    }).bind(this))\r\n    this.frame.find('.instruments .newgroupname input').on(\"keyup\", (e=>{\r\n        let ngn = e.target.value;\r\n        if (e.keyCode==13){\r\n            e.target.value = '';\r\n            createGroup.call(this, ngn);\r\n        }\r\n    }).bind(this)); \r\n\r\n    // marker settings\r\n    this.frame.find('.instruments .setting input')\r\n    .on('change', e=>{\r\n        let display = '';\r\n        this.frame.find('.instruments .setting input').each((i, e)=>{\r\n            if (e.checked)\r\n                display += \"{{{\" + e.id + \"}}}\";\r\n        });\r\n        if (display=='')\r\n            display = '{{{foo}}}';  \r\n        this.model.markerTemplate =  this.model.markerTemplate.replace(/<td>\\{\\{\\{.+\\}\\}\\}<\\/td>/, '<td>' + display + '</td>');\r\n        this.model.drawMarkers();\r\n    })\r\n    \r\n    // visibility controller\r\n    this.frame.find('.instruments .switch input[type=\"checkbox\"]').on(\"click\", this.model.showOnlyMyfleet); \r\n\r\n    // group list\r\n    this.groupList = new GroupList(this.frame);\r\n    this.groupList.onRepaintItem = ((i, elm)=>{\r\n        elm.querySelector('input[type=checkbox]').checked = this.model.isMemberShown(elm.querySelector('.mmsi').innerText);\r\n    }).bind(this);\r\n    this.groupList.onDeleteGroup = (group=>{\r\n        this.inProgress(true);\r\n        this.model.deleteGroup(group);\r\n    }).bind(this);\r\n    \r\n    this.tableTemplate = this.groupList.toString();\r\n};\r\n\r\nMyFleetView.prototype = Object.create(BaseView.prototype);\r\n\r\nMyFleetView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div');\r\n    if (state)\r\n        progress.show();\r\n    else\r\n        progress.hide();\r\n};\r\n\r\nMyFleetView.prototype.repaint = function () {\r\n    _clean.call(this);  \r\n    BaseView.prototype.repaint.apply(this, arguments);\r\n\r\n    let onlyMyfleet = this.model.showOnlyMyFleet();\r\n    this.frame.find('.instruments .switch input[type=\"checkbox\"]')[0].checked = onlyMyfleet;\r\n\r\n    this.groupList.repaint();   \r\n    this.groupList.onCheckItem = this.model.showMembers;\r\n    this.groupList.onChangeGroup = ((mmsi, group)=>{\r\n        let view = this;\r\n        this.inProgress(true);          \r\n        this.model.changeGroup(mmsi, group)\r\n        .then((r)=>{\r\n            view.repaint();\r\n            view.inProgress(false); \r\n            view.model.drawMarkers();  \r\n        })\r\n        .catch((err)=>{\r\n            console.log(err)\r\n            view.inProgress(false);   \r\n        });\r\n    }).bind(this);\r\n    this.groupList.onExcludeItem = ((ev, mmsi, i) => {\r\n            ev.stopPropagation();\r\n            let view = this;\r\n            let vessel = view.model.vessels[i];\r\n            view.prepare(vessel.mmsi.toString());\r\n            let dlg = $('.ui-dialog:contains(\"' + vessel.mmsi + '\")');\r\n            if (dlg[0]){ \r\n                dlg.find('.button.addremove').click();\r\n            }\r\n            else{\r\n                view.model.change(vessel).then(function () {\r\n                    view.show();\r\n                })\r\n            }        \r\n    }).bind(this);    \r\n    this.groupList.onGroupMenuShow = ((group)=>{\r\n        let i = parseInt(group.replace(/gr/, ''), 10);\r\n        return {\r\n            marker_style:parseInt(this.model.data.groups[i].marker_style.replace(/#/, ''), 16),\r\n            label_color:parseInt(this.model.data.groups[i].label_color.replace(/#/, ''), 16),\r\n            label_shadow:parseInt(this.model.data.groups[i].label_shadow.color.replace(/#/, ''), 16)\r\n        };\r\n    }).bind(this);\r\n    this.groupList.onChangeGroupStyle = ((group, colors)=>{\r\n        let i = parseInt(group.replace(/gr/, ''), 10);\r\n        this.model.changeGroupStyle(i, colors);\r\n    }).bind(this);\r\n    this.groupList.onSaveGroupStyle = this.model.saveGroupStyle;\r\n};\r\n\r\nMyFleetView.prototype.prepare = function (mmsi) {\r\n    if (this.isActive){\r\n       this.model.freeMember(mmsi);\r\n    }\r\n}\r\n\r\nMyFleetView.prototype.hide = function () {\r\n    this.model.showNotOnlyMyfleet();\r\n    BaseView.prototype.hide.apply(this, arguments);\r\n}\r\n// MyFleetView.prototype.show = function () {\r\n//     BaseView.prototype.show.apply(this, arguments); \r\n// }\r\nmodule.exports = MyFleetView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/MyFleetView.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/MyFleet.css\n// module id = 11\n// module chunks = 0","const GroupWidget = require('./GroupWidget.js');\r\n\r\nlet _onRepaintItemHandler,\r\n_onCheckItem,\r\n_onExcludeItem,\r\n_onChangeGroup,\r\n_onDeleteGroup,\r\n_onGroupMenuShow,\r\n_onChangeGroupStyle,\r\n_rolledupGroups = {},\r\n_cp1, _cp2, _cp3,\r\n_getFiltered = function(){\r\n    let filtered = [];\r\n    let group = this.frame.find('.mf_group'), selectAll, selectOne;\r\n    for (let i = 0; i < group.length; i++){\r\n        selectAll = group.eq(i).find('.results input[type=\"checkbox\"]');\r\n        selectOne = group.eq(i).find('.ais_vessel input[type=\"checkbox\"]');\r\n        selectAll[0].checked = true;\r\n        for (let j = 0; j < selectOne.length; j++)\r\n            if (!selectOne[j].checked) {\r\n                filtered.push(selectOne[j].closest('.ais_vessel').querySelector('.mmsi').innerText);\r\n                selectAll[0].checked = false;\r\n            }\r\n    }\r\n    return filtered;\r\n},\r\n_setCheckBoxes = function(){\r\n    this.frame.find('.ais_vessel').each(_onRepaintItemHandler);            \r\n    this.frame.find('.results input[type=\"checkbox\"]')\r\n    .each((i,e)=>{\r\n        let check = true; \r\n        e.closest('.mf_group').querySelectorAll('input').forEach((e,i)=>check = check && e.checked); \r\n        e.checked = check;\r\n    });\r\n},\r\n_setGroupCommands = function(){\r\n    this.frame.find('.results input[type=\"checkbox\"]').off(\"click\").on(\"click\", ((e)=>{\r\n        let group = $(e.target).closest('.mf_group');\r\n        group.find('.ais_vessel input[type=\"checkbox\"]').each((i, elm)=>{\r\n            elm.checked = e.target.checked;\r\n        }) \r\n        let filtered = _getFiltered.call(this);\r\n        _onCheckItem(filtered);\r\n    }).bind(this)); \r\n           \r\n    this.frame.find('.results').off(\"contextmenu\").on(\"contextmenu\", (e=>{  \r\n        e.preventDefault();\r\n        let values= e.currentTarget.classList.values(), \r\n        cssClass, group;\r\n        while (!cssClass || !cssClass.done){\r\n            cssClass = values.next(); \r\n            group = cssClass.value;\r\n            if (group && group.search(/^gr\\d/)==0)\r\n                break;\r\n        }\r\n//console.log(\"group \"+group);\r\n        // if(!e.currentTarget.querySelector(\".delete\"))\r\n        //     return; \r\n        let ctxMenu = this.contextMenu,//$('.mf_group_menu'),\r\n        evnt = e;\r\n        if (_cp1)\r\n            _cp1.remove();\r\n        if (_cp2)\r\n            _cp2.remove();   \r\n        if (_cp3)\r\n            _cp3.remove();           \r\n        ctxMenu.html('');\r\n        let colorChangeHandler = function(c, cs){\r\n            //console.log(c); \r\n            //console.log(cs);\r\n            _groupStyleChanged = true;\r\n            \r\n            cs.style.backgroundColor = \"#\" + c;\r\n            let c1 = cp1.style.backgroundColor,\r\n            c2 = cp2.style.backgroundColor,\r\n            c3 = cp3.style.backgroundColor\r\n            _onChangeGroupStyle(group, {\r\n                marker_style: c1.substr(0,3)==\"rgb\" ? nsGmx.Utils.rgb2hex(c1) : c1,\r\n                label_color: c2.substr(0,3)==\"rgb\" ? nsGmx.Utils.rgb2hex(c2) : c2,\r\n                label_shadow: c3.substr(0,3)==\"rgb\" ? nsGmx.Utils.rgb2hex(c3) : c3 \r\n            })\r\n        },\r\n        colors = _onGroupMenuShow(group),\r\n        cp1 = nsGmx.Controls.createColorPicker(colors.marker_style, ()=>{}, ()=>{}, (c1, c2, c3)=>{colorChangeHandler(c2, cp1)}),\r\n        cp2 = nsGmx.Controls.createColorPicker(colors.label_color, ()=>{}, ()=>{}, (c1, c2, c3)=>{colorChangeHandler(c2, cp2)}),\r\n        cp3 = nsGmx.Controls.createColorPicker(colors.label_shadow, ()=>{}, ()=>{}, (c1, c2, c3)=>{colorChangeHandler(c2, cp3)});\r\n        _cp1 = document.querySelector(\"#\"+$(cp1).data('colorpickerId'));\r\n        _cp2 = document.querySelector(\"#\"+$(cp2).data('colorpickerId'));\r\n        _cp3 = document.querySelector(\"#\"+$(cp3).data('colorpickerId'));\r\n        $(_cp1).on('mouseleave', (e)=>{if(!e.relatedTarget || !e.relatedTarget.closest('.mf_group_menu')) _hideContextMenu.call(this, e); $(cp1).ColorPickerHide()});\r\n        $(_cp2).on('mouseleave', (e)=>{if(!e.relatedTarget || !e.relatedTarget.closest('.mf_group_menu')) _hideContextMenu.call(this, e); $(cp2).ColorPickerHide()});\r\n        $(_cp3).on('mouseleave', (e)=>{if(!e.relatedTarget || !e.relatedTarget.closest('.mf_group_menu')) _hideContextMenu.call(this, e); $(cp3).ColorPickerHide()});\r\n        cp1.title = \"\";\r\n        cp2.title = \"\";\r\n        cp3.title = \"\";\r\n        let div = $('<div class=\"command marker_color\"></div>');         \r\n        ctxMenu.append(div.append(cp1).append(\"<span>\"+_gtxt(\"AISSearch2.markerShadow\")+\"</span>\"));\r\n        div = $('<div class=\"command label_color\"></div>');         \r\n        ctxMenu.append(div.append(cp2).append(\"<span>\"+_gtxt('AISSearch2.labelColor')+\"</span>\"));\r\n        div = $('<div class=\"command label_shadow\"></div>');         \r\n        ctxMenu.append(div.append(cp3).append(\"<span>\"+_gtxt('AISSearch2.labelShadow')+\"</span>\"));\r\n        ctxMenu.append('<div class=\"command remove\">' + _gtxt(\"AISSearch2.DeleteGroupCommand\") + '</div>');\r\n        \r\n        $(cp1).on('click', e=>$(_cp1).offset({left:$('.colorpicker:visible').offset().left+20}));       \r\n        $(cp2).on('click', e=>$(_cp2).offset({left:$('.colorpicker:visible').offset().left+20}));       \r\n        $(cp3).on('click', e=>$(_cp3).offset({left:$('.colorpicker:visible').offset().left+20}));\r\n        ctxMenu.find('.command.marker_color').on(\"click\",(e)=>{            \r\n            $(cp1).click();\r\n        })\r\n        ctxMenu.find('.command.label_color').on(\"click\",(e)=>{             \r\n            $(cp2).click();\r\n        })\r\n        ctxMenu.find('.command.label_shadow').on(\"click\",(e)=>{             \r\n            $(cp3).click();\r\n        })\r\n        \r\n        if (e.currentTarget.querySelector(\".delete\")) {\r\n            ctxMenu.find('.command.remove').show().on(\"click\", (e) => {\r\n                _onDeleteGroup(evnt.currentTarget.querySelector('.title').innerText);\r\n                ctxMenu.hide();\r\n            })\r\n        }\r\n        else{\r\n            ctxMenu.find('.command.remove').hide();\r\n        }\r\n        ctxMenu.show();\r\n        ctxMenu[0].style.left = (e.clientX - 10) + \"px\";\r\n        if ((e.clientY - 10 + ctxMenu[0].offsetHeight) < window.innerHeight) {\r\n            ctxMenu[0].style.top = (e.clientY - 10) + \"px\";\r\n            ctxMenu[0].style.bottom = \"\";//\"auto\";\r\n        }\r\n        else {  \r\n            ctxMenu[0].style.bottom = (window.innerHeight - e.clientY - 10) + \"px\";\r\n            ctxMenu[0].style.top = \"\";//\"auto\";\r\n        }\r\n    }).bind(this));\r\n\r\n    this.frame.find('.results .upout').off(\"click\").on(\"click\", (e=>{\r\n        let arrow = e.currentTarget,\r\n            title = arrow.closest('.results').querySelector('.title').innerText,\r\n            cl = arrow.classList,\r\n            vessels = arrow.closest('.mf_group').querySelectorAll('.ais_vessel');\r\n        if (cl.contains('icon-down-open')){\r\n            cl.remove('icon-down-open');\r\n            cl.add('icon-right-open');\r\n            vessels.forEach(v=>v.style.display='none');\r\n            _rolledupGroups[title] = true;\r\n        }\r\n        else{\r\n            cl.add('icon-down-open');\r\n            cl.remove('icon-right-open');\r\n            vessels.forEach(v=>v.style.display='block');\r\n            delete(_rolledupGroups[title]);\r\n        }\r\n//console.log(_rolledupGroups)\r\n    }).bind(this))    \r\n    .each((i,el)=>{\r\n        let title = el.closest('.results').querySelector('.title').innerText;\r\n        if (_rolledupGroups[title]){\r\n            el.classList.remove('icon-right-open');\r\n            el.classList.add('icon-down-open');\r\n            el.click();            \r\n        }\r\n    });\r\n    _rolledupGroups = {};\r\n    this.frame.find('.results .icon-right-open').each((i, el) => {\r\n        _rolledupGroups[el.closest('.results').querySelector('.title').innerText] = true;\r\n    })\r\n\r\n    this.frame.find('.results .delete')\r\n    .off(\"click\").on(\"click\", (e=>{\r\n        _onDeleteGroup(e.currentTarget.closest('.results').querySelector('.title').innerText);\r\n    }).bind(this));\r\n},\r\n_onSaveGroupStyle,\r\n_groupStyleChanged,\r\n_saveStylePromise = Promise.resolve(0),\r\n_hideContextMenu = function (e){\r\n    this.contextMenu.hide();\r\n    //if (e.currentTarget.querySelector('.colorSelector') || e.currentTarget.classList.contains('colorpicker'))\r\n    if (_groupStyleChanged){\r\n        _groupStyleChanged = false;\r\n        _saveStylePromise = _saveStylePromise.then(_onSaveGroupStyle);\r\n    }\r\n};\r\n\r\nconst GroupList = function (frame) {\r\n    this.frame = frame;\r\n       \r\n    // context menu\r\n    this.contextMenu = $('<div class=\"mf_group_menu\"></div>')\r\n    .on('mouseleave', (e=>{\r\n        if(!e.relatedTarget || !e.relatedTarget.closest('.colorpicker')){\r\n            _hideContextMenu.call(this, e);\r\n            $('.colorpicker:visible').hide();\r\n        }\r\n    }).bind(this));\r\n    $('body').append(this.contextMenu); \r\n\r\n    this.repaint = function(){\r\n        _setCheckBoxes.call(this);\r\n        _setGroupCommands.call(this);\r\n\r\n        // exclude memeber control\r\n        this.frame.find('.ais_vessel .exclude').each((i, elm)=>{\r\n            $(elm).on('click', (ev)=>{\r\n                $(elm).off('click');\r\n                _onExcludeItem(ev, elm.closest('.ais_vessel').querySelector('.mmsi').innerText, i);\r\n            })\r\n        });\r\n\r\n        // memeber visibility control\r\n        this.frame.find('.ais_vessel input[type=\"checkbox\"]').each(((i, elm)=>{\r\n            $(elm).off('click').on('click', (e => {\r\n                e.stopPropagation();\r\n                let filtered = _getFiltered.call(this);\r\n                _onCheckItem(filtered);\r\n            }).bind(this));\r\n        }).bind(this));  \r\n        \r\n        // context menu event handler\r\n        this.frame.find('.ais_vessel').off(\"contextmenu\").on(\"contextmenu\", (e=>{\r\n            e.preventDefault();\r\n            let mmsi = e.currentTarget.querySelector('.mmsi'),\r\n            ctxMenu = this.contextMenu,//$('.mf_group_menu'),\r\n            groupblock = e.currentTarget.closest('.mf_group'),\r\n            group = groupblock.querySelector('.results .title').innerText,\r\n            groups = this.frame.find('.results .title'),\r\n            template = '';\r\n            if (groups.length==1)\r\n                return;\r\n\r\n            groups.each((i,g)=>{\r\n                if (i>0 && g.innerText!=group)\r\n                    template += ('<div class=\"command\">' + g.innerText + '</div>');\r\n            });\r\n            if (template!='')\r\n                template = ('<div>' + _gtxt(\"AISSearch2.AddIntoGroup\") + '</div>') + template;\r\n            if (groupblock.previousSibling){\r\n                if (template!='')\r\n                    template += ('<div class=\"command remove\">' + _gtxt(\"AISSearch2.RemoveFromGroup\") + '</div>');\r\n                else\r\n                    template += ('<div class=\"command remove lonely\">' + _gtxt(\"AISSearch2.RemoveFromGroup\") + '</div>');\r\n            }\r\n            ctxMenu.html(template);\r\n            \r\n            ctxMenu.find('.command').on(\"click\",(e)=>{\r\n                if(!e.currentTarget.classList.contains('remove'))\r\n                    _onChangeGroup(mmsi.innerText, e.currentTarget.innerText);\r\n                else\r\n                    _onChangeGroup(mmsi.innerText, null);                \r\n                ctxMenu.hide();\r\n            });\r\n            ctxMenu.show();\r\n            ctxMenu[0].style.left = (e.clientX - 10) + \"px\";\r\n            if ((e.clientY - 10 + ctxMenu[0].offsetHeight) < window.innerHeight) {\r\n                ctxMenu[0].style.top = (e.clientY - 10) + \"px\";\r\n                ctxMenu[0].style.bottom = \"\";//\"auto\";\r\n            }\r\n            else {  \r\n                ctxMenu[0].style.bottom = (window.innerHeight - e.clientY - 10) + \"px\";\r\n                ctxMenu[0].style.top = \"\";//\"auto\";\r\n            }\r\n        }).bind(this));       \r\n    };\r\n\r\n    // events\r\n    Object.defineProperty(this, \"onChangeGroup\", {\r\n        set: function (callback) {\r\n            _onChangeGroup = callback;\r\n        }\r\n    });\r\n    Object.defineProperty(this, \"onDeleteGroup\", {\r\n        set: function (callback) {\r\n            _onDeleteGroup = callback;\r\n        }\r\n    });\r\n    Object.defineProperty(this, \"onRepaintItem\", {\r\n        set: function (callback){\r\n            _onRepaintItemHandler = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onCheckItem\", {\r\n        set: function (callback){\r\n            _onCheckItem = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onExcludeItem\", {\r\n        set: function (callback){\r\n            _onExcludeItem = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onGroupMenuShow\", {\r\n        set: function (callback){\r\n            _onGroupMenuShow = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onChangeGroupStyle\", {\r\n        set: function (callback){\r\n            _onChangeGroupStyle = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onSaveGroupStyle\", {\r\n        set: function (callback){\r\n            _onSaveGroupStyle = callback;\r\n        }\r\n    }); \r\n      \r\n    // template\r\n    this.toString = function () {\r\n        return '{{#each groups}}' + GroupWidget.prototype.toString.call() + '{{/each}}' +\r\n            '{{#each msg}}<div class=\"msg\">{{txt}}</div>{{/each}}';\r\n    } \r\n}\r\n\r\nGroupList.prototype.appendGroup = function(group, index){\r\n    this.frame.find('.mf_group').eq(0).parent().append(Handlebars.compile(GroupWidget.prototype.toString.call().replace(/\\{\\{@index\\}\\}/, index))(group));    \r\n    _setGroupCommands.call(this);\r\n}\r\n\r\nmodule.exports = GroupList;\n\n\n// WEBPACK FOOTER //\n// ./src/Controls/GroupList.js","const GroupWidget = function (title){\r\n    \r\n}\r\n\r\nGroupWidget.prototype.toString = function () {\r\n    return '<div class=\"mf_group\">' +\r\n    '<table class=\"results gr{{@index}}\"><tr>'+\r\n    '<td><input type=\"checkbox\" checked><div class=\"upout clicable ui-helper-noselect icon-down-open\" style=\"float: right;\"></div></td>' +\r\n    '<td><span class=\"title\">{{title}}</span></td>' +\r\n    '<td class=\"count\">{{vessels.length}}</td>' +    \r\n    '<td>' +\r\n    '{{#unless default}}' +\r\n    '<img class=\"delete clicable\" title=\"{{i \"AISSearch2.DeleteGroup\"}}\" src=\"plugins/AIS/AISSearch/svg/delete.svg\">' +\r\n    '</td>' +\r\n    '{{/unless}}' +\r\n    '</tr></table>'+\r\n    '{{#each vessels}}' +\r\n    //'{{#unless foovessel}}' +\r\n    '<div class=\"ais_vessel\">' +\r\n    '<table border=0><tr>' +\r\n    '<td><input type=\"checkbox\" checked></td>' +\r\n    '<td><div class=\"position\">{{vessel_name}}</div><div>mmsi: <span class=\"mmsi\">{{mmsi}}</span> imo: <span class=\"imo\">{{imo}}</span></div></td>' +\r\n    '<td><img src=\"{{icon}}\" class=\"course rotateimg{{icon_rot}}\">' +\r\n    '<div class=\"info\" vessel=\"{{aisjson this}}\" title=\"{{i \"AISSearch2.info\"}}\">' +\r\n    '<img src=\"plugins/AIS/AISSearch/svg/info.svg\"></div>' +\r\n    '</td>' +\r\n    '<td>' +\r\n    '<div class=\"ais_info_dialog_close-button exclude\" title=\"{{i \"AISSearch2.vesselExclude\"}}\"></div>' +\r\n    '<span class=\"date\">{{dt_pos_utc}}</span></td>' +\r\n    '</tr></table>' +\r\n    '</div>' +\r\n    //'{{/unless}}' +\r\n    '{{/each}}</div>';\r\n}\r\n\r\nmodule.exports = GroupWidget;\n\n\n// WEBPACK FOOTER //\n// ./src/Controls/GroupWidget.js","const Polyfill = require('../Polyfill');\r\nlet emptyGroup = function(title, isDefault, id, style){\r\n    let ms = \"#ffff00\",\r\n    lsc = \"#ffff00\",\r\n    ls = {\"color\":\"#ffff00\",\"text_shadow\": \"-1px -1px 0 #ffff00, 0px -1px 0 #ffff00, 1px -1px 0 #ffff00, -1px  0px 0 #ffff00, 1px  0px 0 #ffff00, -1px  1px 0 #ffff00, 0px  1px 0 #ffff00, 1px  1px 0 #ffff00\"},\r\n    eg = {\r\n    title: title,\r\n    vessels: [],\r\n    get marker_style(){return ms}, \r\n    set marker_style(c){ms = c},\r\n    //label_shadow:\"color:black;-webkit-text-stroke:1px yellow;\"\r\n    label_color: \"#000000\",\r\n    get label_shadow_color(){return lsc},\r\n    get label_shadow(){return ls},\r\n    set label_shadow(c){ \r\n        lsc = c;\r\n        ls = {\"color\": c, \"text_shadow\": \"-1px -1px 0 \" + c + \", 0px -1px 0 \" + c + \", 1px -1px 0 \" + c + \", -1px  0px 0 \" + c + \", 1px  0px 0 \" + c + \", -1px  1px 0 \" + c + \", 0px  1px 0 \" + c + \", 1px  1px 0 \" + c + \"\"}\r\n    }\r\n    };\r\n    if (isDefault) eg.default = true;\r\n\r\n    if (style)\r\n    {\r\n        style = JSON.parse(style);\r\n        eg.marker_style = style.ms;\r\n        eg.label_color = style.lc;\r\n        eg.label_shadow = style.lsc;\r\n    }\r\n    eg.id = id;\r\n\r\n    return eg;\r\n}\r\n\r\nconst VesselData = function () {\r\n    this.groups = []\r\n};\r\n\r\nlet _tools,\r\n_isDirty = true,\r\n_myFleetLayers = [],\r\n_defaultGroup = _gtxt(\"AISSearch2.AllGroup\"),\r\n_vessels = [],\r\n_mapID,\r\n_prepared,\r\n_actualUpdate,\r\n_markerTemplate,\r\n_filteredState = [], \r\n_displayngState,\r\n_data,\r\n_view,\r\n_aisLayerSearcher,\r\n_onChangedHandlers = [],\r\n_fireChanged = function(){ _onChangedHandlers.forEach(h=>h()); },\r\n_loadVoyageInfo = function (vessels) {   \r\n    return new Promise(function (resolve, reject) {\r\n        if (!vessels.length){\r\n            reject();\r\n            return;\r\n        }\r\n\r\n        let data;\r\n        if (Polyfill.findIndex(vessels, v=>v.mmsi || v.imo)<0){\r\n            data = _parseVoyageInfo({Result:{fields:[], values:[]}}, vessels); \r\n            resolve(data);\r\n        } \r\n        else\r\n            _aisLayerSearcher.searchNames(\r\n                vessels,\r\n                function (response) {\r\n                    if (response.Status && response.Status.toLowerCase() == \"ok\") {\r\n                        data = _parseVoyageInfo(response, vessels);\r\n                        resolve(data);\r\n                    }\r\n                    else {\r\n                        reject(response);\r\n                    }\r\n                });\r\n    });\r\n},\r\n_compareGroups = function(l, r){\r\n    if (l.default)\r\n        return -1;\r\n    if (r.default)\r\n        return 1;        \r\n    if (l.id<r.id)\r\n        return -1;\r\n    if (l.id>r.id)\r\n        return 1;        \r\n    return 0;\r\n},\r\n_parseVoyageInfo = function (response, vessels) {\r\n        let mmsi = response.Result.fields.indexOf(\"mmsi\"),\r\n            vessel_name = response.Result.fields.indexOf(\"vessel_name\"),\r\n            ts_pos_utc = response.Result.fields.indexOf(\"ts_pos_utc\"),\r\n            imo = response.Result.fields.indexOf(\"imo\"),\r\n            lat = response.Result.fields.indexOf(\"longitude\"),\r\n            lon = response.Result.fields.indexOf(\"latitude\"),\r\n            vt = response.Result.fields.indexOf(\"vessel_type\"),\r\n            cog = response.Result.fields.indexOf(\"cog\"),\r\n            sog = response.Result.fields.indexOf(\"sog\"),\r\n            data,\r\n            eg;\r\n        if (_data){ // _data.groups.length>1 || _data.groups[0].vessels_length>0\r\n            data = _data;\r\n            data.groups.forEach(g=>g.vessels.length=0);\r\n        }\r\n        else{\r\n            data = new VesselData();\r\n            vessels.forEach(v=>{\r\n                if (!v.mmsi && !v.imo){\r\n                    if (v.group)\r\n                        eg = emptyGroup(v.group, false, v.gmx_id, v.style);\r\n                    else\r\n                        eg = emptyGroup(_defaultGroup, true, v.gmx_id, v.style);\r\n                    data.groups.push(eg);\r\n                }\r\n            });\r\n            data.groups.sort(_compareGroups);\r\n//console.log(data);\r\n        }\r\n        response.Result.values.forEach(c => {\r\n            let d = new Date(c[ts_pos_utc] * 1000),\r\n                member = {\r\n                    vessel_name: c[vessel_name], mmsi: c[mmsi], imo: c[imo],\r\n                    ts_pos_utc: _aisLayerSearcher.formatDateTime(d), dt_pos_utc: _aisLayerSearcher.formatDate(d),\r\n                    ts_pos_org: c[ts_pos_utc],\r\n                    xmin: c[lat], xmax: c[lat], ymin: c[lon], ymax: c[lon],\r\n                    vessel_type: c[vt], cog: c[cog], sog: c[sog]\r\n                };\r\n            member.icon_rot = Math.round(member.cog / 15) * 15;\r\n            _aisLayerSearcher.placeVesselTypeIcon(member);\r\n\r\n            let i = Polyfill.findIndex(vessels, function (v) {\r\n                return v.mmsi == member.mmsi;\r\n            }),\r\n                gn = i<0 ? \"\" : (!vessels[i].group ? _defaultGroup : vessels[i].group);\r\n            if (gn != \"\") {\r\n                i = Polyfill.findIndex(data.groups, function (g) {\r\n                    return g.title == gn;\r\n                });\r\n                data.groups[i].vessels.push(member);\r\n            }\r\n        });\r\n\r\n        //thisInst.data.vessels.sort(function (a, b) { return +(a.vessel_name > b.vessel_name) || +(a.vessel_name === b.vessel_name) - 1; })\r\n//console.log(\"PARSE VI \" + data.groups.reduce((p,c)=>p+c.vessels.length, 0))\r\n        return data;\r\n}, \r\n_repaintMap = function(vessels){\r\n//console.log(vessels) \r\n    _loadVoyageInfo(vessels)\r\n        //.then(data => _tools.repaintOtherMarkers(data, _markerTemplate, _view.isActive ? _filteredState : []))\r\n        .then(data => _tools.repaintOtherMarkers(data, _markerTemplate, _filteredState))\r\n        .catch(error => { error && console.log(error) })\r\n};\r\n\r\n\r\nmodule.exports = function ({aisLayerSearcher, toolbox}) {    \r\n    _tools = toolbox;\r\n    _aisLayerSearcher = aisLayerSearcher;\r\n    _mapID = String($(_queryMapLayers.buildedTree).find(\"[MapID]\")[0].gmxProperties.properties.MapID);\r\n    let addGroupField = function(lid, resolve, reject, vessels){\r\nconsole.log(\"add group and style field\");\r\n        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl + 'VectorLayer/Update.ashx?VectorLayerID=' + lid +\r\n            '&columns=[{\"Name\":\"mmsi\",\"OldName\":\"mmsi\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"mmsi\\\\\"\"},{\"Name\":\"imo\",\"OldName\":\"imo\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"imo\\\\\"\"},{\"Name\":\"gmx_id\",\"OldName\":\"gmx_id\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":true,\"IsIdentity\":true,\"IsComputed\":false,\"expression\":\"\\\\\"gmx_id\\\\\"\"},{\"Name\":\"group\",\"OldName\":\"group\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"group\\\\\"\"},{\"Name\":\"style\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"style\\\\\"\"}]',\r\n            function (response) {\r\n                if (response.Status.toLowerCase() == \"ok\")\r\n                    setTimeout(function run() {\r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            \"AsyncTask.ashx?TaskID=\" + response.Result.TaskID, function (response) {\r\n                                if (response.Status.toLowerCase() == \"ok\")\r\n                                    if (!response.Result.Completed)\r\n                                        setTimeout(run, 1000);\r\n                                    else {\r\n                                        if(response.Result.ErorInfo)\r\n                                            reject(response);\r\n                                        else\r\n                                            resolve(vessels);\r\n                                    }\r\n                                else \r\n                                    reject(response);\r\n                            });\r\n                    }, 1000);\r\n            });\r\n        },  \r\n        addDefaultGroup = function(resolve, reject, vessels){\r\n            sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                '&objects=[{\"properties\":{\"group\": null},\"action\":\"insert\"}]',\r\n                function (response) {\r\n                    if (response.Status.toLowerCase() == \"ok\") {                           \r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            'VectorLayer/Search.ashx?layer=' + _myFleetLayers[0] +\r\n                            '&query=\"group\" is null and \"mmsi\" is null and \"imo\" is null',\r\n                            function (response) {                                          \r\n                                if (response.Status.toLowerCase() == \"ok\" && response.Result.values && response.Result.values.length>0) {\r\n                                    let f = response.Result.fields, v = response.Result.values;  \r\n                                    console.log(\"insert def group\");\r\n                                    vessels.push({imo:null, mmsi:null, group:null, gmx_id:v[0][f.indexOf('gmx_id')]});\r\n                                    resolve(vessels);\r\n                                }\r\n                                else\r\n                                    reject(response);\r\n                            })\r\n                    }\r\n                    else\r\n                        reject(response);\r\n                }\r\n            ); \r\n        },\r\n        fetchMyFleet = function (lid) {\r\n            return new Promise(function (resolve, reject) {\r\n                sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl + \"VectorLayer/Search.ashx?layer=\" + lid,\r\n                    function (response) {\r\n                        if (response.Status.toLowerCase() == \"ok\") {\r\n                            let v = response.Result.values,\r\n                                f = response.Result.fields,\r\n                                vessels = [];\r\n                            for (let i = 0; i < v.length; ++i) {\r\n                                vessels.push({})\r\n                                for (let j = 0; j < f.length; ++j){\r\n                                    vessels[i][f[j]] = v[i][j];\r\n                                }\r\n                            }\r\n\r\n                            new Promise((rs, rj)=>{\r\n                                if (f.indexOf('group')<0 || f.indexOf('style')<0)\r\n                                    addGroupField(lid, rs, rj, vessels);\r\n                                else \r\n                                    rs();\r\n                            }).then(()=>{\r\n                                if (Polyfill.findIndex(vessels, v=>!v.imo&&!v.mmsi&&!v.group)<0)\r\n                                    addDefaultGroup(resolve, reject, vessels);\r\n                                else\r\n                                    resolve(vessels);\r\n                            },  r=>reject(r));\r\n                        }\r\n                        else\r\n                            reject(response);\r\n                    });\r\n            })\r\n        };\r\n\r\n    nsGmx.gmxMap.layersByID[aisLayerSearcher.screenSearchLayer].on('versionchange', ()=>{\r\n//console.log(\"V C\"); \r\n        _repaintMap(_vessels);\r\n    });\r\n    nsGmx.widgets.commonCalendar.getDateInterval().on('change', \r\n    //()=>_tools.repaintOtherMarkers(_data, _markerTemplate, _view.isActive ? _filteredState : [])\r\n    ()=>_tools.repaintOtherMarkers(_data, _markerTemplate, _filteredState)\r\n    );\r\n    _prepared = new Promise((resolve, reject) => {\r\n        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n            \"User/GetUserInfo.ashx\",\r\n            function (response) {\r\n                if (response.Status.toLowerCase() == \"ok\" && response.Result)\r\n                    resolve(response);\r\n                if (response.Status.toLowerCase() == \"ok\" && !response.Result)\r\n                    reject({Status:\"auth\"});\r\n                else\r\n                    reject(response);\r\n            });\r\n    })\r\n    .then((response) => {\r\n            let nickname = response.Result.Nickname;\r\n            return new Promise((resolve, reject) => {\r\n                sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                    \"Layer/Search2.ashx?page=0&pageSize=50&orderby=title &query=([Title]='myfleet\" + _mapID + \"' and [OwnerNickname]='\" + nickname + \"')\",\r\n                    function (response) {\r\n                        if (response.Status.toLowerCase() == \"ok\" && response.Result.count > 0)\r\n                            resolve(response);\r\n                        else \r\n                            reject(response); // no my fleet layer\r\n                    });\r\n            });\r\n    })\r\n    .then((response) => {\r\n            let lid = response.Result.layers[0].LayerID;\r\n            _myFleetLayers.push(lid);\r\n            return fetchMyFleet(lid)\r\n        }\r\n        ,(rejectedResponse) => {\r\n            if (rejectedResponse.Status && rejectedResponse.Status.toLowerCase() == \"ok\")\r\n                return Promise.resolve([]); // no mf layer\r\n            else\r\n                return Promise.reject(rejectedResponse); // smth wrong\r\n        }\r\n    )\r\n    .then((vessels=>{\r\n//console.log('INIT REPAINT MAP')\r\n        _vessels = vessels.map(v=>v);\r\n        _repaintMap(vessels); // only on init\r\n        return Promise.resolve();\r\n    }).bind(this));\r\n    //.catch(error=>error);\r\n\r\n    return {\r\n        get isDirty() { return _isDirty; },\r\n        set isDirty(value) { _isDirty = value; },\r\n        get data() { return _data; },\r\n        set data(value) { _data = value; },\r\n        get view() { return _view; },\r\n        set view(value) { _view = value; },\r\n        get vessels(){\r\n            let myfleet = _data.groups.reduce((p, c) => {\r\n                c.vessels.forEach(v=>{if(v.mmsi)p.push({mmsi:v.mmsi, imo:v.imo})});\r\n                return p;\r\n            }, []);\r\n            return myfleet;\r\n        },\r\n        findIndex: function (vessel) {\r\n            if (_vessels.length == 0)\r\n                return -1;\r\n            return Polyfill.findIndex(_vessels, function (v) {\r\n                return v.mmsi == vessel.mmsi && v.imo == vessel.imo;\r\n            })\r\n        },\r\n        load: function (actualUpdate) {\r\n            var thisInst = this;\r\n            return _prepared.then(()=>{\r\n                if (_myFleetLayers.length == 0 || !thisInst.isDirty)\r\n                    return Promise.resolve();\r\n\r\n                return fetchMyFleet(_myFleetLayers[0]) \r\n                    .then(vessels=>{\r\n                        _vessels = vessels;\r\n                        return _loadVoyageInfo(vessels);\r\n                    })\r\n                    .then(data=>{\r\n                        _data=data;\r\n                        _isDirty = false;\r\n                        return Promise.resolve();\r\n                    })\r\n                    .catch(error=>{\r\n                        _isDirty = false;\r\n                        return Promise.reject(error);\r\n                    });\r\n            });\r\n        },\r\n        update: function () {\r\n            _actualUpdate = new Date().getTime();\r\n            let thisModel = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);\r\n            this.load(actualUpdate).then(\r\n                function () {\r\n                    if (_actualUpdate == actualUpdate) {\r\n                        thisModel.view.inProgress(false);\r\n                        if (_data)\r\n                            thisModel.view.repaint();\r\n                    }\r\n                }, \r\n                function (json) {\r\n                    thisModel.dataSrc = null;\r\n                    if ((json.Status && json.Status.toLowerCase() == \"auth\") ||\r\n                        (json.ErrorInfo && json.ErrorInfo.some && json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })))\r\n                        thisModel.data = { msg: [{ txt: _gtxt(\"AISSearch2.auth\") }], groups: [] };\r\n                    else {\r\n                        //thisModel.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                        console.log(json);\r\n                    }\r\n                    thisModel.view.inProgress(false);\r\n                    thisModel.view.repaint();\r\n                });\r\n        },\r\n        get markerTemplate(){return _markerTemplate;},\r\n        set markerTemplate(v){_markerTemplate = v;},\r\n        drawMarker: function(vessel){\r\n            _repaintMap( _vessels);\r\n        },\r\n        drawMarkers: function(){\r\n            //_tools.repaintOtherMarkers(_data, _markerTemplate, _view.isActive ? _filteredState : []);\r\n            _tools.repaintOtherMarkers(_data, _markerTemplate, _filteredState);\r\n        },\r\n        markMembers: function (vessels) {\r\n            if (this.data && this.data.groups){\r\n                let membCounter = 0;\r\n                this.data.groups.forEach(function (g) {\r\n                    g.vessels.forEach(function (v) {\r\n                        let i = Polyfill.findIndex(vessels, function (vv) { return v.mmsi == vv.mmsi && v.imo == v.imo });\r\n                        if (i>-1){\r\n                            let member = vessels[i]\r\n                            member.mf_member = \"visibilty:visible\";\r\n                            vessels.splice(i, 1);\r\n                            vessels.splice(membCounter++, 0, member);\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        },\r\n        createGroup: function(name){\r\n            if (!_myFleetLayers.length)\r\n                return Promise.reject({Status:\"error\", ErrorInfo:\"no data\"});\r\n\r\n            return new Promise((resolve, reject)=>{\r\n                sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                    'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                    '&objects=[{\"properties\":{ \"group\": \"' + name.replace(/\"/g, '\\\\\\\"') + '\"},\"action\":\"insert\"}]',\r\n                    function (response) {\r\n                        if (response.Status.toLowerCase() == \"ok\") {                           \r\n                            sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                                'VectorLayer/Search.ashx?layer=' + _myFleetLayers[0] +\r\n                                '&query=\"group\"=\\'' + name.replace(/'/g, \"''\") + '\\'',\r\n                                function (response) {                                          \r\n                                    if (response.Status.toLowerCase() == \"ok\" && response.Result.values && response.Result.values.length>0) {\r\n                                        let f = response.Result.fields, v = response.Result.values;  \r\n                                        let group = emptyGroup(name, false, v[0][f.indexOf('gmx_id')]);\r\n                                        _data.groups.push(group);\r\n                                        _vessels.push({gmx_id: v[0][f.indexOf('gmx_id')], mmsi:null, imo:null, group:name})\r\n                                        resolve(group);\r\n                                    }\r\n                                    else\r\n                                        reject(response);\r\n                                })\r\n                        }\r\n                        else\r\n                            reject(response);\r\n                    }\r\n                ); \r\n            });\r\n        },\r\n        deleteGroup: function(group){\r\n            let objects = [], thisModel = this, i, j=-1;\r\n            for (i = 0; i < _vessels.length; ++i) {\r\n                if (_vessels[i].group == group) {\r\n                    if (!_vessels[i].mmsi && !_vessels[i].imo) {\r\n                        j = i;\r\n                        objects.push({ id: _vessels[i].gmx_id, action: \"delete\" });\r\n                    }\r\n                    else {\r\n                        _vessels[i].group = null;\r\n                        objects.push({ properties: _vessels[i], id: _vessels[i].gmx_id, action: \"update\" });\r\n                    }\r\n                }\r\n            }\r\n            if (j<0)\r\n                return;\r\n            i = Polyfill.findIndex(_data.groups, g=>g.id==_vessels[j].gmx_id);\r\n// console.log(i+\", \"+j + \" - \"+ _data.groups[i].id +\" \"+_vessels[j].gmx_id);    \r\n            _data.groups.splice(i, 1);\r\n            _data.groups.sort(_compareGroups);\r\n// console.log(_data.groups)\r\n// console.log(_vessels);            \r\n            _vessels.splice(j, 1);\r\n            sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                '&objects=' + JSON.stringify(objects),\r\n                function (response) {\r\n                    if (response.Status.toLowerCase() == \"ok\") {\r\n                        thisModel.isDirty = true;\r\n                        thisModel.update();\r\n                    }\r\n                    else\r\n                        console.log(response);\r\n                }\r\n            ); \r\n        },\r\n        set onChanged(callback){ _onChangedHandlers.push(callback) },\r\n        change: function (vessel) {\r\n            var remove = false;\r\n            for (var i = 0; i < _vessels.length; ++i) {\r\n                if (_vessels[i].imo == vessel.imo && _vessels[i].mmsi == vessel.mmsi) {\r\n                    remove = _vessels[i].gmx_id;\r\n                    _vessels.splice(i, 1);\r\n                }\r\n            }\r\n            return new Promise((resolve, reject) => {\r\n                if (!_myFleetLayers.length){\r\n                    sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                        'VectorLayer/CreateVectorLayer.ashx?Title=myfleet' + _mapID + '&geometrytype=point&Columns=' +\r\n                        '[{\"Name\":\"mmsi\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"mmsi\\\\\"\"},{\"Name\":\"imo\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"imo\\\\\"\"},{\"Name\":\"group\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"group\\\\\"\"},{\"Name\":\"style\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"style\\\\\"\"}]',\r\n                        function (response) {\r\n                            if (response.Status.toLowerCase() == \"ok\") {\r\n                                _myFleetLayers.push(response.Result.properties.name);\r\n                                addDefaultGroup(resolve, reject, []);\r\n                            }\r\n                            else\r\n                                reject(response); // creation failed\r\n                        }\r\n                    );\r\n                }\r\n                else\r\n                    resolve();\r\n            })\r\n            .then(()=>{\r\n                return new Promise((resolve, reject) => {\r\n                    if (!remove)\r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                            '&objects=[{\"properties\":{ \"imo\": ' + vessel.imo + ', \"mmsi\": ' + vessel.mmsi + '},\"action\":\"insert\"}]',\r\n                            function (response) {\r\n                                if (response.Status.toLowerCase() == \"ok\") {\r\n                                    resolve();\r\n                                    _vessels.push({ \"mmsi\": vessel.mmsi, \"imo\": vessel.imo, \"gmx_id\": response.Result[0] });\r\n                                }\r\n                                else\r\n                                    reject(response);\r\n                            })\r\n                    else\r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                            '&objects=[{\"id\":' + remove + ',\"action\":\"delete\"}]',\r\n                            function (response) {\r\n                                if (response.Status.toLowerCase() == \"ok\")\r\n                                    resolve();\r\n                                else\r\n                                    reject(response);\r\n                            })\r\n                })\r\n                .then(\r\n                function () {\r\n                    this.isDirty = true;\r\n                    _fireChanged();\r\n                    return Promise.resolve();\r\n                }.bind(this),\r\n                function (response) {\r\n                    console.log(response);\r\n                    this.isDirty = true;\r\n                    return Promise.resolve();\r\n                }.bind(this));\r\n            });\r\n        },\r\n        changeGroup: function(mmsi, group)  {   \r\n            let i=Polyfill.findIndex(_vessels, (v)=>{return v.mmsi==mmsi})\r\n            if (i<0) \r\n                return Promise.reject(mmsi);\r\n            _vessels[i].group = group;\r\n            return new Promise((resolve, reject)=>{\r\n                sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                    'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                    '&objects=[' +\r\n                    '{\"properties\":' + JSON.stringify(_vessels[i]) +\r\n                    ',\"id\":' + _vessels[i].gmx_id + ',\"action\":\"update\"}]', (r)=>{\r\n                    if (r.Status && r.Status.toLowerCase()==\"ok\"){\r\n                        let i, j, found = false;\r\n                        for (i=0; i<_data.groups.length; ++i){\r\n                            for (j=0; j<_data.groups[i].vessels.length; ++j){\r\n                                found = _data.groups[i].vessels[j].mmsi==mmsi;\r\n                                if (found) break;\r\n                            }                            \r\n                            if (found) break; \r\n                        } \r\n                        let temp = _data.groups[i].vessels.splice(j, 1)[0];\r\n                        i = !group?0:Polyfill.findIndex(_data.groups, g=>g.title==group)\r\n                        _data.groups[i].vessels.push(temp);\r\n                        resolve(r);\r\n                    }\r\n                    else\r\n                        reject(r);\r\n                });\r\n            });\r\n        },\r\n        saveGroupStyle: function(count){\r\n            return new Promise((resolve, reject)=>{\r\n                let temp = [];\r\n                for (let i=0; i<_data.groups.length; ++i){\r\n                    temp.push({\r\n                        properties:{style:JSON.stringify({ms: _data.groups[i].marker_style, lc: _data.groups[i].label_color, lsc: _data.groups[i].label_shadow_color})}, \r\n                        id:_data.groups[i].id, action:\"update\"\r\n                    })\r\n                }\r\n\r\n                let form = new FormData();\r\n                form.set('WrapStyle', 'none');\r\n                form.set('LayerName', _myFleetLayers[0]);\r\n                form.set('objects', JSON.stringify(temp));\r\n                fetch(aisLayerSearcher.baseUrl + 'VectorLayer/ModifyVectorObjects.ashx', {\r\n                credentials: 'include',\r\n                method: \"POST\",\r\n                body: form\r\n                })\r\n                .then((r)=>r.json())\r\n                .then((r)=>{  \r\n                    if (!r.Status || r.Status.toLowerCase() != \"ok\")\r\n                        console.log(r);  \r\n                    resolve(count + 1);\r\n                })\r\n                .catch(err=>{\r\n                    console.log(err);                \r\n                    resolve(count + 1);\r\n                });                \r\n            });    \r\n        },\r\n        changeGroupStyle: function(i, colors){\r\n            this.data.groups[i].marker_style = colors.marker_style;\r\n            this.data.groups[i].label_color = colors.label_color;\r\n            this.data.groups[i].label_shadow = colors.label_shadow;\r\n            _tools.highlightMarker(i, this.data.groups[i]);\r\n// console.log(vessels)\r\n//console.log(this.data.groups[i].marker_style)\r\n        },\r\n        /// Visibility switch click ///\r\n        showOnlyMyfleet: function(e){\r\n            _displayngState = null;\r\n            if (e.currentTarget.checked) {\r\n                let myfleet = _vessels.reduce((p,c)=>{if(c.mmsi)p.push(c.mmsi.toString()); return p;}, []);\r\n                if (myfleet.length > 0)\r\n                    _displayngState = myfleet;\r\n            }            \r\n            _tools.hideVesselMarkers(_filteredState, _displayngState);            \r\n        },\r\n        isMemberShown: function(mmsi){\r\n            return _filteredState.indexOf(mmsi)<0;\r\n        },    \r\n        /// Vessel visibility checkbox click ///\r\n        showMembers: function(filtered){ \r\n            _filteredState = filtered;            \r\n            _tools.hideVesselMarkers(_filteredState, _displayngState);  \r\n            //_tools.repaintOtherMarkers(_data, _markerTemplate, _view.isActive ? _filteredState : []);\r\n            _tools.repaintOtherMarkers(_data, _markerTemplate, _filteredState);\r\n        },        \r\n        /// Before exclude member ///\r\n        freeMember:function(mmsi){\r\n            _displayngState = _displayngState ? _displayngState.filter(m => m != mmsi) : null;\r\n            if (_displayngState && _displayngState.length == 0)\r\n                _displayngState = null;\r\n            _filteredState = _filteredState.filter(m => m != mmsi);\r\n        },\r\n        /// MF view repaint ///\r\n        showOnlyMyFleet: function()\r\n        { \r\n            if (_displayngState)\r\n                _displayngState = _vessels.reduce((p,c)=>{if(c.mmsi)p.push(c.mmsi.toString()); return p;}, []);//_vessels.map(v=>v.mmsi.toString());\r\n\r\n            _tools.hideVesselMarkers(_filteredState, _displayngState);\r\n            //_tools.repaintOtherMarkers(_data, _markerTemplate, _view.isActive ? _filteredState : []);\r\n            _tools.repaintOtherMarkers(_data, _markerTemplate, _filteredState);\r\n            return _displayngState;\r\n        },    \r\n        /// MF view hide ///\r\n        showNotOnlyMyfleet: function(){\r\n            //_tools.repaintOtherMarkers(_data, _markerTemplate, []);\r\n            _tools.repaintOtherMarkers(_data, _markerTemplate, _filteredState);\r\n            _tools.hideVesselMarkers([], null);\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Models/MyFleetModel.js","module.exports = { \r\n\tfind: function(a, predicate) {\r\n\t\tvar list = Object(a);\r\n\t\tvar length = list.length >>> 0;\r\n\t\tvar thisArg = arguments[2];\r\n\t\tvar value;\r\n\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t  value = list[i];\r\n\t\t  if (predicate.call(thisArg, value, i, list)) {\r\n\t\t\treturn value;\r\n\t\t  }\r\n\t\t}\r\n\t\treturn undefined;\r\n\t},\r\n\tfindIndex: function(a, predicate) {\r\n\t\tvar list = Object(a);\r\n\t\tvar length = list.length >>> 0;\r\n\t\tvar thisArg = arguments[2];\r\n\t\tvar value;\r\n\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t  value = list[i];\r\n\t\t  if (predicate.call(thisArg, value, i, list)) {\r\n\t\t\treturn i;\r\n\t\t  }\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Polyfill.js","require(\"./DbSearch.css\")\r\nconst BaseView = require('./BaseView.js');\r\n\r\nlet _searchString = \"\",\r\n    _setSearchInputValue = function (s) {\r\n        let searchBut = this.frame.find('.filter .search'),\r\n            removeBut = this.frame.find('.filter .remove'),\r\n            _searchString = s;\r\n            \r\n        this.searchInput.val(_searchString);\r\n        if (s != \"\") {\r\n            removeBut.show();\r\n            searchBut.hide();\r\n        }\r\n        else\r\n            removeBut.click();\r\n    },\r\n    _highlight,\r\n    _tools,\r\n    _displayedOnly = null;\r\n\r\nconst DbSearchView = function ({ model, highlight, tools }) {\r\n    BaseView.call(this, model);\r\n    _highlight = highlight;\r\n    _tools = tools;\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view search_view\">' +\r\n        '<table border=0 class=\"instruments\">' +\r\n        '<tr><td colspan=\"2\"><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filter\"}}\"/>' +\r\n        '<div><img class=\"search clicable\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        '<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\">' +\r\n        '</div></div>' +\r\n\r\n        '</td></tr>' +\r\n        '<tr><td class=\"time\" colspan=\"2\"><span class=\"label\">{{i \"AISSearch2.time_switch\"}}:</span>' +\r\n        '<span class=\"utc on unselectable\" unselectable=\"on\">UTC</span><span class=\"local unselectable\" unselectable=\"on\">{{i \"AISSearch2.time_local\"}}</span>'+\r\n        '<span class=\"sync-switch-slider-description\" style=\"padding: 0;margin-left: 10px;line-height:12px\">{{i \"AISSearch2.thisVesselOnly\"}}</span>'+ \r\n        '<label class=\"sync-switch switch only_this\" style=\"margin-left:5px\"><input type=\"checkbox\">'+\r\n        '<div class=\"sync-switch-slider switch-slider round\"></div></label>' +\r\n        '</td>' +\r\n\r\n        '<tr><td><div class=\"calendar\"></div></td>' +\r\n        '<td style=\"padding-left:5px;padding-right:25px;vertical-align:top;\"><div class=\"refresh clicable\" title=\"{{i \"AISSearch2.refresh\"}}\">' +\r\n        '<div class=\"progress\">' + this.gifLoader + '</div>' +\r\n        '<div class=\"reload\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"#2f3c47\" d=\"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z\"/></svg></div>' +\r\n        '</div></td></tr>' +\r\n        '</table>' +\r\n\r\n        '<div class=\"ais_history\">' +\r\n        '<table class=\"ais_positions_date\"><tr><td>NO HISTORY FOUND</td></tr></table>' +\r\n        '</div>' +\r\n        '<table class=\"start_screen\"><tr><td>' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/steer-weel.svg\">' +\r\n        '<div>{{{i \"AISSearh2.searchresults_view\"}}}' +\r\n        '</div></td></tr></table>' +\r\n\r\n        '<div class=\"suggestions\"><div class=\"suggestion\">SOME VESSEL<br><span>mmsi:0, imo:0</span></div></div>' +\r\n        '</div>'\r\n    )());\r\n\r\n    Object.defineProperty(this, \"topOffset\", {\r\n        get: function () {\r\n            let rv = $('.ais_tabs')[0].getBoundingClientRect().height + \r\n            this.frame.find('.instruments')[0].getBoundingClientRect().height;\r\n            return rv;\r\n        }\r\n    });  \r\n\r\n    this.container = this.frame.find('.ais_history');\r\n    this.startScreen = this.frame.find('.start_screen');\r\n    this.tableTemplate = '{{#if msg}}<div class=\"message\">{{msg}}</div>{{/if}}' +\r\n        '{{#each vessels}}' +\r\n        '<table class=\"ais_positions_date\" border=0><tr>' +\r\n        '<td><div class=\"open_positions ui-helper-noselect icon-right-open\" title=\"{{i \"AISSearch2.voyageInfo\"}}\"></div></td>' +\r\n        '<td><span class=\"date\">{{{ts_pos_utc}}}</span></td>' +\r\n        '<td><div class=\"track\" date=\"{{{ts_pos_utc}}}\"><input type=\"checkbox\" title=\"{{i \"AISSearch2.dailyTrack\"}}\"></div></td>' +\r\n        '<td><div class=\"count\">{{count}}</div></td></tr></table>' +\r\n        '<div id=\"voyage_info{{n}}\"></div>' +\r\n        '{{/each}}';\r\n\r\n    let calendar = this.frame.find('.calendar');\r\n\r\n    // walkaround with focus at first input in ui-dialog\r\n    calendar.append('<span class=\"ui-helper-hidden-accessible\"><input type=\"text\"/></span>')\r\n    let mapDateInterval = nsGmx.widgets.commonCalendar.getDateInterval(),\r\n        dateInterval = new nsGmx.DateInterval();\r\n    dateInterval\r\n        .set('dateBegin', mapDateInterval.get('dateBegin'))\r\n        .set('dateEnd', mapDateInterval.get('dateEnd'))\r\n        .on('change', function (e) {\r\n//console.log(this.model.historyInterval) \r\n//console.log('CHANGE ' + dateInterval.get('dateBegin').toUTCString() + ' ' + dateInterval.get('dateEnd').toUTCString()) \r\n            this.model.historyInterval = { dateBegin: dateInterval.get('dateBegin'), dateEnd: dateInterval.get('dateEnd') };\r\n            this.model.isDirty = true;\r\n            this.show();\r\n        }.bind(this));\r\n\r\n    this.calendar = new nsGmx.CalendarWidget({\r\n        dateInterval: dateInterval,\r\n        name: 'searchInterval',\r\n        container: calendar,\r\n        dateMin: new Date(0, 0, 0),\r\n        dateMax: new Date(3015, 1, 1),\r\n        dateFormat: 'dd.mm.yy',\r\n        minimized: false,\r\n        showSwitcher: false,\r\n        dateBegin: new Date(),\r\n        dateEnd: new Date(2000, 10, 10),\r\n        //buttonImage: 'img/calendar.png'\r\n    })\r\n\r\n    let td = calendar.find('tr:nth-of-type(1) td');\r\n    td.eq(1).after('<td style=\"font-weight:bold\">&nbsp;&nbsp;&ndash;&nbsp;&nbsp;</td>');\r\n    td.eq(td.length - 1).after('<td>&nbsp;&nbsp;<img class=\"default_date\" style=\"cursor:pointer\" title=\"'+_gtxt('AISSearch2.calendar_today')+'\" src=\"plugins/AIS/AISSearch/svg/calendar.svg\"></td>');\r\n\r\n    calendar.find('.default_date').on('click', () => {\r\n        let db = nsGmx.DateInterval.getUTCDayBoundary(new Date());\r\n        this.calendar.getDateInterval().set('dateBegin', db.dateBegin);\r\n        this.calendar.getDateInterval().set('dateEnd', db.dateEnd);\r\n        nsGmx.widgets.commonCalendar.setDateInterval(db.dateBegin, db.dateEnd);\r\n    })\r\n\r\n    //sidebarControl && sidebarControl.on('closing', ()=>calendar.reset())\r\n    this.frame.on('click', ((e) => {\r\n        if (e.target.classList.toString().search(/CalendarWidget/) < 0) {\r\n            this.calendar.reset()\r\n        }\r\n        suggestions.hide();\r\n    }).bind(this));\r\n\r\n    this.frame.find('.time .only_this  input[type=\"checkbox\"]').click((e=>{\r\n        _displayedOnly = null;\r\n//console.log(this.model.data.vessels[0].positions[0].mmsi.toString())\r\n        if (e.currentTarget.checked && this.frame.find('.show_info')[0] ) {\r\n            _displayedOnly = [this.model.data.vessels[0].positions[0].mmsi.toString()];\r\n            _tools.showOtherMarkers([this.model.data.vessels[0].positions[0].mmsi.toString()])\r\n        }\r\n        else\r\n            _tools.showOtherMarkers();\r\n        _tools.hideVesselMarkers([], _displayedOnly);  \r\n    }).bind(this));\r\n\r\n    this.frame.find('.time .utc,.local').click((e => {\r\n        let trg = $(e.currentTarget);\r\n        if (!trg.is('.on')) {\r\n            this.frame.find('.time span').removeClass(\"on\");\r\n            trg.addClass('on')\r\n            if (trg.is('.utc')) {\r\n                this.frame.find('.utc_time').show();\r\n                this.frame.find('.local_time').hide();\r\n                this.frame.find('.utc_date').show();\r\n                this.frame.find('.local_date').hide();\r\n            }\r\n            else {\r\n                this.frame.find('.utc_time').hide();\r\n                this.frame.find('.local_time').show();\r\n                this.frame.find('.utc_date').hide();\r\n                this.frame.find('.local_date').show();\r\n            }\r\n        }\r\n\r\n    }).bind(this));\r\n\r\n    this.frame.find('.refresh .reload').click((e=>{\r\n        if (e.currentTarget.style.display=\"block\"){\r\n            this.model.isDirty = true;\r\n            this.model.update();\r\n        }\r\n    }).bind(this));\r\n\r\n    this.searchInput = this.frame.find('.filter input');\r\n\r\n    let searchBut = this.frame.find('.filter .search'),\r\n        removeBut = this.frame.find('.filter .remove'),\r\n        delay,\r\n        suggestions = this.frame.find('.suggestions'),\r\n        suggestionsCount = 5,\r\n        suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 },\r\n        found = { values: [] },\r\n        searchDone = function () {\r\n            if (found.values.length > 0) {\r\n                _searchString = found.values[suggestionsFrame.current].vessel_name;\r\n                this.searchInput.val(_searchString);\r\n                let v = found.values[suggestionsFrame.current];\r\n                if (!this.vessel || this.vessel.mmsi != v.mmsi || !this.frame.find('.ais_positions_date')[0]) {\r\n                    this.vessel = v;\r\n                    this.show();\r\n                }\r\n            }\r\n            else {\r\n                _clean.call(this);\r\n                _cleanMap();\r\n            }\r\n        },\r\n        doSearch = function (actualId) {\r\n            //console.log(_searchString)\r\n            new Promise(function (resolve, reject) {\r\n                this.model.searcher.searchString(_searchString, true, function (response) {\r\n                    if (response.Status.toLowerCase() == \"ok\") {\r\n                        found = {\r\n                            values: response.Result.values.map(function (v) {\r\n                                return { vessel_name: v[0], mmsi: v[1], imo: v[2], ts_pos_utc: v[3], ts_pos_org: v[3], vessel_type: v[4] }\r\n                            })\r\n                        };\r\n                        resolve();\r\n                    }\r\n                    else {\r\n                        reject(response);\r\n                    }\r\n                })\r\n            }.bind(this))\r\n                .then(function () { \r\n                    \r\n                    if (actualId!=delay)\r\n                        return;\r\n\r\n                    // SUCCEEDED\r\n                    if (found.values.length == 0) {\r\n                        suggestions.hide();\r\n                        return;\r\n                    }\r\n\r\n//console.log(\"ss: \"+_searchString)\r\n                    if (_searchString==\"\") {\r\n                        suggestions.hide();\r\n                        return;\r\n                    }\r\n\r\n                    let scrollCont = suggestions.find('.mCSB_container'),\r\n                        content = $(Handlebars.compile(\r\n                            '{{#each values}}<div class=\"suggestion\" id=\"{{@index}}\">{{vessel_name}}<br><span>mmsi:{{mmsi}}, imo:{{imo}}</span></div>{{/each}}'\r\n                        )(found));\r\n                    if (!scrollCont[0])\r\n                        suggestions.html(content).mCustomScrollbar();\r\n                    else\r\n                        $(scrollCont).html(content);\r\n\r\n                    let suggestion = suggestions.find('.suggestion');\r\n                    if (!suggestions.is(':visible')) {\r\n                        let cr = this.frame.find('.filter')[0].getBoundingClientRect();\r\n                        suggestions.show();\r\n                        suggestions.offset({ left: cr.left, top: cr.bottom - 3 });\r\n                        suggestions.outerWidth(cr.width)\r\n                    }\r\n\r\n                    suggestions.innerHeight(suggestion[0].getBoundingClientRect().height *\r\n                        (found.values.length > suggestionsCount ? suggestionsCount : found.values.length));\r\n                    suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 };\r\n                    suggestion.eq(suggestionsFrame.current).addClass('selected');\r\n                    suggestion.click(e => {\r\n                        suggestionsFrame.current = e.currentTarget.id;\r\n                        searchDone.call(this);\r\n                    });\r\n                    //console.log(\"doFilter2 \"+_searchString)\r\n                }.bind(this),\r\n                function (response) { // FAILED\r\n                    console.log(response);\r\n                });\r\n        };\r\n    removeBut.click(function (e) {\r\n        this.searchInput.val('');\r\n        this.searchInput.focus();\r\n        clearTimeout(delay)\r\n        removeBut.hide();\r\n        searchBut.show();\r\n        suggestions.hide();\r\n        _clean.call(this);\r\n        _cleanMap();\r\n        //nsGmx.leafletMap.removeLayer(highlight);\r\n    }.bind(this));\r\n    this.searchInput.keydown(function (e) {\r\n        let suggestion = suggestions.find('.suggestion.selected');\r\n        if (suggestions.is(':visible')) {\r\n            if (e.keyCode == 38) {\r\n                if (suggestionsFrame.current > 0) {\r\n                    suggestionsFrame.current--;\r\n                    suggestion.removeClass('selected').prev().addClass('selected');\r\n                }\r\n            }\r\n            else if (e.keyCode == 40) {\r\n                if (suggestionsFrame.current < found.values.length - 1) {\r\n                    suggestionsFrame.current++;\r\n                    suggestion.removeClass('selected').next().addClass('selected');\r\n                }\r\n            }\r\n            if (suggestionsFrame.last < suggestionsFrame.current) {\r\n                suggestionsFrame.last = suggestionsFrame.current;\r\n                suggestionsFrame.first = suggestionsFrame.last - (suggestionsCount - 1);\r\n            }\r\n            if (suggestionsFrame.first > suggestionsFrame.current) {\r\n                suggestionsFrame.first = suggestionsFrame.current;\r\n                suggestionsFrame.last = suggestionsFrame.first + (suggestionsCount - 1);\r\n            }\r\n            suggestions.mCustomScrollbar(\"scrollTo\", \"#\" + suggestionsFrame.first, { scrollInertia: 0 });\r\n        }\r\n    });\r\n\r\n    let prepareSearchInput = function (temp, keyCode) {\r\n        removeBut.show();\r\n        searchBut.hide();\r\n        if (_searchString == temp && (!keyCode || keyCode != 13))\r\n            return false;\r\n        _searchString = temp;\r\n        clearTimeout(delay);\r\n        if (_searchString == \"\") {\r\n            removeBut.click();\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    this.searchInput.keyup(function (e) {\r\n        let temp = (this.searchInput.val() || \"\")\r\n            .replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n        if (!prepareSearchInput(temp, e.keyCode))\r\n            return;\r\n        if (e.keyCode == 13) {\r\n            suggestions.hide();\r\n            searchDone.call(this);\r\n        }\r\n        else\r\n            delay = setTimeout((() => {\r\n                doSearch.apply(this, [delay])\r\n            }).bind(this), 200);\r\n        //nsGmx.leafletMap.removeLayer(highlight);\r\n    }.bind(this));\r\n    this.searchInput.on(\"paste\", function (e) {\r\n        let temp = ((e.originalEvent || window.clipboardData).clipboardData.getData('text') || \"\")\r\n            .replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n        if (!prepareSearchInput(temp))\r\n            return;\r\n        delay = setTimeout((() => {\r\n            doSearch.apply(this, [delay])\r\n        }).bind(this), 200);\r\n    }.bind(this));\r\n};\r\n\r\nDbSearchView.prototype = Object.create(BaseView.prototype);\r\n\r\nlet _clean = function () {\r\n    this.frame.find('.open_positions').off('click');\r\n    this.frame.find('.ais_positions_date .track input[type=\"checkbox\"]').off('click');\r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n    //console.log(\"EMPTY ON SELF.CLEAN \"+this)\r\n    this.startScreen.css({ visibility: \"hidden\" });\r\n    nsGmx.leafletMap.removeLayer(_highlight);\r\n},\r\n_cleanMap = function(){\r\n    _displayedOnly = null;\r\n    _tools.showOtherMarkers(_displayedOnly);  \r\n    _tools.hideVesselMarkers([], _displayedOnly);\r\n};\r\n\r\nDbSearchView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div.progress'),\r\n    reload = this.frame.find('.refresh div.reload');\r\n    if (state){\r\n        progress.show();\r\n        reload.hide();\r\n    }\r\n    else{\r\n        progress.hide();\r\n        reload.show();\r\n    }\r\n};\r\n\r\nlet _vi_template = '<table class=\"ais_positions\">' +\r\n    '{{#each positions}}' +\r\n    '<tr>' +\r\n    '<td  title=\"{{i \"AISSearch2.info\"}}\"><img class=\"show_info\" id=\"show_info{{@index}}\" src=\"plugins/AIS/AISSearch/svg/info.svg\"></td>' +\r\n    '<td><span class=\"utc_time\">{{tm_pos_utc}}</span><span class=\"local_time\">{{tm_pos_loc}}</span></td>' +\r\n    '<td><span class=\"utc_date\">{{dt_pos_utc}}</span><span class=\"local_date\">{{dt_pos_loc}}</span></td>' +\r\n    '<td><img src=\"{{icon}}\" class=\"rotateimg{{icon_rot}}\"></td>' +\r\n    '<td><img src=\"{{source}}\"></td>' +\r\n    '<td>{{longitude}}&nbsp;&nbsp;{{latitude}}</td>' +\r\n    '<td><div class=\"show_pos\" id=\"show_pos{{@index}}\" title=\"{{i \"AISSearch2.position\"}}\"><img src=\"plugins/AIS/AISSearch/svg/center.svg\"></div></td>' +\r\n    '</tr>' +\r\n    '<tr><td colspan=\"7\" class=\"more\"><hr><div class=\"vi_more\">' +\r\n\r\n    '<div class=\"c1\">COG | SOG:</div><div class=\"c2\">&nbsp;{{cog}} {{#if cog_sog}}&nbsp;{{/if}} {{sog}}</div>' +\r\n    '<div class=\"c1\">HDG | ROT:</div><div class=\"c2\">&nbsp;{{heading}} {{#if heading_rot}}&nbsp;{{/if}} {{rot}}</div>' +\r\n    '<div class=\"c1\">{{i \"AISSearch2.draught\"}}:</div><div class=\"c2\">&nbsp;{{draught}}</div>' +\r\n    '<div class=\"c1\">{{i \"AISSearch2.destination\"}}:</div><div class=\"c2\">&nbsp;{{destination}}</div>' +\r\n    '<div class=\"c1\">{{i \"AISSearch2.nav_status\"}}:</div><div class=\"c2\">&nbsp;{{nav_status}}</div>' +\r\n    '<div class=\"c1\">ETA:</div><div class=\"c2\">&nbsp;<span class=\"utc_time\">{{eta_utc}}</span><span class=\"local_time\">{{eta_loc}}</span></div>' +\r\n\r\n    '</div></td></tr>' +\r\n    '{{/each}}' +\r\n    '</table>';\r\n\r\nlet _prepare_history = function(){   \r\n//console.log(_tools.displayedTrack)     \r\n    if (this.model.data.vessels.length>0 && _tools.displayedTrack && \r\n        _tools.displayedTrack.mmsi==this.model.data.vessels[0].positions[0].mmsi){            \r\n        this.frame.find('.ais_positions_date').each((i, el) => {\r\n            if (_tools.displayedTrack.dates) {\r\n                let modelDate = new Date(this.model.data.vessels[i].positions[0].ts_pos_org * 1000).setUTCHours(0, 0, 0, 0)\r\n                for (let j = 0; j < _tools.displayedTrack.dates.list.length; ++j) {\r\n                    let trackDate = _tools.displayedTrack.dates.list[j];\r\n                    if (modelDate === trackDate.getTime()) {\r\n                        $(el).find('.track input')[0].checked = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            else\r\n                $(el).find('.track input')[0].checked = true;\r\n        });\r\n    }\r\n}\r\n\r\nDbSearchView.prototype.repaint = function () {\r\n    _clean.call(this);\r\n    BaseView.prototype.repaint.apply(this, arguments); \r\n\r\n    _prepare_history.call(this);\r\n\r\n//console.log(\"REPAINT\")\r\n    if (this.frame.find('.time .only_this  input[type=\"checkbox\"]')[0].checked) {\r\n        _displayedOnly = [this.model.data.vessels[0].positions[0].mmsi.toString()];\r\n        _tools.showOtherMarkers(_displayedOnly); \r\n        _tools.hideVesselMarkers([], _displayedOnly);  \r\n    }\r\n\r\n    let open_pos = this.frame.find('.open_positions');\r\n    open_pos.each((ind, elm) => {\r\n        $(elm).click(((e) => {\r\n            let icon = $(e.target),\r\n                vi_cont = this.frame.find('#voyage_info' + ind);\r\n\r\n            if (icon.is('.icon-down-open')) {\r\n                icon.removeClass('icon-down-open').addClass('.icon-right-open');\r\n                vi_cont.find('.ais_positions td[class!=\"more\"]').off('click')\r\n                vi_cont.empty();\r\n            }\r\n            else {\r\n                icon.addClass('icon-down-open').removeClass('.icon-right-open');\r\n                vi_cont.html(Handlebars.compile(_vi_template)(this.model.data.vessels[ind]));\r\n                if (this.frame.find('.time .local').is('.on')) {\r\n                    vi_cont.find('.utc_time').hide();\r\n                    vi_cont.find('.local_time').show();\r\n                    vi_cont.find('.utc_date').hide();\r\n                    vi_cont.find('.local_date').show();\r\n                }\r\n                vi_cont.find('.ais_positions td[class!=\"more\"]').click((e) => {\r\n                    let td = $(e.currentTarget);\r\n                    if (td.is('.active')) {\r\n                        td.removeClass('active')\r\n                        td.siblings().removeClass('active')\r\n                        td.parent().next().find('td').removeClass('active')\r\n                    }\r\n                    else {\r\n                        td.addClass('active')\r\n                        td.siblings().addClass('active')\r\n                        td.parent().next().find('td').addClass('active')\r\n                    }\r\n                });\r\n                let infoDialog = this.infoDialogView,\r\n                    vessel = this.vessel;\r\n                vi_cont.find('.ais_positions .show_info').click(((e) => {\r\n                    let i = e.currentTarget.id.replace(/show_info/, \"\"),\r\n                        position = this.model.data.vessels[ind].positions[i];\r\n                    position.vessel_name = vessel.vessel_name;\r\n                    position.imo = vessel.imo;\r\n                    position.latitude = position.ymax;\r\n                    position.longitude = position.xmax;\r\n                    position.source = position.source_orig;\r\n                    //console.log(vessel)\r\n                    //console.log(position)\r\n                    infoDialog.show(position, false);\r\n                    e.stopPropagation();\r\n                }).bind(this));\r\n                vi_cont.find('.ais_positions .show_pos').click(((e) => {\r\n                    //showPosition\r\n                    let i = e.currentTarget.id.replace(/show_pos/, \"\"),\r\n                        vessel = this.model.data.vessels[ind].positions[parseInt(i)];\r\n                    this.positionMap(vessel, this.calendar.getDateInterval());\r\n                    this.frame.find('.track input')[ind].checked = true;                    \r\n                    let dates = getDates.call(this);\r\n                    this.showTrack({mmsi:this.model.data.vessels[0].positions[0].mmsi}, dates, [], _displayedOnly);\r\n                    e.stopPropagation();\r\n                }).bind(this));\r\n            }\r\n        }).bind(this))\r\n    })\r\n\r\n    let getDates = function(){\r\n        let dates = [];\r\n        this.frame.find('.ais_positions_date .track').each((i, el)=>{            \r\n            if ($('input', el)[0].checked)\r\n                dates.push(\r\n                    new Date(new Date(1000*this.model.data.vessels[i].positions[0].ts_pos_utc).setUTCHours(0,0,0,0))\r\n                );\r\n        })\r\n        return dates;\r\n    };\r\n\r\n    this.frame.find('.ais_positions_date .track input[type=\"checkbox\"]').click(((e)=>{\r\n        let calendarInterval = this.calendar.getDateInterval(),\r\n        interval = {dateBegin:calendarInterval.get(\"dateBegin\"), dateEnd:calendarInterval.get(\"dateEnd\")};\r\n        nsGmx.widgets.commonCalendar.setDateInterval(interval.dateBegin, interval.dateEnd);\r\n        let dates = getDates.call(this);\r\n        this.showTrack({mmsi:this.model.data.vessels[0].positions[0].mmsi}, dates, [], _displayedOnly);\r\n    }).bind(this));\r\n\r\n    if (this.model.data.vessels.length == 1)\r\n        open_pos.eq(0).click();\r\n\r\n    if (this.vessel.lastPosition)\r\n        this.positionMap(this.vessel, this.calendar.getDateInterval());\r\n};\r\n\r\n\r\nObject.defineProperty(DbSearchView.prototype, \"vessel\", {\r\n    get() {\r\n        return this.model.vessel;\r\n    },\r\n    set(v) {\r\n        _setSearchInputValue.call(this, v.vessel_name);\r\n        _searchString = v.vessel_name;\r\n        \r\n        let positionDate = nsGmx.DateInterval.getUTCDayBoundary(new Date(v.ts_pos_org * 1000));\r\n        this.model.vessel = null;\r\n        let checkInterval = this.calendar.getDateInterval();\r\n// console.log(positionDate.dateBegin + '<' + checkInterval.get('dateBegin'))\r\n// console.log(checkInterval.get('dateEnd') + '<' + positionDate.dateEnd)\r\n        if (positionDate.dateBegin < checkInterval.get('dateBegin') || checkInterval.get('dateEnd') < positionDate.dateEnd){\r\n            this.calendar.getDateInterval().set('dateBegin', positionDate.dateBegin);\r\n            this.calendar.getDateInterval().set('dateEnd', positionDate.dateEnd);      \r\n            this.model.historyInterval = { dateBegin: positionDate.dateBegin, dateEnd: positionDate.dateEnd };\r\n        }\r\n        else\r\n            this.model.historyInterval = { dateBegin: checkInterval.get('dateBegin'), dateEnd: checkInterval.get('dateEnd') };\r\n        this.model.vessel = v;\r\n        this.model.isDirty = true;\r\n    }\r\n});\r\n\r\nDbSearchView.prototype.show = function () {\r\n    this.frame.show();\r\n    this.searchInput.focus();\r\n\r\n    _tools.showOtherMarkers(_displayedOnly);  \r\n    _tools.hideVesselMarkers([], _displayedOnly); \r\n\r\n    if (!this.vessel)\r\n        return;\r\n    BaseView.prototype.show.apply(this, arguments);\r\n};\r\n\r\nDbSearchView.prototype.hide = function () {\r\n    _tools.showOtherMarkers(); // throwaway filter  \r\n    BaseView.prototype.hide.apply(this, arguments);\r\n};\r\n\r\nDbSearchView.prototype.showTrack = function (vessel, dates) {\r\n    let dlg = $('.ui-dialog:contains(\"' + vessel.mmsi + '\")');\r\n    $('.showtrack').attr('title', _gtxt('AISSearch2.show_track'))\r\n        .removeClass('ais active');\r\n    if (dlg[0]) \r\n        dlg.find('.showtrack').attr('title', _gtxt('AISSearch2.hide_track'))\r\n        .addClass('ais active')\r\n    _tools.showTrack([vessel.mmsi], dates, [], _displayedOnly);\r\n};\r\n\r\nDbSearchView.prototype.positionMap = function (vessel, interval) {\r\n    if (interval) {    \r\n        // interval = {dateBegin:interval.get(\"dateBegin\"), dateEnd:interval.get(\"dateEnd\")};\r\n        // nsGmx.widgets.commonCalendar.setDateInterval(interval.dateBegin, interval.dateEnd);        \r\n        nsGmx.widgets.commonCalendar.setDateInterval(interval.get(\"dateBegin\"), interval.get(\"dateEnd\"));\r\n    }\r\n    let xmin = vessel.xmin ? vessel.xmin : vessel.longitude,\r\n        xmax = vessel.xmax ? vessel.xmax : vessel.longitude,\r\n        ymin = vessel.ymin ? vessel.ymin : vessel.latitude,\r\n        ymax = vessel.ymax ? vessel.ymax : vessel.latitude,\r\n        zoom = nsGmx.leafletMap.getZoom();\r\n    // nsGmx.leafletMap.fitBounds([\r\n    //     [ymin, xmin],\r\n    //     [ymax, xmax]\r\n    // ], {\r\n    //         maxZoom: (zoom < 9 ? 12 : zoom)\r\n    //     });\r\n    nsGmx.leafletMap.setView([ymax, xmax<0?(360+xmax):xmax], (zoom < 9 ? 12 : zoom));\r\n    nsGmx.leafletMap.removeLayer(_highlight);\r\n    _highlight.vessel = vessel;\r\n    _highlight.setLatLng([ymax, xmax<0?(360+xmax):xmax]).addTo(nsGmx.leafletMap);\r\n};\r\n\r\nmodule.exports = DbSearchView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/DbSearchView.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/DbSearch.css\n// module id = 17\n// module chunks = 0","module.exports = function (aisLayerSearcher) {\r\n    let _actualUpdate,\r\n        _round = function (d, p) {\r\n            let isNeg = d < 0,\r\n                power = Math.pow(10, p)\r\n            return d ? ((isNeg ? -1 : 1) * (Math.round((isNeg ? d = -d : d) * power) / power)) : d\r\n        },\r\n        _addUnit = function (v, u) {\r\n            return v != null && v != \"\" ? v + u : \"\";\r\n        },\r\n        _toDd = function (D, lng) {\r\n            let dir = D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n                deg = Math.round((D < 0 ? D = -D : D) * 1000000) / 1000000\r\n            return deg.toFixed(2) + \" \"//\"°\"\r\n                + dir\r\n        },\r\n        _formatPosition = function (vessel) {\r\n            vessel.cog_sog = vessel.cog && vessel.sog\r\n            vessel.heading_rot = vessel.heading && vessel.rot\r\n            vessel.x_y = vessel.longitude && vessel.latitude\r\n            let d = new Date(vessel.ts_pos_utc * 1000)\r\n            let eta = new Date(vessel.ts_eta * 1000)\r\n            vessel.tm_pos_utc = _formatTime(d);\r\n            vessel.tm_pos_loc = _formatTime(d, true);\r\n            vessel.dt_pos_utc = _formatDate(d);\r\n            vessel.dt_pos_loc = _formatDate(d, true);\r\n            vessel.eta_utc = aisLayerSearcher.formatDateTime(eta);\r\n            vessel.eta_loc = aisLayerSearcher.formatDateTime(eta, true);\r\n            vessel.icon_rot = Math.round(vessel.cog/15)*15;\r\n            vessel.cog = _addUnit(_round(vessel.cog, 5), \"°\");\r\n            vessel.rot = _addUnit(_round(vessel.rot, 5), \"°/мин\");\r\n            vessel.heading = _addUnit(_round(vessel.heading, 5), \"°\");\r\n            vessel.draught = _addUnit(_round(vessel.draught, 5), \" м\");\r\n            //vessel.length = _addUnit(vessel.length, \" м\");\r\n            //vessel.width = _addUnit(vessel.width, \" м\");\r\n            //vessel.source = 'plugins/AIS/AISSearch/svg/satellite-ais.svg'//vessel.source=='T-AIS'?_gtxt('AISSearch2.tais'):_gtxt('AISSearch2.sais');\r\n            vessel.source_orig = vessel.source;\r\n            vessel.source = vessel.source=='T-AIS'?'plugins/AIS/AISSearch/svg/waterside-radar.svg':'plugins/AIS/AISSearch/svg/satellite-ais.svg';\r\n\t            \r\n            vessel.xmin = vessel.longitude;\r\n            vessel.xmax = vessel.longitude;           \r\n            vessel.ymin = vessel.latitude;\r\n            vessel.ymax = vessel.latitude; \r\n\r\n            vessel.longitude = _toDd(vessel.longitude, true);\r\n            vessel.latitude = _toDd(vessel.latitude);\r\n            aisLayerSearcher.placeVesselTypeIcon(vessel);\r\n            vessel.sog = _addUnit(_round(vessel.sog, 5), \" уз\");\r\n\r\n            return vessel;\r\n        },\r\n        _formatTime = function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleTimeString();\r\n        },\r\n        _formatDate = function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleDateString();\r\n        }\r\n    return {\r\n        searcher: aisLayerSearcher,\r\n        filterString: \"\",\r\n        isDirty: false,\r\n        load: function (actualUpdate) {\r\n            if (!this.isDirty)\r\n                return Promise.resolve();\r\n            //return new Promise((resolve)=>setTimeout(resolve, 1000))\r\n            //console.log('LOAD ' + _historyInterval['dateBegin'].toUTCString() + ' ' + _historyInterval['dateEnd'].toUTCString())     \r\n            var _this = this;\r\n            return new Promise((resolve) => {\r\n                aisLayerSearcher.searchPositionsAgg([_this.vessel.mmsi], _this.historyInterval, function (response) {\r\n                    if (parseResponse(response)) {\r\n                        let position, positions = [],\r\n                            fields = response.Result.fields,\r\n                            groups = response.Result.values.reduce((p, c) => {\r\n                                let obj = {}, d;\r\n                                for (var j = 0; j < fields.length; ++j) {\r\n                                    obj[fields[j]] = c[j];\r\n                                    if (fields[j] == 'ts_pos_utc'){\r\n                                        let dt = c[j], t = dt - dt % (24 * 3600);\r\n                                        d = new Date(t * 1000);\r\n                                        obj['ts_pos_org'] = c[j];\r\n                                    }\r\n                                }\r\n                                if (p[d]) {\r\n                                    p[d].positions.push(_formatPosition(obj));\r\n                                    p[d].count = p[d].count + 1;\r\n                                }\r\n                                else\r\n                                    p[d] = { ts_pos_utc: _formatDate(d), positions: [_formatPosition(obj)], count: 1 };\r\n                                return p;\r\n                            }, {});\r\n                        let counter = 0;\r\n                        for (var k in groups) {\r\n                            groups[k][\"n\"] = counter++;\r\n                            positions.push(groups[k]);\r\n                        }\r\n                        /*\r\n                        positions.sort((a, b) => {\r\n                            if (a.ts_pos_org > b.ts_pos_org) return -1\r\n                            if (a.ts_pos_org < b.ts_pos_org) return 1;\r\n                            return 0;\r\n                        })\r\n                        */\r\n                        resolve({ Status: \"ok\", Result: { values: positions } });\r\n                    }\r\n                    else\r\n                        resolve(response)\r\n                })\r\n            })\r\n                .then(function (response) {\r\n                    //console.log(response)       \r\n                    _this.isDirty = false;\r\n                    if (response.Status.toLowerCase() == \"ok\") {\r\n                        _this.data = { vessels: response.Result.values }\r\n                        return Promise.resolve();\r\n                    }\r\n                    else {\r\n                        return Promise.reject(response);\r\n                    }\r\n                });\r\n        },\r\n        update: function () {\r\n            if (!this.vessel || !this.isDirty)\r\n                return;\r\n\r\n            _actualUpdate = new Date().getTime();\r\n            let _this = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);\r\n            //this.filterString&&console.log(this.filterString+\" \"+this.filterString.search(/\\r$/))\r\n            //this.filterString&&console.log(this.filterString.replace(/^\\s+/, \"\").replace(/\\s+\\r*$/, \"\")!=\"\")            \r\n\r\n            this.load(actualUpdate).then(function () {\r\n                //console.log(\"LOADED \"+(new Date().getTime()-_this._actualUpdate)+\"ms\")\r\n                //console.log(\"3>\"+new Date(_this._actualUpdate))\r\n                //console.log(\"4>\"+new Date(actualUpdate))\r\n                if (_actualUpdate == actualUpdate) {\r\n//_this.data.vessels && (_this.data.vessels.length>0) && console.log(_this.data.vessels[0].positions[0])                    \r\n                    _this.view.inProgress(false);\r\n                    _this.view.repaint();\r\n                }\r\n            }, function (json) {\r\n                _this.dataSrc = null;\r\n                console.log(json)\r\n                if (json.Status.toLowerCase() == \"auth\" ||\r\n                    (json.ErrorInfo && json.ErrorInfo.some &&\r\n                        json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })) ||\r\n                    (json.ErrorInfo && json.ErrorInfo.ErrorMessage.search(/not access/i) != -1))\r\n                    _this.data = { msg: _gtxt(\"AISSearch2.auth\"), vessels: [] };\r\n                else {\r\n                    //_this.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                    console.log(json);\r\n                }\r\n                _this.view.inProgress(false);\r\n                _this.view.repaint();\r\n            });\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/Models/DbSearchModel.js","const displayInfoDialog = require('./infodialog.js'),\r\n      Polyfill = require('../Polyfill'),\r\n      VesselInfoScreen = require('./VesselInfoScreen');\r\n\r\nlet infoDialogCascade = [],\r\n    allIinfoDialogs = [],\r\n    vesselInfoScreen;\r\n\r\nmodule.exports = function ({\r\n    tools,\r\n    aisLayerSearcher: aisLayerSearcher,\r\n    modulePath: modulePath,\r\n    aisView: aisView, \r\n    myFleetView: myFleetView,\r\n    menuId:menuId }) {\r\n\r\n    vesselInfoScreen  = new VesselInfoScreen({modulePath: modulePath, aisServices: aisLayerSearcher.aisServices});\r\n    const _showPosition = function(vessel){ \r\n        window.iconSidebarWidget.open(menuId);\r\n\r\n        aisView.vessel = vessel;\r\n        if (aisView.tab)\r\n        if (aisView.tab.is('.active'))\r\n            aisView.show();\r\n        else\r\n            aisView.tab.click();    \r\n    }, \r\n    _updateView = function (displayed, vessel, getmore){\r\n        if (displayed.vessel.ts_pos_utc!=vessel.ts_pos_utc){\r\n            $(displayed.dialog).dialog(\"close\")\r\n            return true;\r\n        }\r\n        else\r\n            return false;\r\n    };\r\n    return {\r\n        showPosition: function(vessel){  \r\n            _showPosition(vessel);\r\n            aisView.showTrack(vessel);\r\n        },\r\n        show: function (vessel, getmore) {\r\n            let ind = Polyfill.findIndex(allIinfoDialogs, function (d) { \r\n                return d.vessel.imo == vessel.imo && d.vessel.mmsi == vessel.mmsi \r\n            }),\r\n            isNew = true,\r\n            dialogOffset;\r\n            if (ind >= 0) {\r\n                isNew = false;\r\n                let displayed = allIinfoDialogs[ind];\r\n                dialogOffset = $(displayed.dialog).parent().offset();\r\n                ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == displayed.dialog.id })\r\n                if(!_updateView(displayed, vessel)){\r\n                    $(displayed.dialog).parent().insertAfter($('.ui-dialog').eq($('.ui-dialog').length - 1));\r\n                    return;\r\n                }\r\n            }\r\n\r\n            let dialog = displayInfoDialog({\r\n                vessel: vessel,\r\n                getmore: getmore,\r\n                displayedTrack: tools.displayedTrack,\r\n                closeFunc: function (event) {\r\n                    let ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == dialog.id });\r\n                    if (ind >= 0)\r\n                        infoDialogCascade.splice(ind, 1);\r\n                    ind = Polyfill.findIndex(allIinfoDialogs, function (d) { return d.dialog.id == dialog.id });\r\n                    if (ind >= 0)\r\n                        allIinfoDialogs.splice(ind, 1);\r\n                },\r\n                aisLayerSearcher: aisLayerSearcher,\r\n                modulePath:modulePath, \r\n                aisView: aisView,\r\n                myFleetView: myFleetView\r\n            },\r\n                {\r\n                    openVesselInfoScreen: vesselInfoScreen.open,\r\n                    showTrack: tools.showTrack,\r\n                    showPosition: _showPosition\r\n                })\r\n\r\n            if (!dialogOffset && infoDialogCascade.length > 0) {\r\n                let pos = $(infoDialogCascade[infoDialogCascade.length - 1]).parent().position();\r\n                dialogOffset = {left:pos.left - 10, top:pos.top + 10};\r\n            }\r\n            if (dialogOffset)\r\n                $(dialog).dialog(\"option\", \"position\", [dialogOffset.left, dialogOffset.top]);\r\n            if (ind >= 0)\r\n                infoDialogCascade.splice(ind, 0, dialog);\r\n            else if(isNew)\r\n                infoDialogCascade.push(dialog);\r\n\r\n            allIinfoDialogs.push({ vessel: vessel, dialog: dialog });\r\n            $(dialog).on(\"dialogdragstop\", function (event, ui) {\r\n                var ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == dialog.id });\r\n                if (ind >= 0)\r\n                    infoDialogCascade.splice(ind, 1);\r\n            });\r\n\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/Views/InfoDialogView.js","require(\"./infodialog.css\")\r\n\r\nlet addUnit = function (v, u) {\r\n\treturn v != null && v != \"\" ? v + u : \"\";\r\n},\r\n\tformatDate,\r\n\tformatDateTime,\r\n\tround = function (d, p) {\r\n\t\tlet isNeg = d < 0,\r\n\t\t\tpower = Math.pow(10, p)\r\n\t\treturn d ? ((isNeg ? -1 : 1) * (Math.round((isNeg ? d = -d : d) * power) / power)) : d\r\n\t},\r\n\tformatVessel = function (vessel) {\r\n\t\tlet d = new Date(vessel.ts_pos_utc * 1000);\r\n\t\tvessel.ts_pos_org = vessel.ts_pos_utc;\r\n\t\tvessel.dt_pos_utc = formatDate(d);\r\n\t\tvessel.ts_pos_utc = formatDateTime(d);\r\n\t\tvessel.ts_pos_loc = \"<br><span class='local'>\" + formatDateTime(d, true) + \"</span>\";\r\n\t\tvessel.ts_eta = vessel.ts_eta ? formatDateTime(new Date(vessel.ts_eta * 1000)) : \"\";\r\n\t\tvessel.cog = !isNaN(vessel.cog)?addUnit(round(vessel.cog, 5), \"°\"):vessel.cog;\r\n\t\tvessel.sog = !isNaN(vessel.sog)?addUnit(round(vessel.sog, 5), nsGmx.Translations.getLanguage()==\"rus\"?\" уз\":\" kn\"):vessel.sog;\r\n\t\tvessel.rot = !isNaN(vessel.rot)?addUnit(round(vessel.rot, 5), nsGmx.Translations.getLanguage()==\"rus\"?\"°/мин\":\"°/min\"):vessel.rot;\r\n\t\tvessel.heading = !isNaN(vessel.heading)?addUnit(round(vessel.heading, 5), \"°\"):vessel.heading;\r\n\t\tvessel.draught = !isNaN(vessel.draught)?addUnit(round(vessel.draught, 5), nsGmx.Translations.getLanguage()==\"rus\"?\" м\":\" m\"):vessel.draught;\r\n\t\tvessel.length = !isNaN(vessel.length)?addUnit(vessel.length, nsGmx.Translations.getLanguage()==\"rus\"?\" м\":\" m\"):vessel.length;\r\n\t\tvessel.width = !isNaN(vessel.width)?addUnit(vessel.width, nsGmx.Translations.getLanguage()==\"rus\"?\" м\":\" m\"):vessel.width;\r\n\t\tvessel.source = vessel.source == 'T-AIS' ? _gtxt('AISSearch2.tais') : _gtxt('AISSearch2.sais');\r\n\t\treturn vessel;\r\n\t},\r\n\ttoDd = function (D, lng) {\r\n\t\tlet dir = D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n\t\t\tdeg = Math.round((D < 0 ? D = -D : D) * 1000000) / 1000000\r\n\t\treturn deg + \"°\" + dir\r\n\t},\r\n\tddToDms = function (D, lng) {\r\n\t\tlet dms = {\r\n\t\t\tdir: D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n\t\t\tdeg: 0 | (D < 0 ? D = -D : D),\r\n\t\t\tmin: 0 | D % 1 * 60,\r\n\t\t\tsec: (0 | D * 60 % 1 * 6000) / 100\r\n\t\t};\r\n\t\treturn dms.deg + \"°\" + dms.min + \"'\" + dms.sec + \"\\\" \" + dms.dir\r\n\t}\r\n\r\nmodule.exports = function ({ vessel, closeFunc, aisLayerSearcher, getmore,\r\n\tmodulePath,\taisView, displayedTrack,\r\n\tmyFleetView, aisPluginPanel }, commands) {\r\n\r\n\tformatDate = aisLayerSearcher.formatDate;\r\n\tformatDateTime = aisLayerSearcher.formatDateTime;\r\n\r\n\tlet myFleetModel = myFleetView.model,\r\n\t\tadd = myFleetModel && myFleetModel.findIndex(vessel) < 0;\r\n\r\n\tlet canvas = $('<div class=\"ais_myfleet_dialog\"/>'),\r\n\t\tmenu = $('<div class=\"column1 menu\"></div>').appendTo(canvas),\r\n\t\tphoto = $('<div class=\"photo\"><div></div></div>').appendTo(menu),\r\n\t\tunderphoto = $('<div class=\"underphoto\"><div></div></div>').appendTo(menu),\r\n\t\tcontent = $('<div class=\"column2 content\"></div>'),\r\n\t\tbuttons = $('<div class=\"column3 buttons\"></div>'),\r\n\t\tgifLoader = '<img src=\"img/progress.gif\">'\r\n\t//console.log(content);\r\n\r\n\tcanvas.append(content).append(buttons)\r\n\r\n\tlet searchInput = $('.leaflet-ext-search'),\r\n\t\tdialogW = 610, dialogH = 250,\r\n\t\tposX = searchInput.offset().left + searchInput.width() - dialogW,\r\n\t\tposY = searchInput.offset().top + searchInput.height() + 10,\r\n\t\tdialog = showDialog(vessel.vessel_name, canvas[0], { \r\n\t\t\twidth: dialogW, height: dialogH, posX: posX, posY:posY, \r\n\t\t\tcloseFunc: closeFunc \r\n\t\t}),\r\n\t\tvessel2,\r\n\t\tmoreInfo = function (v) {\r\n\t\t\tlet smallShipIcon = '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"14px\" height=\"14px\" viewBox=\"0 0 14 14\" style=\"margin-left: 10px\" xml:space=\"preserve\">' +\r\n\t\t\t\t'<g style=\"fill: #48aff1;\">' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M13.4,11H0.6c-0.2,0-0.4,0.1-0.5,0.3c-0.1,0.2-0.1,0.4,0,0.6l1.2,1.8C1.4,13.9,1.6,14,1.8,14h9.9   c0.2,0,0.3-0.1,0.4-0.2l1.7-1.8c0.2-0.2,0.2-0.4,0.1-0.7C13.9,11.1,13.7,11,13.4,11z\"/>' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M9.3,9.7h2.9c0.2,0,0.4-0.1,0.5-0.3c0.1-0.2,0.1-0.4,0-0.6L9.8,4.5C9.7,4.3,9.4,4.2,9.2,4.3   C8.9,4.4,8.7,4.6,8.7,4.9v4.3C8.7,9.5,9,9.7,9.3,9.7z\"/>' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M1.2,9.7H7c0.3,0,0.6-0.3,0.6-0.6V0.6c0-0.3-0.2-0.5-0.4-0.6C6.9-0.1,6.7,0,6.5,0.3L0.7,8.8   C0.6,9,0.5,9.2,0.6,9.4C0.7,9.6,0.9,9.7,1.2,9.7z\"/>' +\r\n\t\t\t\t'</g>' +\r\n\t\t\t\t'</svg>',\r\n\t\t\t\tvesselPropTempl = '<div class=\"vessel_prop vname\"><b>{{vessel_name}}</b>' + smallShipIcon + '</div>' +\r\n\t\t\t\t\t'<div class=\"vessel_prop altvname\"><b>' + (vessel2.registry_name && vessel2.registry_name != vessel2.vessel_name ? vessel2.registry_name : '') + '&nbsp;</b></div>'\r\n\r\n\t\t\t$('.content', canvas).append(Handlebars.compile(\r\n\t\t\t\t'<div class=\"vessel_props1\">' + vesselPropTempl +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.vessel_type\"}}: </div></td><td><div class=\"vessel_prop value\">{{vessel_type}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.flag\"}}: </div></td><td><div class=\"vessel_prop value\">{{flag_country}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">IMO: </div></td><td><div class=\"vessel_prop value\">{{imo}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">MMSI: </div></td><td><div class=\"vessel_prop value mmsi\">{{mmsi}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.callsign\"}}: </div></td><td><div class=\"vessel_prop value mmsi\">{{callsign}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.source\"}}: </div></td><td><div class=\"vessel_prop value\">{{source}}</div></td></tr>' +\r\n\t\t\t\t'</table>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t)(v));\r\n\r\n\t\t\t$('.content', canvas).append(Handlebars.compile(\r\n\t\t\t\t'<div class=\"vessel_props2\">' + vesselPropTempl +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">COG | SOG: </div></td><td><div class=\"vessel_prop value\">{{cog}}&nbsp;&nbsp;&nbsp;{{sog}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">HDG | ROT: </div></td><td><div class=\"vessel_prop value\">{{heading}}&nbsp;&nbsp;&nbsp;{{rot}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.draught\"}}: </div></td><td><div class=\"vessel_prop value\">{{draught}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.destination\"}}: </div></td><td><div class=\"vessel_prop value\">{{destination}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.nav_status\"}}: </div></td><td><div class=\"vessel_prop value\">{{nav_status}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">ETA: </div></td><td><div class=\"vessel_prop value\">{{ts_eta}}</div></td></tr>' +\r\n\r\n\t\t\t\t'</div>'\r\n\t\t\t)(v));\r\n\r\n\t\t\t$(underphoto).append('<table><tr>' +\r\n\t\t\t\t'<td class=\"ais_refresh\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" height=\"16\" width=\"16\"><g class=\"nc-icon-wrapper\" fill=\"#444444\"><polyline data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 15,16 7,16 7,13 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 15,18 17,16 15,14 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" data-stroke=\"none\" fill=\"#444444\" points=\"15,18 17,16 15,14 \" stroke-linejoin=\"miter\" stroke-linecap=\"square\" style=\"stroke: currentColor;fill: currentColor;\"/> <polyline data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 9,8 17,8 17,11 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\"9,6 7,8 9,10 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" data-stroke=\"none\" fill=\"#444444\" points=\"9,6 7,8 9,10 \" stroke-linejoin=\"miter\" stroke-linecap=\"square\" style=\"stroke: currentColor;fill: currentColor;\"/> <rect x=\"2\" y=\"1\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" width=\"20\" height=\"22\" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/></g></svg></td>' +\r\n\t\t\t\t'<td><div class=\"vessel_prop coordinates\"><span class=\"small\">' +\r\n\t\t\t\tddToDms(v.latitude, false) + ' ' + ddToDms(v.longitude, true) +\r\n\t\t\t\t'</small></div></td>' +\r\n\t\t\t\t'</tr></table>'\r\n\t\t\t);\r\n\r\n\t\t\tlet swap = \"<span class='small'>\" + toDd(v.latitude, false) + \" \" + toDd(v.longitude, true) + \"</span>\"\r\n\t\t\t$('.ais_refresh', underphoto).click((e) => {\r\n\t\t\t\tlet mi = $('.coordinates', underphoto),\r\n\t\t\t\t\tt = mi.html()\r\n\t\t\t\tmi.html(swap)\r\n\t\t\t\tswap = t\r\n\t\t\t})\r\n\r\n\t\t\t$('.vessel_props1', canvas).hide()\r\n\t\t\t$('.vessel_prop.vname svg', canvas).css('visibility', add ? 'hidden' : 'visible')\r\n\r\n\t\t}\r\n\r\n\t$(dialog).dialog({ resizable: false });\r\n\r\n\tif (!getmore) {\r\n\t\tvessel2 = $.extend({}, vessel);\r\n\t\tmoreInfo(formatVessel(vessel2));\r\n\t}\r\n\telse\r\n\t\taisLayerSearcher.searchNames([{ mmsi: vessel.mmsi, imo: vessel.imo }], function (response) {\r\n\t\t\tif (parseResponse(response)) {\r\n\t\t\t\tvessel2 = {};\r\n\t\t\t\tfor (var i = 0; i < response.Result.fields.length; ++i)\r\n\t\t\t\t\tvessel2[response.Result.fields[i]] = response.Result.values[0][i];\r\n\t\t\t\tmoreInfo(formatVessel(vessel2));\r\n\t\t\t\t$('.date', titlebar).html('<span class=\"utc\">' + vessel2.ts_pos_utc + ' UTC</span>' + vessel2.ts_pos_loc);\r\n\t\t\t\tif (typeof (getmore) == \"function\")\r\n\t\t\t\t\tgetmore(vessel2)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tconsole.log(response)\r\n\t\t})\r\n\r\n\t// IMAGE\t\r\n\tlet scheme = document.location.href.replace(/^(https?:).+/, \"$1\");\r\n\r\n\t$('<img src=\"' + scheme + window.serverBase.replace(/^https?:/, \"\")+'plugins/ais/getphoto.ashx?mmsi=' + vessel.mmsi + '\">')\r\n\t.load(function(){\t\r\n\t\tif (this) $('div', photo).replaceWith(this);\r\n\t})\r\n\t.error(function(){\t\t\r\n\t\t$('<img src=\"' + scheme + '//photos.marinetraffic.com/ais/showphoto.aspx?size=thumb&mmsi=' + vessel.mmsi + '\">')\r\n\t\t.load(function(){\r\n\t\t\t\tif (this) $('div', photo).replaceWith(this);\r\n\t\t})\r\n\t});\t\r\n\r\n\t// BUTTONS\r\n\tlet menubuttons = $('<div class=\"menubuttons\"></div>').appendTo(buttons)\r\n\r\n\tlet openpage = $('<div class=\"button openpage\" title=\"' + _gtxt('AISSearch2.show_info') + '\">' +\r\n\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">' +\r\n\t\t'<g class=\"nc-icon-wrapper\" style=\"fill:currentColor\">' +\r\n\t\t'<path d=\"M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z\"/>' +\r\n\t\t'</g>' +\r\n\t\t'</svg>'\r\n\t\t+ '</div>')\r\n\t\t.appendTo(menubuttons)\r\n\t\t.on('click', () => commands.openVesselInfoScreen.call(null, vessel, vessel2));\r\n\r\n\tlet showpos = $('<div class=\"button showpos\" title=\"' + _gtxt('AISSearch2.show_pos') + '\">' +\r\n\t\t'<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" width=\"20\" height=\"20\"><g class=\"nc-icon-wrapper\" fill=\"#444444\"><polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 1,7 1,1 7,1 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 17,1 23,1 23,7 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 23,17 23,23 17,23 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 7,23 1,23 1,17 \" stroke-linejoin=\"miter\"/> <rect style=\"stroke:currentColor\" x=\"8\" y=\"8\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" width=\"8\" height=\"8\" stroke-linejoin=\"miter\"/></g></svg>' +\r\n\t\t'</div>')\r\n\t\t.appendTo(menubuttons)\r\n\t\t.on('click', function () {\r\n\t\t\tif (!vessel.ts_pos_org)\r\n\t\t\t\tvessel.ts_pos_org = vessel.ts_pos_utc;\r\n\t\t\tvessel.lastPosition = true;\r\n\t\t\tcommands.showPosition(vessel);\r\n\t\t\t// if(showtrack.is('.active'))\r\n\t\t\t// \tcommands.showTrack.call(null, [vessel.mmsi])\r\n\t\t});\r\n\r\n\tlet addremoveIcon = function (add) {\r\n\t\treturn (add ? '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><g class=\"nc-icon-wrapper\" fill=\"#444444\" style=\"fill: currentColor;\"><path d=\"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z\"/></g></svg>'\r\n\t\t\t: '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"24px\" height=\"24px\" viewBox=\"0 0 24 24\" style=\"enable-background:new 0 0 24 24;fill: currentColor;\" xml:space=\"preserve\"><g><path class=\"st0\" d=\"M4,6H2v14c0,1.1,0.9,2,2,2h14v-2H4V6z M20,2H8C6.9,2,6,2.9,6,4v12c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V4    C22,2.9,21.1,2,20,2z M19,11h-4v4h-2v-4H9V9h4V5h2v4h4V11z\"/></g><rect x=\"9\" y=\"5\" class=\"st0\" width=\"10\" height=\"4\"/><rect x=\"9\" y=\"11\" class=\"st0\" width=\"10\" height=\"4\"/></g></svg>')\r\n\t}\r\n\t//if (myFleetModel && myFleetModel.data && myFleetModel.data.vessels) {\r\n\tlet addremove = $('<div class=\"button addremove\">' + addremoveIcon(add) + '</div>')\r\n\t\t//.css('background-image','url('+modulePath+'svg/'+(add?'add':'rem')+'-my-fleet.svg)')\r\n\t\t.attr('title', add ? _gtxt('AISSearch2.myfleet_add') : _gtxt('AISSearch2.myfleet_remove'))\r\n\t\t.appendTo(menubuttons)\r\n\tif (myFleetModel.filterUpdating)\r\n\t\taddremove.addClass('disabled');\r\n\taddremove.on('click', function () {\r\n\t\tif (addremove.is('.disabled'))\r\n\t\t\treturn;\r\n\r\n\t\t$('.addremove').addClass('disabled')\r\n\t\taddremove.hide()\r\n\t\tprogress.append(gifLoader)\r\n\r\n\t\tmyFleetView.prepare(vessel);\r\n\t\tmyFleetModel.change(vessel).then(function () {\r\n\t\t\tadd = myFleetModel.findIndex(vessel) < 0;\r\n\t\t\tvar info = $('.icon-ship[vessel=\"' + vessel.mmsi + ' ' + vessel.imo + '\"]');\r\n\t\t\tinfo.css('visibility', !add ? 'visible' : 'hidden');\r\n\t\t\t$('.vessel_prop.vname svg', canvas).css('visibility', add ? 'hidden' : 'visible')\r\n\r\n\t\t\taddremove.attr('title', add ? 'добавить в мой флот' : 'удалить из моего флота')\r\n\t\t\t\t.html(addremoveIcon(add))\r\n\t\t\t//.css('background-image','url('+modulePath+'svg/'+(add?'add':'rem')+'-my-fleet.svg)')\r\n\r\n\t\t\tprogress.text('');\r\n\t\t\t$('.addremove').removeClass('disabled').show()\r\n\t\t\tif (myFleetView.isActive)\r\n\t\t\t\tmyFleetView.show();\r\n\t\t\telse\r\n\t\t\t\tmyFleetModel.drawMarker(vessel);\r\n\t\t})\r\n\t\t.catch((ex)=>console.log(ex));\r\n\t});\r\n\t//}\r\n\r\n\tlet progress = $('<div class=\"progress\"></div>')\r\n\t\t.appendTo(menubuttons);\r\n\r\n\t// TITLEBAR\t\r\n\tcanvas.parent('div').css({ 'margin': '0', 'overflow': 'hidden' })\r\n\tlet titlebar = $(dialog).parent().find('.ui-dialog-titlebar').css('padding', '0')\r\n\t\t.html('<table class=\"ais_info_dialog_titlebar\">' +\r\n\t\t'<tr><td><div class=\"date\">' +\r\n\t\t(!getmore ? Handlebars.compile('<span class=\"utc\">{{{ts_pos_utc}}} UTC</span>{{{ts_pos_loc}}}')(vessel2 ? vessel2 : vessel) : '') +\r\n\t\t'</div></td>' +\r\n\t\t\r\n\t\t'<td><div class=\"choose chooser done\"><span unselectable=\"on\">'+_gtxt('AISSearch2.dialog_tab_params')+'</span></div></td>' +\r\n\t\t'<td><div class=\"choose chooser\"><span unselectable=\"on\">'+_gtxt('AISSearch2.dialog_tab_general')+'</span></div></td>' +\r\n\t\t\r\n\t\t'<td id=\"closebut\" title=\"'+_gtxt('AISSearch2.close_but')+'\"><div class=\"ais_info_dialog_close-button\" title=\"'+_gtxt(\"AISSearch2.close_but\")+'\"></div></td></tr>' +\r\n\t\t'</table>'),\r\n\t\tonDone = function (e) { \r\n\t\t\te.stopPropagation(); \r\n\t\t\t$('.choose', titlebar).removeClass('done'); \r\n\t\t\t$(e.currentTarget).addClass('done'); \r\n\t\t};\r\n\r\n\t$('#closebut', titlebar).on('click', (e) => {$(dialog).dialog(\"close\"); })\r\n\t.on('mouseover', (e) => { \r\n\t\t$('.ais_info_dialog_close-button', titlebar).css('background', 'url(\"data:image/svg+xml;charset=utf8,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cline x1=\\'0\\' y1=\\'0\\' x2=\\'12\\' y2=\\'12\\' style=\\'stroke:%2348aff1;stroke-width:2px\\'/%3E%3Cline x1=\\'0\\' y1=\\'12\\' x2=\\'12\\' y2=\\'0\\' style=\\'stroke:%2348aff1;stroke-width:2px\\'/%3E%3C/svg%3E\") no-repeat')\r\n\t})\r\n\t.on('mouseout', (e) => { \r\n\t\t$('.ais_info_dialog_close-button', titlebar).attr('style', '')\r\n\t})\r\n\t//url(\"data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='0' y1='0' x2='12' y2='12' style='stroke:%2348aff1;stroke-width:2px'/%3E%3Cline x1='0' y1='12' x2='12' y2='0' style='stroke:%2348aff1;stroke-width:2px'/%3E%3C/svg%3E\") no-repeat\r\n\t$('.chooser', titlebar).eq(1).on('mousedown', (e) => { onDone(e); $('.vessel_props1', canvas).show(); $('.vessel_props2', canvas).hide() })\r\n\t$('.chooser', titlebar).eq(0).on('mousedown', (e) => { onDone(e); $('.vessel_props2', canvas).show(); $('.vessel_props1', canvas).hide() })\r\n\t$('.date span', titlebar).on('mousedown', (e) => { e.stopPropagation(); })\r\n\r\n\t//$( dialog ).on( \"dialogdragstart\", function( e, ui ) {console.log(e);console.log(ui)} );\r\n\r\n\treturn dialog\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Views/infodialog.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/infodialog.css\n// module id = 21\n// module chunks = 0","require(\"./VesselInfoScreen.css\")\r\n\r\nmodule.exports = function ({modulePath, aisServices}){\r\n        var _ais,  \r\n        _galery, \r\n        _register, \r\n        _regcap,    \r\n        _leftPanel,  \r\n        _minh,\r\n        _lloyds,\r\n        resize,\r\n        menuAction,       \r\n\t    scheme = document.location.href.replace(/^(https?:).+/, \"$1\"),\r\n        show = function(vessel){\r\n//console.log(vessel) \r\n            $(\"body\").append(''+  \r\n'<table class=\"vessel-info-page overlay\">' +\r\n        '<tr>' +\r\n            '<td>' +\r\n'<table class=\"vessel-info-page container\">' +\r\n    '<tr>' +\r\n        '<td class=\"column1\">' +\r\n                '<table>' +\r\n                    '<tr>' +\r\n                        '<td>' +\r\n                            '<div>' +\r\n                                '<div class=\"title\">' +\r\n                                   '<div class=\"cell\">'+vessel.vessel_name+'<div class=\"timestamp\">'+vessel.ts_pos_utc+'</div></div>  ' +                  \r\n                                '</div>' +\r\n                                '<div class=\"menu\">' +\r\n                                '<div class=\"ais cell menu-item active\"><img src=\"'+modulePath+'svg/info_gen.svg\" class=\"icon\">'+_gtxt(\"AISSearch2.infoscreen_gen\")+'</div>' +\r\n                                '<div class=\"register cell menu-item\"><img src=\"'+modulePath+'svg/info.svg\" class=\"icon\">'+_gtxt(\"AISSearch2.infoscreen_reg\")+'</div>' +\r\n                                '<div class=\"galery cell menu-item\"><img src=\"'+modulePath+'svg/photogallery.svg\" class=\"icon\">'+_gtxt(\"AISSearch2.infoscreen_gal\")+'<div class=\"counter\">0</div></div>' +\r\n                               '</div>' +\r\n                            '</div>  ' +\r\n                        '</td>' +\r\n                    '</tr>' +\r\n                    '<tr>' +\r\n                        '<td class=\"frame\">' +\r\n                                '<div class=\"photo\">' +\r\n                                    '<img src=\"'+modulePath+'svg/no-image.svg\" class=\"no-image\">' +\r\n                                '</div>  ' +  \r\n                        '</td>' +\r\n                    '</tr>' +\r\n                '</table>' +\r\n    '</td>' +\r\n    '<td class=\"column2\">' +\r\n        '<div class=\"close-button-holder\">' +\r\n            '<div class=\"close-button\" title=\"'+_gtxt(\"AISSearch2.close_but\")+'\"></div>' +\r\n        '</div>' +\r\n        '<div class=\"register panel\">' +\r\n            '<div class=\"caption\">' +\r\n                '<span style=\"display: inline-block;height: 100%;vertical-align: middle;width: 40px;\"></span>' +\r\n                '<img src=\"img/progress.gif\" style=\"vertical-align: middle\">' +\r\n            '</div>' +\r\n            '<div class=\"menu\">' +\r\n                '<div>' +\r\n                    '<table>' +\r\n                        '<tr>' +\r\n                            '<td><div class=\"general menu-item active\">'+_gtxt(\"AISSearch2.reg_general_tab\")+'</div></td>' +\r\n                            '<td><div class=\"build menu-item\">'+_gtxt(\"AISSearch2.reg_build_tab\")+'</div></td>' +\r\n                            '<td><div class=\"dimensions menu-item\">'+_gtxt(\"AISSearch2.reg_chars_tab\")+'</div></td>' +\r\n                            '<td><div class=\"gears menu-item\">'+_gtxt(\"AISSearch2.reg_devs_tab\")+'</div></td>' +\r\n                        '</tr>' +\r\n                    '</table>' +\r\n                '</div>' +\r\n            '</div>' +\r\n            '<div class=\"content\">' +\r\n                '<div class=\"placeholder\"></div>' +\r\n            '</div>' +\r\n        '</div>' +\r\n\r\n        '<div class=\"galery panel\">' +   \r\n'<form action=\"' + aisServices + 'Upload.ashx\" class=\"uploadFile\" method=\"post\" enctype=\"multipart/form-data\" target=\"upload_target\" style=\"display:none\" >' +\r\n    '<input name=\"Filedata\" class=\"chooseFile\" type=\"file\">' +    \r\n    '<input name=\"imo\" type=\"hidden\" value=\"'+vessel.imo+'\">' +    \r\n    '<input name=\"mmsi\" type=\"hidden\" value=\"'+vessel.mmsi+'\">' +\r\n          //'<input type=\"submit\" name=\"submitBtn\" value=\"Upload\" />' +\r\n'</form>' + \r\n'<iframe id=\"upload_target\" name=\"upload_target\" src=\"#\" style=\"width:0;height:0;border:0px solid #fff;\"></iframe>' + \r\n            '<div class=\"placeholder\">' +\r\n                '<div class=\"photo\" onclick=\"document.querySelector(\\'.vessel-info-page .chooseFile\\').click();\"'+\r\n                ' style=\"background-image: url('+modulePath+'svg/add-image.svg);background-size: 50px;\"></div>' +                \r\n            '</div>' +\r\n        '</div>' +\r\n\r\n        '<div class=\"ais panel\">' +\r\n            '<div class=\"placeholder\"></div>' +\r\n        '</div>' +\r\n    '</td>' +\r\n    '</tr>' +\r\n'</table>' +\r\n            '</td>' +\r\n        '</tr>' +\r\n    '</table>'           \r\n            );\r\n        window.addEventListener(\"message\", function(e){\r\n            if (e.data.search(/\"uploaded\"\\:/)<0)\r\n                return;\r\n            var data = JSON.parse(e.data);    \r\n            if (data.id && parseInt(data.id)) { //uploaded:\r\n//console.log('UPLOADED '+id)\r\n                var counter = $('.vessel-info-page .menu-item .counter'), \r\n                count = parseInt(counter.text())+1;\r\n                counter.text(count).css('display', 'inline');\r\n                var preview = $(\"<div class='photo preview' id='\"+data.id+\"' style='background-image: url(\"+aisServices+\"getphoto.ashx?id=\"+data.id+\")'/>\");\r\n                $('.vessel-info-page .uploader').replaceWith(preview);\r\n                preview.click(showPicture);\r\n//console.log(preview)\r\n            }\r\n            else {//uploadError:            \r\n                $('.vessel-info-page .uploader').remove();\r\n                console.log(data.errmsg)\r\n            }  \r\n        }, false);\r\n\r\n        $('<img src=\"' + scheme + window.serverBase.replace(/^https?:/, \"\")+'plugins/ais/getphoto.ashx?mmsi=' + vessel.mmsi + '\">')\r\n        .load(function () {\t\r\n            if (this)\r\n                $('.column1 .photo img.no-image').replaceWith(this);\t\r\n        }).error(function(){\t\t\t\r\n            $('<img src=\"' + scheme + '//photos.marinetraffic.com/ais/showphoto.aspx?size=thumb&mmsi=' + vessel.mmsi + '\">').load(function () {\r\n                    if (this)\r\n                        $('.column1 .photo img.no-image').replaceWith(this);\r\n            });\r\n        });\r\n\r\n        $('.vessel-info-page .chooseFile').change(function(){            \r\n            $('<div class=\"photo uploader\" style=\"background-image:url(img/progress.gif);background-size:20px;\"></div>')\r\n            .insertAfter($('.vessel-info-page .galery .placeholder .photo').eq(0));\r\n            $('.vessel-info-page .uploadFile')[0].submit();\r\n        })\r\n        $('.vessel-info-page .close-button').click(function(){\r\n            $('.vessel-info-page.overlay').remove();\r\n        });\r\n/**/\r\n        $('.vessel-info-page .menu img[src$=\".svg\"]').each(function() {\r\n            var $img = jQuery(this);\r\n            var imgURL = $img.attr('src');\r\n            var attributes = $img.prop(\"attributes\");\r\n\r\n            $.get(imgURL, function(data) {\r\n                // Get the SVG tag, ignore the rest\r\n                var $svg = jQuery(data).find('svg');\r\n\r\n                // Remove any invalid XML tags\r\n                $svg = $svg.removeAttr('xmlns:a');\r\n\r\n                // Loop through IMG attributes and apply on SVG\r\n                $.each(attributes, function() {\r\n                    $svg.attr(this.name, this.value);\r\n                });\r\n\r\n                // Replace IMG with SVG\r\n                $img.replaceWith($svg);\r\n            }, 'xml');\r\n        });\r\n\r\n        _ais = document.querySelector('.vessel-info-page .column2 .ais') \r\n        _galery = document.querySelector('.vessel-info-page .column2 .galery')\r\n        _register = document.querySelector('.vessel-info-page .column2 .register .content')\r\n        _regcap = document.querySelector('.vessel-info-page .column2 .register .caption')    \r\n        _leftPanel = document.querySelector('.vessel-info-page .column1 table')      \r\n        _minh = 420\r\n        resize = function(){\r\n            var h = Math.floor(window.innerHeight*0.8);\r\n            if (h>_minh){\r\n                _leftPanel.style.height = _ais.style.height = _galery.style.height = h + \"px\";\r\n                _register.style.height = h - _regcap.offsetHeight + \"px\";\r\n            }\r\n            else{\r\n                _leftPanel.style.height = _ais.style.height = _galery.style.height = _minh + \"px\";\r\n                _register.style.height = _minh - _regcap.offsetHeight + \"px\";\r\n            }      \r\n        }\r\n        menuAction = function(e){\r\n            var target = e.currentTarget, p = target.parentElement, mia;\r\n            while(!(mia = p.querySelectorAll('.menu-item')) || mia.length<2){\r\n                p = p.parentElement;\r\n            }\r\n            for (var j=0; j<mia.length; ++j){\r\n                    //console.log( mia[j])\r\n                mia[j].className = mia[j].className.replace(/ active/, \"\");\r\n                var panel = document.querySelector('.panel.' + mia[j].classList[0]);\r\n                if (panel){\r\n                    if (mia[j]!=target)\r\n                    panel.style.display = \"none\";\r\n                    else{\r\n                    panel.style.display = \"block\";\r\n                    }\r\n                }\r\n            }\r\n            target.className += \" active\"\r\n            resize(); \r\n        }\r\n\r\n        window.addEventListener(\"resize\", resize, false); \r\n    \r\n        var mia = document.querySelectorAll('.column1 .menu-item');\r\n        for (var i=0; i<mia.length; ++i){\r\n            mia[i].addEventListener('click', menuAction)\r\n        }\r\n    \r\n        resize();    \r\n        $(_ais).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        $(_galery).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        $(_register).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        document.querySelector('.vessel-info-page .container').style.display = \"table\";  \r\n    },\r\n    showPicture = function(){\r\n//console.log($(this))\r\n            $('.vessel-info-page .picture').remove();\r\n            var div = $('<div class=\"picture\" style=\"display:none;position:absolute;\"></div>')\r\n            .insertAfter('.vessel-info-page.container').click(function(){this.remove()});\r\n            $('<img src=\"'+aisServices+'getphoto.ashx?id='+this.id+'\">').load(function() {\r\n                    if (this){\r\n                        var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,\r\n                        h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n                        div.append(this)\r\n                        .css('display', 'table')\r\n                        .offset({\r\n                            left:(w-this.offsetWidth)/2,\r\n                            top:(h-this.offsetHeight)/2})\r\n//console.log($(this))\r\n//console.log(window.screen.width+\"-\"+$(this)[0].offsetWidth)\r\n//console.log((window.screen.width-$(this)[0].offsetWidth)/2)\r\n                    }\r\n            });\r\n        },\r\n    drawGallery = function(gallery){\r\n        if (gallery.length>0)\r\n            $('.vessel-info-page .menu-item .counter').text(gallery.length).css('display', 'inline');   \r\n        var galcontent = $(\".vessel-info-page .galery .placeholder\")\r\n        for (var i=0; i<gallery.length; ++i)\r\n            galcontent.append(\"<div class='photo preview' id='\"+gallery[i]+\"' style='background-image: url(\"+aisServices+\"getphoto.ashx?id=\"+gallery[i]+\")'/>\" )             \r\n        $('.photo.preview').click(showPicture)\r\n        resize();     \r\n    },\r\n    drawAis = function(ledokol){\r\n    var aiscontent = document.querySelector(\".vessel-info-page .ais .placeholder\")\r\n    aiscontent.innerHTML = \"\" +                \r\n    \"<div class='caption'><div>\"+_gtxt(\"AISSearch2.vessel_info\")+\"</div></div>\" +\r\n    \"<table>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.vessel_name\")+\"</td><td><b>\"+ledokol.vessel_name+(ledokol.registry_name?\" (\"+ledokol.registry_name+\")\":\"\")+\"</b></td></tr>\" +\r\n        \"<tr><td>IMO</td><td>\"+ledokol.imo+\"</td></tr>\" +\r\n        \"<tr><td>MMSI</td><td>\"+ledokol.mmsi+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.vessel_type\")+\"</td><td>\"+ledokol.vessel_type+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.flag\")+\"</td><td>\"+ledokol.flag_country+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.callsign\")+\"</td><td>\"+ledokol.callsign+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.length\")+\"</td><td>\"+ledokol.length+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.width\")+\"</td><td>\"+ledokol.width+\"</td></tr>\" +\r\n    \"</table>\" +\r\n    \"<div class='caption'><div>\"+_gtxt(\"AISSearch2.vessel_voyage\")+\"</div></div>\" +\r\n    \"<table>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.nav_status\")+\"</td><td>\"+ledokol.nav_status+\"</td></tr>\" +\r\n        \"<tr><td>COG</td><td>\"+ledokol.cog+\"</td></tr>\" +\r\n        \"<tr><td>SOG</td><td>\"+ledokol.sog+\"</td></tr>\" +\r\n        \"<tr><td>HDG</td><td>\"+ledokol.heading+\"</td></tr>\" +\r\n        \"<tr><td>ROT</td><td>\"+ledokol.rot+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.draught\")+\"</td><td>\"+ledokol.draught+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.destination\")+\"</td><td>\"+ledokol.destination+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.eta\")+\"</td><td>\"+ledokol.ts_eta+\"</td></tr>\" +\r\n    \"</table>\";     \r\n        resize();        \r\n    },\r\n    drawRegister = function(ledokol){\r\n        let regcontent = _register.querySelector(\".placeholder\"),\r\n        drawTable = function(groups, article, display){\r\n            let s = \"<div class='panel \"+article+\" article' style='display:\"+display+\"'>\";\r\n            for(let i=0; i<groups.length; ++i){\r\n                if (!groups[i])\r\n                    continue;\r\n                s += \"<div class='group'>\"+groups[i].name+\"</div><table>\"\r\n                for(let j=0; j<groups[i].properties.length; ++j){\r\n                    let pn = groups[i].properties[j].name,\r\n                    desc = nsGmx.Translations.getLanguage()==\"rus\"?groups[i].properties[j].description:null, \r\n                    pv = groups[i].properties[j].value\r\n                    s+= \"<tr><td>\"+pn+\r\n                    (desc ? \"<div class='description'>\" + desc + \"</div>\" : \"\")+ \r\n                    \"</td><td>\"+(pn==\"Название судна\"||pn==\"Латинское название\"?\"<b>\"+pv+\"</b>\":pv)+\"</td></tr>\"\r\n                }\r\n                s += \"<tr><td>&nbsp;</td><td>&nbsp;</td></tr></table>\"\r\n            }\r\n            s += \"</div>\"\r\n            return s;\r\n        }\t\r\n\r\n        _regcap.innerHTML = \"<table class='register-title'>\"+\r\n        \"<tr><td><span class='switch active'>\"+_gtxt(\"AISSearch2.rmrs\")+\"</span> <span class='switch'>Lloyd's register</span></td></tr>\"+\r\n        \"<tr><td><span class='update'></span></td></tr>\"+\r\n        \"</table>\";\r\n\r\n        let drawRMR = function(){\r\n            if (ledokol) {\r\n                regcontent.innerHTML =\r\n                    drawTable([ledokol.data[0], ledokol.data[1], ledokol.data[9]], \"general\", \"block\") +\r\n                    drawTable([ledokol.data[2]], \"build\", \"none\") +\r\n                    drawTable([ledokol.data[3]], \"dimensions\", \"none\") +\r\n                    drawTable([ledokol.data[4], ledokol.data[5], ledokol.data[6], ledokol.data[7], ledokol.data[8]], \"gears\", \"none\");\r\n                _regcap.querySelector('.update').innerText = _gtxt(\"AISSearch2.last_update\") + \" \" + ledokol.version.replace(/ \\S+$/g, '');\r\n            }\r\n            else{\r\n                regcontent.innerHTML = \"\";\r\n                _regcap.querySelector('.update').innerHTML = \"&nbsp;\"; \r\n            }\r\n        },\r\n        drawLloyds = function(){\r\n            regcontent.innerHTML =\r\n                drawTable([_lloyds.data[15], _lloyds.data[14], _lloyds.data[13], _lloyds.data[11], _lloyds.data[0]], \"general\", \"block\") +\r\n                drawTable([_lloyds.data[10], _lloyds.data[12]], \"build\", \"none\") +\r\n                drawTable([_lloyds.data[9], _lloyds.data[8], _lloyds.data[7], _lloyds.data[6]], \"dimensions\", \"none\") +\r\n                drawTable([_lloyds.data[4], _lloyds.data[3], _lloyds.data[2], _lloyds.data[1], _lloyds.data[5]], \"gears\", \"none\");\r\n            _regcap.querySelector('.update').innerText = _gtxt(\"AISSearch2.last_update\") + \" \" + _lloyds.version.replace(/ \\S+$/g, '');   \r\n        },\r\n        regSwitches = _regcap.querySelectorAll(\".switch\");\r\n        regSwitches.forEach((item, i)=>item.addEventListener('click', e => {\r\n            let cl = e.currentTarget.classList;\r\n            if (!cl.contains('active')) {\r\n                _regcap.querySelector(\".switch.active\").classList.remove('active');\r\n                cl.add('active');\r\n                switch (i){\r\n                    case 0:\r\n                        drawRMR();\r\n                        break;\r\n                    case 1:\r\n                        if (_lloyds)\r\n                            drawLloyds();\r\n                        else\r\n                            regcontent.innerHTML = \"\";                        \r\n                        break;\r\n                }           \r\n                resize();   \r\n                mia[0] && mia[0].click();\r\n            }\r\n        }));\r\n        var mia = document.querySelectorAll('.column2 .menu-item');\r\n        for (var i=0; i<mia.length; ++i){\r\n            mia[i].addEventListener('click', menuAction)\r\n        }\r\n        drawRMR();             \r\n        resize(); \r\n        if (!ledokol)        \r\n            regSwitches[1].click();         \r\n    }\r\n\t\r\n\tlet open = function(vessel, vessel2){\r\n                    show(vessel2);\r\n                    var onFail = function(error){\r\n                        if (error!='register_no_data')\r\n                            console.log(error)\r\n                        _regcap.innerHTML = \"\";\r\n                    } \r\n                    new Promise(function(resolve, reject){\r\n                        (function wait(){\r\n                            if(!vessel2)\r\n                                setTimeout(wait, 100);\r\n                        })();\r\n                        resolve(vessel2)\r\n                    })\r\n                    .then(function(ship){\r\n//console.log(ship)\r\n                        drawAis(ship)\r\n                    }, \r\n                    onFail);\r\n                    var registerServerUrl = scheme + \"//kosmosnimki.ru/demo/register/api/v1/\",\r\n                        lloydsServerUrl = scheme + \"//kosmosnimki.ru/demo/lloyds/api/v1/\",\r\n                        rmr;\r\n                    if(vessel.imo && vessel.imo!=0 && vessel.imo!=-1){\r\n                        fetch(registerServerUrl+\"Ship/Search/\"+vessel.imo+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"))\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            if (ship.length>0)\r\n                                return fetch(registerServerUrl+\"Ship/Get/\"+ship[0].RS+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"))\r\n                            else\r\n                                return Promise.resolve({json:()=>null});\r\n                            //else\r\n                            //    return Promise.reject('register_no_data');\r\n                        })\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            //console.log(ship)\r\n                            rmr = ship;\r\n                            if (rmr)\r\n                                drawRegister(rmr);\r\n                            return fetch(lloydsServerUrl+\"Ship/Search/\"+vessel.imo+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"));\r\n                        })                        \r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            if (ship.length>0)\r\n                                return fetch(lloydsServerUrl+\"Ship/Get/\"+ship[0].RS+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"))\r\n                            else\r\n                                return Promise.reject('register_no_data');\r\n                        })\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            _lloyds = ship;\r\n                            if (nsGmx.Translations.getLanguage()!=\"rus\"){\r\n                                _lloyds.data[15].name = \"Vessel Data\";\r\n                                _lloyds.data[14].name = \"Type and Status\";\r\n                                _lloyds.data[13].name = \"Companies\";\r\n                                _lloyds.data[12].name = \"Companies\";\r\n                                _lloyds.data[11].name = \"Safety\";\r\n                                _lloyds.data[10].name = \"History\";\r\n                                _lloyds.data[9].name = \"Characteristics\";\r\n                                _lloyds.data[8].name = \"Dimensions\";\r\n                                _lloyds.data[7].name = \"Hull\";\r\n                                _lloyds.data[6].name = \"Capacity\";\r\n                                _lloyds.data[5].name = \"Cargo\";\r\n                                _lloyds.data[4].name = \"Machinery\";\r\n                                _lloyds.data[3].name = \"Fuel\";\r\n                                _lloyds.data[2].name = \"Energy Supply\";\r\n                                _lloyds.data[1].name = \"Propellers and Thrusters\";\r\n                                _lloyds.data[0].name = \"Codes\";\r\n                            }\r\n                            if (!rmr)\r\n                                drawRegister(rmr);\r\n                        })\r\n                        .catch( onFail );\r\n                    }\r\n                    else                    \r\n                        _regcap.innerHTML = \"\";\r\n\r\n                    new Promise(function(resolve, reject){\r\n                        sendCrossDomainJSONRequest(aisServices + \r\n                            \"gallery.ashx?mmsi=\"+vessel.mmsi+\"&imo=\"+vessel.imo, function(response){\r\n                            if (response.Status==\"ok\") \r\n                                resolve(response.Result);\r\n                            else\r\n                                reject(response)\r\n                        });\r\n                    })\r\n                    .then(function(gallery){\r\n                        drawGallery(gallery)\r\n                    }, \r\n                    onFail);\r\n                }\r\n        \r\n    return {\r\n\t\topen:open,\r\n            show: show,\r\n            drawRegister: drawRegister,\r\n            drawAis: drawAis,\r\n            drawGallery:drawGallery\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Views/VesselInfoScreen.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/VesselInfoScreen.css\n// module id = 23\n// module chunks = 0","module.exports = function (options) {\r\n    const _baseUrl = window.serverBase || document.location.href.replace(/^(https?:).+/, \"$1\") + '//maps.kosmosnimki.ru/',\r\n        _aisServices = _baseUrl + \"Plugins/AIS/\",\r\n        _serverScript = _baseUrl + 'VectorLayer/Search.ashx';\r\n    const { aisLastPoint:_aisLastPoint, \r\n        screenSearchLayer:_screenSearchLayer, \r\n        aisLayerID:_aisLayerID, \r\n        historyLayer:_historyLayer \r\n    } = options;\r\n\r\n    return {\r\n        baseUrl: _baseUrl,\r\n        get screenSearchLayer(){return _screenSearchLayer},\r\n        aisServices: _aisServices,\r\n        getBorder: function () {\r\n            var lmap = nsGmx.leafletMap;\r\n            var dFeatures = lmap.gmxDrawing.getFeatures();\r\n            if (dFeatures.length) { return dFeatures[dFeatures.length - 1].toGeoJSON(); }\r\n            var latLngBounds = lmap.getBounds(),\r\n                sw = latLngBounds.getSouthWest(),\r\n                ne = latLngBounds.getNorthEast(),\r\n                min = { x: sw.lng, y: sw.lat },\r\n                max = { x: ne.lng, y: ne.lat },\r\n                minX = min.x,\r\n                maxX = max.x,\r\n                geo = { type: 'Polygon', coordinates: [[[minX, min.y], [minX, max.y], [maxX, max.y], [maxX, min.y], [minX, min.y]]] },\r\n                w = (maxX - minX) / 2;\r\n\r\n            if (w >= 180) {\r\n                geo = { type: 'Polygon', coordinates: [[[-180, min.y], [-180, max.y], [180, max.y], [180, min.y], [-180, min.y]]] };\r\n            }\r\n            else if (maxX > 180 || minX < -180) {\r\n                var center = ((maxX + minX) / 2) % 360;\r\n                if (center > 180) { center -= 360; }\r\n                else if (center < -180) { center += 360; }\r\n                minX = center - w; maxX = center + w;\r\n                if (minX < -180) {\r\n                    geo = {\r\n                        type: 'MultiPolygon', coordinates: [\r\n                            [[[-180, min.y], [-180, max.y], [maxX, max.y], [maxX, min.y], [-180, min.y]]],\r\n                            [[[minX + 360, min.y], [minX + 360, max.y], [180, max.y], [180, min.y], [minX + 360, min.y]]]\r\n                        ]\r\n                    };\r\n                } else if (maxX > 180) {\r\n                    geo = {\r\n                        type: 'MultiPolygon', coordinates: [\r\n                            [[[minX, min.y], [minX, max.y], [180, max.y], [180, min.y], [minX, min.y]]],\r\n                            [[[-180, min.y], [-180, max.y], [maxX - 360, max.y], [maxX - 360, min.y], [-180, min.y]]]\r\n                        ]\r\n                    };\r\n                }\r\n            }\r\n            return geo;\r\n        },\r\n\r\n        formatTime: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleTimeString();\r\n        },\r\n        formatDate: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleDateString();\r\n        },\r\n        formatDateTime: function (d, local) {\r\n            if (d.isNaN)\r\n                return \"\";\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleString().replace(/,/, \"\");\r\n        },\r\n\r\n        formatDate2: function (d, local) {\r\n            var dd, m, y, h, mm;\r\n            if (local) {\r\n                dd = (\"0\" + d.getDate()).slice(-2);\r\n                m = (\"0\" + (d.getMonth() + 1)).slice(-2);\r\n                y = d.getFullYear();\r\n                h = (\"0\" + d.getHours()).slice(-2);\r\n                mm = (\"0\" + d.getMinutes()).slice(-2);\r\n                return dd + \".\" + m + \".\" + y + \" \" + h + \":\" + mm +\r\n                    \" (\" + (\"0\" + d.getUTCHours()).slice(-2) + \":\" + (\"0\" + d.getUTCMinutes()).slice(-2) + \" UTC)\";\r\n            }\r\n            else {\r\n                dd = (\"0\" + d.getUTCDate()).slice(-2);\r\n                m = (\"0\" + (d.getUTCMonth() + 1)).slice(-2);\r\n                y = d.getUTCFullYear();\r\n                h = (\"0\" + d.getUTCHours()).slice(-2);\r\n                mm = (\"0\" + d.getUTCMinutes()).slice(-2);\r\n                var\r\n                    ldd = (\"0\" + d.getDate()).slice(-2),\r\n                    lm = (\"0\" + (d.getMonth() + 1)).slice(-2),\r\n                    ly = d.getFullYear(),\r\n                    lh = (\"0\" + d.getHours()).slice(-2),\r\n                    lmm = (\"0\" + d.getMinutes()).slice(-2),\r\n                    offset = -d.getTimezoneOffset() / 60;\r\n                return dd + \".\" + m + \".\" + y + \" <span class='utc'>\" + h + \":\" + mm + \" UTC</span> (\" + lh + \":\" + lmm + \")\"\r\n                //return dd+\".\"+m+\".\"+y+\" \"+h+\":\"+mm+\" UTC <br>\"+\r\n                //\"<span class='small'>(\"+ldd+\".\"+lm+\".\"+ly+\" \"+lh+\":\"+lmm+\" UTC\"+(offset>0?\"+\":\"\")+offset+\")</span>\";\r\n            }\r\n        },\r\n        placeVesselTypeIcon: function(vessel){\r\n            switch (vessel.vessel_type.toLowerCase()) {\r\n                case \"cargo\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Ccargo-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"tanker\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Ctanker-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"fishing\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cfishing-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"passenger\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cpassenger-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;                \r\n                case \"hsc\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Chighspeed-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"pleasure craft\":\r\n                case \"sailing\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cpleasure-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                case \"unknown\": \r\n                case \"reserved\": \r\n                case \"other\":\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cother-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n                default:\r\n                    vessel.icon = \"http://maps.kosmosnimki.ru/GetImage.ashx?usr=haibrahmanov%40scanex.ru&img=AIS%5Cspecialcraft-L-100-\" +\r\n                        (vessel.sog != 0 ? \"move\" : \"stand\") + \".svg\"\r\n                    break;\r\n            }\r\n        },\r\n\r\n        searchPositionsAgg: function (vessels, dateInterval, callback) {\r\n            //console.log(dateInterval);\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _historyLayer, //'8EE2C7996800458AAF70BABB43321FA4',//\r\n                orderdirection: 'desc',\r\n                orderby: 'ts_pos_utc',\r\n                columns:'[{\"Value\":\"mmsi\"},{\"Value\":\"flag_country\"},{\"Value\":\"callsign\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"cog\"},{\"Value\":\"sog\"},{\"Value\":\"draught\"},{\"Value\":\"vessel_type\"},'+\r\n                '{\"Value\":\"destination\"},{\"Value\":\"ts_eta\"},{\"Value\":\"nav_status\"},{\"Value\":\"heading\"},{\"Value\":\"rot\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]',\r\n                \r\n                query: \"([mmsi] IN (\" + vessels.join(',') + \")) and '\" + dateInterval.dateBegin.toISOString() + \"'<=[ts_pos_utc] and [ts_pos_utc]<'\" + dateInterval.dateEnd.toISOString() + \"'\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchPositions: function (vessels, dateInterval, callback) {\r\n            //console.log(\"searchById\");\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _historyLayer, //'8EE2C7996800458AAF70BABB43321FA4',//\r\n                //orderdirection: 'desc',\r\n                //orderby: 'ts_pos_utc',\r\n                query: \"([mmsi] IN (\" + vessels.join(',') + \")) and '\" + dateInterval.dateBegin.toISOString() + \"'<=[ts_pos_utc] and [ts_pos_utc]<'\" + dateInterval.dateEnd.toISOString() + \"'\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchById: function (aid, callback) {\r\n            //console.log(\"searchById\");\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLayerID, //'8EE2C7996800458AAF70BABB43321FA4'\r\n                columns: '[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]',\r\n                query: \"([id] IN (\" + aid.join(',') + \"))\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchString: function (searchString, isfuzzy, callback) {\r\n            //console.log(_aisLastPoint+\", \"+_aisLayerID)\r\n            var query = \"\";\r\n            if (searchString) {\r\n                searchString = searchString.toUpperCase();\r\n                if (searchString.search(/[^\\d, ]/) === -1) {\r\n                    var arr = searchString.replace(/ /g, '').split(/,/);\r\n                    query = \"([mmsi] IN (\" + arr.join(',') + \"))\" +\r\n                        \"OR ([imo] IN (\" + arr.join(',') + \"))\"\r\n                } else {\r\n                    if (isfuzzy)\r\n                        query = '([vessel_name] startswith \\'' + searchString + '\\') OR ([vessel_name] contains \\' ' + searchString + '\\')';\r\n                    else\r\n                        query = '([vessel_name] startswith \\'' + searchString + '\\') OR ([vessel_name] contains \\' ' + searchString + '\\')';\r\n                }\r\n            }\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLastPoint,\r\n                columns: '[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"vessel_type\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]',\r\n                //orderdirection: 'desc',\r\n                orderby: 'vessel_name',\r\n                query: query\r\n            };\r\n            if (isfuzzy)\r\n                request.pagesize = 1000;\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchNames: function (avessels, callback) {\r\n            var a = avessels.reduce((p,c)=>{\r\n                if((c.mmsi && c.mmsi!=\"\") || (c.imo && c.imo!=\"\" && c.imo!=-1)) \r\n                    p.push(c); \r\n                return p;\r\n            },[]),\r\n            request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLastPoint,\r\n                orderdirection: 'desc',\r\n                orderby: 'ts_pos_utc',\r\n                query: a.map(function (v) { return \"([mmsi]=\" + v.mmsi + (v.imo && v.imo != \"\" ? (\" and [imo]=\" + v.imo) : \"\") + \")\" }).join(\" or \")\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchScreen: function (options, callback) {\r\n            var lmap = nsGmx.leafletMap;\r\n            var latLngBounds = lmap.getBounds(),\r\n                sw = latLngBounds.getSouthWest(),\r\n                ne = latLngBounds.getNorthEast(),\r\n                min = { x: sw.lng, y: sw.lat },\r\n                max = { x: ne.lng, y: ne.lat };\r\n            let queryParams = { WrapStyle: 'window', minx: min.x, miny: min.y, maxx: max.x, maxy: max.y, layer: _screenSearchLayer },\r\n            //     layerTreeNode = $(_queryMapLayers.buildedTree).find(\"div[LayerID='\"+_screenSearchLayer+\"']\")[0];\r\n            // if (layerTreeNode){   \r\n            //     var gmxProp = layerTreeNode.gmxProperties.content.properties;\r\n            //     if (gmxProp.Temporal) {\r\n            //         queryParams.s = options.dateInterval.get('dateBegin').toJSON(),\r\n            //         queryParams.e = options.dateInterval.get('dateEnd').toJSON();\r\n            //     }\r\n            // }\r\n            dateInterval = nsGmx.widgets.commonCalendar.getDateInterval();\r\n            queryParams.s = options.dateInterval.get('dateBegin').toJSON(),\r\n            queryParams.e = options.dateInterval.get('dateEnd').toJSON();\r\n//console.log(queryParams);\r\n            L.gmxUtil.sendCrossDomainPostRequest(_aisServices + \"SearchScreen.ashx\",\r\n                queryParams,\r\n                callback);\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/Search/Searcher.js","const Polyfill = require('./Polyfill');\r\nmodule.exports = function (options) {\r\n    const _layersByID = nsGmx.gmxMap.layersByID,\r\n          _aisLayer = _layersByID[options.aisLayerID],\r\n          _tracksLayer = _layersByID[options.tracksLayerID],\r\n          _screenSearchLayer = _layersByID[options.screenSearchLayer];\r\n    let   _almmsi, _tlmmsi, _aldt, _tldt;\r\n    try{\r\n          _almmsi = _aisLayer.getGmxProperties().attributes.indexOf(\"mmsi\") + 1, \r\n          _tlmmsi = Polyfill.findIndex(_tracksLayer.getGmxProperties().attributes, function(p){return \"mmsi\"==p.toLowerCase();}) + 1,\r\n          _aldt = _aisLayer.getGmxProperties().attributes.indexOf(\"ts_pos_utc\") + 1, \r\n          _tldt = Polyfill.findIndex(_tracksLayer.getGmxProperties().attributes, function(p){return \"date\"==p.toLowerCase();}) + 1;\r\n// console.log(_almmsi+\" \"+_aldt)\r\n// console.log(_tlmmsi+\" \"+_tldt)\r\n    }\r\n    catch(ex){}\r\n\r\n    let _displayedTrack = {mmsi:null},\r\n    _filterFunc = function (args, filtered, displayedVessel) {\r\n        let dates = _displayedTrack.dates ? _displayedTrack.dates.list : null,\r\n        mmsiArr = [];\r\n        mmsiArr.push(_displayedTrack.mmsi);\r\n\r\n        let mmsi = args.properties[args.properties.length > 20 ? _almmsi : _tlmmsi].toString(),\r\n            dt = new Date(new Date(args.properties[args.properties.length>20 ? _aldt : _tldt]*1000).setUTCHours(0,0,0,0)),\r\n            i, j, len;\r\n        for (i = 0, len = mmsiArr.length; i < len; i++) {\r\n            if (mmsi == mmsiArr[i] && filtered.indexOf(mmsi)<0 \r\n            && (!displayedVessel || displayedVessel.indexOf(mmsi)>=0)) { \r\n                if (dates)\r\n                    for (j=0; j<dates.length; ++j){\r\n                        if (dates[j].getTime()==dt.getTime()){\r\n                            return true;\r\n                        }\r\n                    }\r\n                else{\r\n                    return true; \r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }, \r\n    _setTrackFilter = function(filtered, displayedVessel){\r\n//console.log(_displayedTrack)\r\n        let lmap = nsGmx.leafletMap;\r\n        if (_aisLayer) {\r\n            if (_displayedTrack.mmsi) {\r\n                _aisLayer.setFilter((args)=>_filterFunc(args, filtered, displayedVessel));\r\n                if (!_aisLayer._map) {\r\n                    lmap.addLayer(_aisLayer);\r\n                }\r\n            } else {\r\n                _aisLayer.removeFilter();\r\n                lmap.removeLayer(_aisLayer);\r\n            }\r\n        }\r\n        if (_tracksLayer) {\r\n            if (_displayedTrack.mmsi) {\r\n                _tracksLayer.setFilter((args)=>_filterFunc(args, filtered, displayedVessel));\r\n                if (!_tracksLayer._map) {\r\n                    lmap.addLayer(_tracksLayer);\r\n                }\r\n            } else {\r\n                _tracksLayer.removeFilter();\r\n                lmap.removeLayer(_tracksLayer);\r\n            }\r\n        }\r\n    }, \r\n    _setVesselFilter = function(filtered, displayedVessel){\r\n// console.log(displayedVessel)\r\n// console.log(filtered)\r\n        let lmap = nsGmx.leafletMap;\r\n        if (_screenSearchLayer) {\r\n            if (displayedVessel || filtered.length) {\r\n                _screenSearchLayer.setFilter((args) => {\r\n                    let mmsi = args.properties[1].toString();\r\n                    if (filtered.indexOf(mmsi) < 0){\r\n                        if (displayedVessel && displayedVessel.indexOf(mmsi) < 0)\r\n                            return false;\r\n                        else\r\n                            return true;\r\n                    }\r\n                    else\r\n                        return false;\r\n                });\r\n            } else {\r\n                _screenSearchLayer.removeFilter();\r\n            }\r\n        }\r\n\r\n    },\r\n    _markers,\r\n    _visibleMarkers = [],\r\n    _markerMustBeShown = function(mmsi, filtered){\r\n        return (!_visibleMarkers.length && filtered.indexOf(mmsi.toString())<0)\r\n        || _visibleMarkers.indexOf(mmsi.toString())>=0;\r\n    },\r\n    _repaintOtherMarkers = function(data, markerTemplate, filtered){ \r\n        if (!data)\r\n            return;\r\n            \r\n        let di = nsGmx.widgets.commonCalendar.getDateInterval();\r\n        if (!_markers)\r\n            _markers = L.layerGroup().addTo(nsGmx.leafletMap);\r\n        else\r\n            _markers.clearLayers();\r\n//console.log(filtered)\r\n//console.log(_visibleMarkers)\r\n        let label_line = function(label, label_color, label_shadow){\r\n            if (label!=\"\")\r\n            return '<div style=\"height:14px;\">'+\r\n            '<div class=\"label_shadow\" style=\"height:14px;color' + label_shadow.color + \";text-shadow:\" + label_shadow.text_shadow + '\">' + label + '</div>'+\r\n            '<div class=\"label_color\" style=\"position:relative;top:-14px;color:' + label_color + '\">' + label + '</div></div>';\r\n            else\r\n            return \"\";\r\n        },\r\n        marker = function(vessel, marker_style){\r\n            let type_color = \"#000\";\r\n            switch(vessel.vessel_type){\r\n                case \"Cargo\": type_color = \"#33a643\"; break;\r\n                case \"Fishing\": type_color = \"#f44336\"; break;\r\n                case \"Tanker\": type_color = \"#246cbd\"; break;\r\n                case \"Passenger\": type_color = \"#c6b01d\"; break;\r\n                case \"HSC\": type_color = \"#ff6f00\"; break;\r\n                case 'Pleasure Craft': \r\n                case 'Sailing': type_color = \"#9c27b0\"; break;\r\n                case 'Dredging':\r\n                case 'Law Enforcement':\r\n                case 'Medical Transport':\r\n                case 'Military':\r\n                case 'Pilot':\r\n                case 'Port Tender':\r\n                case 'SAR':\r\n                case 'Ships Not Party to Armed Conflict':\r\n                case 'Spare':\r\n                case 'Towing':\r\n                case 'Tug':\r\n                case 'Vessel With Anti-Pollution Equipment':\r\n                case 'WIG':\r\n                case 'Diving': type_color = \"#9b4628\"; break;\r\n            }\r\n            return vessel.sog ?\r\n            '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(' + (!vessel.cog?0:vessel.cog) + 'deg)\"><title>1</title><path style=\"fill:' + type_color + ';\" d=\"M13.8,20.07a1,1,0,0,1-.69-0.28l-1.79-1.72a0.72,0.72,0,0,0-1,0L8.52,19.79a1,1,0,0,1-.69.28,1,1,0,0,1-1-1V8.65c0-1.52,1.55-7.59,4-7.59s4,6.07,4,7.59V19a1,1,0,0,1-1,1h0Z\"/><path style=\"fill:' + marker_style + ';\" d=\"M10.82,1.57c1.93,0,3.5,5.57,3.5,7.09V19a0.52,0.52,0,0,1-.51.53,0.49,0.49,0,0,1-.34-0.14l-1.79-1.72a1.22,1.22,0,0,0-1.71,0L8.17,19.42a0.49,0.49,0,0,1-.34.14A0.52,0.52,0,0,1,7.32,19V8.65c0-1.51,1.57-7.09,3.5-7.09h0m0-1c-3,0-4.5,6.72-4.5,8.09V19a1.52,1.52,0,0,0,1.51,1.53,1.49,1.49,0,0,0,1-.42l1.79-1.72a0.22,0.22,0,0,1,.32,0l1.79,1.72a1.49,1.49,0,0,0,1,.42A1.52,1.52,0,0,0,15.32,19V8.65c0-1.37-1.51-8.09-4.5-8.09h0Z\"/><ellipse style=\"fill:#fff;\" cx=\"10.82\" cy=\"10.54\" rx=\"1.31\" ry=\"1.35\"/><path style=\"fill:#fff;\" d=\"M10.73,3.34h0.12a0.35,0.35,0,0,1,.35.35v6.85a0,0,0,0,1,0,0H10.38a0,0,0,0,1,0,0V3.69A0.35,0.35,0,0,1,10.73,3.34Z\"/></svg>'\r\n            : '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(' + (!vessel.cog?0:vessel.cog) + 'deg)\"><title>1</title><rect style=\"fill:' + type_color + ';stroke:' + marker_style + ';stroke-miterlimit:10;\" x=\"5.9\" y=\"5.6\" width=\"9.19\" height=\"9.19\" rx=\"2\" ry=\"2\" transform=\"translate(-4.13 10.41) rotate(-45)\"/><circle style=\"fill:#fff;\" cx=\"10.5\" cy=\"10.19\" r=\"1.5\"/></svg>';\r\n        };\r\n        for (let i = 0; i < data.groups.length; ++i) {\r\n//console.log(data.groups[i].marker_style);\r\n            for (let j = 0; j < data.groups[i].vessels.length; ++j) {\r\n                if (_markerMustBeShown(data.groups[i].vessels[j].mmsi, filtered)){\r\n                    if (di.get(\"dateBegin\").getTime()<=data.groups[i].vessels[j].ts_pos_org*1000 && \r\n                    data.groups[i].vessels[j].ts_pos_org*1000<di.get(\"dateEnd\").getTime()){ \r\n                        let temp = {};\r\n                        temp.group_name = label_line(data.groups[i].default?\"\":(data.groups[i].title), data.groups[i].label_color, data.groups[i].label_shadow)\r\n                        temp.vessel_name = label_line(data.groups[i].vessels[j].vessel_name, data.groups[i].label_color, data.groups[i].label_shadow);    \r\n                        temp.sog = label_line(data.groups[i].vessels[j].sog + _gtxt(\"AISSearch2.KnotShort\"), data.groups[i].label_color, data.groups[i].label_shadow);  \r\n                        temp.cog = label_line(isNaN(data.groups[i].vessels[j].cog)?\"\":data.groups[i].vessels[j].cog.toFixed(1) + \"&deg;\", data.groups[i].label_color, data.groups[i].label_shadow);    \r\n                        temp.marker = marker(data.groups[i].vessels[j], data.groups[i].marker_style);\r\n                        let m = L.marker([data.groups[i].vessels[j].ymin, data.groups[i].vessels[j].xmin>0?data.groups[i].vessels[j].xmin:360+data.groups[i].vessels[j].xmin],\r\n                            {\r\n                                id:data.groups[i].vessels[j].mmsi,\r\n                                icon: L.divIcon({\r\n                                    className: 'mf_label gr' + i,\r\n                                    html: Handlebars.compile(markerTemplate)(temp)\r\n                                }),\r\n                                zIndexOffset:1000\r\n                            });\r\n                        m.id = data.groups[i].vessels[j].mmsi;\r\n                        _markers.addLayer(m);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    return {\r\n        get displayedTrack(){ return _displayedTrack; },\r\n        set displayedTrack(value){ _displayedTrack = value; },\r\n        showTrack: function (mmsiArr, dates, filtered, displayedVessel) { \r\n            _displayedTrack = { mmsi:mmsiArr && mmsiArr.length? mmsiArr[0] : null};\r\n            if (dates)\r\n                _displayedTrack.dates = { mmsi:mmsiArr[0], list:dates };\r\n            if (_aisLayer || _tracksLayer)\r\n                _displayedTrack.mmsi = mmsiArr[0];\r\n            else\r\n                _displayedTrack.mmsi = null;\r\n            _setTrackFilter(filtered, displayedVessel);\r\n        },\r\n        hideVesselMarkers: function (filtered, displayedVessel) {\r\n            _setTrackFilter(filtered, displayedVessel);\r\n            _setVesselFilter(filtered, displayedVessel);\r\n        },\r\n        showOtherMarkers: function(onlyThis){\r\n            if (!onlyThis) {\r\n                _visibleMarkers.length = 0;\r\n            }\r\n            else {\r\n                _visibleMarkers = onlyThis.map(m=>m);\r\n            }\r\n            _screenSearchLayer.fire('versionchange');\r\n        },\r\n        repaintOtherMarkers: _repaintOtherMarkers,\r\n        highlightMarker: function(i, group){\r\n            $('.mf_label.gr'+i+' svg').each((i,e)=>{\r\n                let paths = e.querySelectorAll('path');\r\n                if(paths[1])\r\n                    paths[1].style.fill = group.marker_style;\r\n            })\r\n            $('.mf_label.gr'+i+' svg rect').css({\"stroke\":group.marker_style});\r\n\r\n            $('.mf_label.gr'+i+' .label_color').css({\"color\":group.label_color});\r\n            $('.mf_label.gr'+i+' .label_shadow').css({\"color\":group.label_shadow.color, \"text-shadow\":group.label_shadow.text_shadow});\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Toolbox.js"],"sourceRoot":""}