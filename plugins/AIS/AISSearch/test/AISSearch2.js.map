{"version":3,"sources":["webpack:///webpack/bootstrap 44cc81cc4d351054679d","webpack:///./src/entry.js","webpack:///./src/all.css","webpack:///./src/Views/AisView.css","webpack:///./src/locale.js","webpack:///./src/Polyfill2.js","webpack:///./src/aisPluginPanel.js","webpack:///./src/ViewsFactory.js","webpack:///./src/Views/ScreenSearchView.js","webpack:///./src/Views/BaseView.js","webpack:///./src/Models/ScreenSearchModel.js","webpack:///./src/Views/MyFleetView.js","webpack:///./src/Views/MyFleet.css","webpack:///./src/Controls/GroupList.js","webpack:///./src/Controls/GroupWidget.js","webpack:///./src/Models/MyFleetModel.js","webpack:///./src/Polyfill.js","webpack:///./src/Views/DbSearchView.js","webpack:///./src/Views/DbSearch.css","webpack:///./src/Controls/SearchControl.css","webpack:///./src/Controls/SearchControl.js","webpack:///./src/Models/DbSearchModel.js","webpack:///./src/Views/InfoDialogView.js","webpack:///./src/Views/infodialog.js","webpack:///./src/Views/infodialog.css","webpack:///./src/Views/SpecialFloatView.js","webpack:///./src/Views/SpecialFloatView.css","webpack:///./src/Views/BaseFloatView.js","webpack:///./src/Views/VesselInfoScreen.js","webpack:///./src/Views/VesselInfoScreen.css","webpack:///./src/Search/Searcher.js","webpack:///./src/Controls/Calendar.js","webpack:///./src/Controls/LegendControl.js","webpack:///./src/canvg.js","webpack:///./src/Toolbox.js","webpack:///./src/Track.js","webpack:///./src/VesselMarker.js"],"names":["PRODUCTION","SIDEBAR2","BETA","require","AisPluginPanel","ViewsFactory","LegendControl","Toolbox","Handlebars","registerHelper","context","mmsi","imo","JSON","stringify","pluginName","menuId","toolbarIconId","cssTable","modulePath","gmxCore","getModulePath","replace","document","location","href","highlight","L","marker","icon","className","iconAnchor","iconSize","iconUrl","zIndexOffset","ready","publicInterface","afterViewer","params","map","tools","legendControl","aisLastPoint","lastPointLayerAlt","options","aisLayerID","screenSearchLayer","searchLayer","historyLayer","tracksLayerID","historyLayerAlt","tracksLayerAlt","vesselLegend","key","toLowerCase","myFleetLayers","split","id","viewFactory","layersByID","nsGmx","gmxMap","setLayerClickHandler","layer","removeEventListener","addEventListener","e","gmx","properties","hasOwnProperty","infoDialogView","show","forLayers","layersId","i","length","sidebar","window","iconSidebarWidget","sidebarControl","sidebarPane","setPane","position","showOnTop","createTab","createTabFunction","active","inactive","hint","_gtxt","withLegendSwitch","aisPluginPanel","createSwitch","_activeTabId","$","removeClass","_renderTabs","activeTabId","setTimeout","open","search","a","substr","x","filter","c","indexOf","y","vessel","setLatLng","addTo","leafletMap","fitBounds","maxZoom","animate","addModule","css","_translationsHash","addtext","proto","matches","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","closest","selector","parentElement","Element","prototype","arr","CharacterData","DocumentType","args","forEach","item","push","Object","defineProperty","configurable","enumerable","writable","value","remove","parentNode","removeChild","append","argArr","Array","slice","call","arguments","docFrag","createDocumentFragment","argItem","isNode","Node","appendChild","createTextNode","String","Document","DocumentFragment","NodeList","module","exports","withFooter","_isReady","_canvas","createElement","_activeView","_views","create","_createFooter","footer","_createTabs","tabsTemplate","compile","v","frame","tabs","on","is","target","each","tab","addClass","hide","_tabs","_footer","_returnInstance","element","eq","resize","click","ScreenSearchView","ScreenSearchModel","MyFleetView","MyFleetModel","DbSearchView","DbSearchModel","InfoDialogView","Searcher","ViewCalendar","_tools","_daysLimit","_mapDateInterval","widgets","commonCalendar","getDateInterval","_viewCalendar1","begin","get","end","daysLimit","_viewCalendar2","onChange","interval","_modulePath","_searcher","_mfm","aisLayerSearcher","toolbox","_ssm","myFleetModel","_dbsm","_dbsv","_ssv","_mfv","_idv","aisView","myFleetView","BaseView","_delayedRepaint","model","apply","onLegendSwitched","showAlternative","isActive","data","vessels","repaint","hideAisSwitch","checked","hideAisData","bind","gifLoader","th","getBoundingClientRect","height","ih","find","rh","rv","container","tableTemplate","cleanFilter","filterReady","filterInput","doFilter","setFilter","filterString","val","keyup","input","keyCode","needUpdate","isDirty","update","currentTarget","_clean","text","_switchLegendIcon","ic","ica","inProgress","state","progress","_firstRowsPos","_firstRowsNum","_firstRowsShift","_setEventHandlers","thisInst","parse","attr","xmin","xmax","longitude","ymin","ymax","latitude","ts_pos_utc","ts_pos_org","dt_pos_utc","html","stopPropagation","lastPosition","showPosition","arrowHead","innerHTML","groups","needAltLegend","groupsAlt","off","scrollCont","empty","tempFirst","content","msg","mcsTopPctPrev","rowH","mCustomScrollbar","callbacks","onScroll","scroledPx","mcs","top","whileScrolling","startShow","topPct","start","scrollInertia","timeout","focus","_calcHeight","topOffset","view","clean","h","startScreen","bb","left","width","_this","restoreDefault","_actualUpdate","_myFleetModel","_aisLayerSearcher","_vesselLegend","thisInstance","onChanged","_filterString","set","_filterPromise","s","dataSrc","g","sortData","thisModel","cancel","run","inst","Promise","rs","rj","RegExp","icons","setGroups","name","undefined","url","count","vessel_name","getIcon","vessel_type","getIconAlt","vessel_","parseInt","sog","then","r","load","actualUpdate","resolve","Date","all","reject","searchScreen","dateInterval","border","group","json","Status","Result","values","d","mf_member","formatDate","Math","floor","getTime","maxid","cog","heading","icon_rot","round","placeVesselTypeIcon","k","isNaN","sortGrups","b","sort","markMembers","ErrorInfo","some","txt","console","log","GroupList","style","display","visibility","_displayedOnly","_notDisplayed","_saveLabelSettingsPromise","_viewState","isViewActive","displayedOnly","notDisplayed","showTracks","trackBuilder","needAlt","showMyFleetTracks","hideTracks","hideMyFleetTracks","cleanTracks","cleanMyFleetTracks","viewCalendar","settings","calendar","el","historyInterval","dateBegin","dateEnd","reloadTrack","displayTracks","loadTracks","setDateInterval","showTracsCtrl","newGroupNameValid","ngn","isValid","title","createGroup","groupList","appendGroup","error","markerTemplate","showVesselsOnMap","saveLabelSettings","showMyFleetTrack","toString","hideVesselsOnMap","onRepaintItem","elm","querySelector","innerText","onDeleteGroup","deleteGroup","labelSettings","match","labelSettingCtrl","onCheckItem","uncheked","onChangeGroup","changeGroup","catch","err","onExcludeItem","ev","thisView","beforeExcludeMember","dlg","changeMembers","eraseMyFleetMarker","onGroupMenuShow","marker_style","label_color","label_shadow","color","onChangeGroupStyle","colors","changeGroupStyle","onSaveGroupStyle","saveGroupStyle","strMmsi","m","cleanMap","GroupWidget","_onRepaintItemHandler","_onCheckItem","_onExcludeItem","_onChangeGroup","_onDeleteGroup","_onGroupMenuShow","_onChangeGroupStyle","_rolledupGroups","_cp1","_cp2","_cp3","_getFiltered","filtered","selectAll","selectOne","j","_setCheckBoxes","check","querySelectorAll","_setGroupCommands","preventDefault","classes","classList","ctxMenu","contextMenu","evnt","colorChangeHandler","cs","_groupStyleChanged","backgroundColor","c1","cp1","c2","cp2","c3","cp3","Utils","rgb2hex","Controls","createColorPicker","relatedTarget","_hideContextMenu","ColorPickerHide","div","offset","clientX","clientY","offsetHeight","innerHeight","bottom","arrow","cl","contains","add","_onSaveGroupStyle","_saveStylePromise","groupblock","template","previousSibling","callback","index","parent","Polyfill","emptyGroup","isDefault","updateTemplate","ms","lsc","ls","eg","label_shadow_color","default","lc","mt","_markerTemplate","VesselData","_trackLoaders","_isDirty","_myFleetLayers","_defaultGroup","_vessels","_mapID","_prepared","_data","_view","_onChangedHandlers","_fireChanged","_loadVoyageInfo","findIndex","_parseVoyageInfo","fields","searchNames","response","_compareGroups","l","lat","lon","vt","gmx_id","member","formatDateTime","gn","_persistGroupsLook","temp","action","FormData","sendCrossDomainJSONRequest","baseUrl","encodeURIComponent","form","fetch","credentials","method","body","_queryMapLayers","buildedTree","gmxProperties","MapID","addGroupField","lid","TaskID","Completed","ErorInfo","addDefaultGroup","f","fetchMyFleet","nickname","Nickname","layers","LayerID","rejectedResponse","specialVesselFilters","ai","displayed","drawMyFleetMarker","myfleet","reduce","p","membCounter","vv","splice","objects","infoDialog","removeMyFleetTrack","loadTrack","found","highlightMarker","Worker","serverBase","counter","myWorker","postMessage","toISOString","onmessage","pid","searchById","res","onerror","viewState","w","terminate","positions","predicate","list","thisArg","SearchControl","_searchLayer","_highlight","_displayed","showHistoryTracks","cleanHistoryTracks","changes","removeLayer","trg","searchInput","searcher","searchPromise","request","protocol","headers","mode","encodeURI","parser","columns","showTrack","reload","_vi_template","clearMyFleetMarkers","openPos","thisVessel","showInfoDialog","source","source_orig","ind","vi_cont","td","siblings","next","positionMap","allTracksInput","nv","ts","tracksInputs","dv","lastPos","searchString","positionDate","DateInterval","getUTCDayBoundary","checkInterval","onclick","showHistoryTrack","isArray","zoom","getZoom","setView","local","formatPosition","obj","_searchString","_sparams","searchparams","suggestions","q","preferences","localStorage","getItem","asparams","sr","borderRight","paddingRight","searchBut","prefeBut","removeBut","delay","suggestionsCount","suggestionsFrame","first","current","last","searchDone","doSearch","actualId","requests","status","concat","suggestion","cr","offsetWidth","ch","sparam","setItem","clearTimeout","onkeydown","nextSibling","prepareSearchInput","onkeyup","onpaste","originalEvent","clipboardData","getData","searchPositionsAgg2","parseResponse","previous","dt","t","total","ErrorMessage","displayInfoDialog","VesselInfoScreen","infoDialogCascade","allIinfoDialogs","vesselInfoScreen","aisServices","_showPosition","track","_updateView","getmore","dialog","isNew","dialogOffset","insertAfter","displayedTrack","closeFunc","event","openVesselInfoScreen","pos","ui","SpecialFloatView","addUnit","u","isNeg","power","pow","formatVessel","ts_pos_loc","ts_eta","Translations","getLanguage","rot","draught","toDd","D","lng","dir","deg","ddToDms","dms","min","sec","shipCams","commands","_gmx","props","meta","MetaProperties","ships","Value","urls","canvas","menu","appendTo","photo","underphoto","buttons","dialogW","dialogH","posX","posY","showDialog","vessel2","moreInfo","smallShipIcon","vesselPropTempl","registry_name","swap","mi","resizable","extend","titlebar","scheme","replaceWith","menubuttons","openpage","showpos","shipCam","setImages","moment","setMinutes","getMinutes","getTimezoneOffset","getFullYear","getMonth","getDate","getHours","getSeconds","images","special","showCamBut","visible","close","addremoveIcon","addremove","filterUpdating","info","redrawMarkers","ex","onDone","_cssClassName","BaseFloatView","cancelBubble","returnValue","closeCom","zinCom","zoutCom","img1Com","img2Com","twoimgCom","rc1","rc2","image1","image2","logos","showTwo","restoreSize","h1","h2","zoomIn","image","wiw","wih","setPlace1","setPlace2","zoomIn2","ceil","allowMove","src","closeCallback","srcElement","st","getComputedStyle","innerWidth","right","rc","imageUrl","timers","downloadingImage1","Image","onload","random","downloadingImage2","defaultView","getWindowWidth","intrerval","timer","disposeTimer","_getMaxZindex","dialogs","z","zMax","parseFloat","zIndex","dx","dy","rect","fx","fy","_ais","_galery","_register","_regcap","_leftPanel","_minh","_lloyds","menuAction","preview","showPicture","errmsg","change","submit","$img","jQuery","imgURL","attributes","prop","$svg","removeAttr","mia","panel","theme","documentElement","clientWidth","clientHeight","drawGallery","gallery","galcontent","drawAis","ledokol","aiscontent","flag_country","callsign","nav_status","destination","drawRegister","regcontent","drawTable","article","pn","desc","description","pv","drawRMR","version","drawLloyds","regSwitches","onFail","wait","ship","registerServerUrl","lloydsServerUrl","rmr","RS","_aisServices","_baseUrl","_serverScript","_aisLastPoint","_screenSearchLayer","_aisLayerID","_historyLayer","_lastPointLayerAlt","getBorder","lmap","dFeatures","gmxDrawing","getFeatures","toGeoJSON","latLngBounds","getBounds","sw","getSouthWest","ne","getNorthEast","max","minX","maxX","geo","type","coordinates","center","formatTime","toLocaleTimeString","toLocaleDateString","toLocaleString","formatDate2","dd","mm","getUTCHours","getUTCMinutes","getUTCDate","getUTCMonth","getUTCFullYear","ldd","lm","ly","lh","lmm","iconAlt","imgAlt","img","colorAlt","cache","searchPositionsAgg2Mf","searchPositionsAgg","WrapStyle","orderdirection","orderby","query","join","gmxUtil","sendCrossDomainPostRequest","searchPositions","aid","searchString2","isfuzzy","pagesize","toUpperCase","avessels","toJSON","mapDateInterval","MS_DAY","_utcLimits","UTC","_calendar","_now","_begin","_end","_current","_onChangeCallbacks","_setBegin","_setEnd","_onChangeHandler","dp","_beginCtl","datepicker","_endCtl","maxd","minDate","maxDate","cb","_thisInstance","onSelect","limits","newEnd","newBegin","shift","setDate","dpEnd","di","pickerEnd","SvgParser","aisLastPointLayer","_layersByID","_layers","_getIcons","gmxStyles","styles","Filter","RenderStyle","Name","_icons","_iconsDict","typeColor","_iconsAlt","_iconsAltDict","_getSvgPromise","httpRequest","XMLHttpRequest","onreadystatechange","readyState","svg","responseText","exec","msToBlob","canvg","toDataURL","svg64","btoa","unescape","b64Start","image64","imgSvg","ctx","getContext","clearRect","drawImage","send","_svgLoader","_svgAltLoader","_createSwitch","lswitchClick","switchLegend","legendDiv","loader","iconCollection","_getAtAnchorIcon","_getUnderWayIcon","getClientRects","type_color","group_style","getUnderWayIcon","getAtAnchorIcon","iconsAlt","cond","eval","re1","re2","getIconAltUrl","getIconUrl","str","_parser","cvd","logCommand","opts","getElementById","build","stop","loadXml","FRAMERATE","init","Definitions","Styles","Animations","Images","ViewPort","viewPorts","SetCurrent","RemoveCurrent","pop","Current","ComputeSize","sqrt","ImagesLoaded","loaded","trim","compressSpaces","ajax","AJAX","ActiveXObject","parseXml","xml","DOMParser","parseFromString","xmlDoc","async","loadXML","Property","hasValue","numValue","n","valueOrDefault","def","numValueOrDefault","that","Color","addOpacity","opacity","newValue","RGBColor","ok","Definition","getDefinition","isUrl","getFillStyle","createGradient","createPattern","Length","DPI","viewPort","EM","em","fontSize","Font","Parse","font","toPixels","Time","toMilliseconds","Angle","toRadians","PI","Variants","Weights","CreateFont","fontStyle","fontVariant","fontWeight","fontFamily","inherit","ff","ToNumberArray","Point","angleTo","atan2","applyTransform","xp","yp","CreatePoint","CreatePath","path","BoundingBox","x1","y1","x2","y2","Number","NaN","addPoint","addX","addY","addQuadraticCurve","p0x","p0y","p1x","p1y","p2x","p2y","cp1x","cp1y","cp2x","cp2y","addBezierCurve","p3x","p3y","p0","p1","p2","p3","b2ac","t1","t2","isPointInBox","Transform","Type","translate","applyToPoint","rotate","angle","cx","cy","cos","sin","scale","matrix","transform","SkewBase","base","skewX","tan","skewY","transforms","AspectRatio","aspectRatio","desiredWidth","desiredHeight","minY","refX","refY","align","meetOrSlice","scaleX","scaleY","scaleMin","scaleMax","ElementBase","node","children","attribute","createIfNotExists","render","save","setContext","renderChildren","clearContext","restore","addChild","childNode","child","CreateElement","nodeType","childNodes","nodeName","nodeValue","RenderedElementBase","fs","fillStyle","strokeStyle","lineWidth","lineCap","lineJoin","miterLimit","clip","globalAlpha","PathElementBase","beginPath","Mouse","checkPath","fill","stroke","markers","getMarkers","getBoundingBox","baseClearContext","baseSetContext","moveTo","lineTo","closePath","viewBox","rx","ry","quadraticCurveTo","circle","arc","ellipse","KAPPA","bezierCurveTo","line","getPoints","points","polyline","polygon","basePath","PathParser","tokens","reset","command","previousCommand","control","angles","isEnd","isCommandOrEnd","isRelativeCommand","getToken","getScalar","nextCommand","getPoint","makeAbsolute","getAsControlPoint","getAsCurrentPoint","getReflectedControlPoint","addMarker","from","addMarkerAngle","getMarkerPoints","getMarkerAngles","pp","newP","curr","cntrl","cp","xAxisRotation","largeArcFlag","sweepFlag","currp","cpp","centp","acos","a1","ad","halfWay","sx","sy","pattern","tempSvg","baseRender","point","defs","GradientBase","gradientUnits","stops","getGradient","stopsContainer","addColorStop","linearGradient","createLinearGradient","radialGradient","createRadialGradient","stopColor","AnimateBase","duration","maxDuration","calcValue","delta","updated","attributeType","attributeName","to","animateColor","animateTransform","tspan","textAnchor","textAlign","textBaseline","measureText","TextElementBase","fillText","getText","textToMeasure","tref","hasText","baseRenderChildren","checkBoundingBox","onmousemove","cursor","symbol","cssDefs","cssDef","cssClasses","cssProps","cssClass","use","clipPath","MISSING","mapXY","offsetLeft","offsetTop","offsetParent","scrollX","scrollY","dom","isFirstRender","draw","waitingForImages","intervalID","setInterval","hasEvents","runEvents","clearInterval","events","eventElements","isPointInPath","CanvasRenderingContext2D","drawSvg","dw","dh","ignoreMouse","ignoreAnimation","ignoreDimensions","ignoreClear","offsetX","offsetY","scaleWidth","scaleHeight","Track","_lmap","_aisLayer","_curLegendLayer","_prevLegendLayer","_almmsi","_tlmmsi","_aldt","_tldt","_needAltLegend","getGmxProperties","_displayedVessels","_notDisplayedVessels","_filterFunc","mmsiArr","setUTCHours","dates","_specialVesselFilters","_setVesselFilter","removeFilter","tileAttributeIndexes","_markers","_visibleMarkers","_getSvg","_markerIcon","vtype","_eraseMyFleetMarker","layerGroup","getLayers","_drawMyFleetMarker","isVisible","parsedStyleKeys","label_line","label","text_shadow","group_name","toFixed","divIcon","addLayer","_switchLayers","l1","l2","_map","_legendSwitchedHandlers","_legendSwitched","_round","_addUnit","_toDd","_trackBuilder","hasAlternativeLayers","comment","clearLayers","paths","handler","cog_sog","heading_rot","x_y","eta","tm_pos_utc","tm_pos_loc","dt_pos_loc","eta_utc","eta_loc","isNeeded","vesselMarker","_tracks","_tracksAlt","_tracksMF","_tracksAltMF","_addMarker","ep","radius","fillColor","fillOpacity","weight","renderer","latLng","_addMarkers","_prevCursor","_historyMmsi","_container","_onMouseMove","_onClick","trackId","pointerEvents","keys","ra","notDisplayedVessels","Canvas","include","_updateVesselMarker","_drawing","_empty","_drawnLayers","_leaflet_id","_point","_ctx","_radius","np","latLngToLayerPoint","VesselMarker","CircleMarker","_updatePath","_renderer"],"mappings":"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","file":"AISSearch2Test.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 44cc81cc4d351054679d","let PRODUCTION = false,\r\n    SIDEBAR2 = false,\r\n    BETA = false;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\nif (has('BETA'))\r\n    BETA = true;\r\n\r\nrequire(\"./all.css\");\r\nrequire(\"./Views/AisView.css\");\r\nrequire(\"./locale.js\");\r\nrequire(\"./Polyfill2.js\");\r\n\r\nconst AisPluginPanel = require('./aisPluginPanel.js'),\r\n      ViewsFactory = require('./ViewsFactory'),\r\n      LegendControl = require(\"./Controls/LegendControl.js\"),\r\n      Toolbox = require('./Toolbox.js');\r\n\r\nHandlebars.registerHelper('aisinfoid', function (context) {\r\n    return context.mmsi + \" \" + context.imo;\r\n});\r\n\r\nHandlebars.registerHelper('aisjson', function (context) {\r\n    return JSON.stringify(context);\r\n});\r\n\r\nconst pluginName = PRODUCTION ? (BETA ? 'AISPluginBeta' : 'AISPlugin') : 'AISSearch2Test',\r\n    menuId = 'AISSearch',\r\n    toolbarIconId = null, \r\n    cssTable = PRODUCTION ? (BETA ? 'AISPluginBeta' : 'AISPlugin') : 'AISSearch2',\r\n    modulePath = gmxCore.getModulePath(pluginName).replace(/https*\\:\\/\\/[^\\/]+\\/api\\//, document.location.href.replace(/\\/[^\\/]+$/, '/'));\r\n\r\nconst highlight = L.marker([0, 0], {icon:L.icon({\r\n    className:\"ais_highlight-icon\", \r\n    iconAnchor:[12, 12], \r\n    iconSize:[25,25], \r\n    iconUrl:'plugins/ais/aissearch/highlight.png'}), zIndexOffset:1000});\r\n\r\nlet ready = false;\r\nconst publicInterface = {\r\n    pluginName: pluginName,\r\n    afterViewer: function (params, map) {\r\n        if (ready)\r\n            return;\r\n        ready = true;\r\n//console.log(\"ready\");\r\n        const tools = new Toolbox(params),\r\n            legendControl = new LegendControl(tools, params.aisLastPoint, params.lastPointLayerAlt),\r\n            options = {\r\n                aisLayerID: params.aisLayerID,// || '8EE2C7996800458AAF70BABB43321FA4',\t// searchById\t\t\t\r\n                screenSearchLayer: params.searchLayer,// || '8EE2C7996800458AAF70BABB43321FA4', // screen search\r\n\r\n                aisLastPoint: params.aisLastPoint, // || '303F8834DEE2449DAF1DA9CD64B748FE', // db search\r\n                historyLayer: params.historyLayer,\r\n                tracksLayerID: params.tracksLayerID, // || '13E2051DFEE04EEF997DC5733BD69A15',\r\n\r\n                lastPointLayerAlt: params.lastPointLayerAlt,\r\n                historyLayerAlt: params.historyLayerAlt,\r\n                tracksLayerAlt: params.tracksLayerAlt,\r\n\r\n                modulePath: modulePath,\r\n                highlight: highlight,\r\n                menuId: menuId,\r\n                vesselLegend: legendControl,\r\n                tools: tools\r\n            };\r\n\r\n        for (var key in params) \r\n            if (key.toLowerCase() == \"myfleet\") {\r\n                options.myFleetLayers = params[key].split(\",\").map(function (id) {\r\n                    return id.replace(/\\s/, \"\");\r\n                });\r\n                break;\r\n            }\r\n        const viewFactory = new ViewsFactory(options),\r\n            layersByID = nsGmx.gmxMap.layersByID,\r\n            setLayerClickHandler = function (layer) {\r\n                layer.removeEventListener('click')\r\n                layer.addEventListener('click', function (e) {\r\n//console.log('layer', e)\r\n                    if (e.gmx && e.gmx.properties.hasOwnProperty(\"imo\"))\r\n                        viewFactory.infoDialogView.show(e.gmx.properties)\r\n                }, false)\r\n            },\r\n            forLayers = function (layer) {\r\n                try {\r\n                    if (layer) {\r\n                        //setLocaleDate(layer)\r\n                        setLayerClickHandler(layer)\r\n                    }\r\n                }\r\n                catch (e) { }\r\n            };\r\n\r\n        for (var key in params) {\r\n            let layersId = params[key].split(\",\").map(function (id) {\r\n                return id.replace(/\\s/, \"\");\r\n            });\r\n            for (var i = 0; i < layersId.length; ++i) {\r\n//console.log(layersId[i])\r\n                forLayers(layersByID[layersId[i]]);\r\n            }\r\n        }\r\n\r\n        const sidebar = SIDEBAR2 ? window.iconSidebarWidget : window.sidebarControl,\r\n            sidebarPane = sidebar.setPane(\r\n                menuId, {\r\n                    position: params.showOnTop ? -100 : 0,\r\n                    createTab: window.createTabFunction({\r\n                        icon: menuId,\r\n                        active: \"ais_sidebar-icon-active\",\r\n                        inactive: \"ais_sidebar-icon\",\r\n                        hint: _gtxt('AISSearch2.caption')\r\n                    })\r\n                }\r\n            ),\r\n            withLegendSwitch = params.lastPointLayerAlt && nsGmx.gmxMap.layersByID[params.lastPointLayerAlt],       \r\n            aisPluginPanel = new AisPluginPanel(sidebarPane, viewFactory, withLegendSwitch);\r\n        aisPluginPanel.menuId = menuId;\r\n\r\n        if (withLegendSwitch)\r\n            legendControl.createSwitch(aisPluginPanel); // LEGEND SWITCH IN FOOTER\r\n\r\n        sidebar.addEventListener('opened', function (e) {\r\n            if (sidebar._activeTabId == menuId)\r\n                aisPluginPanel.show();\r\n        });\r\n        if (params.showOnTop) { // hack\r\n            $('div[data-pane-id]').removeClass('iconSidebarControl-pane-active')\r\n            sidebar._renderTabs({ activeTabId: menuId });\r\n            setTimeout(() => sidebar.open(menuId), 50);\r\n        }\r\n\r\n        if (location.search.search(/x=[^y=]+y=/i) != -1) {\r\n            var a = location.search.toLowerCase().substr(1).split('&'),\r\n                x = a.filter(function (c) { return !c.indexOf(\"x=\") })[0].substr(2),\r\n                y = a.filter(function (c) { return !c.indexOf(\"y=\") })[0].substr(2)\r\n            highlight.vessel = null;\r\n            highlight.setLatLng([y, x]).addTo(nsGmx.leafletMap);    \r\n            nsGmx.leafletMap.fitBounds([\r\n                [y, x],\r\n                [y, x]\r\n            ], {\r\n                    maxZoom: 9,//config.user.searchZoom,\r\n                    animate: false\r\n            }) \r\n        }\r\n    }\r\n};\r\n\r\n// warm up db connection\r\n//fetch('//geomixer.scanex.ru/Plugins/AIS/SearchScreenAsync.ashx?minx=03&miny=0&maxx=0&maxy=0&layer=EE5587AF1F70433AA878462272C0274C&s=3020-02-13T00:00:00.000Z&e=3020-02-14T00:00:00.000Z', {credentials: 'include'});\r\n\r\ngmxCore.addModule(pluginName, publicInterface, {\r\n    css: cssTable + '.css'\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/entry.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/all.css\n// module id = 1\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/AisView.css\n// module id = 3\n// module chunks = 0","\r\n    _translationsHash.addtext('rus', {\r\n        'AISSearch2.title': 'Поиск судов',\r\n        'AISSearch2.title1': 'Найдено судов',\r\n        'AISSearch2.title2': '<b>Данных не найдено!</b>',\r\n        'AISSearch2.error': '<b>Ошибка при получении данных!</b>',\r\n        'AISSearch2.iconTitle': 'Поиск судов по экрану',\r\n        'AISSearch2.placeholder_0': 'Поиск по адресам, координатам',\r\n        'AISSearch2.placeholder_1': 'Поиск судна по названию / MMSI',\r\n        // 'AISSearch2.placeholder_1': 'Поиск судна по названию / MMSI. Поиск по адресам, координатам, кадастровым номерам'\r\n        'AISSearch2.myFleetDialog': 'Мой флот',\r\n        'AISSearch2.vesselName': 'название',\r\n        'AISSearch2.vesselAdd': 'добавить',\r\n        'AISSearch2.vesselRemove': 'удалить',\r\n        'AISSearch2.vesselExclude': 'исключить',\r\n        'AISSearch2.myFleetMembers': 'Состав',\r\n        'AISSearch2.myFleetMember': 'мой флот',\r\n        'AISSearch2.info': 'информация',\r\n        'AISSearch2.position': 'положение',\r\n        'AISSearch2.found':'Найдено: ',\r\n        'AISSearch2.filter':'Введите название или mmsi или imo судна',\r\n        'AISSearch2.filterName':'Введите название судна',\r\n        'AISSearch2.screen':'По экрану',\r\n        'AISSearch2.database':'По базе данных',\r\n        'AISSearch2.capShort': 'Поиск судов',\r\n        'AISSearch2.caption': 'Поиск судов и \"Мой флот\"',\r\n        'AISSearch2.refresh': 'обновить',\r\n        'AISSearch2.refreshing': 'обновляется',\r\n        'AISSearch2.nomyfleet': 'Сервис не доступен',\r\n        'AISSearch2.auth': 'Требуется авторизация',\r\n        'AISSearch2.vessel_info':'ИНФОРМАЦИЯ О СУДНЕ',\r\n        'AISSearch2.vessel_voyage':'СВЕДЕНИЯ О ДВИЖЕНИИ',\r\n        'AISSearch2.vessel_name': 'Название',\r\n        'AISSearch2.mmsi': 'MMSI',\r\n        'AISSearch2.imo': 'IMO',\r\n        'AISSearch2.flag_country': 'Страна',\r\n        'AISSearch2.vessel_type': 'Тип судна',\r\n        'AISSearch2.flag': 'Флаг',\r\n        'AISSearch2.callsign': 'Позывной',\r\n        'AISSearch2.length': 'Длина',\r\n        'AISSearch2.width': 'Ширина',\r\n        'AISSearch2.draught': 'Осадка',\r\n        'AISSearch2.destination': 'Назначение',\r\n        'AISSearch2.eta': 'Расчетное время прибытия',\r\n        'AISSearch2.nav_status': 'Статус',\r\n        'AISSearch2.last_sig': 'Последний сигнал',\r\n        'AISSearch2.show_track': 'трек за сутки',\r\n        'AISSearch2.hide_track': 'скрыть трек',\r\n\t\t'AISSearch2.source': 'Источник данных',\r\n\t\t'AISSearch2.sais': 'спутниковый AIS',\r\n\t\t'AISSearch2.tais': 'береговой AIS',\r\n\t\t'AISSearch2.lon': 'Долгота',\r\n\t\t'AISSearch2.lat': 'Широта',\r\n\t\t'AISSearch2.historyTab': 'История',\r\n        'AISSearch2.voyageInfo': 'Параметры движения',\r\n        'AISSearch2.DbSearchTab':'БАЗА ДАННЫХ',\r\n        'AISSearch2.ScreenSearchTab':'СУДА НА ЭКРАНЕ',\r\n        'AISSearch2.MyFleetTab':'МОЙ ФЛОТ',\r\n        'AISSearch2.dailyTrack':'трек за сутки',\r\n        'AISSearch2.allDailyTracks':'все треки',\r\n        'AISSearch2.myFleetOnly':'только мой флот',\r\n        'AISSearch2.show_pos':'показать положение и историю',\r\n        'AISSearch2.show_info':'информация о судне',\r\n        'AISSearch2.time_switch':'Время',\r\n        'AISSearch2.time_local':'Местное',\r\n        'AISSearch2.legend_switch':'Раскраска судов',\r\n        'AISSearch2.legend_type':'По типу',\r\n        'AISSearch2.legend_speed':'По скорости',\r\n        'AISSearch2.calendar_today':'сегодня',\r\n        'AISSearh2.searchresults_view':'Здесь будут отображаться<br>результаты поиска по названию,<br>IMO илм MMSI судна',\r\n        'AISSearh2.myfleet_view':'Здесь будут отображаться<br>выбранные суда<br>',\r\n        'AISSearch2.dialog_tab_general':'Общие сведения',\r\n        'AISSearch2.dialog_tab_params':'Параметры движения',\r\n        'AISSearch2.close_but':'закрыть',\r\n        'AISSearch2.myfleet_add':'добавить в мой флот',\r\n        'AISSearch2.myfleet_remove':'удалить из моего флота',\r\n        'AISSearch2.infoscreen_gen':'Основные сведения',\r\n        'AISSearch2.infoscreen_reg':'Регистр',\r\n        'AISSearch2.infoscreen_gal':'Фотогалерея',\r\n        'AISSearch2.last_update':'Обновление базы данных',\r\n        'AISSearch2.reg_general_tab':'Общие сведения',\r\n        'AISSearch2.reg_build_tab':'Сведения о постройке',\r\n        'AISSearch2.reg_chars_tab':'Размеры и скорость',\r\n        'AISSearch2.reg_devs_tab':'Оборудование',\r\n        'AISSearch2.rmrs':'РМРС',\r\n        'AISSearch2.AddIntoGroup':'Добавить в группу:',\r\n        'AISSearch2.RemoveFromGroup':'Удалить из группы',        \r\n        'AISSearch2.AllGroup':'Все',        \r\n        'AISSearch2.NewGroup':'Новая группа',        \r\n        'AISSearch2.NewGroupName':'название',        \r\n        'AISSearch2.CreateGroup':'создать',        \r\n        'AISSearch2.DeleteGroup':'удалить группу',       \r\n        'AISSearch2.DeleteGroupCommand':'Удалить группу',      \r\n        'AISSearch2.DisplaySection':'Показать на карте:',    \r\n        'AISSearch2.DisplayVesselName':'название судна',    \r\n        'AISSearch2.DisplayGroupName':'название группы',    \r\n        'AISSearch2.DisplayCog':'курс',    \r\n        'AISSearch2.DisplaySog':'скорость',   \r\n        'AISSearch2.KnotShort':' уз',\r\n        'AISSearch2.thisVesselOnly':'Только это судно: ',\r\n        'AISSearch2.allTracks':'треки всех судов',\r\n        'AISSearch2.shipsTracks':'треки судов',\r\n        'AISSearch2.markerShadow':'Цвет обводки маркера',\r\n        'AISSearch2.labelColor':'Цвет подписи маркера',\r\n        'AISSearch2.labelShadow':'Цвет обводки подписи',\r\n        'AISSearch2.zoomin_com':'Увеличить',\r\n        'AISSearch2.zoomout_com':'Уменьшить',\r\n        'AISSearch2.image1_com':'Изображение 1',\r\n        'AISSearch2.image2_com':'Изображение 2',\r\n        'AISSearch2.twoimages_com':'Два изображения',\r\n        'AISSearch2.close_com':'Закрыть',\r\n        'AISSearch2.moving':'В движении',\r\n        'AISSearch2.standing':'Стоит\\\\дрейфует',\r\n        'AISSearch2.myFleetInclude': 'добавить в мой флот',\r\n        'AISSearch2.myFleetExclude': 'удалить из моего флота',\r\n        'AISSearch2.hideAisData': 'скрыть данные AIS',\r\n    });\r\n    _translationsHash.addtext('eng', {\r\n        'AISSearch2.title': 'Searching vessels',\r\n        'AISSearch2.title1': 'Vessels found',\r\n        'AISSearch2.title2': '<b>Vessels not found!</b>',\r\n        'AISSearch2.error': '<b>Vessels not found!</b>',\r\n        'AISSearch2.iconTitle': 'Search vessels within the view area',\r\n        'AISSearch2.placeholder_0': 'Search for addresses, coordinates',\r\n        'AISSearch2.placeholder_1': 'Search by vessel name / MMSI',\r\n        // 'AISSearch2.placeholder_1' : 'Search by vessel name / MMSI. Search by addresses, coordinates, cadastre number'\r\n        'AISSearch2.myFleetDialog': 'My fleet',\r\n        'AISSearch2.vesselName': 'name',\r\n        'AISSearch2.vesselAdd': 'add',\r\n        'AISSearch2.vesselRemove': 'remove',\r\n        'AISSearch2.vesselExclude': 'exclude',\r\n        'AISSearch2.myFleetMembers': 'Members',\r\n        'AISSearch2.myFleetMember': 'my fleet',\r\n        'AISSearch2.info': 'info',\r\n        'AISSearch2.position': 'position',\r\n        'AISSearch2.found':'Found ',\r\n        'AISSearch2.filter':'Insert vessel name or mmsi or imo',\r\n        'AISSearch2.filterName':'Insert vessel name',\r\n        'AISSearch2.screen':'On screen',\r\n        'AISSearch2.database':'In database',\r\n        'AISSearch2.capShort': 'Vessel Search',\r\n        'AISSearch2.caption': 'Vessel Search & My Fleet',\r\n        'AISSearch2.refresh': 'refresh',\r\n        'AISSearch2.refreshing': 'refreshing',\r\n        'AISSearch2.nomyfleet': 'Service is unavailable',\r\n        'AISSearch2.auth': 'Authorization required',\r\n        'AISSearch2.vessel_info':'VESSEL INFORMATION',\r\n        'AISSearch2.vessel_voyage':'VOYAGE INFORMATION',\r\n        'AISSearch2.vessel_name': 'Name',\r\n        'AISSearch2.mmsi': 'MMSI',\r\n        'AISSearch2.imo': 'IMO',\r\n        'AISSearch2.flag_country': 'Flag',\r\n        'AISSearch2.vessel_type': 'Vessel type',\r\n        'AISSearch2.flag': 'Flag',\r\n        'AISSearch2.callsign': 'Callsign',\r\n        'AISSearch2.length': 'Length',\r\n        'AISSearch2.width': 'Width',\r\n        'AISSearch2.draught': 'Draught',\r\n        'AISSearch2.destination': 'Destination',\r\n        'AISSearch2.eta': 'ETA',\r\n        'AISSearch2.nav_status': 'Navigation status',\r\n        'AISSearch2.last_sig': 'Last signal',\r\n        'AISSearch2.show_track': 'show track',\r\n        'AISSearch2.hide_track': 'hide track',\r\n\t\t'AISSearch2.source': 'Source',\r\n\t\t'AISSearch2.sais': 'S-AIS',\r\n\t\t'AISSearch2.tais': 'T-AIS',\r\n\t\t'AISSearch2.lon': 'Longitude',\r\n\t\t'AISSearch2.lat': 'Latitude',\r\n\t\t'AISSearch2.historyTab': 'History',\r\n\t\t'AISSearch2.voyageInfo': 'Voyage Info',\r\n        'AISSearch2.DbSearchTab':'DATA BASE',\r\n        'AISSearch2.ScreenSearchTab':'VESSELS ON SCREEN',\r\n        'AISSearch2.MyFleetTab':'MY FLEET',\r\n        'AISSearch2.dailyTrack':'daily track',\r\n        'AISSearch2.allDailyTracks':'all tracks',\r\n        'AISSearch2.myFleetOnly':'my fleet only',\r\n        'AISSearch2.show_pos':'position and history',\r\n        'AISSearch2.show_info':'vessel data',\r\n        'AISSearch2.time_switch':'Time',\r\n        'AISSearch2.time_local':'Local',\r\n        'AISSearch2.legend_switch':'Vessel legend',\r\n        'AISSearch2.legend_type':'Type',\r\n        'AISSearch2.legend_speed':'Speed',\r\n        'AISSearch2.calendar_today':'today',\r\n        'AISSearh2.searchresults_view':'Results View of Vessel Search<br>by Name,IMO or MMSI',\r\n        'AISSearh2.myfleet_view':'List of Special Selected<br>Vessels<br>',       \r\n        'AISSearch2.dialog_tab_general':'General',\r\n        'AISSearch2.dialog_tab_params':'Parameters',\r\n        'AISSearch2.close_but':'close',\r\n        'AISSearch2.myfleet_add':'include in my fleet',\r\n        'AISSearch2.myfleet_remove':'exclude from my fleet' ,\r\n        'AISSearch2.infoscreen_gen':'General',\r\n        'AISSearch2.infoscreen_reg':'Register',\r\n        'AISSearch2.infoscreen_gal':'Gallery',\r\n        'AISSearch2.last_update':'Last update',   \r\n        'AISSearch2.reg_general_tab':'General',\r\n        'AISSearch2.reg_build_tab':'Building',\r\n        'AISSearch2.reg_chars_tab':'Specification',\r\n        'AISSearch2.reg_devs_tab':'Equipment',        \r\n        'AISSearch2.rmrs':'RMRS',\r\n        'AISSearch2.AddIntoGroup':'Add into group',\r\n        'AISSearch2.RemoveFromGroup':'Remove from group',        \r\n        'AISSearch2.AllGroup':'All',        \r\n        'AISSearch2.NewGroup':'New group',        \r\n        'AISSearch2.NewGroupName':'name',        \r\n        'AISSearch2.CreateGroup':'create',        \r\n        'AISSearch2.DeleteGroup':'delete group',       \r\n        'AISSearch2.DeleteGroupCommand':'Delete group',      \r\n        'AISSearch2.DisplaySection':'Display on map:',    \r\n        'AISSearch2.DisplayVesselName':'vessel name',    \r\n        'AISSearch2.DisplayGroupName':'group name',    \r\n        'AISSearch2.DisplayCog':'cog',    \r\n        'AISSearch2.DisplaySog':'sog',   \r\n        'AISSearch2.KnotShort':' kn',\r\n        'AISSearch2.thisVesselOnly':'Only this ship ',\r\n        'AISSearch2.allTracks':'all ships tracks ',\r\n        'AISSearch2.shipsTracks':'ships tracks ',\r\n        'AISSearch2.markerShadow':'Marker highlight',\r\n        'AISSearch2.labelColor':'Label color',\r\n        'AISSearch2.labelShadow':'Label highlight',\r\n        'AISSearch2.zoomin_com':'Zoom in',\r\n        'AISSearch2.zoomout_com':'Zoom out',\r\n        'AISSearch2.image1_com':'Image 1',\r\n        'AISSearch2.image2_com':'Image 2',\r\n        'AISSearch2.twoimages_com':'Two images',\r\n        'AISSearch2.close_com':'Close',\r\n        'AISSearch2.moving':'Moving',\r\n        'AISSearch2.standing':'Standing',\r\n        'AISSearch2.myFleetInclude': 'include in my fleet',\r\n        'AISSearch2.myFleetExclude': 'exclude from my fleet',\r\n        'AISSearch2.hideAisData': 'hide ais data',\r\n    });\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/locale.js","// Element.closest\r\n(function(proto) {\r\n    proto.matches = proto.matches || proto.mozMatchesSelector || proto.msMatchesSelector || proto.oMatchesSelector || proto.webkitMatchesSelector;\r\n    proto.closest = proto.closest || function closest(selector) {\r\n        if (!this) return null;\r\n        if (this.matches(selector)) return this;\r\n        if (!this.parentElement) {return null}\r\n        else return this.parentElement.closest(selector)\r\n      };\r\n}(Element.prototype));\r\n\r\n// Element.remove\r\n(function() {\r\n    var arr = [window.Element, window.CharacterData, window.DocumentType];\r\n    var args = [];\r\n  \r\n    arr.forEach(function (item) {\r\n      if (item) {\r\n        args.push(item.prototype);\r\n      }\r\n    });  \r\n    // from:https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/remove()/remove().md\r\n    (function (arr) {\r\n      arr.forEach(function (item) {\r\n        if (item.hasOwnProperty('remove')) {\r\n          return;\r\n        }\r\n        Object.defineProperty(item, 'remove', {\r\n          configurable: true,\r\n          enumerable: true,\r\n          writable: true,\r\n          value: function remove() {\r\n            this.parentNode && this.parentNode.removeChild(this);\r\n          }\r\n        });\r\n      });\r\n    })(args);\r\n  })();\r\n\r\n// Element.append, Document.append, DocumentFragment.append\r\n(function (arr) {\r\n  arr.forEach(function (item) {\r\n    if (item.hasOwnProperty('append')) {\r\n      return;\r\n    }\r\n    Object.defineProperty(item, 'append', {\r\n      configurable: true,\r\n      enumerable: true,\r\n      writable: true,\r\n      value: function append() {\r\n        var argArr = Array.prototype.slice.call(arguments),\r\n          docFrag = document.createDocumentFragment();\r\n        \r\n        argArr.forEach(function (argItem) {\r\n          var isNode = argItem instanceof Node;\r\n          docFrag.appendChild(isNode ? argItem : document.createTextNode(String(argItem)));\r\n        });\r\n        \r\n        this.appendChild(docFrag);\r\n      }\r\n    });\r\n  });\r\n})([Element.prototype, Document.prototype, DocumentFragment.prototype]);\r\n\r\n//NodeList.forEach\r\nNodeList.prototype[\"forEach\"] = NodeList.prototype[\"forEach\"] || Array.prototype[\"forEach\"];\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/Polyfill2.js","let PRODUCTION = false,\r\n    SIDEBAR2 = false;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\n\r\n\r\nmodule.exports = function (sidebarPane, viewFactory, withFooter) {\r\n    let _isReady = false,\r\n        _canvas = document.createElement('div'),\r\n        _activeView,\r\n        _views = viewFactory.create(),\r\n        _createFooter = function () { \r\n            let footer;\r\n            if (withFooter){           \r\n                footer = document.createElement('div');\r\n                footer.className = \"ais_panel_footer\";\r\n                $(_canvas).append(footer);\r\n            }\r\n            return footer;\r\n        },\r\n        _createTabs = function () {\r\n            let tabsTemplate = '<table class=\"ais_tabs\" border=0><tr>' +\r\n                '</td><td class=\"ais_tab myfleet_tab unselectable\" unselectable=\"on\">' + // ACTIVE\r\n                '<div>{{i \"AISSearch2.MyFleetTab\"}}</div>' +\r\n                '<td class=\"ais_tab dbsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.DbSearchTab\"}}</div>' +\r\n                '</td><td class=\"ais_tab scrsearch_tab unselectable\" unselectable=\"on\">' +\r\n                '<div>{{i \"AISSearch2.ScreenSearchTab\"}}</div>' +\r\n                '</td></tr></table>';\r\n\r\n            $(sidebarPane).append(_canvas);\r\n            $(_canvas).append(Handlebars.compile(tabsTemplate));\r\n            $(_canvas).append(_views.map(v => v.frame));\r\n    \r\n            let tabs = $('.ais_tab', _canvas); \r\n            tabs.on('click', function () {\r\n                if (!$(this).is('.active')) {\r\n                    let target = this;\r\n                    tabs.each(function (i, tab) {\r\n                        if (!$(tab).is('.active') && target == tab) {\r\n                            $(tab).addClass('active');\r\n                            _views[i].show();\r\n                            _activeView = _views[i];\r\n                        }\r\n                        else {\r\n                            $(tab).removeClass('active');\r\n                            _views[i].hide();\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n            return tabs;\r\n        },\r\n        _tabs = _createTabs(),\r\n        _footer = _createFooter(),\r\n        _returnInstance = {\r\n            get footer() {return _footer;},\r\n            set footer(element) { \r\n                if (_footer)\r\n                    _footer.append(element);\r\n            },\r\n            show: function () {\r\n                if (!_isReady)\r\n                {     \r\n                    _views.forEach((v,i) =>{\r\n                        v.tab = _tabs.eq(i);\r\n                        v.resize(true);\r\n                    }); \r\n                    // Show the first tab\r\n                    _tabs.eq(0).removeClass('active').click();\r\n                    // All has been done at first time\r\n                    _isReady = true;\r\n                }\r\n                else{           \r\n                    _activeView && _activeView.show(); \r\n                }\r\n            }\r\n        };\r\n    return _returnInstance;\r\n}\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/aisPluginPanel.js","const ScreenSearchView = require('./Views/ScreenSearchView'),\r\n    ScreenSearchModel = require('./Models/ScreenSearchModel'),\r\n    MyFleetView = require('./Views/MyFleetView'),\r\n    MyFleetModel = require('./Models/MyFleetModel'),\r\n    DbSearchView = require('./Views/DbSearchView'),\r\n    DbSearchModel = require('./Models/DbSearchModel'),\r\n    InfoDialogView = require('./Views/InfoDialogView'),\r\n    Searcher = require('./Search/Searcher'),\r\n    ViewCalendar = require('./Controls/Calendar');\r\n\r\nmodule.exports = function (options) {\r\n\r\n    const _tools = options.tools,\r\n          _daysLimit = 14,\r\n          _mapDateInterval = nsGmx.widgets.commonCalendar.getDateInterval();\r\n\r\n    const _viewCalendar1 = new ViewCalendar({id:'vc1', begin: _mapDateInterval.get('dateBegin'), end: _mapDateInterval.get('dateEnd'), daysLimit: _daysLimit}),\r\n          _viewCalendar2 = new ViewCalendar({id:'vc2', begin: _mapDateInterval.get('dateBegin'), end: _mapDateInterval.get('dateEnd'), daysLimit: _daysLimit});\r\n\r\n    _viewCalendar1.onChange = function(e){\r\n        _viewCalendar2.interval = e.interval;\r\n    }\r\n\r\n    _viewCalendar2.onChange = function(e){        \r\n        _viewCalendar1.interval = e.interval;\r\n    }    \r\n    ///////////////////////////////////////////////\r\n    \r\n    const _modulePath = options.modulePath,\r\n        _searcher = new Searcher(options),\r\n        _mfm = new MyFleetModel({aisLayerSearcher:_searcher, toolbox:_tools, modulePath: _modulePath}),\r\n        _ssm = new ScreenSearchModel({ aisLayerSearcher: _searcher, myFleetModel: _mfm, vesselLegend: options.vesselLegend }),\r\n        _dbsm = new DbSearchModel(_searcher),\r\n        _dbsv = new DbSearchView(_dbsm, options, _tools, _viewCalendar2),\r\n        _ssv = new ScreenSearchView(_ssm, _tools),\r\n        _mfv = new MyFleetView(_mfm, _tools, _viewCalendar1),\r\n        _idv = new InfoDialogView({\r\n            tools:_tools,\r\n            aisLayerSearcher: _searcher, \r\n            modulePath: _modulePath,\r\n            aisView: _dbsv, \r\n            myFleetView: _mfv,\r\n            menuId: options.menuId\r\n        });\r\n        _ssv.infoDialogView = _idv;\r\n        _mfv.infoDialogView = _idv;\r\n        _dbsv.infoDialogView = _idv;\r\n    return {\r\n        // get tools(){\r\n        //     return _tools;\r\n        // },\r\n        get infoDialogView(){\r\n            return _idv;\r\n        },\r\n        create: function () {\r\n            return [ _mfv, _dbsv, _ssv ];\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/ViewsFactory.js","const BaseView = require('./BaseView.js');\r\nlet _tools, _delayedRepaint;\r\nconst ScreenSearchView = function (model, tools) {\r\n    BaseView.apply(this, arguments);\r\n\r\n    _tools = tools;          \r\n    _tools.onLegendSwitched(((showAlternative)=>{\r\n        if (this.isActive) {    \r\n            this.model.data && this.model.data.vessels && this.repaint();\r\n            if (this.hideAisSwitch[0].checked)\r\n                _tools.hideAisData(true);\r\n        }\r\n        else{\r\n            _delayedRepaint = true;\r\n        }\r\n    }).bind(this));\r\n\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view screensearch_view\">' +\r\n\r\n        '<table border=0 class=\"instruments\">' +\r\n        //'<tr><td colspan=\"2\"><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filter\"}}\"/><i class=\"icon-flclose clicable\"></div></td></tr>'+\r\n        '<tr><td><div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filterName\"}}\"/>' +\r\n        '<div><img class=\"search clicable\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        '<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\">' +\r\n        '</div></div>' +\r\n        '</td></tr>' + \r\n\r\n        '<tr><td style=\"padding-top:0px\">' +'<label class=\"sync-switch switch hide_ais\" style=\"margin-left:5px\"><input type=\"checkbox\">'+\r\n        '<div class=\"sync-switch-slider switch-slider round\"></div></label>' + \r\n        '<span class=\"sync-switch-slider-description\" style=\"padding: 0;line-height:12px\">{{i \"AISSearch2.hideAisData\"}}</span>'+ \r\n        '<div>&nbsp;</div>'+\r\n        '</td></tr>' + \r\n\r\n        '</table>' +\r\n\r\n        '<table class=\"results\">'+\r\n        '<tr><td class=\"count\"></td>' +\r\n        '<td><div class=\"refresh clicable\" title=\"{{i \"AISSearch2.refresh\"}}\"><div>' + this.gifLoader + '</div></div></td></tr>' +\r\n        '<tr><td colspan=\"2\" style=\"padding:0px\"><div class=\"groups\"></div></td></tr>' +\r\n        '</table>'+\r\n        // '<table class=\"start_screen\"><tr><td>'+\r\n        // '<img src=\"plugins/AIS/AISSearch/svg/steer-weel.svg\">'+\r\n        // '<div>Здесь будут отображаться<br>результаты поиска</div></td></tr></table>'+\r\n        '<div class=\"ais_vessels\">'+\r\n        '<div class=\"ais_vessel\">' +\r\n        '<table border=0><tr><td><div class=\"position\">NO VESSELS</div><div>mmsi: 0 imo: 0</div></td>' +\r\n        '<td><i class=\"icon-ship\" vessel=\"\" title=\"\"></i></td>' +\r\n        '<td><span class=\"date\"></span></td>'+\r\n        '<td><div class=\"info\" vessel=\"aisjson this\" title=\"i AISSearch2.info\">' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n        '</div></td></tr></table>' +\r\n        '</div>' +       \r\n        '</div>' +\r\n        \r\n        '</div>'\r\n    )());\r\n    Object.defineProperty(this, \"topOffset\", {\r\n        get: function () {\r\n            let th = $('.ais_tabs')[0].getBoundingClientRect().height,\r\n            ih = this.frame.find('.instruments')[0].getBoundingClientRect().height,\r\n            rh = this.frame.find('.results')[0].getBoundingClientRect().height,\r\n            rv = th + ih + rh;\r\n            this.frame.find('.instruments').height(ih);\r\n            return rv;\r\n        }\r\n    });    \r\n    this.container = this.frame.find('.ais_vessels');\r\n    //this.startScreen = this.frame.find('.start_screen');\r\n    this.tableTemplate = '{{#each vessels}}' +\r\n        '<div class=\"ais_vessel\">' +\r\n        '<table border=0><tr><td><div class=\"position\">{{vessel_name}}</div><div>mmsi: {{mmsi}} imo: {{imo}}</div></td>' +       \r\n        '<td><img src=\"{{icon}}\" class=\"rotateimg{{icon_rot}} legend_icon\"><img src=\"{{iconAlt}}\" class=\"rotateimg{{icon_rot}} legend_iconalt\"></td>' +\r\n        \r\n        //'<td><i class=\"icon-ship\" vessel=\"{{aisinfoid this}}\" style=\"{{mf_member}}\" title=\"{{i \"AISSearch2.myFleetMember\"}}\"></i></td>' +\r\n        '<td><span vessel=\"{{aisinfoid this}}\" style=\"{{mf_member}}\" title=\"{{i \"AISSearch2.myFleetMember\"}}\">'+        \r\n        '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"14px\" height=\"14px\" viewBox=\"0 0 14 14\" xml:space=\"preserve\">' +\r\n        '<g style=\"fill: #48aff1;\">' +\r\n        '<path class=\"st0\" d=\"M13.4,11H0.6c-0.2,0-0.4,0.1-0.5,0.3c-0.1,0.2-0.1,0.4,0,0.6l1.2,1.8C1.4,13.9,1.6,14,1.8,14h9.9   c0.2,0,0.3-0.1,0.4-0.2l1.7-1.8c0.2-0.2,0.2-0.4,0.1-0.7C13.9,11.1,13.7,11,13.4,11z\"/>' +\r\n        '<path class=\"st0\" d=\"M9.3,9.7h2.9c0.2,0,0.4-0.1,0.5-0.3c0.1-0.2,0.1-0.4,0-0.6L9.8,4.5C9.7,4.3,9.4,4.2,9.2,4.3   C8.9,4.4,8.7,4.6,8.7,4.9v4.3C8.7,9.5,9,9.7,9.3,9.7z\"/>' +\r\n        '<path class=\"st0\" d=\"M1.2,9.7H7c0.3,0,0.6-0.3,0.6-0.6V0.6c0-0.3-0.2-0.5-0.4-0.6C6.9-0.1,6.7,0,6.5,0.3L0.7,8.8   C0.6,9,0.5,9.2,0.6,9.4C0.7,9.6,0.9,9.7,1.2,9.7z\"/>' +\r\n        '</g>' +\r\n        '</svg></span></td>'+\r\n        \r\n        '<td><span class=\"date\">{{ts_pos_utc}}</span></td>'+\r\n        '<td><div class=\"info\" vessel=\"{{aisjson this}}\" title=\"{{i \"AISSearch2.info\"}}\">' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/info.svg\">' +\r\n        '</div></td></tr></table>' +\r\n        '</div>' +\r\n        '{{/each}}' +\r\n        '{{#each msg}}<div class=\"msg\">{{txt}}</div>{{/each}}';\r\n\r\n    let cleanFilter = this.frame.find('.remove'),\r\n        filterReady = this.frame.find('.search'),\r\n        filterInput = this.frame.find('input'),\r\n        doFilter = function(){\r\n            this.model.setFilter(); \r\n        };\r\n        cleanFilter.click(function(e){\r\n            if (this.model.filterString === '')\r\n                return;\r\n            filterInput.val('');\r\n            this.model.filterString = '';  \r\n            filterReady.show();\r\n            cleanFilter.hide();\r\n            doFilter.call(this);\r\n            //nsGmx.leafletMap.removeLayer(highlight);\r\n        }.bind(this));\r\n        filterInput.keyup(function(e){            \r\n            let input = filterInput.val() || \"\";\r\n            input = input.replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n \r\n            if (input==this.model.filterString)// && e.keyCode!=13\r\n                return; \r\n\r\n            if (input==''){\r\n                filterReady.show();\r\n                cleanFilter.hide();\r\n                this.model.filterString = input;\r\n                doFilter.call(this);\r\n            }\r\n            else{\r\n                cleanFilter.show();\r\n                filterReady.hide();\r\n            }\r\n            this.model.filterString = input; \r\n            //if (e.keyCode==13){\r\n            if (e.keyCode!=13){\r\n                doFilter.call(this);\r\n                //nsGmx.leafletMap.removeLayer(highlight);\r\n            }\r\n            //}\r\n        }.bind(this))\r\n    \r\n    let needUpdate = function(){\r\n        this.model.isDirty = true;\r\n        if (this.isActive)\r\n            this.model.update();\r\n    };\r\n    nsGmx.leafletMap.on('moveend', needUpdate.bind(this));\r\n    nsGmx.widgets.commonCalendar.getDateInterval().on('change', needUpdate.bind(this));\r\n\r\n    this.hideAisSwitch = this.frame.find('.instruments .hide_ais  input[type=\"checkbox\"]');\r\n    this.hideAisSwitch.click((e=>{\r\n        _tools.hideAisData(e.currentTarget.checked);\r\n    }).bind(this));\r\n\r\n    \r\n    this.model.update(); //warm up\r\n\r\n};\r\n\r\nScreenSearchView.prototype = Object.create(BaseView.prototype);\r\n\r\nconst _clean = function () {\r\n    this.frame.find('.count').text(_gtxt('AISSearch2.found') + 0); \r\n},\r\n_switchLegendIcon = function(showAlternative){\r\n    let ic = this.frame.find('.legend_icon'),\r\n    ica = this.frame.find('.legend_iconalt');\r\n    if (showAlternative){\r\n        ic.hide(); ica.show();\r\n    }\r\n    else{\r\n        ica.hide(); ic.show();\r\n    }\r\n};\r\n\r\nScreenSearchView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div');\r\n    if (state)\r\n        progress.show();\r\n    else\r\n        progress.hide();\r\n};\r\n\r\nlet\r\n_firstRowsPos = 0,\r\n_firstRowsNum = 40,\r\n_firstRowsShift = 20,\r\n_setEventHandlers = function(){\r\n    let thisInst = this;\r\n    this.container.find('.info', ).on('click', function (e) {\r\n        let target = $(this),\r\n            vessel = JSON.parse(target.attr('vessel'))\r\n//console.log(vessel)\r\n        thisInst.infoDialogView && thisInst.infoDialogView.show(vessel, (v) => {\r\n//console.log(v)\r\n            vessel.xmin = vessel.xmax = v.longitude\r\n            vessel.ymin = vessel.ymax = v.latitude\r\n            if (vessel.hasOwnProperty('ts_pos_utc')) {\r\n                 vessel.ts_pos_utc = v.ts_pos_utc;\r\n                 vessel.ts_pos_org = v.ts_pos_org;\r\n                 v.dt_pos_utc && $(this).closest('tr').find('.date').html(v.dt_pos_utc);\r\n            }\r\n            target.attr('vessel', JSON.stringify(vessel))\r\n        });\r\n        e.stopPropagation();\r\n    });\r\n    this.container.find('.ais_vessel').on('click', function () {\r\n//console.log(JSON.parse($(this).find('.info').attr('vessel')))\r\n        let v = JSON.parse($(this).find('.info').attr('vessel'));                \r\n        v.lastPosition = true;\r\n        thisInst.infoDialogView.showPosition(v);\r\n    }); \r\n//console.log(\"repaint \"+(new Date()-start)+\"ms\" ) \r\n    this.frame.find('.show_groups').on('click', function () {\r\n        arrowHead = arrowHead == 'icon-down-open' ? 'icon-right-open': 'icon-down-open';\r\n        this.repaint();\r\n    }.bind(this));     \r\n}\r\n\r\nlet arrowHead = 'icon-down-open';\r\nScreenSearchView.prototype.repaint = function () {\r\n    if (!this.isActive){\r\n        _delayedRepaint = true;\r\n        return;\r\n    }\r\n\r\n    _delayedRepaint = false;\r\n//let startRep = new Date();\r\n//console.log(\"REPAINT\")\r\n    //_clean.call(this);\r\n    this.frame.find('.count').html('<div class=\"show_groups clicable ui-helper-noselect ' + arrowHead + '\" ' +\r\n    'style=\"margin-right:5px;display:inline\"></div>' + \r\n    _gtxt('AISSearch2.found') + this.model.data.vessels.length); \r\n    //BaseView.prototype.repaint.apply(this, arguments);\r\n\r\n    this.frame.find('.groups')[0].innerHTML = '';\r\n    if (this.model.data.groups && this.model.data.groups.length && arrowHead == 'icon-down-open')\r\n        this.frame.find('.groups')[0].innerHTML = (Handlebars.compile('<table>' +\r\n            '{{#each groups}}' +\r\n            '<tr><td><img src=\"{{url}}\" style=\"width:20px;height:20px\"></td><td><div class=\"group_name\">{{name}}</div></td><td>{{count}}</td></tr>' +\r\n            '{{/each}}' +\r\n            '</table>')({groups: !_tools.needAltLegend ? this.model.data.groups :  this.model.data.groupsAlt}));\r\n        \r\n    BaseView.prototype.resize.apply(this, arguments);   \r\n     \r\n    ////////////////////////////////////////////////////\r\n    this.container.find('.info').off('click');\r\n    this.container.find('.ais_vessel', ).off('click');   \r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n    if (!this.model.data)\r\n        return;\r\n\r\n    let thisInst = this,\r\n        tempFirst = this.model.data.vessels.slice(0, _firstRowsNum),\r\n        content = $(Handlebars.compile(this.tableTemplate)({msg:this.model.data.msg, vessels:tempFirst})),\r\n        mcsTopPctPrev = 0,\r\n        rowH;\r\n    _firstRowsPos = _firstRowsNum;\r\n\r\n    if (!scrollCont[0]) {\r\n        this.container.mCustomScrollbar(\"destroy\").append(content).mCustomScrollbar({\r\n            //scrollInertia: 0,//this.model.data.vessels.length > _firstRowsNum ? 0 : 600,\r\n            callbacks:{\r\n                onScroll:function(){                    \r\n                    thisInst.scroledPx = this.mcs.top;\r\n                    //console.log(\"onScroll \" + this.mcs.top + \" \" + thisInst.container.is(':visible'));\r\n                },\r\n                whileScrolling: /*scrollingHandler*/function(){                     \r\n//console.log(\"whileScrolling \" + this.mcs.top + \"px \" + thisInst.container.is(':visible')+\" ss \"+thisInst.startShow)                  \r\n//console.log(\"% \" + this.mcs.topPct + \" pos\" + _firstRowsPos)\r\n                    if (thisInst.startShow && this.mcs.top == 0){\r\n                        return;\r\n                    }\r\n                    else\r\n                    thisInst.startShow = false;\r\n                        \r\n                    if (this.mcs.topPct==100 && mcsTopPctPrev != 100 && thisInst.model.data.vessels.length > _firstRowsPos){\r\n                        let start = _firstRowsPos - _firstRowsNum + _firstRowsShift,\r\n                            end = _firstRowsPos + _firstRowsShift;\r\n                        if (thisInst.model.data.vessels.length-start <= thisInst.container.height()/rowH)\r\n                            start = thisInst.model.data.vessels.length - _firstRowsNum;\r\n///console.log(\">\"+start+\", \"+end)\r\n                        tempFirst = thisInst.model.data.vessels.slice(start, end),\r\n                        _firstRowsPos += _firstRowsShift;                       \r\n                        let scrollCont = thisInst.container.find('.mCSB_container');\r\n                        scrollCont.html(Handlebars.compile(thisInst.tableTemplate)({vessels:tempFirst}));  \r\n//console.log(\"h=\"+rowH) \r\n                        setTimeout(()=>{\r\n                            thisInst.scroledPx = -rowH * _firstRowsShift + thisInst.container.height();\r\n                            thisInst.container.mCustomScrollbar(\"scrollTo\",\r\n                            thisInst.scroledPx, {\r\n                                    scrollInertia: 0,\r\n                                    callbacks: false\r\n                            });\r\n                            _setEventHandlers.call(thisInst);\r\n                        }, 200);\r\n                        _switchLegendIcon.call(thisInst, _tools.needAltLegend);\r\n                    }\r\n                    if (this.mcs.topPct == 0 && mcsTopPctPrev != 0 && _firstRowsPos > _firstRowsNum) {\r\n//console.log(_firstRowsPos)\r\n                        let start = _firstRowsPos - _firstRowsShift - _firstRowsNum,\r\n                            end = _firstRowsPos - _firstRowsShift;\r\n//console.log(\"<\"+start + \", \" + end)\r\n                        tempFirst = thisInst.model.data.vessels.slice(start, end),\r\n                        _firstRowsPos -= _firstRowsShift;                       \r\n                        let scrollCont = thisInst.container.find('.mCSB_container');\r\n                        scrollCont.html(Handlebars.compile(thisInst.tableTemplate)({ vessels: tempFirst })); \r\n//console.log(\"h=\"+rowH)\r\n                        setTimeout(() => {\r\n                            thisInst.scroledPx = rowH * _firstRowsShift;\r\n                            thisInst.container.mCustomScrollbar(\"scrollTo\",\r\n                                thisInst.scroledPx, {\r\n                                    scrollInertia: 0,\r\n                                    callbacks: false\r\n                                }\r\n                            );\r\n                            _setEventHandlers.call(thisInst);\r\n                        }, 200);\r\n                        _switchLegendIcon.call(thisInst, _tools.needAltLegend);\r\n                    }\r\n                    mcsTopPctPrev = this.mcs.topPct;\r\n                }\r\n            }\r\n        });\r\n        scrollCont = this.container.find('.mCSB_container');\r\n        rowH = scrollCont.height()/$('.ais_vessel', scrollCont).length;\r\n    }\r\n    else {\r\n        scrollCont.append(content);\r\n        this.container.mCustomScrollbar(\"scrollTo\", \"top\", {scrollInertia:0, callbacks:false, timeout:200});\r\n    }\r\n    _setEventHandlers.call(this);  \r\n    _switchLegendIcon.call(this, _tools.needAltLegend);\r\n//console.log((new Date().getTime()-startRep)/1000)\r\n};\r\n\r\nScreenSearchView.prototype.show = function () {\r\n    this.startShow = true;\r\n    BaseView.prototype.show.apply(this, arguments);\r\n\r\n    if (_delayedRepaint && !this.model.isDirty)\r\n        this.repaint();\r\n\r\n    this.frame.find('.filter input').focus();\r\n\r\n    if (this.scroledPx) {\r\n        this.container.mCustomScrollbar(\"scrollTo\",\r\n            this.scroledPx, { scrollInertia: 0, callbacks: false }\r\n        );\r\n    }  \r\n    \r\n    _tools.hideAisData(this.hideAisSwitch[0].checked);\r\n};\r\nScreenSearchView.prototype.hide = function () {\r\n    if (!this.isActive)\r\n        return;\r\n    _tools.hideAisData(false);\r\n    BaseView.prototype.hide.call(this);\r\n};\r\n\r\nmodule.exports = ScreenSearchView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/ScreenSearchView.js","let PRODUCTION = false,\r\n    SIDEBAR2 = false;\r\nif (has('SIDEBAR2'))\r\n    SIDEBAR2 = true;\r\nif (has('PRODUCTION'))\r\n    PRODUCTION = true;\r\n\r\nlet _calcHeight = function () {  \r\n    return $('.iconSidebarControl-pane').height() - \r\n    ($('.ais_panel_footer')[0]?$('.ais_panel_footer').height():0)\r\n    - this.topOffset;\r\n};\r\n\r\nlet _tools;\r\nconst BaseView = function (model, tools) {\r\n    model.view = this;\r\n    this.model = model;\r\n    this.gifLoader = '<img src=\"img/progress.gif\">';\r\n    _tools = tools;\r\n};\r\n\r\nlet _clean = function(){ \r\n    this.container.find('.info').off('click');\r\n    this.container.find('.position', ).off('click');   \r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n//console.log(\"EMPTY ON BASE.CLEAN\")\r\n};\r\n\r\nBaseView.prototype = function () {\r\n    return {\r\n        get isActive(){\r\n            return this.frame.is(\":visible\");\r\n        },\r\n        resize: function (clean) {\r\n            if (clean){\r\n                this.container.empty()\r\n            }\r\n            let h = _calcHeight.call(this);\r\n            if (this.startScreen && $('.iconSidebarControl-pane:visible')[0]){\r\n                let bb = $('.iconSidebarControl-pane:visible')[0].getBoundingClientRect();\r\n                this.startScreen.css({ position:\"absolute\", left: bb.left+\"px\", top: (bb.height/2-50)+\"px\", \r\n                width: bb.width+\"px\"});\r\n            }\r\n            this.container.height(h);\r\n        },\r\n        repaint: function(){\r\n            _clean.call(this);            \r\n//console.log(this.model.data)\r\n            if (!this.model.data)\r\n                return;\r\n            let scrollCont = this.container.find('.mCSB_container'),\r\n            content = $(Handlebars.compile(this.tableTemplate)(this.model.data));\r\n            if (!scrollCont[0]) {\r\n                this.container.append(content).mCustomScrollbar();\r\n            }\r\n            else {\r\n                $(scrollCont).append(content);\r\n            }\r\n\r\n            var _this = this;\r\n            this.container.find('.info').on('click', function (e) {\r\n                let target = $(this),\r\n                    vessel = JSON.parse(target.attr('vessel'))\r\n//console.log(vessel)\r\n                _this.infoDialogView && _this.infoDialogView.show(vessel, (v) => {\r\n//console.log(v)\r\n                    vessel.xmin = vessel.xmax = v.longitude\r\n                    vessel.ymin = vessel.ymax = v.latitude\r\n                    if (vessel.hasOwnProperty('ts_pos_utc')) {\r\n                         vessel.ts_pos_utc = v.ts_pos_utc;\r\n                         vessel.ts_pos_org = v.ts_pos_org;\r\n                         v.dt_pos_utc && $(this).closest('tr').find('.date').html(v.dt_pos_utc);\r\n                    }\r\n                    target.attr('vessel', JSON.stringify(vessel))\r\n                });\r\n                e.stopPropagation();\r\n            });\r\n            this.container.find('.ais_vessel').on('click', function () {\r\n                let v = JSON.parse($(this).find('.info').attr('vessel'));                \r\n                v.lastPosition = true;\r\n                v.xmax = null;\r\n                v.xmin = null;\r\n                v.ymax = null;\r\n                v.ymin = null;\r\n                _this.infoDialogView.showPosition(v);\r\n            });      \r\n        },\r\n        show: function () {\r\n            _tools.restoreDefault();\r\n            this.frame.show();\r\n            this.model.update();\r\n        },\r\n        hide: function () {\r\n            this.frame.hide();\r\n        }\r\n    }\r\n}();\r\n\r\nmodule.exports = BaseView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/BaseView.js","let _actualUpdate,\r\n_myFleetModel,\r\n_aisLayerSearcher,\r\n_vesselLegend;\r\n\r\nconst ScreenSearchModel = function ({aisLayerSearcher, myFleetModel, vesselLegend}) {\r\n\r\n    let thisInstance = this;\r\n    myFleetModel.onChanged = function(){\r\n        thisInstance.isDirty = true;\r\n        if (thisInstance.view.isActive)\r\n            thisInstance.update();\r\n    };\r\n    _aisLayerSearcher = aisLayerSearcher;\r\n    _myFleetModel = myFleetModel;\r\n    _vesselLegend = vesselLegend;\r\n    //this.filterString = \"\";\r\n    this.isDirty = true;\r\n};\r\n\r\nlet _filterString = '';\r\nObject.defineProperty(ScreenSearchModel.prototype, \"filterString\", {\r\n    get() {\r\n        return _filterString;\r\n    },\r\n    set(v) {\r\n        _filterString = v;\r\n    }\r\n});\r\n\r\nlet _filterPromise;\r\nScreenSearchModel.prototype.setFilter = function (s) {        \r\n    this.view.inProgress(true);  \r\n    if (this.filterString=='')\r\n    {\r\n        this.data.vessels = this.dataSrc.vessels.map(v=>v);\r\n        this.data.groups = this.dataSrc.groups.map(g=>g)\r\n        this.data.groupsAlt = this.dataSrc.groupsAlt.map(g=>g);\r\n        \r\n        this.sortData();\r\n        this.view.inProgress(false);\r\n        this.view.repaint(); \r\n    }\r\n    else{\r\n        const thisModel = this;\r\n        if (_filterPromise)\r\n            _filterPromise.cancel = true; \r\n        _filterPromise = {\r\n            cancel: false, \r\n            run: function(){\r\n                const inst=this; \r\n                return new Promise(function(rs, rj){\r\n                    setTimeout( function(){\r\n                        if (inst.cancel || !thisModel.data)\r\n                            rj(0);\r\n                        thisModel.data.vessels = [], thisModel.data.groups = [], thisModel.data.groupsAlt = [];\r\n                        const filter = new RegExp(`^${thisModel.filterString}| ${thisModel.filterString}`, \"ig\");\r\n//console.log(`[${filter}]`);\r\n                        let icons = {}, setGroups = function(ic, a){\r\n                                if (icons[ic.name]==undefined){\r\n                                    icons[ic.name] = a.length;\r\n                                    a.push({ url: ic.url, name: ic.name, count: 1})\r\n                                }\r\n                                else\r\n                                    a[icons[ic.name]].count = a[icons[ic.name]].count + 1;\r\n                        };\r\n\r\n                        const a = thisModel.dataSrc.vessels;\r\n                        for (var i=0, v; i<a.length; ++i){\r\n                            if (inst.cancel) rj(0);\r\n                            v=a[i];\r\n                            if (v.vessel_name.search(filter)>-1){\r\n                                thisModel.data.vessels.push(v);\r\n                                let ic = _vesselLegend.getIcon(v.vessel_type, 1);\r\n                                setGroups(ic, thisModel.data.groups);\r\n                                ic = _vesselLegend.getIconAlt(v.vessel_, parseInt(v.sog));\r\n                                setGroups(ic, thisModel.data.groupsAlt);\r\n                            }\r\n                        }\r\n                        if (inst.cancel) rj(0);\r\n\r\n                        rs(thisModel.filterString);\r\n                    }, 500);\r\n                });\r\n            }\r\n        };\r\n        _filterPromise.run().then(function(r){\r\n//console.log(`<${r}>`);\r\n            thisModel.sortData();\r\n            thisModel.view.inProgress(false);\r\n            thisModel.view.repaint(); \r\n        }, ()=>{});\r\n\r\n        // this.data.vessels = [], this.data.groups = [], this.data.groupsAlt = [];\r\n        // const filter = new RegExp(`^${this.filterString}| ${this.filterString}`, \"ig\");\r\n        // let icons = {}, setGroups = function(ic, a){\r\n        //         if (icons[ic.name]==undefined){\r\n        //             icons[ic.name] = a.length;\r\n        //             a.push({ url: ic.url, name: ic.name, count: 1})\r\n        //         }\r\n        //         else\r\n        //             a[icons[ic.name]].count = a[icons[ic.name]].count + 1;\r\n        // };\r\n        // this.dataSrc.vessels.forEach(v=>{\r\n        //     if (v.vessel_name.search(filter)>-1){\r\n        //         this.data.vessels.push(v);\r\n        //         let ic = _vesselLegend.getIcon(v.vessel_type, 1);\r\n        //         setGroups(ic, this.data.groups);\r\n        //         ic = _vesselLegend.getIconAlt(v.vessel_, parseInt(v.sog));\r\n        //         setGroups(ic, this.data.groupsAlt);\r\n        //     }\r\n        // });\r\n        // this.sortData();\r\n        // this.view.inProgress(false);\r\n        // this.view.repaint(); \r\n    }\r\n};\r\n\r\nScreenSearchModel.prototype.load = function (actualUpdate) {\r\n    if (!this.isDirty)\r\n        return Promise.resolve();\r\n\r\n    let thisInst = this;\r\n    let s = new Date();\r\n    return Promise.all([\r\n        new Promise(function (resolve, reject) {\r\n            _aisLayerSearcher.searchScreen({\r\n                dateInterval: nsGmx.widgets.commonCalendar.getDateInterval(),\r\n                border: true,\r\n                group: true\r\n            }, function (json) {\r\n//console.log(\"RECEIVED \"+((new Date()-s)/1000));\r\n                if (json.Status.toLowerCase() == \"ok\") {\r\n//console.log(json.Result.elapsed);\r\n                    s = new Date();\r\n\r\n                    // thisInst.filterString = thisInst.filterString.replace(/\\r+$/, \"\"); !!!!!!TO DO FILTER\r\n\r\n                    thisInst.dataSrc = {\r\n                        vessels: json.Result.values.map(function (v) {\r\n                            let d = new Date(v[12]),//nsGmx.widgets.commonCalendar.getDateInterval().get('dateBegin'),\r\n                            vessel = {\r\n                                vessel_name: v[0], mmsi: v[1], imo: v[2], mf_member: 'visibility:hidden', \r\n                                ts_pos_utc: _aisLayerSearcher.formatDate(d), ts_pos_org: Math.floor(d.getTime()/1000),\r\n                                xmin: v[4], xmax: v[5], ymin: v[6], ymax: v[7], maxid: v[3],\r\n                                vessel_type: v[8], sog: v[9], cog: v[10], heading: v[11]\r\n                            };\r\n                            //if (_myFleetModel.findIndex(vessel)>=0)\r\n                            //    vessel.mf_member = \"visibility:visible\";\r\n                            vessel.icon_rot = Math.round(vessel.cog/15)*15;\r\n                            _aisLayerSearcher.placeVesselTypeIcon(vessel);\r\n                            return vessel;\r\n                        }),\r\n                        groups: [], \r\n                        groupsAlt: []\r\n                    };\r\n\r\n                    thisInst.data = { groups: [], groupsAlt: [] }; \r\n                    for (let k in json.Result.groups){\r\n                        let ic = _vesselLegend.getIcon(k, 1)\r\n                        thisInst.data.groups.push({ url: ic.url, name: ic.name, count: json.Result.groups[k]});\r\n                    }\r\n                    for (let k in json.Result.groupsAlt){\r\n                        if (!isNaN(k)){\r\n                            let ic = _vesselLegend.getIconAlt(\"ABC\", parseInt(k))\r\n                            if (ic)\r\n                                thisInst.data.groupsAlt.push({ url: ic.url, name: ic.name, count: json.Result.groupsAlt[k]});\r\n                        }\r\n                    }\r\n                    thisInst.dataSrc.groups = thisInst.data.groups.map(g=>g)\r\n                    thisInst.dataSrc.groupsAlt = thisInst.data.groupsAlt.map(g=>g)\r\n\r\n//console.log((\"MAP \"+((new Date()-s)/1000)))\r\n                    if (_actualUpdate == actualUpdate) {\r\n                        //console.log(\"ALL CLEAN\")\r\n                        //console.log(\"1>\"+new Date(thisInst._actualUpdate))\r\n                        //console.log(\"2>\"+new Date(actualUpdate))\r\n                        thisInst.isDirty = false;\r\n                    }\r\n                    resolve();\r\n                }\r\n                else {\r\n                    reject(json);\r\n                }\r\n            });\r\n        })\r\n        , _myFleetModel.load()\r\n    ]);\r\n};\r\n\r\nScreenSearchModel.prototype.sortData = function () {\r\n        let sortGrups = function(a, b) {\r\n            return b.count - a.count;\r\n          }\r\n        this.data.groups.sort(sortGrups);\r\n        this.data.groupsAlt.sort(sortGrups);\r\n        // let sortNames = (a,b)=>{\r\n        //     if (a.vessel_name == b.vessel_name)\r\n        //         return 0;\r\n        //     else\r\n        //         return a.vessel_name > b.vessel_name ? 1 : -1;\r\n        // };  \r\n        // this.data.vessels.sort((a,b)=>{\r\n        //     let a_member = _myFleetModel.findIndex(a)>=0,\r\n        //         b_member = _myFleetModel.findIndex(b)>=0;\r\n        //     if (a_member)\r\n        //         a.mf_member = \"visibility:visible\";\r\n        //     if (b_member)\r\n        //         b.mf_member = \"visibility:visible\";\r\n        //     if ((!a_member && !b_member) || (a_member && b_member))\r\n        //         return 0; //sortNames(a,b);\r\n        //     else if (a_member && !b_member)\r\n        //         return -1;\r\n        //     else if (!a_member && b_member)\r\n        //         return 1;\r\n        // });\r\n};\r\nScreenSearchModel.prototype.update = function () {\r\n    if (!this.isDirty)\r\n        return;\r\n    _actualUpdate = new Date().getTime();\r\n    let thisInst = this,\r\n        actualUpdate = _actualUpdate;\r\n    this.view.inProgress(true);       \r\n\r\nlet s = new Date()\r\n    this.load(actualUpdate).then(function () {\r\n        if (_actualUpdate == actualUpdate) {\r\n            if (thisInst.dataSrc)\r\n                _myFleetModel.markMembers(thisInst.dataSrc.vessels);  \r\n            if (thisInst.filterString!=''){\r\n                thisInst.setFilter();\r\n            }\r\n            else{                \r\n                thisInst.data.vessels = thisInst.dataSrc.vessels;\r\n                \r\n                thisInst.sortData();         \r\n                thisInst.view.inProgress(false);\r\n                thisInst.view.repaint(); \r\n            }\r\n        }\r\n    }, function (json) {\r\n        thisInst.dataSrc = null;\r\n//console.logconsole.log(json)\r\n        if (json.Status.toLowerCase() == \"auth\" ||\r\n            (json.ErrorInfo && json.ErrorInfo.some && json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })))\r\n            thisInst.data = { msg: [{ txt: _gtxt(\"AISSearch2.auth\") }], vessels: [] };\r\n        else {\r\n            //thisInst.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n            console.log(json);\r\n        }\r\n        thisInst.view.inProgress(false);\r\n        thisInst.view.repaint();\r\n    });\r\n};\r\n\r\nmodule.exports = ScreenSearchModel;\n\n\n// WEBPACK FOOTER //\n// ./src/Models/ScreenSearchModel.js","require(\"./MyFleet.css\")\r\nconst BaseView = require('./BaseView.js');\r\nconst GroupList = require('../Controls/GroupList.js');\r\n\r\nconst _switchLegendIcon = function(showAlternative){\r\n    let ic = this.frame.find('.legend_icon'),\r\n    ica = this.frame.find('.legend_iconalt');\r\n    if (showAlternative){\r\n        ic.hide(); //ica.show();\r\n        ica.each( (i,e)=>e.style.display=\"\");\r\n    }\r\n    else{\r\n        ica.hide(); //ic.show();\r\n        ic.each( (i,e)=>e.style.display=\"\");\r\n    }\r\n},\r\n_clean = function(){  \r\n    this.frame.find('.ais_vessels input[type=\"checkbox\"]').off('click');    \r\n    this.startScreen.css({ visibility: \"hidden\" });\r\n};\r\n\r\nlet _tools, \r\n_displayedOnly=[], \r\n_notDisplayed=[],\r\n_saveLabelSettingsPromise = Promise.resolve(0),\r\n_viewState = {   \r\n    get isViewActive(){return !!this.view.isActive;},\r\n    get displayedOnly(){return _displayedOnly;},\r\n    get notDisplayed(){return _notDisplayed;},\r\n    showTracks: function(trackBuilder, needAlt){\r\n        trackBuilder.showMyFleetTracks(_displayedOnly, needAlt);\r\n    },\r\n    hideTracks: function(trackBuilder, needAlt){\r\n        trackBuilder.hideMyFleetTracks(_notDisplayed, needAlt);\r\n    },\r\n    cleanTracks: function(trackBuilder, needAlt){\r\n        trackBuilder.cleanMyFleetTracks();\r\n    }\r\n};\r\n\r\nconst MyFleetView = function (model, tools, viewCalendar){\r\n    BaseView.apply(this, arguments);\r\n    _viewState.view = this;\r\n    _tools = tools; \r\n    _tools.onLegendSwitched(((showAlternative)=>{\r\n        _switchLegendIcon.call(this, _tools.needAltLegend);\r\n    }).bind(this));\r\n\r\n    let settings = []; //DEFAULT SETTINGS\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view myfleet_view\">' +\r\n    '<table class=\"instruments\">'+\r\n    '<tr><td style=\"vertical-align:top; padding-right:0\">'+\r\n\r\n    '<div style=\"width:140px; margin-bottom: 8px;\">{{i \"AISSearch2.DisplaySection\"}}</div>' +\r\n\r\n        '<div style=\"margin-bottom: 5px;\"><label class=\"sync-switch switch only_myflot\"><input type=\"checkbox\">'+\r\n        '<div class=\"sync-switch-slider switch-slider round\"></div></label>' +\r\n        '<span class=\"sync-switch-slider-description\">{{i \"AISSearch2.myFleetOnly\"}}</span></div>'+  \r\n\r\n        '<label class=\"sync-switch switch all_tracks\"><input type=\"checkbox\">'+\r\n        '<div class=\"sync-switch-slider switch-slider round\"></div></label>' +\r\n        '<span class=\"sync-switch-slider-description\" >{{i \"AISSearch2.shipsTracks\"}}</span>'+ \r\n            \r\n    '</td>' +\r\n\r\n    '<td style=\"padding-right:0\">' +\r\n    '<div style=\"width:120px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"group_name\" ' + (settings.indexOf('group_name')<0?'':'checked') + '>{{i \"AISSearch2.DisplayGroupName\"}}</div>' +\r\n    '<div style=\"width:120px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"vessel_name\" ' + (settings.indexOf('vessel_name')<0?'':'checked') + '>{{i \"AISSearch2.DisplayVesselName\"}}</label></div>' +\r\n    '<div style=\"width:70px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"sog\" ' + (settings.indexOf('sog')<0?'':'checked') + '>{{i \"AISSearch2.DisplaySog\"}}</label></div>' +\r\n    '<div style=\"width:45px;float:left;\" class=\"setting\"><label><input type=\"checkbox\" id=\"cog\" ' + (settings.indexOf('cog')<0?'':'checked') + '>{{i \"AISSearch2.DisplayCog\"}}</label></div>' +\r\n    '</td>' +\r\n    '<td><div class=\"refresh\"><div>' + this.gifLoader + '</div></div></td></tr>' +\r\n\r\n    '<tr><td colspan=\"3\" style=\"padding-top:0; padding-bottom:5px\">' +\r\n    '<table class=\"newgroup\"><tr><td>{{i \"AISSearch2.NewGroup\"}}</td>' +\r\n    '<td><div class=\"newgroupname\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.NewGroupName\"}}\"/></div></td>' +\r\n    '<td><img class=\"create clicable\" title=\"{{i \"AISSearch2.CreateGroup\"}}\" src=\"plugins/AIS/AISSearch/svg/add.svg\"></td>' +\r\n    '</tr></table>' +\r\n    '</td></tr>' +\r\n\r\n    '<tr><td colspan=\"2\"><style>' + \r\n    '#ui-datepicker-div .ui-datepicker-next {height: 1.8em !important;}' +\r\n    '#ui-datepicker-div .ui-datepicker-next span.ui-icon.ui-icon-circle-triangle-e {background: url(img/arrows.png) no-repeat 0 -18px !important;}' +\r\n    '#ui-datepicker-div .ui-datepicker-next.ui-state-hover span.ui-icon.ui-icon-circle-triangle-e {background: url(img/arrows.png) no-repeat 0 -38px !important;}' +\r\n    '</style><div class=\"calendar\"></div></td>' +\r\n    '<td style=\"vertical-align:top;\"><div class=\"clicable\" title=\"{{i \"AISSearch2.refresh\"}}\">' +\r\n    //'<div class=\"progress\">' + this.gifLoader + '</div>' +\r\n    '<div class=\"reload\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"#2f3c47\" d=\"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z\"/></svg></div>' +\r\n    '</div></td></tr>' +\r\n\r\n\r\n    '</table>'+ \r\n\r\n    '<div class=\"ais_vessels\">'+\r\n    '<table class=\"results\">'+\r\n    '<td><input type=\"checkbox\" checked></td>' +\r\n    '<td class=\"count\"></td></tr></table>'+\r\n    '<div class=\"ais_vessel\">' +\r\n    '<table border=0><tr>' +\r\n    '<td><input type=\"checkbox\" checked></td>' +\r\n    '<td><div class=\"position\">vessel_name</div><div>mmsi: mmsi imo: imo</div></td>' +\r\n    '<td></td>' +  \r\n    '<td><span class=\"date\">ts_pos_utc</span></td>'+\r\n\r\n    '</tr></table>' +\r\n    '</div>' +      \r\n    '</div>' +\r\n\r\n    '<table class=\"start_screen\"><tr><td>' +\r\n    '<img src=\"plugins/AIS/AISSearch/svg/steer-weel.svg\">' +\r\n    '<div>{{{i \"AISSearh2.myfleet_view\"}}}' +\r\n    '</div></td></tr></table>' +\r\n\r\n    '</div>')());    \r\n\r\n    this.calendar = viewCalendar;\r\n    this.frame.find('.calendar').append(this.calendar.el);\r\n    this.model.historyInterval = { dateBegin: this.calendar.begin, dateEnd: this.calendar.end };\r\n\r\n    const reloadTrack = function(){\r\n        if (!this.displayTracks)\r\n            return;                  \r\n        this.inProgress(true); \r\n        this.model.loadTracks(this.infoDialogView, _viewState);\r\n    };\r\n\r\n    this.calendar.onChange = function (e) {  \r\n        this.model.historyInterval = {dateBegin: e.interval.begin, dateEnd: e.interval.end};   \r\n//console.log('myfleet.historyInterval', this.model.historyInterval)               \r\n        if (this.isActive)\r\n            nsGmx.widgets.commonCalendar.setDateInterval(e.interval.begin, e.interval.end);\r\n        reloadTrack.call(this);\r\n    }.bind(this)\r\n\r\n    \r\n    this.frame.find('.reload').on('click', reloadTrack.bind(this));\r\n\r\n    \r\n    Object.defineProperty(this, \"displayTracks\", {\r\n        get: function () {\r\n            const showTracsCtrl = this.frame.find('.instruments .switch.all_tracks input[type=\"checkbox\"]')[0];\r\n            return showTracsCtrl.checked;\r\n        }\r\n    }); \r\n\r\n    Object.defineProperty(this, \"topOffset\", {\r\n        get: function () {\r\n            let th = $('.ais_tabs')[0].getBoundingClientRect().height,\r\n            ih = this.frame.find('.instruments')[0].getBoundingClientRect().height,\r\n            rv = th + ih;\r\n            this.frame.find('.instruments').height(ih);\r\n            return rv;\r\n        }\r\n    });  \r\n\r\n    this.container = this.frame.find('.ais_vessels');     \r\n    this.startScreen = this.frame.find('.start_screen');\r\n    \r\n    // craete group controller\r\n    let newGroupNameValid = function(ngn){\r\n        let isValid = ngn.search(/\\S/)!=-1;\r\n        this.model.data.groups.forEach(g=>{\r\n            if (isValid)\r\n                isValid = g.title!=ngn;\r\n        });\r\n        return isValid;\r\n    },\r\n    createGroup = function(ngn){\r\n        if (newGroupNameValid.call(this, ngn)){\r\n            this.inProgress(true);\r\n            this.model.createGroup(ngn)\r\n            .then((group)=>{\r\n                this.groupList.appendGroup(group, this.model.data.groups.length-1);\r\n                this.inProgress(false);\r\n            },\r\n            (error)=>{\r\n                this.inProgress(false);\r\n                console.log(error)\r\n            }\r\n            );\r\n        }        \r\n    };\r\n    this.frame.find('.instruments .create').on(\"click\", (e=>{\r\n        let input = this.frame.find('.instruments .newgroupname input'),\r\n        ngn = input.val();\r\n        input.val('');\r\n        createGroup.call(this, ngn);\r\n    }).bind(this))\r\n    this.frame.find('.instruments .newgroupname input').on(\"keyup\", (e=>{\r\n        let ngn = e.target.value;\r\n        if (e.keyCode==13){\r\n            e.target.value = '';\r\n            createGroup.call(this, ngn);\r\n        }\r\n    }).bind(this)); \r\n\r\n    // marker settings\r\n    this.frame.find('.instruments .setting input')\r\n    .on('change', (e=>{\r\n        let display = '';\r\n        this.frame.find('.instruments .setting input').each((i, e)=>{\r\n            if (e.checked)\r\n                display += \"{{{\" + e.id + \"}}}\";\r\n        });\r\n        if (display=='')\r\n            display = '{{{foo}}}';  \r\n        this.model.markerTemplate =  this.model.markerTemplate.replace(/<td>\\{\\{\\{.+\\}\\}\\}<\\/td>/, '<td>' + display + '</td>');\r\n        _tools.showVesselsOnMap(_viewState);\r\n            \r\n        _saveLabelSettingsPromise = _saveLabelSettingsPromise.then(((c)=>{return this.model.saveLabelSettings(c);}).bind(this));\r\n    }).bind(this));\r\n  \r\n       \r\n    // tracks controller    \r\n    this.frame.find('.instruments .switch.all_tracks input[type=\"checkbox\"]').on(\"click\", \r\n        function(e){\r\n            if (e.currentTarget.checked) {    \r\n                this.inProgress(true);              \r\n                this.model.loadTracks(this.infoDialogView, _viewState);\r\n            }\r\n            else {\r\n                _tools.showMyFleetTrack();\r\n            }            \r\n        }.bind(this)\r\n    ); \r\n\r\n    // visibility controller\r\n    this.frame.find('.instruments .switch.only_myflot input[type=\"checkbox\"]').on(\"click\", \r\n        function(e){\r\n            _displayedOnly.length = 0;\r\n            if (e.currentTarget.checked)\r\n                _displayedOnly = this.model.vessels.map(v=>v.mmsi.toString());\r\n            _tools.showVesselsOnMap(_viewState);\r\n            _tools.hideVesselsOnMap(_viewState, 'click only'); \r\n        }.bind(this)\r\n    ); \r\n\r\n    // group list\r\n    this.groupList = new GroupList(this.frame);\r\n    this.groupList.onRepaintItem = ((i, elm)=>{\r\n        elm.querySelector('input[type=checkbox]').checked = _notDisplayed.indexOf(elm.querySelector('.mmsi').innerText)<0;\r\n    }).bind(this);\r\n    this.groupList.onDeleteGroup = (group=>{\r\n        this.inProgress(true);\r\n        this.model.deleteGroup(group);\r\n    }).bind(this);\r\n    \r\n    this.tableTemplate = this.groupList.toString();\r\n};\r\n\r\nMyFleetView.prototype = Object.create(BaseView.prototype);\r\n\r\nObject.defineProperty(MyFleetView.prototype, \"notDisplayed\", {\r\n    get() {\r\n        return _notDisplayed;\r\n    }\r\n});\r\n\r\nMyFleetView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div');\r\n    if (state)\r\n        progress.show();\r\n    else\r\n        progress.hide();\r\n};\r\n\r\nMyFleetView.prototype.repaint = function () {\r\n    _clean.call(this);  \r\n    BaseView.prototype.repaint.apply(this, arguments);\r\n\r\n    // MEMBERS ON MAP\r\n    _displayedOnly.length = 0;\r\n    if (!this.model.vessels.length)\r\n        this.frame.find('.instruments .switch.only_myflot input[type=\"checkbox\"]')[0].checked = false;    \r\n    if (this.frame.find('.instruments .switch.only_myflot input[type=\"checkbox\"]')[0].checked)\r\n        _displayedOnly = this.model.vessels.map(v=>v.mmsi.toString()); \r\n    _tools.showVesselsOnMap(_viewState);\r\n    _tools.hideVesselsOnMap(_viewState, 'repaint'); \r\n    ///////////////// \r\n\r\n    let labelSettings = this.model.markerTemplate.match(/(?!\\{\\{\\{)[^\\{\\}]+(?=\\}\\}\\})/g),\r\n    labelSettingCtrl;\r\n    for (var i in labelSettings){\r\n        labelSettingCtrl = this.frame.find('.instruments .setting input#' + labelSettings[i])[0];\r\n        if (labelSettingCtrl)\r\n            labelSettingCtrl.checked = true;\r\n    }\r\n\r\n    this.groupList.repaint();  \r\n    \r\n    // GROUP LIST EVENTS\r\n    this.groupList.onCheckItem = function(uncheked){\r\n        if (uncheked.length)\r\n            _notDisplayed=uncheked.map(mmsi=>mmsi);\r\n        else\r\n            _notDisplayed.length = 0;\r\n        _tools.hideVesselsOnMap(_viewState, 'check item');\r\n    }\r\n    this.groupList.onChangeGroup = ((mmsi, group)=>{\r\n        let view = this;\r\n        this.inProgress(true);          \r\n        this.model.changeGroup(mmsi, group)\r\n        .then((r)=>{\r\n            view.repaint();\r\n            view.inProgress(false);  \r\n        })\r\n        .catch((err)=>{\r\n            console.log(err)\r\n            view.inProgress(false);   \r\n        });\r\n    }).bind(this);\r\n    this.groupList.onExcludeItem = ((ev, mmsi, i) => {\r\n            ev.stopPropagation();\r\n            let thisView = this;\r\n            let vessel = thisView.model.vessels[i];\r\n            \r\n            thisView.beforeExcludeMember(vessel.mmsi.toString());\r\n            thisView.inProgress(true);\r\n\r\n            let dlg = $('.ui-dialog:contains(\"' + vessel.mmsi + '\")');\r\n            if (dlg[0]){ \r\n                dlg.find('.button.addremove').click();\r\n            }\r\n            else{\r\n                thisView.model.changeMembers(vessel, this.infoDialogView).then(function () {\r\n                    thisView.show();\t\t\t\r\n                    _tools.eraseMyFleetMarker(vessel.mmsi);\r\n                })\r\n            }        \r\n    }).bind(this);    \r\n    this.groupList.onGroupMenuShow = ((group)=>{\r\n        let i = parseInt(group.replace(/gr/, ''), 10);\r\n        return {\r\n            marker_style:parseInt(this.model.data.groups[i].marker_style.replace(/#/, ''), 16),\r\n            label_color:parseInt(this.model.data.groups[i].label_color.replace(/#/, ''), 16),\r\n            label_shadow:parseInt(this.model.data.groups[i].label_shadow.color.replace(/#/, ''), 16)\r\n        };\r\n    }).bind(this);\r\n    this.groupList.onChangeGroupStyle = ((group, colors)=>{\r\n        let i = parseInt(group.replace(/gr/, ''), 10);\r\n        this.model.changeGroupStyle(i, colors);\r\n    }).bind(this);\r\n    this.groupList.onSaveGroupStyle = this.model.saveGroupStyle;\r\n    _switchLegendIcon.call(this, _tools.needAltLegend);\r\n};\r\n\r\nMyFleetView.prototype.beforeExcludeMember = function (strMmsi) {\r\n    _displayedOnly = _displayedOnly.filter(m => m != strMmsi);\r\n    _notDisplayed = _notDisplayed.filter(m => m != strMmsi);\r\n}\r\n\r\nMyFleetView.prototype.hide = function () {\r\n    if (!this.isActive)\r\n        return;\r\n        \r\n    BaseView.prototype.hide.apply(this, arguments); \r\n    _tools.cleanMap(_viewState);\r\n}\r\n\r\n// MyFleetView.prototype.show = function () {\r\n//     BaseView.prototype.show.apply(this, arguments);  \r\n//     _switchLegendIcon.call(this, _tools.needAltLegend);\r\n// }\r\n\r\nmodule.exports = MyFleetView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/MyFleetView.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/MyFleet.css\n// module id = 12\n// module chunks = 0","const GroupWidget = require('./GroupWidget.js');\r\n\r\nlet _onRepaintItemHandler,\r\n_onCheckItem,\r\n_onExcludeItem,\r\n_onChangeGroup,\r\n_onDeleteGroup,\r\n_onGroupMenuShow,\r\n_onChangeGroupStyle,\r\n_rolledupGroups = {},\r\n_cp1, _cp2, _cp3,\r\n_getFiltered = function(){\r\n    let filtered = [];\r\n    let group = this.frame.find('.mf_group'), selectAll, selectOne;\r\n    for (let i = 0; i < group.length; i++){\r\n        selectAll = group.eq(i).find('.results input[type=\"checkbox\"]');\r\n        selectOne = group.eq(i).find('.ais_vessel input[type=\"checkbox\"]');\r\n        selectAll[0].checked = true;\r\n        for (let j = 0; j < selectOne.length; j++)\r\n            if (!selectOne[j].checked) {\r\n                filtered.push(selectOne[j].closest('.ais_vessel').querySelector('.mmsi').innerText);\r\n                selectAll[0].checked = false;\r\n            }\r\n    }\r\n    return filtered;\r\n},\r\n_setCheckBoxes = function(){\r\n    this.frame.find('.ais_vessel').each(_onRepaintItemHandler);            \r\n    this.frame.find('.results input[type=\"checkbox\"]')\r\n    .each((i,e)=>{\r\n        let check = true; \r\n        e.closest('.mf_group').querySelectorAll('input').forEach((e,i)=>{\r\n            check = check && e.checked\r\n        }); \r\n        e.checked = check;\r\n    });\r\n},\r\n_setGroupCommands = function(){\r\n    this.frame.find('.results input[type=\"checkbox\"]').off(\"click\").on(\"click\", ((e)=>{\r\n        let group = $(e.target).closest('.mf_group');\r\n        group.find('.ais_vessel input[type=\"checkbox\"]').each((i, elm)=>{\r\n            elm.checked = e.target.checked;\r\n        }) \r\n        let filtered = _getFiltered.call(this);\r\n        _onCheckItem(filtered);\r\n    }).bind(this)); \r\n           \r\n    this.frame.find('.results').off(\"contextmenu\").on(\"contextmenu\", (e=>{  \r\n        e.preventDefault();\r\n        // let values= e.currentTarget.classList.values(), \r\n        // cssClass, group;\r\n        // while (!cssClass || !cssClass.done){\r\n        //     cssClass = values.next(); \r\n        //     group = cssClass.value;\r\n        //     if (group && group.search(/^gr\\d/)==0)\r\n        //         break;\r\n        // }\r\n        let group, classes = e.currentTarget.classList;\r\n        for (let i=0; i<classes.length; ++i){\r\n            group = classes[i];\r\n            if (group && group.search(/^gr\\d/)==0)\r\n                break;\r\n        }\r\n\r\n        let ctxMenu = this.contextMenu,//$('.mf_group_menu'),\r\n        evnt = e;\r\n        if (_cp1)\r\n            _cp1.remove();\r\n        if (_cp2)\r\n            _cp2.remove();   \r\n        if (_cp3)\r\n            _cp3.remove();           \r\n        ctxMenu.html('');\r\n        let colorChangeHandler = function(c, cs){\r\n            _groupStyleChanged = true;            \r\n            cs.style.backgroundColor = \"#\" + c;\r\n            let c1 = cp1.style.backgroundColor,\r\n            c2 = cp2.style.backgroundColor,\r\n            c3 = cp3.style.backgroundColor;\r\n            _onChangeGroupStyle(group, {\r\n                marker_style: c1.substr(0,3)==\"rgb\" ? nsGmx.Utils.rgb2hex(c1) : c1,\r\n                label_color: c2.substr(0,3)==\"rgb\" ? nsGmx.Utils.rgb2hex(c2) : c2,\r\n                label_shadow: c3.substr(0,3)==\"rgb\" ? nsGmx.Utils.rgb2hex(c3) : c3 \r\n            })\r\n        },\r\n        colors = _onGroupMenuShow(group),\r\n        cp1 = nsGmx.Controls.createColorPicker(colors.marker_style, ()=>{}, ()=>{}, (c1, c2, c3)=>{colorChangeHandler(c2, cp1)}),\r\n        cp2 = nsGmx.Controls.createColorPicker(colors.label_color, ()=>{}, ()=>{}, (c1, c2, c3)=>{colorChangeHandler(c2, cp2)}),\r\n        cp3 = nsGmx.Controls.createColorPicker(colors.label_shadow, ()=>{}, ()=>{}, (c1, c2, c3)=>{colorChangeHandler(c2, cp3)});\r\n        _cp1 = document.querySelector(\"#\"+$(cp1).data('colorpickerId'));\r\n        _cp2 = document.querySelector(\"#\"+$(cp2).data('colorpickerId'));\r\n        _cp3 = document.querySelector(\"#\"+$(cp3).data('colorpickerId'));\r\n        $(_cp1).on('mouseleave', (e)=>{if(!e.relatedTarget || !e.relatedTarget.closest('.mf_group_menu')) _hideContextMenu.call(this, e); $(cp1).ColorPickerHide()});\r\n        $(_cp2).on('mouseleave', (e)=>{if(!e.relatedTarget || !e.relatedTarget.closest('.mf_group_menu')) _hideContextMenu.call(this, e); $(cp2).ColorPickerHide()});\r\n        $(_cp3).on('mouseleave', (e)=>{if(!e.relatedTarget || !e.relatedTarget.closest('.mf_group_menu')) _hideContextMenu.call(this, e); $(cp3).ColorPickerHide()});\r\n        cp1.title = \"\";\r\n        cp2.title = \"\";\r\n        cp3.title = \"\";\r\n        let div = $('<div class=\"command marker_color\"></div>');         \r\n        ctxMenu.append(div.append(cp1).append(\"<span>\"+_gtxt(\"AISSearch2.markerShadow\")+\"</span>\"));\r\n        div = $('<div class=\"command label_color\"></div>');         \r\n        ctxMenu.append(div.append(cp2).append(\"<span>\"+_gtxt('AISSearch2.labelColor')+\"</span>\"));\r\n        div = $('<div class=\"command label_shadow\"></div>');         \r\n        ctxMenu.append(div.append(cp3).append(\"<span>\"+_gtxt('AISSearch2.labelShadow')+\"</span>\"));\r\n        ctxMenu.append('<div class=\"command remove\">' + _gtxt(\"AISSearch2.DeleteGroupCommand\") + '</div>');\r\n        \r\n        $(cp1).on('click', e=>$(_cp1).offset({left:$('.colorpicker:visible').offset().left+20}));       \r\n        $(cp2).on('click', e=>$(_cp2).offset({left:$('.colorpicker:visible').offset().left+20}));       \r\n        $(cp3).on('click', e=>$(_cp3).offset({left:$('.colorpicker:visible').offset().left+20}));\r\n        ctxMenu.find('.command.marker_color').on(\"click\",(e)=>{            \r\n            $(cp1).click();\r\n        })\r\n        ctxMenu.find('.command.label_color').on(\"click\",(e)=>{             \r\n            $(cp2).click();\r\n        })\r\n        ctxMenu.find('.command.label_shadow').on(\"click\",(e)=>{             \r\n            $(cp3).click();\r\n        })\r\n        \r\n        if (e.currentTarget.querySelector(\".delete\")) {\r\n            ctxMenu.find('.command.remove').show().on(\"click\", (e) => {\r\n                _onDeleteGroup(evnt.currentTarget.querySelector('.title').innerText);\r\n                ctxMenu.hide();\r\n            })\r\n        }\r\n        else{\r\n            ctxMenu.find('.command.remove').hide();\r\n        }\r\n        ctxMenu.show();\r\n        ctxMenu[0].style.left = (e.clientX - 10) + \"px\";\r\n        if ((e.clientY - 10 + ctxMenu[0].offsetHeight) < window.innerHeight) {\r\n            ctxMenu[0].style.top = (e.clientY - 10) + \"px\";\r\n            ctxMenu[0].style.bottom = \"\";//\"auto\";\r\n        }\r\n        else {  \r\n            ctxMenu[0].style.bottom = (window.innerHeight - e.clientY - 10) + \"px\";\r\n            ctxMenu[0].style.top = \"\";//\"auto\";\r\n        }\r\n    }).bind(this));\r\n\r\n    this.frame.find('.results .upout').off(\"click\").on(\"click\", (e=>{\r\n        let arrow = e.currentTarget,\r\n            title = arrow.closest('.results').querySelector('.title').innerText,\r\n            cl = arrow.classList,\r\n            vessels = arrow.closest('.mf_group').querySelectorAll('.ais_vessel');\r\n        if (cl.contains('icon-down-open')){\r\n            cl.remove('icon-down-open');\r\n            cl.add('icon-right-open');\r\n            vessels.forEach(v=>v.style.display='none');\r\n            _rolledupGroups[title] = true;\r\n        }\r\n        else{\r\n            cl.add('icon-down-open');\r\n            cl.remove('icon-right-open');\r\n            vessels.forEach(v=>v.style.display='block');\r\n            delete(_rolledupGroups[title]);\r\n        }\r\n//console.log(_rolledupGroups)\r\n    }).bind(this))    \r\n    .each((i,el)=>{\r\n        let title = el.closest('.results').querySelector('.title').innerText;\r\n        if (_rolledupGroups[title]){\r\n            el.classList.remove('icon-right-open');\r\n            el.classList.add('icon-down-open');\r\n            el.click();            \r\n        }\r\n    });\r\n    _rolledupGroups = {};\r\n    this.frame.find('.results .icon-right-open').each((i, el) => {\r\n        _rolledupGroups[el.closest('.results').querySelector('.title').innerText] = true;\r\n    })\r\n\r\n    this.frame.find('.results .delete')\r\n    .off(\"click\").on(\"click\", (e=>{\r\n        _onDeleteGroup(e.currentTarget.closest('.results').querySelector('.title').innerText);\r\n    }).bind(this));\r\n},\r\n_onSaveGroupStyle,\r\n_groupStyleChanged,\r\n_saveStylePromise = Promise.resolve(0),\r\n_hideContextMenu = function (e){\r\n    this.contextMenu.hide();\r\n    //if (e.currentTarget.querySelector('.colorSelector') || e.currentTarget.classList.contains('colorpicker'))\r\n    if (_groupStyleChanged){\r\n        _groupStyleChanged = false;\r\n        _saveStylePromise = _saveStylePromise.then(_onSaveGroupStyle);\r\n    }\r\n};\r\n\r\nconst GroupList = function (frame) {\r\n    this.frame = frame;\r\n       \r\n    // context menu\r\n    this.contextMenu = $('<div class=\"mf_group_menu\"></div>')\r\n    .on('mouseleave', (e=>{\r\n        if(!e.relatedTarget || !e.relatedTarget.closest('.colorpicker')){\r\n            _hideContextMenu.call(this, e);\r\n            $('.colorpicker:visible').hide();\r\n        }\r\n    }).bind(this));\r\n    $('body').append(this.contextMenu); \r\n\r\n    this.repaint = function(){\r\n        _setCheckBoxes.call(this);\r\n        _setGroupCommands.call(this);\r\n\r\n        // exclude memeber control\r\n        this.frame.find('.ais_vessel .exclude').each((i, elm)=>{\r\n            $(elm).on('click', (ev)=>{\r\n                $(elm).off('click');\r\n                _onExcludeItem(ev, elm.closest('.ais_vessel').querySelector('.mmsi').innerText, i);\r\n            })\r\n        });\r\n\r\n        // memeber visibility control\r\n        this.frame.find('.ais_vessel input[type=\"checkbox\"]').each(((i, elm)=>{\r\n            $(elm).off('click').on('click', (e => {\r\n                e.stopPropagation();\r\n                let filtered = _getFiltered.call(this);\r\n                _onCheckItem(filtered);\r\n            }).bind(this));\r\n        }).bind(this));  \r\n        \r\n        // context menu event handler\r\n        this.frame.find('.ais_vessel').off(\"contextmenu\").on(\"contextmenu\", (e=>{\r\n            e.preventDefault();\r\n            let mmsi = e.currentTarget.querySelector('.mmsi'),\r\n            ctxMenu = this.contextMenu,//$('.mf_group_menu'),\r\n            groupblock = e.currentTarget.closest('.mf_group'),\r\n            group = groupblock.querySelector('.results .title').innerText,\r\n            groups = this.frame.find('.results .title'),\r\n            template = '';\r\n            if (groups.length==1)\r\n                return;\r\n\r\n            groups.each((i,g)=>{\r\n                if (i>0 && g.innerText!=group)\r\n                    template += ('<div class=\"command\">' + g.innerText + '</div>');\r\n            });\r\n            if (template!='')\r\n                template = ('<div>' + _gtxt(\"AISSearch2.AddIntoGroup\") + '</div>') + template;\r\n            if (groupblock.previousSibling){\r\n                if (template!='')\r\n                    template += ('<div class=\"command remove\">' + _gtxt(\"AISSearch2.RemoveFromGroup\") + '</div>');\r\n                else\r\n                    template += ('<div class=\"command remove lonely\">' + _gtxt(\"AISSearch2.RemoveFromGroup\") + '</div>');\r\n            }\r\n            ctxMenu.html(template);\r\n            \r\n            ctxMenu.find('.command').on(\"click\",(e)=>{\r\n                if(!e.currentTarget.classList.contains('remove'))\r\n                    _onChangeGroup(mmsi.innerText, e.currentTarget.innerText);\r\n                else\r\n                    _onChangeGroup(mmsi.innerText, null);                \r\n                ctxMenu.hide();\r\n            });\r\n            ctxMenu.show();\r\n            ctxMenu[0].style.left = (e.clientX - 10) + \"px\";\r\n            if ((e.clientY - 10 + ctxMenu[0].offsetHeight) < window.innerHeight) {\r\n                ctxMenu[0].style.top = (e.clientY - 10) + \"px\";\r\n                ctxMenu[0].style.bottom = \"\";//\"auto\";\r\n            }\r\n            else {  \r\n                ctxMenu[0].style.bottom = (window.innerHeight - e.clientY - 10) + \"px\";\r\n                ctxMenu[0].style.top = \"\";//\"auto\";\r\n            }\r\n        }).bind(this));       \r\n    };\r\n\r\n    // events\r\n    Object.defineProperty(this, \"onChangeGroup\", {\r\n        set: function (callback) {\r\n            _onChangeGroup = callback;\r\n        }\r\n    });\r\n    Object.defineProperty(this, \"onDeleteGroup\", {\r\n        set: function (callback) {\r\n            _onDeleteGroup = callback;\r\n        }\r\n    });\r\n    Object.defineProperty(this, \"onRepaintItem\", {\r\n        set: function (callback){\r\n            _onRepaintItemHandler = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onCheckItem\", {\r\n        set: function (callback){\r\n            _onCheckItem = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onExcludeItem\", {\r\n        set: function (callback){\r\n            _onExcludeItem = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onGroupMenuShow\", {\r\n        set: function (callback){\r\n            _onGroupMenuShow = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onChangeGroupStyle\", {\r\n        set: function (callback){\r\n            _onChangeGroupStyle = callback;\r\n        }\r\n    }); \r\n    Object.defineProperty(this, \"onSaveGroupStyle\", {\r\n        set: function (callback){\r\n            _onSaveGroupStyle = callback;\r\n        }\r\n    }); \r\n      \r\n    // template\r\n    this.toString = function () {\r\n        return '{{#each groups}}' + GroupWidget.prototype.toString.call() + '{{/each}}' +\r\n            '{{#each msg}}<div class=\"msg\">{{txt}}</div>{{/each}}';\r\n    } \r\n}\r\n\r\nGroupList.prototype.appendGroup = function(group, index){\r\n    this.frame.find('.mf_group').eq(0).parent().append(Handlebars.compile(GroupWidget.prototype.toString.call().replace(/\\{\\{@index\\}\\}/, index))(group));    \r\n    _setGroupCommands.call(this);\r\n}\r\n\r\nmodule.exports = GroupList;\n\n\n// WEBPACK FOOTER //\n// ./src/Controls/GroupList.js","const GroupWidget = function (title){\r\n    \r\n}\r\n\r\nGroupWidget.prototype.toString = function () {\r\n    return '<div class=\"mf_group\">' +\r\n    '<table class=\"results gr{{@index}}\"><tr>'+\r\n    '<td><input type=\"checkbox\" checked><div class=\"upout clicable ui-helper-noselect icon-down-open\" style=\"float: right;\"></div></td>' +\r\n    '<td><span class=\"title\">{{title}}</span></td>' +\r\n    '<td class=\"count\">{{vessels.length}}</td>' +    \r\n    '<td>' +\r\n    '{{#unless default}}' +\r\n    '<img class=\"delete clicable\" title=\"{{i \"AISSearch2.DeleteGroup\"}}\" src=\"plugins/AIS/AISSearch/svg/delete.svg\">' +\r\n    '</td>' +\r\n    '{{/unless}}' +\r\n    '</tr></table>'+\r\n    '{{#each vessels}}' +\r\n    //'{{#unless foovessel}}' +\r\n    '<div class=\"ais_vessel\">' +\r\n    '<table border=0><tr>' +\r\n    '<td><input type=\"checkbox\" checked></td>' +\r\n    '<td><div class=\"position\">{{vessel_name}}</div><div>mmsi: <span class=\"mmsi\">{{mmsi}}</span> imo: <span class=\"imo\">{{imo}}</span></div></td>' +\r\n    '<td><img src=\"{{icon}}\" class=\"course rotateimg{{icon_rot}} legend_icon\"><img src=\"{{iconAlt}}\" class=\"course rotateimg{{icon_rot}} legend_iconalt\">' +\r\n    '<div class=\"info\" vessel=\"{{aisjson this}}\" title=\"{{i \"AISSearch2.info\"}}\">' +\r\n    '<img src=\"plugins/AIS/AISSearch/svg/info.svg\"></div>' +\r\n    '</td>' +\r\n    '<td>' +\r\n    '<div class=\"ais_info_dialog_close-button exclude\" title=\"{{i \"AISSearch2.vesselExclude\"}}\"></div>' +\r\n    '<span class=\"date\">{{dt_pos_utc}}</span></td>' +\r\n    '</tr></table>' +\r\n    '</div>' +\r\n    //'{{/unless}}' +\r\n    '{{/each}}</div>';\r\n}\r\n\r\nmodule.exports = GroupWidget;\n\n\n// WEBPACK FOOTER //\n// ./src/Controls/GroupWidget.js","const Polyfill = require('../Polyfill');\r\nlet emptyGroup = function(title, isDefault, id, style, updateTemplate){\r\n    let ms = \"#ffff00\",\r\n    lsc = \"#ffff00\",\r\n    ls = {\"color\":\"#ffff00\",\"text_shadow\": \"-1px -1px 0 #ffff00, 0px -1px 0 #ffff00, 1px -1px 0 #ffff00, -1px  0px 0 #ffff00, 1px  0px 0 #ffff00, -1px  1px 0 #ffff00, 0px  1px 0 #ffff00, 1px  1px 0 #ffff00\"},\r\n    eg = {\r\n    title: title,\r\n    vessels: [],\r\n    get marker_style(){return ms}, \r\n    set marker_style(c){ms = c},\r\n    //label_shadow:\"color:black;-webkit-text-stroke:1px yellow;\"\r\n    label_color: \"#000000\",\r\n    get label_shadow_color(){return lsc},\r\n    get label_shadow(){return ls},\r\n    set label_shadow(c){ \r\n        lsc = c;\r\n        ls = {\"color\": c, \"text_shadow\": \"-1px -1px 0 \" + c + \", 0px -1px 0 \" + c + \", 1px -1px 0 \" + c + \", -1px  0px 0 \" + c + \", 1px  0px 0 \" + c + \", -1px  1px 0 \" + c + \", 0px  1px 0 \" + c + \", 1px  1px 0 \" + c + \"\"}\r\n    }\r\n    };\r\n    if (isDefault) eg.default = true;\r\n    if (style)\r\n    {\r\n        style = JSON.parse(style);\r\n        eg.marker_style = style.ms;\r\n        eg.label_color = style.lc;\r\n        eg.label_shadow = style.lsc;\r\n        if (isDefault && style.mt && updateTemplate)\r\n            _markerTemplate = style.mt;\r\n    }\r\n    eg.id = id;\r\n    return eg;\r\n}\r\n\r\nconst VesselData = function () {\r\n    this.groups = []\r\n};\r\n\r\nlet _tools,\r\n_trackLoaders = [],\r\n_isDirty = true,\r\n_myFleetLayers = [],\r\n_defaultGroup = _gtxt(\"AISSearch2.AllGroup\"),\r\n_vessels = [],\r\n_mapID,\r\n_modulePath,\r\n_prepared,\r\n_actualUpdate,\r\n_markerTemplate = '<div><table><tr>' +\r\n'<td style=\"vertical-align:top\">' +\r\n//'<svg width=\"12\" height=\"11\" fill=\"#00f\" style=\"{{marker_style}}\" viewBox=\"0 0 260 245\"><use xlink:href=\"#mf_label_icon\"/></svg>' +\r\n'{{{marker}}}' +\r\n'</td><td>{{{foo}}}</td></tr></table></div>',\r\n_data,\r\n_view,\r\n_aisLayerSearcher,\r\n_onChangedHandlers = [],\r\n_fireChanged = function(){ _onChangedHandlers.forEach(h=>h()); },\r\n_loadVoyageInfo = function (vessels) {   \r\n    return new Promise(function (resolve, reject) {\r\n        if (!vessels.length){\r\n            reject();\r\n            return;\r\n        }\r\n\r\n        let data;\r\n        if (Polyfill.findIndex(vessels, v=>v.mmsi || v.imo)<0){\r\n            data = _parseVoyageInfo({Result:{fields:[], values:[]}}, vessels); \r\n            resolve(data);\r\n        } \r\n        else\r\n            _aisLayerSearcher.searchNames(\r\n                vessels,\r\n                function (response) {\r\n                    if (response.Status && response.Status.toLowerCase() == \"ok\") {\r\n                        data = _parseVoyageInfo(response, vessels);\r\n                        resolve(data);\r\n                    }\r\n                    else {\r\n                        reject(response);\r\n                    }\r\n                });\r\n    });\r\n},\r\n_compareGroups = function(l, r){\r\n    if (l.default)\r\n        return -1;\r\n    if (r.default)\r\n        return 1;        \r\n    if (l.id<r.id)\r\n        return -1;\r\n    if (l.id>r.id)\r\n        return 1;        \r\n    return 0;\r\n},\r\n_parseVoyageInfo = function (response, vessels) {\r\n        let mmsi = response.Result.fields.indexOf(\"mmsi\"),\r\n            vessel_name = response.Result.fields.indexOf(\"vessel_name\"),\r\n            ts_pos_utc = response.Result.fields.indexOf(\"ts_pos_utc\"),\r\n            imo = response.Result.fields.indexOf(\"imo\"),\r\n            lat = response.Result.fields.indexOf(\"longitude\"),\r\n            lon = response.Result.fields.indexOf(\"latitude\"),\r\n            vt = response.Result.fields.indexOf(\"vessel_type\"),\r\n            cog = response.Result.fields.indexOf(\"cog\"),\r\n            sog = response.Result.fields.indexOf(\"sog\"),\r\n            data,\r\n            eg;\r\n        if (_data){ // _data.groups.length>1 || _data.groups[0].vessels_length>0\r\n            data = _data;\r\n            data.groups.forEach(g=>g.vessels.length=0);\r\n        }\r\n        else{\r\n            data = new VesselData();\r\n            vessels.forEach(v=>{\r\n                if (!v.mmsi && !v.imo){\r\n                    if (v.group)\r\n                        eg = emptyGroup(v.group, false, v.gmx_id, v.style, true);\r\n                    else\r\n                        eg = emptyGroup(_defaultGroup, true, v.gmx_id, v.style, true);\r\n                    data.groups.push(eg);\r\n                }\r\n            });\r\n            data.groups.sort(_compareGroups);\r\n//console.log(data);\r\n        }\r\n        response.Result.values.forEach(c => {\r\n            let d = new Date(c[ts_pos_utc] * 1000),\r\n                member = {\r\n                    vessel_name: c[vessel_name], mmsi: c[mmsi], imo: c[imo],\r\n                    ts_pos_utc: _aisLayerSearcher.formatDateTime(d), dt_pos_utc: _aisLayerSearcher.formatDate(d),\r\n                    ts_pos_org: c[ts_pos_utc],\r\n                    xmin: c[lat], xmax: c[lat], ymin: c[lon], ymax: c[lon],\r\n                    vessel_type: c[vt], cog: c[cog], sog: c[sog]\r\n                };\r\n            member.icon_rot = Math.round(member.cog / 15) * 15;\r\n            _aisLayerSearcher.placeVesselTypeIcon(member);\r\n\r\n            let i = Polyfill.findIndex(vessels, function (v) {\r\n                return v.mmsi == member.mmsi;\r\n            }),\r\n                gn = i<0 ? \"\" : (!vessels[i].group ? _defaultGroup : vessels[i].group);\r\n            if (gn != \"\") {\r\n                i = Polyfill.findIndex(data.groups, function (g) {\r\n                    return g.title == gn;\r\n                });\r\n                data.groups[i].vessels.push(member);\r\n            }\r\n        });\r\n\r\n        //thisInst.data.vessels.sort(function (a, b) { return +(a.vessel_name > b.vessel_name) || +(a.vessel_name === b.vessel_name) - 1; })\r\n//console.log(\"PARSE VI \" + data.groups.reduce((p,c)=>p+c.vessels.length, 0))\r\n        return data;\r\n},\r\n_persistGroupsLook = function(count, groups){\r\n    return new Promise((resolve, reject)=>{\r\n        let temp = [], style;\r\n        for (let i=0; i<groups.length; ++i){\r\n            style = {ms: groups[i].marker_style, lc: groups[i].label_color, lsc: groups[i].label_shadow_color};\r\n            if(groups[i].default)\r\n                style.mt = _markerTemplate;\r\n            temp.push({\r\n                properties:{style:JSON.stringify(style)}, \r\n                id:groups[i].id, action:\"update\"\r\n            });\r\n        }\r\n        if (!FormData.prototype.set) { \r\n            sendCrossDomainJSONRequest(_aisLayerSearcher.baseUrl +\r\n                'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                '&objects=' + encodeURIComponent(JSON.stringify(temp)),\r\n                function (r) {\r\n                    if (!r.Status || r.Status.toLowerCase() != \"ok\")\r\n                        console.log(r);\r\n                    resolve(count + 1);\r\n                }\r\n            );                    \r\n        }\r\n        else {\r\n            let form = new FormData();\r\n            form.set('WrapStyle', 'none');\r\n            form.set('LayerName', _myFleetLayers[0]);\r\n            form.set('objects', JSON.stringify(temp));\r\n            fetch(_aisLayerSearcher.baseUrl + 'VectorLayer/ModifyVectorObjects.ashx', {\r\n                credentials: 'include',\r\n                method: \"POST\",\r\n                body: form\r\n            })\r\n                .then((r) => r.json())\r\n                .then((r) => {\r\n                    if (!r.Status || r.Status.toLowerCase() != \"ok\")\r\n                        console.log(r);\r\n                    resolve(count + 1);\r\n                })\r\n                .catch(err => {\r\n                    console.log(err);\r\n                    resolve(count + 1);\r\n                });\r\n        }                 \r\n    });\r\n    } \r\n;\r\n\r\nmodule.exports = function ({aisLayerSearcher, toolbox, modulePath}) {    \r\n    _modulePath = modulePath;\r\n    _tools = toolbox;\r\n    _aisLayerSearcher = aisLayerSearcher;\r\n    _mapID = String($(_queryMapLayers.buildedTree).find(\"[MapID]\")[0].gmxProperties.properties.MapID);\r\n    let addGroupField = function(lid, resolve, reject, vessels){\r\nconsole.log(\"add group and style field\");\r\n        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl + 'VectorLayer/Update.ashx?VectorLayerID=' + lid +\r\n            '&columns=[{\"Name\":\"mmsi\",\"OldName\":\"mmsi\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"mmsi\\\\\"\"},{\"Name\":\"imo\",\"OldName\":\"imo\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"imo\\\\\"\"},{\"Name\":\"gmx_id\",\"OldName\":\"gmx_id\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":true,\"IsIdentity\":true,\"IsComputed\":false,\"expression\":\"\\\\\"gmx_id\\\\\"\"},{\"Name\":\"group\",\"OldName\":\"group\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"group\\\\\"\"},{\"Name\":\"style\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"style\\\\\"\"}]',\r\n            function (response) {\r\n                if (response.Status.toLowerCase() == \"ok\")\r\n                    setTimeout(function run() {\r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            \"AsyncTask.ashx?TaskID=\" + response.Result.TaskID, function (response) {\r\n                                if (response.Status.toLowerCase() == \"ok\")\r\n                                    if (!response.Result.Completed)\r\n                                        setTimeout(run, 1000);\r\n                                    else {\r\n                                        if(response.Result.ErorInfo)\r\n                                            reject(response);\r\n                                        else\r\n                                            resolve(vessels);\r\n                                    }\r\n                                else \r\n                                    reject(response);\r\n                            });\r\n                    }, 1000);\r\n            });\r\n        },  \r\n        addDefaultGroup = function(resolve, reject, vessels){\r\n            sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                '&objects=[{\"properties\":{\"group\": null},\"action\":\"insert\"}]',\r\n                function (response) {\r\n                    if (response.Status.toLowerCase() == \"ok\") {                           \r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            'VectorLayer/Search.ashx?layer=' + _myFleetLayers[0] +\r\n                            '&query=\"group\" is null and \"mmsi\" is null and \"imo\" is null',\r\n                            function (response) {                                          \r\n                                if (response.Status.toLowerCase() == \"ok\" && response.Result.values && response.Result.values.length>0) {\r\n                                    let f = response.Result.fields, v = response.Result.values;  \r\n                                    console.log(\"insert def group\");\r\n                                    vessels.push({imo:null, mmsi:null, group:null, gmx_id:v[0][f.indexOf('gmx_id')]});\r\n                                    resolve(vessels);\r\n                                }\r\n                                else\r\n                                    reject(response);\r\n                            })\r\n                    }\r\n                    else\r\n                        reject(response);\r\n                }\r\n            ); \r\n        },\r\n        fetchMyFleet = function (lid) {\r\n            return new Promise(function (resolve, reject) {\r\n                sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl + \"VectorLayer/Search.ashx?layer=\" + lid,\r\n                    function (response) {\r\n                        if (response.Status.toLowerCase() == \"ok\") {\r\n                            let v = response.Result.values,\r\n                                f = response.Result.fields,\r\n                                vessels = [];\r\n                            for (let i = 0; i < v.length; ++i) {\r\n                                vessels.push({})\r\n                                for (let j = 0; j < f.length; ++j){\r\n                                    vessels[i][f[j]] = v[i][j];\r\n                                }\r\n                            }\r\n\r\n                            new Promise((rs, rj)=>{\r\n                                if (f.indexOf('group')<0 || f.indexOf('style')<0)\r\n                                    addGroupField(lid, rs, rj, vessels);\r\n                                else \r\n                                    rs();\r\n                            }).then(()=>{\r\n                                if (Polyfill.findIndex(vessels, v=>!v.imo&&!v.mmsi&&!v.group)<0)\r\n                                    addDefaultGroup(resolve, reject, vessels);\r\n                                else\r\n                                    resolve(vessels);\r\n                            },  r=>reject(r));\r\n                        }\r\n                        else\r\n                            reject(response);\r\n                    });\r\n            })\r\n        };\r\n\r\n    _prepared = new Promise((resolve, reject) => {\r\n        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n            \"User/GetUserInfo.ashx\",\r\n            function (response) {\r\n                if (response.Status.toLowerCase() == \"ok\" && response.Result)\r\n                    resolve(response);\r\n                if (response.Status.toLowerCase() == \"ok\" && !response.Result)\r\n                    reject({Status:\"auth\"});\r\n                else\r\n                    reject(response);\r\n            });\r\n    })\r\n    .then((response) => {\r\n            let nickname = response.Result.Nickname;\r\n            return new Promise((resolve, reject) => {\t\t\t\t\r\n                if ((nickname == 'scf_captain' || nickname == 'scf_captain2020' || nickname == 'scf_master2020')\r\n                 && _mapID=='KGEJB')\r\n\t\t\t\t\tresolve({Status:\"ok\", Result:{count:1, layers:[{LayerID:\"0A5CE9C59487441689ABF3031991BF2F\"}]}});\r\n\t\t\t\telse\r\n                    sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                        \"Layer/Search2.ashx?page=0&pageSize=50&orderby=title &query=([Title]='myfleet\" + _mapID + \"' and [OwnerNickname]='\" + nickname + \"')\",\r\n                        function (response) {\r\n                            if (response.Status.toLowerCase() == \"ok\" && response.Result.count > 0)\r\n                                resolve(response);\r\n                            else \r\n                                reject(response); // no my fleet layer\r\n                        });\r\n            });\r\n    })\r\n    .then((response) => {\r\n            let lid = response.Result.layers[0].LayerID;\r\n            _myFleetLayers.push(lid);\r\n            return fetchMyFleet(lid)\r\n        }\r\n        ,(rejectedResponse) => {\r\n            if (rejectedResponse.Status && rejectedResponse.Status.toLowerCase() == \"ok\")\r\n                return Promise.resolve([]); // no mf layer\r\n            else\r\n                return Promise.reject(rejectedResponse); // smth wrong\r\n        }\r\n    )\r\n    .then((vessels=>{\r\n//console.log('INIT REPAINT MAP')\r\n        _vessels = vessels.map(v=>v);\r\n        _tools.specialVesselFilters = {key: \"drawMarker\", value: (args, ai, displayed)=>{          \r\n            let vessel = Polyfill.find(_vessels, v=>{\r\n                return v.mmsi && v.mmsi==args.properties[ai.mmsi];\r\n            })\r\n            if (vessel){\r\n                let group = Polyfill.find(_vessels, v=>(!v.mmsi && !v.imo && v.group==vessel.group));\r\n                if (vessel.group)\r\n                    group = emptyGroup(vessel.group, false, group.gmx_id, group.style);\r\n                else\r\n                    group = emptyGroup(_defaultGroup, true, group.gmx_id, group.style);\r\n                _tools.drawMyFleetMarker(args, _markerTemplate, group, ai, \r\n                    (displayed==\"all\" || displayed.indexOf(vessel.mmsi.toString())>=0) && _view.notDisplayed.indexOf(vessel.mmsi.toString())<0);\r\n            }\r\n        }}\r\n        // _repaintMap(vessels); // only on init\r\n        return Promise.resolve();\r\n    }).bind(this));\r\n\r\n    return {\r\n        get isDirty() { return _isDirty; },\r\n        set isDirty(value) { _isDirty = value; },\r\n        get data() { return _data; },\r\n        set data(value) { _data = value; },\r\n        get view() { return _view; },\r\n        set view(value) { _view = value; },\r\n        get vessels(){\r\n            let myfleet = _data.groups.reduce((p, c) => {\r\n                c.vessels.forEach(v=>{if(v.mmsi)p.push({mmsi:v.mmsi, imo:v.imo})});\r\n                return p;\r\n            }, []);\r\n            return myfleet;\r\n        },\r\n        findIndex: function (vessel) {\r\n            if (_vessels.length == 0)\r\n                return -1;\r\n            return Polyfill.findIndex(_vessels, function (v) {\r\n                return v.mmsi == vessel.mmsi && (!vessel.imo || v.imo == vessel.imo);\r\n            })\r\n        },\r\n        load: function (actualUpdate) {\r\n            var thisInst = this;\r\n            return _prepared.then(()=>{\r\n                if (_myFleetLayers.length == 0 || !thisInst.isDirty)\r\n                    return Promise.resolve();\r\n\r\n                return fetchMyFleet(_myFleetLayers[0]) \r\n                    .then(vessels=>{\r\n                        _vessels = vessels;\r\n                        return _loadVoyageInfo(vessels);\r\n                    })\r\n                    .then(data=>{\r\n                        _data=data;\r\n                        //_isDirty = false;\r\n                        return Promise.resolve();\r\n                    })\r\n                    .catch(error=>{\r\n                        //_isDirty = false;\r\n                        return Promise.reject(error);\r\n                    });\r\n            });\r\n        },\r\n        update: function () {\r\n\r\n            if (!this.isDirty){\r\n                this.view.repaint()\r\n                return;\r\n            }\r\nconsole.log('UPDATE')\r\n\r\n            _actualUpdate = new Date().getTime();\r\n            let thisModel = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);\r\n            this.load(actualUpdate).then(\r\n                function () {\r\n                    if (_actualUpdate == actualUpdate) {\r\n                        thisModel.view.inProgress(false);\r\n                        if (_data)\r\n                            thisModel.view.repaint();\r\n                        _isDirty = false;\r\n                    }\r\n                }, \r\n                function (json) {\r\n                    thisModel.dataSrc = null;\r\n                    if ((json.Status && json.Status.toLowerCase() == \"auth\") ||\r\n                        (json.ErrorInfo && json.ErrorInfo.some && json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })))\r\n                        thisModel.data = { msg: [{ txt: _gtxt(\"AISSearch2.auth\") }], groups: [] };\r\n                    else {\r\n                        //thisModel.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                        console.log(json);\r\n                    }\r\n                    thisModel.view.inProgress(false);\r\n                    thisModel.view.repaint();\r\n                    _isDirty = false;\r\n                });\r\n        },\r\n        get markerTemplate(){\r\n            return _markerTemplate;\r\n        },\r\n        set markerTemplate(v){_markerTemplate = v;},\r\n        markMembers: function (vessels) {\r\n            if (this.data && this.data.groups){\r\n                let membCounter = 0;\r\n                this.data.groups.forEach(function (g) {\r\n                    g.vessels.forEach(function (v) {\r\n                        let i = Polyfill.findIndex(vessels, function (vv) { return v.mmsi == vv.mmsi && v.imo == v.imo });\r\n                        if (i>-1){\r\n                            let member = vessels[i]\r\n                            member.mf_member = \"visibilty:visible\";\r\n                            vessels.splice(i, 1);\r\n                            vessels.splice(membCounter++, 0, member);\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        },\r\n        createGroup: function(name){\r\n            if (!_myFleetLayers.length)\r\n                return Promise.reject({Status:\"error\", ErrorInfo:\"no data\"});\r\n\r\n            return new Promise((resolve, reject)=>{\r\n                sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                    'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                    '&objects=[{\"properties\":{ \"group\": \"' + name.replace(/\"/g, '\\\\\\\"') + '\"},\"action\":\"insert\"}]',\r\n                    function (response) {\r\n                        if (response.Status.toLowerCase() == \"ok\") {                           \r\n                            sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                                'VectorLayer/Search.ashx?layer=' + _myFleetLayers[0] +\r\n                                '&query=\"group\"=\\'' + name.replace(/'/g, \"''\") + '\\'',\r\n                                function (response) {                                          \r\n                                    if (response.Status.toLowerCase() == \"ok\" && response.Result.values && response.Result.values.length>0) {\r\n                                        let f = response.Result.fields, v = response.Result.values;  \r\n                                        let group = emptyGroup(name, false, v[0][f.indexOf('gmx_id')]);\r\n                                        _data.groups.push(group);\r\n                                        _vessels.push({gmx_id: v[0][f.indexOf('gmx_id')], mmsi:null, imo:null, group:name})\r\n                                        resolve(group);\r\n                                    }\r\n                                    else\r\n                                        reject(response);\r\n                                })\r\n                        }\r\n                        else\r\n                            reject(response);\r\n                    }\r\n                ); \r\n            });\r\n        },\r\n        deleteGroup: function(group){\r\n            let objects = [], thisModel = this, i, j=-1;\r\n            for (i = 0; i < _vessels.length; ++i) {\r\n                if (_vessels[i].group == group) {\r\n                    if (!_vessels[i].mmsi && !_vessels[i].imo) {\r\n                        j = i;\r\n                        objects.push({ id: _vessels[i].gmx_id, action: \"delete\" });\r\n                    }\r\n                    else {\r\n                        _vessels[i].group = null;\r\n                        objects.push({ properties: _vessels[i], id: _vessels[i].gmx_id, action: \"update\" });\r\n                    }\r\n                }\r\n            }\r\n            if (j<0)\r\n                return;\r\n            i = Polyfill.findIndex(_data.groups, g=>g.id==_vessels[j].gmx_id);\r\n// console.log(i+\", \"+j + \" - \"+ _data.groups[i].id +\" \"+_vessels[j].gmx_id);    \r\n            _data.groups.splice(i, 1);\r\n            _data.groups.sort(_compareGroups);\r\n// console.log(_data.groups)\r\n// console.log(_vessels);            \r\n            _vessels.splice(j, 1);\r\n            sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                '&objects=' + JSON.stringify(objects),\r\n                function (response) {\r\n                    if (response.Status.toLowerCase() == \"ok\") {\r\n                        thisModel.isDirty = true;\r\n                        thisModel.update();\r\n                    }\r\n                    else\r\n                        console.log(response);\r\n                }\r\n            ); \r\n        },\r\n        set onChanged(callback){ \r\n            _onChangedHandlers.push(callback) \r\n        },\r\n        changeMembers: function (vessel, infoDialog) {\r\n//console.log(infoDialog)\r\n//console.log(_vessels, vessel)\r\n            var remove = false;\r\n            for (var i = 0; i < _vessels.length; ++i) {\r\n                if ((!vessel.imo || _vessels[i].imo == vessel.imo) && _vessels[i].mmsi == vessel.mmsi) {\r\n                    remove = _vessels[i].gmx_id;\r\n                    _vessels.splice(i, 1);\r\n                }\r\n            }\r\n//console.log(remove)\r\n            return new Promise((resolve, reject) => {\r\n                if (!_myFleetLayers.length){\r\n                    sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                        'VectorLayer/CreateVectorLayer.ashx?Title=myfleet' + _mapID + '&geometrytype=point&Columns=' +\r\n                        '[{\"Name\":\"mmsi\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"mmsi\\\\\"\"},{\"Name\":\"imo\",\"ColumnSimpleType\":\"Integer\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"imo\\\\\"\"},{\"Name\":\"group\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"group\\\\\"\"},{\"Name\":\"style\",\"ColumnSimpleType\":\"String\",\"IsPrimary\":false,\"IsIdentity\":false,\"IsComputed\":false,\"expression\":\"\\\\\"style\\\\\"\"}]',\r\n                        function (response) {\r\n                            if (response.Status.toLowerCase() == \"ok\") {\r\n                                _myFleetLayers.push(response.Result.properties.name);\r\n                                addDefaultGroup(resolve, reject, []);\r\n                            }\r\n                            else\r\n                                reject(response); // creation failed\r\n                        }\r\n                    );\r\n                }\r\n                else\r\n                    resolve();\r\n            })\r\n            .then(()=>{\r\n                return new Promise((resolve, reject) => {\r\n                    if (!remove)\r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                            '&objects=[{\"properties\":{ \"imo\": ' + vessel.imo + ', \"mmsi\": ' + vessel.mmsi + '},\"action\":\"insert\"}]',\r\n                            function (response) {\r\n                                if (response.Status.toLowerCase() == \"ok\") {\r\n                                    resolve();\r\n                                    _vessels.push({ \"mmsi\": vessel.mmsi, \"imo\": vessel.imo, \"gmx_id\": response.Result[0] });\r\n                                }\r\n                                else\r\n                                    reject(response);\r\n                            });\r\n                    else\r\n                        sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                            'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                            '&objects=[{\"id\":' + remove + ',\"action\":\"delete\"}]',\r\n                            function (response) {\r\n                                if (response.Status.toLowerCase() == \"ok\")\r\n                                    resolve();\r\n                                else\r\n                                    reject(response);\r\n                            });\r\n                })\r\n                .then(\r\n                function () {\r\n                    this.isDirty = true;\r\n                    _fireChanged();\r\n                    return Promise.resolve();\r\n                }.bind(this),\r\n                function (response) {\r\n                    console.log(response);\r\n                    this.isDirty = true;\r\n                    return Promise.resolve();\r\n                }.bind(this))\r\n                .then(\r\n                    function(){\r\n                        if (remove)\r\n                            _tools.removeMyFleetTrack(vessel.mmsi);\r\n                        else\r\n                            this.view.displayTracks && \r\n                            this.loadTrack(vessel.mmsi, infoDialog);\r\n                            \r\n                        return Promise.resolve();                       \r\n                    }.bind(this)\r\n                );\r\n            });\r\n        },\r\n        changeGroup: function(mmsi, group)  {   \r\n            let i=Polyfill.findIndex(_vessels, (v)=>{return v.mmsi==mmsi})\r\n            if (i<0) \r\n                return Promise.reject(mmsi);\r\n            _vessels[i].group = group;\r\n            return new Promise((resolve, reject)=>{\r\n                sendCrossDomainJSONRequest(aisLayerSearcher.baseUrl +\r\n                    'VectorLayer/ModifyVectorObjects.ashx?LayerName=' + _myFleetLayers[0] +\r\n                    '&objects=[' +\r\n                    '{\"properties\":' + JSON.stringify(_vessels[i]) +\r\n                    ',\"id\":' + _vessels[i].gmx_id + ',\"action\":\"update\"}]', (r)=>{\r\n                    if (r.Status && r.Status.toLowerCase()==\"ok\"){\r\n                        let i, j, found = false;\r\n                        for (i=0; i<_data.groups.length; ++i){\r\n                            for (j=0; j<_data.groups[i].vessels.length; ++j){\r\n                                found = _data.groups[i].vessels[j].mmsi==mmsi;\r\n                                if (found) break;\r\n                            }                            \r\n                            if (found) break; \r\n                        } \r\n                        let temp = _data.groups[i].vessels.splice(j, 1)[0];\r\n                        i = !group?0:Polyfill.findIndex(_data.groups, g=>g.title==group)\r\n                        _data.groups[i].vessels.push(temp);\r\n                        resolve(r);\r\n                    }\r\n                    else\r\n                        reject(r);\r\n                });\r\n            });\r\n        },        \r\n        saveLabelSettings: function(count){\r\n            let groups = [];\r\n            for (let i = 0; i < _data.groups.length; ++i) {\r\n                if (_data.groups[i].default){\r\n                    groups.push(_data.groups[i]);\r\n                    break;\r\n                }\r\n            }\r\n            return _persistGroupsLook(count, groups);\r\n        },        \r\n        saveGroupStyle: function(count){\r\n            return _persistGroupsLook(count, _data.groups);\r\n        },\r\n        changeGroupStyle: function(i, colors){\r\n            _data.groups[i].marker_style = colors.marker_style;\r\n            _data.groups[i].label_color = colors.label_color;\r\n            _data.groups[i].label_shadow = colors.label_shadow;\r\n            _tools.highlightMarker(i, this.data.groups[i]);\r\n            \r\n            let g = _data.groups[i],\r\n            group = Polyfill.find(_vessels, v=>(!v.mmsi && !v.imo && v.gmx_id==g.id)),\r\n            style = {ms: g.marker_style, lc: g.label_color, lsc: g.label_shadow_color};\r\n            if(g.default)\r\n                style.mt = _markerTemplate;\r\n            group.style = JSON.stringify(style);\r\n//console.log(group)\r\n//console.log(this.data.groups[i].marker_style)\r\n        },\r\n        loadTrack: function(mmsi, infoDialog){\r\n            if (window.Worker) {\r\n                const baseUrl = window.serverBase.replace(/^(https?:)/, \"$1\"),\r\n                interval = this.historyInterval,\r\n                thisView = this.view;\r\n                let counter = _vessels.length;\r\n\r\n                let v = {mmsi: mmsi},\r\n                    myWorker = new Worker(_modulePath + 'LoaderWorker.js');\r\n                    myWorker.postMessage({mmsi:v.mmsi, url:`${baseUrl}plugins/AIS/SearchMfPositionsAsync.ashx?layer=8EE2C7996800458AAF70BABB43321FA4&mmsi=${v.mmsi}&s=${interval.dateBegin.toISOString()}&e=${interval.dateEnd.toISOString()}`});\r\n                    myWorker.onmessage = function(e) {\r\n//console.log('Message received from worker', e.data);\r\n                        _tools.showMyFleetTrack([e.data], ({pid})=>{\r\n                            _aisLayerSearcher.searchById([pid], response=>{\r\n                                if (response.Status && response.Status.toLowerCase()=='ok' && response.Result){\r\n                                    let v={}, res = response.Result;\r\n                                    res.fields.forEach((f, i)=>v[f] = res.values[0][i]);\r\n                                    infoDialog.show(v, false);\r\n                                }\r\n                            })\r\n                        }, _aisLayerSearcher, thisView);\r\n                        counter--;\r\n                        if (!counter)\r\n                            thisView.inProgress(false);\r\n                    }                \r\n                    myWorker.onerror = function(e) {\r\n                        console.log(e);\r\n                        counter--;\r\n                        if (!counter)\r\n                            thisView.inProgress(false)\r\n                    }\r\n                    _trackLoaders.push(myWorker);\r\n            }\r\n            else\r\n                console.log(\"NO WORKERS\")\r\n        },\r\n        loadTracks: function(infoDialog, viewState){\r\n            if (window.Worker) {\r\n                _trackLoaders.forEach(w=>w.terminate());\r\n                _trackLoaders.length = 0;   \r\n\r\n                const baseUrl = window.serverBase.replace(/^(https?:)/, \"$1\"),\r\n                interval = this.historyInterval,\r\n                thisView = this.view;\r\n//console.log('LOAD TRACKS', interval)\r\n//console.log(_vessels, _vessels.length)\r\n\r\n                const begin = interval.dateBegin.getTime()/1000, end = interval.dateEnd.getTime()/1000;\r\n                this.data.groups.forEach(g=>{\r\n                    g.vessels.forEach(v=>{\r\n                        if (begin>v.ts_pos_org || v.ts_pos_org>end){\r\n                //console.log(v.vessel_name, v.ts_pos_utc)\r\n                            _tools.eraseMyFleetMarker(v.mmsi);\r\n                        }\r\n                    })\r\n                });\r\n                _tools.showMyFleetTrack();\r\n\r\n                Promise.all(_vessels.map(v=>new Promise((resolve, reject)=>{\r\n                    if (v.mmsi) {\r\n                        var myWorker = new Worker(_modulePath + 'LoaderWorker.js');\r\n                        myWorker.postMessage({mmsi:v.mmsi, imo:v.imo, url:`${baseUrl}plugins/AIS/SearchMfPositionsAsync.ashx?layer=8EE2C7996800458AAF70BABB43321FA4&mmsi=${v.mmsi}&s=${interval.dateBegin.toISOString()}&e=${interval.dateEnd.toISOString()}`});\r\n                        myWorker.onmessage = function(e) {\r\n                            resolve(e.data);\r\n                        };                \r\n                        myWorker.onerror = function(e) {\r\n                            reject(e);\r\n                        };\r\n                        _trackLoaders.push(myWorker);\r\n                    }\r\n                    else{\r\n                        resolve();\r\n                    }\r\n                })))\r\n                .then(data=>{\r\n//console.log(data, data.length)\r\n                    data.reduce((p,c)=>p.then(()=>{\r\n                        if (!c) return Promise.resolve();\r\n\r\n                        _tools.showMyFleetTrack([c], ({pid})=>{\r\n                            _aisLayerSearcher.searchById([pid], response=>{\r\n                                if (response.Status && response.Status.toLowerCase()=='ok' && response.Result){\r\n                                    let v={}, res = response.Result;\r\n                                    res.fields.forEach((f, i)=>v[f] = res.values[0][i]);\r\n                                    infoDialog.show(v, false);\r\n                                }\r\n                            })\r\n                        }, _aisLayerSearcher, viewState);\r\n//console.log(c,  c.positions ? Math.round(c.positions.length/3.5) : 0)\r\n                        return new Promise(resolve=>setTimeout(()=>resolve(), c.positions ? Math.round(c.positions.length/3.5) : 0));\r\n                    }) , Promise.resolve())\r\n                    .then(()=>thisView.inProgress(false));\r\n                })\r\n                .catch(e=>{\r\n                    console.log(e);\r\n                    thisView.inProgress(false);\r\n                });\r\n            }\r\n            else\r\n                console.log(\"NO WORKERS\");\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Models/MyFleetModel.js","module.exports = { \r\n\tfind: function(a, predicate) {\r\n\t\tvar list = Object(a);\r\n\t\tvar length = list.length >>> 0;\r\n\t\tvar thisArg = arguments[2];\r\n\t\tvar value;\r\n\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t  value = list[i];\r\n\t\t  if (predicate.call(thisArg, value, i, list)) {\r\n\t\t\treturn value;\r\n\t\t  }\r\n\t\t}\r\n\t\treturn undefined;\r\n\t},\r\n\tfindIndex: function(a, predicate) {\r\n\t\tvar list = Object(a);\r\n\t\tvar length = list.length >>> 0;\r\n\t\tvar thisArg = arguments[2];\r\n\t\tvar value;\r\n\r\n\t\tfor (var i = 0; i < length; i++) {\r\n\t\t  value = list[i];\r\n\t\t  if (predicate.call(thisArg, value, i, list)) {\r\n\t\t\treturn i;\r\n\t\t  }\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Polyfill.js","require(\"./DbSearch.css\");\r\nrequire(\"../Controls/SearchControl.css\");\r\nconst BaseView = require('./BaseView.js'),\r\nSearchControl = require('../Controls/SearchControl');\r\n\r\nlet _searchLayer,\r\n    _highlight,\r\n    _tools,\r\n    _displayedOnly = [],\r\n    _displayed = [],\r\n    _viewState = {\r\n        get displayedOnly(){return _displayedOnly;},\r\n        get displayed(){\r\n            return _displayed;\r\n        },\r\n        showTracks: function(trackBuilder, needAlt){\r\n            trackBuilder.showHistoryTracks(this.displayed, needAlt);\r\n        },\r\n        hideTracks: function(trackBuilder, needAlt){\r\n            //trackBuilder.hideHistoryTracks(_notDisplayed, needAlt);\r\n        },\r\n        cleanTracks: function(trackBuilder){\r\n            _displayed = trackBuilder.cleanHistoryTracks();\r\n        }\r\n    };\r\nconst _switchLegendIcon = function(showAlternative){\r\n    let ic = this.frame.find('.legend_icon'),\r\n    ica = this.frame.find('.legend_iconalt');\r\n    if (showAlternative){\r\n        ic.hide(); ica.show();\r\n    }\r\n    else{\r\n        ica.hide(); ic.show();\r\n    }\r\n};\r\nconst DbSearchView = function (model, options, tools, viewCalendar) {\r\n    BaseView.call(this, model, tools);\r\n    _searchLayer = options.aisLastPoint;\r\n    _highlight = options.highlight;\r\n    _tools = tools;\r\n    _viewState.view = this;\r\n    this.frame = $(Handlebars.compile('<div class=\"ais_view search_view\">' +\r\n        '<table border=0 class=\"instruments\">' +\r\n        '<tr><td colspan=\"2\" class=\"search_input_container\">' + \r\n        \r\n        //'<div class=\"filter\"><input type=\"text\" placeholder=\"{{i \"AISSearch2.filter\"}}\"/>' +\r\n        //'<div><img class=\"search clicable\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        //'<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\">' +\r\n        //'</div></div>' + \r\n        '' +\r\n\r\n        '</td></tr>' +\r\n        '<tr><td class=\"time\" colspan=\"2\"><span class=\"label\">{{i \"AISSearch2.time_switch\"}}:</span>' +\r\n        '<span class=\"utc on unselectable\" unselectable=\"on\">UTC</span><span class=\"local unselectable\" unselectable=\"on\">{{i \"AISSearch2.time_local\"}}</span>'+\r\n        '<span class=\"sync-switch-slider-description\" style=\"padding: 0;margin-left: 10px;line-height:12px\">{{i \"AISSearch2.thisVesselOnly\"}}</span>'+ \r\n        '<label class=\"sync-switch switch only_this\" style=\"margin-left:5px\"><input type=\"checkbox\">'+\r\n        '<div class=\"sync-switch-slider switch-slider round\"></div></label>' +\r\n        '</td></tr>' +\r\n\r\n        '<tr><td><style>' + \r\n        '#ui-datepicker-div .ui-datepicker-next {height: 1.8em !important;}' +\r\n        '#ui-datepicker-div .ui-datepicker-next span.ui-icon.ui-icon-circle-triangle-e {background: url(img/arrows.png) no-repeat 0 -18px !important;}' +\r\n        '#ui-datepicker-div .ui-datepicker-next.ui-state-hover span.ui-icon.ui-icon-circle-triangle-e {background: url(img/arrows.png) no-repeat 0 -38px !important;}' +\r\n        '</style><div class=\"calendar\"></div></td>' +\r\n\r\n        '<td style=\"vertical-align:top;\"><div class=\"refresh clicable\" title=\"{{i \"AISSearch2.refresh\"}}\">' +\r\n        '<div class=\"progress\">' + this.gifLoader + '</div>' +\r\n        '<div class=\"reload\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path fill=\"#2f3c47\" d=\"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z\"/></svg></div>' +\r\n        '</div></td></tr>' +\r\n        '</table>' +\r\n\r\n        '<div class=\"ais_history\">' +\r\n        '<table class=\"ais_positions_date\"><tr><td>NO HISTORY FOUND</td></tr></table>' +\r\n        '</div>' +\r\n        '<table class=\"start_screen\"><tr><td>' +\r\n        '<img src=\"plugins/AIS/AISSearch/svg/steer-weel.svg\">' +\r\n        '<div>{{{i \"AISSearh2.searchresults_view\"}}}' +\r\n        '</div></td></tr></table>' +\r\n\r\n        //'<div class=\"suggestions\"><div class=\"suggestion\">SOME VESSEL<br><span>mmsi:0, imo:0</span></div></div>' +\r\n        '</div>'\r\n    )());\r\n\r\n    Object.defineProperty(this, \"topOffset\", {\r\n        get: function () {\r\n            let th = $('.ais_tabs')[0].getBoundingClientRect().height,\r\n            ih = this.frame.find('.instruments')[0].getBoundingClientRect().height,\r\n            rv = th + ih;\r\n            this.frame.find('.instruments').height(ih);\r\n            return rv;\r\n        }\r\n    });  \r\n\r\n    this.container = this.frame.find('.ais_history');\r\n    this.startScreen = this.frame.find('.start_screen');\r\n    this.tableTemplate = '{{#if msg}}<div class=\"message\">{{msg}}</div>{{/if}}' +\r\n\r\n    '<table class=\"ais_positions_date header\"><tr>' +\r\n    '<td></td>' +\r\n    '<td><span class=\"date\"></span></td>' +\r\n    '<td><div class=\"track all\"><input type=\"checkbox\" title=\"{{i \"AISSearch2.allDailyTracks\"}}\"></div></td>' +\r\n    '<td><div class=\"count\">{{total}}</div></td></tr></table>' +\r\n\r\n        '{{#each vessels}}' +\r\n        '<table class=\"ais_positions_date\" border=0><tr>' +\r\n        '<td><div class=\"open_positions ui-helper-noselect icon-right-open\" title=\"{{i \"AISSearch2.voyageInfo\"}}\"></div></td>' +\r\n        '<td><span class=\"date\">{{{ts_pos_utc}}}</span></td>' +\r\n        '<td><div class=\"track\" date=\"{{{ts_pos_utc}}}\"><input type=\"checkbox\" title=\"{{i \"AISSearch2.dailyTrack\"}}\"></div></td>' +\r\n        '<td><div class=\"count\">{{count}}</div></td></tr></table>' +\r\n        '<div id=\"voyage_info{{n}}\"></div>' +\r\n        '{{/each}}';\r\n\r\n        this.calendar = viewCalendar;\r\n        this.frame.find('.calendar').append(this.calendar.el);\r\n        this.calendar.onChange = function (e) {\r\n            const changes = {\r\n                dateBegin: e.interval.begin, \r\n                dateEnd: e.interval.end\r\n            };\r\n            this.model.historyInterval = changes;\r\n            this.model.isDirty = true;\r\n\r\n//console.log('dbsearch.historyInterval', this.model.historyInterval) \r\n  \r\n            nsGmx.leafletMap.removeLayer(_highlight);                   \r\n            if (this.isActive){  \r\n                nsGmx.widgets.commonCalendar.setDateInterval(changes.dateBegin, changes.dateEnd);\r\n                this.show();  \r\n            }  \r\n\r\n        }.bind(this);\r\n\r\n    this.frame.find('.time .only_this  input[type=\"checkbox\"]').click((e=>{\r\n        _displayedOnly.length = 0;\r\n        if (e.currentTarget.checked && this.frame.find('.ais_positions_date:not(.header)')[0] ) {\r\n            _displayedOnly.push(this.model.data.vessels[0].positions[0].mmsi.toString()); \r\n        }        \r\n        _tools.showVesselsOnMap(_viewState);\r\n \r\n    }).bind(this));\r\n\r\n    _tools.onLegendSwitched((()=>{\r\n        _switchLegendIcon.call(this, _tools.needAltLegend);\r\n    }).bind(this));\r\n\r\n    this.frame.find('.time .utc,.local').click((e => {\r\n        let trg = $(e.currentTarget);\r\n        if (!trg.is('.on')) {\r\n            this.frame.find('.time span').removeClass(\"on\");\r\n            trg.addClass('on')\r\n            if (trg.is('.utc')) {\r\n                this.frame.find('.utc_time').show();\r\n                this.frame.find('.local_time').hide();\r\n                this.frame.find('.utc_date').show();\r\n                this.frame.find('.local_date').hide();\r\n            }\r\n            else {\r\n                this.frame.find('.utc_time').hide();\r\n                this.frame.find('.local_time').show();\r\n                this.frame.find('.utc_date').hide();\r\n                this.frame.find('.local_date').show();\r\n            }\r\n        }\r\n\r\n    }).bind(this));\r\n\r\n    this.frame.find('.refresh .reload').click((e=>{\r\n        if (e.currentTarget.style.display=\"block\"){\r\n            this.model.isDirty = true;\r\n            this.model.update();\r\n        }\r\n    }).bind(this));\r\n\r\n    this.searchInput = new SearchControl({tab:this.frame[0], container:this.frame.find('.search_input_container')[0], \r\n    searcher: {\r\n        searchPromise: function(params){\r\n            var request =  `layer=${_searchLayer}&columns=[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"vessel_type\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]&orderby=vessel_name&${params[0].name}=${params[0].value}`;\r\n            //return Request.fetchRequest('/Plugins/AIS/SearchShip.ashx', request, 'POST');\r\n            return fetch(document.location.protocol + window.serverBase.replace(/^https?:/, '') + 'Plugins/AIS/SearchShip.ashx', {                \r\n                headers: {'Content-Type': 'application/x-www-form-urlencoded'},\r\n                method: 'POST', \r\n                mode: 'cors',\r\n                body: encodeURI(request)\r\n            });\r\n        },\r\n        parser: function(response){ \r\n//console.log(response)               \r\n            if (response.Status && response.Status.toLowerCase()=='ok' && response.Result){                    \r\n                let columns = response.Result.columns,\r\n                    values = response.Result.values;\r\n                return values.map(v=>{\r\n                    let rv = {};\r\n                    columns.forEach((c, i)=>{rv[c] = v[i]});\r\n                    return rv;\r\n                });\r\n            }\r\n            else{\r\n                console.log(response);\r\n                return [];\r\n            }\r\n        }\r\n    },\r\n    callback:(v=>{\r\n//console.log(v)               \r\n        if (v) {\r\n            if (!this.vessel || this.vessel.mmsi != v.mmsi || !this.frame.find('.ais_positions_date:not(.header)')[0]) {\r\n                this.vessel = v;\r\n                this.show();\r\n            }\r\n        }\r\n        else {\r\n            _clean.call(this);\r\n            if (_displayedOnly.length) \r\n                this.frame.find('.time .only_this  input[type=\"checkbox\"]').click();\r\n            this.vessel = null;\r\n        }\r\n    }).bind(this)\r\n});\r\n   \r\n};\r\n\r\nDbSearchView.prototype = Object.create(BaseView.prototype);\r\n\r\nconst _clean = function () {\r\n    this.frame.find('.open_positions').off('click');\r\n    this.frame.find('.ais_positions_date .track input[type=\"checkbox\"]').off('click');\r\n    let scrollCont = this.container.find('.mCSB_container')\r\n    if (scrollCont[0])\r\n        scrollCont.empty();\r\n    else\r\n        this.container.empty();\r\n    //console.log(\"EMPTY ON SELF.CLEAN \"+this)\r\n    this.startScreen.css({ visibility: \"hidden\" });\r\n    nsGmx.leafletMap.removeLayer(_highlight);\r\n    this.showTrack();\r\n};\r\n\r\nDbSearchView.prototype.inProgress = function (state) {\r\n    let progress = this.frame.find('.refresh div.progress'),\r\n    reload = this.frame.find('.refresh div.reload');\r\n    if (state){\r\n        progress.show();\r\n        reload.hide();\r\n    }\r\n    else{\r\n        progress.hide();\r\n        reload.show();\r\n    }\r\n};\r\n\r\nlet _vi_template = '<table class=\"ais_positions\">' +\r\n    '{{#each positions}}' +\r\n    '<tr>' +\r\n    '<td  title=\"{{i \"AISSearch2.info\"}}\"><img class=\"show_info\" id=\"show_info{{@index}}\" src=\"plugins/AIS/AISSearch/svg/info.svg\"></td>' +\r\n    '<td><span class=\"utc_time\">{{tm_pos_utc}}</span><span class=\"local_time\">{{tm_pos_loc}}</span></td>' +\r\n    '<td><span class=\"utc_date\">{{dt_pos_utc}}</span><span class=\"local_date\">{{dt_pos_loc}}</span></td>' +\r\n    '<td><img src=\"{{icon}}\" class=\"legend_icon rotateimg{{icon_rot}}\"><img src=\"{{iconAlt}}\" class=\"legend_iconalt rotateimg{{icon_rot}}\"></td>' +\r\n    '<td><img src=\"{{source}}\"></td>' +\r\n    '<td>{{longitude}}&nbsp;&nbsp;{{latitude}}</td>' +\r\n    '<td><div class=\"show_pos\" id=\"show_pos{{@index}}\" title=\"{{i \"AISSearch2.position\"}}\"><img src=\"plugins/AIS/AISSearch/svg/center.svg\"></div></td>' +\r\n    '</tr>' +\r\n    '<tr><td colspan=\"7\" class=\"more\"><hr><div class=\"vi_more\">' +\r\n\r\n    '<div class=\"c1\">COG | SOG:</div><div class=\"c2\">&nbsp;{{cog}} {{#if cog_sog}}&nbsp;{{/if}} {{sog}}</div>' +\r\n    '<div class=\"c1\">HDG | ROT:</div><div class=\"c2\">&nbsp;{{heading}} {{#if heading_rot}}&nbsp;{{/if}} {{rot}}</div>' +\r\n    '<div class=\"c1\">{{i \"AISSearch2.draught\"}}:</div><div class=\"c2\">&nbsp;{{draught}}</div>' +\r\n    '<div class=\"c1\">{{i \"AISSearch2.destination\"}}:</div><div class=\"c2\">&nbsp;{{destination}}</div>' +\r\n    '<div class=\"c1\">{{i \"AISSearch2.nav_status\"}}:</div><div class=\"c2\">&nbsp;{{nav_status}}</div>' +\r\n    '<div class=\"c1\">ETA:</div><div class=\"c2\">&nbsp;<span class=\"utc_time\">{{eta_utc}}</span><span class=\"local_time\">{{eta_loc}}</span></div>' +\r\n\r\n    '</div></td></tr>' +\r\n    '{{/each}}' +\r\n    '</table>';\r\n\r\nDbSearchView.prototype.repaint = function () {\r\n    _clean.call(this);\r\n    BaseView.prototype.repaint.call(this); \r\n\r\n    if (this.model.data.msg)\r\n        this.frame.find('.ais_positions_date.header').hide();\r\n\r\n// console.log(\"REPAINT\") \r\n    _tools.clearMyFleetMarkers();\r\n    _displayedOnly.length = 0; \r\n    if (this.frame.find('.time .only_this  input[type=\"checkbox\"]')[0].checked) {\r\n        _displayedOnly.push(this.model.data.vessels[0].positions[0].mmsi.toString());  \r\n    }         \r\n    _tools.showVesselsOnMap(_viewState);\r\n\r\n    let openPos = this.frame.find('.open_positions'),    \r\n        infoDialog = this.infoDialogView,\r\n        thisVessel = this.vessel,\r\n        showInfoDialog = function(position){\r\n            position.vessel_name = thisVessel.vessel_name;\r\n            position.latitude = position.ymax;\r\n            position.longitude = position.xmax;\r\n            position.source = position.source_orig;\r\n            infoDialog.show(position, false);\r\n        };\r\n    openPos.each((ind, elm) => {\r\n        $(elm).click(((e) => {\r\n            let icon = $(e.target),\r\n                vi_cont = this.frame.find('#voyage_info' + ind);\r\n            if (icon.is('.icon-down-open')) {\r\n                icon.removeClass('icon-down-open').addClass('.icon-right-open');\r\n                vi_cont.find('.ais_positions td[class!=\"more\"]').off('click')\r\n                vi_cont.empty();\r\n            }\r\n            else {\r\n                icon.addClass('icon-down-open').removeClass('.icon-right-open');\r\n                vi_cont.html(Handlebars.compile(_vi_template)(this.model.data.vessels[ind]));\r\n                if (this.frame.find('.time .local').is('.on')) {\r\n                    vi_cont.find('.utc_time').hide();\r\n                    vi_cont.find('.local_time').show();\r\n                    vi_cont.find('.utc_date').hide();\r\n                    vi_cont.find('.local_date').show();\r\n                }\r\n                //switchLegendIcons();\r\n                _switchLegendIcon.call(this, _tools.needAltLegend);\r\n                vi_cont.find('.ais_positions td[class!=\"more\"]').click((e) => {\r\n                    let td = $(e.currentTarget);\r\n                    if (td.is('.active')) {\r\n                        td.removeClass('active')\r\n                        td.siblings().removeClass('active')\r\n                        td.parent().next().find('td').removeClass('active')\r\n                    }\r\n                    else {\r\n                        td.addClass('active')\r\n                        td.siblings().addClass('active')\r\n                        td.parent().next().find('td').addClass('active')\r\n                    }\r\n                });\r\n                vi_cont.find('.ais_positions .show_info').click(((e) => {\r\n                    let i = e.currentTarget.id.replace(/show_info/, \"\"),\r\n                        position = this.model.data.vessels[ind].positions[i];\r\n                    position.vessel_name = thisVessel.vessel_name;\r\n                    position.latitude = position.ymax;\r\n                    position.longitude = position.xmax;\r\n                    position.source = position.source_orig;\r\n                    infoDialog.show(position, false);\r\n                    e.stopPropagation();\r\n                }).bind(this));\r\n                vi_cont.find('.ais_positions .show_pos').click(((e) => {\r\n                    //showPosition\r\n                    let i = e.currentTarget.id.replace(/show_pos/, \"\"),\r\n                        position = this.model.data.vessels[ind].positions[parseInt(i)];\r\n                    this.positionMap(position, this.calendar.interval);\r\n\r\n                    this.frame.find('.track:not(.all) input')[ind].checked = true; \r\n                    allTracksInput[0].checked = (this.frame.find('.track:not(.all) input:checked').length==this.model.data.vessels.length);  \r\n\r\n                    let v = this.model.data.vessels[ind], nv = this.model.data.vessels[ind+1];\r\n                    this.showTrack([{\r\n                        mmsi: v.positions[0].mmsi, imo: v.positions[0].imo, ts: v.positions[0].ts_pos_org,\r\n                        positions: v.positions,\r\n                        end: nv && nv.positions ? nv.positions[0] : null\r\n                    }], ({p})=>showInfoDialog(p));\r\n\r\n                    e.stopPropagation();\r\n                }).bind(this));\r\n            }\r\n        }).bind(this));\r\n    });\r\n\r\n    const allTracksInput = this.frame.find('.ais_positions_date .track.all input[type=\"checkbox\"]'),\r\n          tracksInputs = this.frame.find('.ais_positions_date .track:not(.all) input[type=\"checkbox\"]');\r\n\r\n    allTracksInput.click(((e) => {        \r\n        //setMapCalendar(this.calendar);\r\n        this.frame.find('.ais_positions_date .track:not(.all) input').each((i, el) => {\r\n            el.checked = e.target.checked;\r\n        });\r\n\r\n        let vessels = [], dv = this.model.data.vessels;\r\n        dv.forEach((v, i) => { \r\n            let nv = dv[i+1];\r\n            vessels.push({ \r\n                mmsi: v.positions[0].mmsi, imo: v.positions[0].imo, ts: v.positions[0].ts_pos_org, lastPos: v.lastPos,\r\n                positions: e.target.checked ? v.positions : [],\r\n                end: nv && nv.positions ? nv.positions[0] : null\r\n            });\r\n        });\r\n        this.showTrack(vessels, ({p})=>showInfoDialog(p));\r\n    }).bind(this));\r\n    tracksInputs.each(((i, el)=>{\r\n        let vessels = this.model.data.vessels, v = vessels[i], nv = vessels[i+1];\r\n        el.addEventListener('click', ((e)=>{ \r\n\r\n            allTracksInput[0].checked = (this.frame.find('.ais_positions_date .track:not(.all) input:checked').length==vessels.length);\r\n            \r\n            this.showTrack([{\r\n                mmsi: v.positions[0].mmsi, imo: v.positions[0].imo, ts: v.positions[0].ts_pos_org, lastPos: v.lastPos,\r\n                positions: e.target.checked ? v.positions : [],\r\n                end: nv && nv.positions ? nv.positions[0] : null\r\n            }], ({p})=>showInfoDialog(p));\r\n\r\n        }).bind(this));\r\n    }).bind(this));\r\n\r\n    if (this.model.data.vessels.length == 1)\r\n        openPos.eq(0).click();\r\n\r\n    tracksInputs.eq(0).click();\r\n\r\n    if (this.vessel.lastPosition){\r\n        this.positionMap(this.vessel, this.calendar.interval);\r\n        this.vessel.lastPosition = false;\r\n    }   \r\n    \r\n//     const intervalEnd = this.model.data.vessels.length;\r\n//     if (intervalEnd){\r\n//         const lastDate = new Date(this.model.data.vessels[intervalEnd-1].positions[0].ts_pos_org*1000);\r\n//         lastDate.setUTCHours(0,0,0,0); \r\n// //console.log(this.model.historyInterval)   \r\n//         if (this.calendar.dateBegin.getTime()<lastDate.getTime()){\r\n//             this.calendar.dateBegin = lastDate;\r\n// //console.log(lastDate, calendarlastDate)  \r\n// //console.log(this.model.historyInterval) \r\n//         }       \r\n//     }\r\n};\r\n\r\nObject.defineProperty(DbSearchView.prototype, \"vessel\", {\r\n    get() {\r\n        return this.model.vessel;\r\n    },\r\n    set(v) {\r\n        this.model.vessel = v;\r\n        if (!v)\r\n            return;\r\n            \r\n        this.searchInput.searchString = v.vessel_name;        \r\n        let positionDate = nsGmx.DateInterval.getUTCDayBoundary(new Date((v.ts_pos_org||v.ts_pos_utc) * 1000)),\r\n            checkInterval = this.calendar.interval;\r\n        if (positionDate.dateBegin < checkInterval.begin || checkInterval.end < positionDate.dateEnd){\r\n            this.calendar.interval = { begin: positionDate.dateBegin, end: positionDate.dateEnd };   \r\n        }\r\n        else\r\n            this.model.historyInterval = { dateBegin: checkInterval.begin, dateEnd: checkInterval.end };\r\n        this.model.isDirty = true;\r\n    }\r\n});\r\n\r\nDbSearchView.prototype.show = function () {\r\n    BaseView.prototype.show.call(this); \r\n    this.searchInput.focus();       \r\n    _tools.showVesselsOnMap(_viewState); \r\n};\r\n\r\nDbSearchView.prototype.hide = function () { \r\n    if (!this.isActive)\r\n        return;\r\n\r\n    BaseView.prototype.hide.call(this); \r\n    _tools.cleanMap(_viewState);\r\n};\r\n\r\nDbSearchView.prototype.showTrack = function (vessels, onclick) {\r\n\r\n    _displayed = _tools.showHistoryTrack(vessels, onclick); \r\n\r\n    if (!vessels || !Array.isArray(vessels))\r\n        return;\r\n\r\n    vessels.forEach(vessel => {\r\n        let dlg = $('.ui-dialog:contains(\"' + vessel.mmsi + '\")');\r\n        $('.showtrack').attr('title', _gtxt('AISSearch2.show_track'))\r\n            .removeClass('ais active');\r\n        if (dlg[0])\r\n            dlg.find('.showtrack').attr('title', _gtxt('AISSearch2.hide_track'))\r\n                .addClass('ais active');\r\n    });\r\n};\r\n\r\nDbSearchView.prototype.positionMap = function (vessel, interval) {\r\n//console.log(\"positionMap\")\r\n    if (interval)       \r\n        nsGmx.widgets.commonCalendar.setDateInterval(interval.begin, interval.end);\r\n\r\n    if (!vessel.xmax && !vessel.longitude && !vessel.ymax && !vessel.latitude){\r\n        vessel.longitude = this.model.data.vessels[0].positions[0].xmax;\r\n        vessel.latitude = this.model.data.vessels[0].positions[0].ymax;\r\n//console.log(vessel);\r\n//console.log(this.model.data.vessels[0].positions[0]);\r\n    }\r\n        \r\n    let xmin = vessel.xmin ? vessel.xmin : vessel.longitude,\r\n        xmax = vessel.xmax ? vessel.xmax : vessel.longitude,\r\n        ymin = vessel.ymin ? vessel.ymin : vessel.latitude,\r\n        ymax = vessel.ymax ? vessel.ymax : vessel.latitude,\r\n        zoom = nsGmx.leafletMap.getZoom();\r\n\r\n    nsGmx.leafletMap.setView([ymax, xmax<0?(360+xmax):xmax], (zoom < 9 ? 12 : zoom));\r\n    nsGmx.leafletMap.removeLayer(_highlight);\r\n    _highlight.vessel = vessel;\r\n    _highlight.setLatLng([ymax, xmax<0?(360+xmax):xmax]).addTo(nsGmx.leafletMap);\r\n};\r\n\r\nDbSearchView.prototype.formatDate = function (d, local){\r\n    return _tools.formatDate(d, local);\r\n};\r\n\r\nDbSearchView.prototype.formatPosition = function (obj, searcher){\r\n    return _tools.formatPosition(obj, searcher);\r\n};\r\n\r\nmodule.exports = DbSearchView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/DbSearchView.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/DbSearch.css\n// module id = 18\n// module chunks = 0","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Controls/SearchControl.css\n// module id = 19\n// module chunks = 0","\r\n\r\nlet _searchString = \"\",\r\n_sparams = 'imo name mmsi';\r\n\r\n_translationsHash.addtext('rus', {'AISSearchControl.placeholder': 'Поиск'});\r\n_translationsHash.addtext('eng', {'AISSearchControl.placeholder': 'Search'});\r\n\r\nconst SearchControl = function ({ tab, container, callback, searchparams, searcher }) {\r\n\r\n    container.innerHTML = '<div class=\"filter\"><input type=\"text\" placeholder=\"' + _gtxt(\"AISSearchControl.placeholder\") + '\"/>' +\r\n        (!searchparams ? '' : '<div class=\"preferences\"></div>') +\r\n        '<div class=\"searchremove\"><img class=\"search\" src=\"plugins/AIS/AISSearch/svg/search.svg\">' +\r\n        '<img class=\"remove clicable\" src=\"plugins/AIS/AISSearch/svg/remove.svg\"></div>' +\r\n        '</div>';\r\n    let suggestions = tab.appendChild(document.createElement('div'));\r\n    suggestions.classList.add(\"suggestions\");\r\n    suggestions.innerHTML = '<div class=\"suggestion\">SOME VESSEL<br><span>mmsi:0, imo:0</span></div>';\r\n\r\n    this.frame = { find: (q) => { return container.querySelector(q) } };\r\n\r\n    let preferences = false;\r\n    if (searchparams){\r\n        _sparams = localStorage.getItem(searchparams);\r\n        preferences = tab.appendChild(document.createElement('div'));\r\n        preferences.classList.add(\"preferences\");\r\n        preferences.innerHTML = '<div class=\"section\">Поиск по:</div>' +\r\n            '<div class=\"line\"><div class=\"checkbox imo disabled\"></div><div class=\"label\">IMO<label></div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox mmsi\"></div><div class=\"label\">MMSI<label></div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox name disabled\"></div><div class=\"label\">названию</div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox callsign\"></div><div class=\"label\">позывному<label></div></div>' +\r\n            '<div class=\"line\"><div class=\"checkbox owner\"></div><div class=\"label\">собственнику<label></div></div>';\r\n        !_sparams && (_sparams = 'imo name mmsi');\r\n        if (_sparams.search(/imo/) < 0)\r\n            _sparams += ' imo';\r\n        if (_sparams.search(/name/) < 0)\r\n            _sparams += ' name';\r\n        let asparams = _sparams.split(' ');\r\n        asparams.forEach((p, i) => { preferences.querySelector('.' + p).classList.add('checked') });\r\n    }\r\n    else{\r\n        let sr = this.frame.find('.filter .searchremove');\r\n        sr.style.borderRight = 'none';\r\n        sr.style.paddingRight = 0;\r\n        this.frame.find('.filter input').style.width = '85%';\r\n    }\r\n\r\n    this.frame = { find: (q) => { return container.querySelector(q) } }\r\n    this.searchInput = this.frame.find('.filter input');\r\n\r\n    let searchBut = this.frame.find('.filter .search'),\r\n        prefeBut = this.frame.find('.filter .preferences'),\r\n        removeBut = this.frame.find('.filter .remove'),\r\n        delay,\r\n        //suggestions = this.frame.find('.suggestions'),\r\n        suggestionsCount = 5,\r\n        suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 },\r\n        found = { values: [] },\r\n        searchDone = function () {\r\n            if (found.values.length > 0) {\r\n                _searchString = found.values[suggestionsFrame.current].vessel_name;\r\n                this.searchInput.value = (_searchString);\r\n                callback(found.values[suggestionsFrame.current]);\r\n            }\r\n            // else {\r\n            //     _clean.call(this);\r\n            // }\r\n        },\r\n        doSearch = function (actualId) {\r\n            let requests = [];\r\n            // _sparams.split(' ').forEach(sp=>{       \r\n            //     requests.push(fetch(\"//kosmosnimki.ru/demo/lloyds/api/v1/Ship/Search/\" + sp + \"/\" + _searchString));\r\n            // });\r\n            requests.push(new searcher.searchPromise([{name:'query', value: [_searchString]}]));\r\n            Promise.all(requests)\r\n            .then(a=>{\r\n//console.log(a)\r\n                return Promise.all(a.map(r=>{\r\n                    if (r.status != 200){\r\n                        console.log(r)                       \r\n                        return [];\r\n                    }\r\n                    else\r\n                        return r.json()\r\n                }))\r\n            })\r\n            .then(a=>{\r\n//console.log(actualId+\" \"+delay)\r\n                if (actualId==delay){\r\n                    found = {values:[]};\r\n                    a.forEach(r=>{found.values = found.values.concat( searcher.parser(r) );});\r\n//console.log(found.values)\r\n                }\r\n                else \r\n                    return Promise.reject(\"stop\")                    \r\n            })\r\n            .then(function () { // SUCCEEDED\r\n//console.log(_searchString)\r\n                if (found.values.length == 0 || _searchString == \"\") {\r\n                    suggestions.style.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                let scrollCont = suggestions.querySelector('.mCSB_container'),\r\n                    content = Handlebars.compile(\r\n                        '{{#each values}}<div class=\"suggestion\" id=\"{{@index}}\">{{vessel_name}}<br><span>mmsi:{{mmsi}}, imo:{{imo}}, {{callsign}}</span><br><span>{{owner}}</span></div>{{/each}}'\r\n                    )(found);\r\n                if (!scrollCont) {\r\n                    suggestions.innerHTML = (content);\r\n                    $(suggestions).mCustomScrollbar();\r\n                }\r\n                else\r\n                    scrollCont.innerHTML = (content);\r\n\r\n                let suggestion = suggestions.querySelectorAll('.suggestion');\r\n                if (suggestions.style.display != 'block') {\r\n                    let cr = this.frame.find('.filter').getBoundingClientRect();\r\n                    suggestions.style.display = 'block';\r\n                    suggestions.style.position = 'fixed';\r\n                    suggestions.style.left = cr.left + \"px\"; suggestions.style.top = (cr.bottom - 3) + \"px\";\r\n                    suggestions.style.width = (Math.round(cr.width) - 2) + \"px\";\r\n                    // $(suggestions).offset({ left: cr.left, top: cr.bottom - 3 });\r\n                    // $(suggestions).outerWidth(cr.width)\r\n                }\r\n\r\n                suggestions.style.height = suggestion[0].getBoundingClientRect().height *\r\n                    (found.values.length > suggestionsCount ? suggestionsCount : found.values.length) + \"px\";\r\n\r\n                suggestionsFrame = { first: 0, current: 0, last: suggestionsCount - 1 };\r\n                suggestion[suggestionsFrame.current].classList.add('selected');\r\n                suggestion.forEach(((el, i) =>\r\n                    el.onclick = (e => {\r\n                        suggestionsFrame.current = e.currentTarget.id;\r\n                        suggestions.style.display = 'none';\r\n                        searchDone.call(this);\r\n                    }).bind(this)\r\n                ).bind(this));\r\n            }.bind(this),\r\n            function (response) { // FAILED\r\n                if (response!=\"stop\")\r\n                    console.log(response);\r\n            });\r\n        };\r\n\r\n    tab.addEventListener('click', function (e) {\r\n        suggestions.style.display = 'none';\r\n    });\r\n    if (preferences) {\r\n        tab.addEventListener('click', function (e) {\r\n            preferences.style.display = 'none';\r\n        });\r\n        prefeBut.onclick = function (e) {\r\n            if (preferences.style.display != 'block') {\r\n                let cr = this.frame.find('.filter').getBoundingClientRect();\r\n                preferences.style.display = 'block';\r\n                preferences.style.position = 'fixed';\r\n                preferences.style.left = (cr.left + (cr.width - preferences.offsetWidth) / 2) + \"px\";\r\n                preferences.style.top = (cr.bottom + 10) + \"px\";\r\n                e.stopPropagation()\r\n            }\r\n        }.bind(this);\r\n\r\n        preferences.querySelectorAll('.line').forEach(el => el.onclick = e => {\r\n            let ch = el.querySelector('.checkbox');\r\n            if (!ch.classList.contains('disabled')) {\r\n                let sparam = ch.classList.value.replace(/ *(checked|checkbox) */g, '');\r\n                if (ch.classList.contains('checked')) {\r\n                    ch.classList.remove('checked');\r\n                    _sparams = _sparams.replace(new RegExp(sparam), '').replace(/ {2,}/g, ' ');\r\n                }\r\n                else {\r\n                    ch.classList.add('checked');\r\n                    _sparams = _sparams + ' ' + sparam;\r\n                }\r\n                _sparams = _sparams.replace(/^\\s+|\\s+$/g, '')\r\n                localStorage.setItem(searchparams, _sparams);\r\n                //console.log(_sparams)\r\n            }\r\n            e.stopPropagation()\r\n        });\r\n    }\r\n    \r\n    removeBut.onclick = (function (e) {\r\n        _searchString = '';\r\n        callback(null);\r\n        this.searchInput.value = ('');\r\n        this.searchInput.focus();\r\n        clearTimeout(delay)\r\n        removeBut.style.display = 'none';\r\n        searchBut.style.display = 'block';\r\n        suggestions.style.display = 'none';\r\n        //_clean.call(this);\r\n    }.bind(this));\r\n\r\n    this.searchInput.onkeydown = (function (e) {\r\n        let suggestion = suggestions.querySelector('.suggestion.selected');\r\n        if (suggestions.style.display == 'block') {\r\n            if (e.keyCode == 38) {\r\n                if (suggestionsFrame.current > 0) {\r\n                    suggestionsFrame.current--;\r\n                    suggestion.classList.remove('selected')\r\n                    suggestion.previousSibling.classList.add('selected');\r\n                }\r\n            }\r\n            else if (e.keyCode == 40) {\r\n                if (suggestionsFrame.current < found.values.length - 1) {\r\n                    suggestionsFrame.current++;\r\n                    suggestion.classList.remove('selected')\r\n                    suggestion.nextSibling.classList.add('selected');\r\n                }\r\n            }\r\n            if (suggestionsFrame.last < suggestionsFrame.current) {\r\n                suggestionsFrame.last = suggestionsFrame.current;\r\n                suggestionsFrame.first = suggestionsFrame.last - (suggestionsCount - 1);\r\n            }\r\n            if (suggestionsFrame.first > suggestionsFrame.current) {\r\n                suggestionsFrame.first = suggestionsFrame.current;\r\n                suggestionsFrame.last = suggestionsFrame.first + (suggestionsCount - 1);\r\n            }\r\n\r\n            $(suggestions).mCustomScrollbar(\"scrollTo\", \"#\" + suggestionsFrame.first, { scrollInertia: 0 });\r\n        }\r\n    });\r\n\r\n    let prepareSearchInput = function (temp, keyCode) {\r\n        removeBut.style.display = 'block';\r\n        searchBut.style.display = 'none';\r\n//console.log(\"delay clear\"+delay)\r\n//console.log(_searchString + \"==\"+ temp)\r\n        if (_searchString == temp && (!keyCode || keyCode != 13))\r\n            return false;\r\n\r\n        clearTimeout(delay);\r\n\r\n        _searchString = temp;\r\n        if (_searchString == \"\") {\r\n            removeBut.click();\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    this.searchInput.onkeyup = (function (e) {\r\n        let temp = (this.searchInput.value || \"\")\r\n            .replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n        if (!prepareSearchInput(temp, e.keyCode))\r\n            return;\r\n        if (e.keyCode == 13) {\r\n            suggestions.style.display = 'none';\r\n            searchDone.call(this);\r\n        }\r\n        else{\r\n            delay = setTimeout((() => {\r\n                doSearch.apply(this, [delay])\r\n            }).bind(this), 200);\r\n        }\r\n    }.bind(this));\r\n\r\n\r\n    this.searchInput.onpaste = function (e) {\r\n        let temp = ((e.originalEvent || window.clipboardData || e).clipboardData.getData('text') || \"\")\r\n            .replace(/^\\s+/, \"\").replace(/\\s+$/, \"\");\r\n        if (!prepareSearchInput(temp))\r\n            return;\r\n        delay = setTimeout((() => {\r\n            doSearch.call(this, [delay])\r\n        }).bind(this), 200);\r\n    }.bind(this);\r\n\r\n    Object.defineProperty(this, \"searchString\", {\r\n        set: function (v) {\r\n            prepareSearchInput(v, 13);\r\n            this.searchInput.value = v;\r\n        }\r\n    }); \r\n\r\n}\r\n\r\nSearchControl.prototype.focus = function () {\r\n    this.searchInput.focus();\r\n}\r\n\r\nmodule.exports = SearchControl;\n\n\n// WEBPACK FOOTER //\n// ./src/Controls/SearchControl.js","module.exports = function (aisLayerSearcher) {\r\n    let _actualUpdate;\r\n    return {\r\n        searcher: aisLayerSearcher,\r\n        filterString: \"\",\r\n        isDirty: false,\r\n        load: function (actualUpdate) {\r\n            if (!this.isDirty)\r\n                return Promise.resolve();\r\n \r\n            var _this = this;\r\n            return new Promise((resolve) => {\r\n                aisLayerSearcher.searchPositionsAgg2(_this.vessel.mmsi, _this.historyInterval, function (response) {\r\n//console.log(response)       \r\n                    if (parseResponse(response)) {\r\n                        let position, positions = [], previous,\r\n                            fields = response.Result.fields,\r\n                            groups = response.Result.values.reduce((p, c) => {\r\n                                let obj = {}, d;\r\n                                for (var j = 0; j < fields.length; ++j) {\r\n                                    obj[fields[j]] = c[j];\r\n                                    if (fields[j] == 'ts_pos_utc'){\r\n                                        let dt = c[j], t = dt - dt % (24 * 3600);\r\n                                        d = new Date(t * 1000);\r\n                                        obj['ts_pos_org'] = c[j];\r\n                                    }\r\n                                }\r\n                                if (p[d]) {\r\n                                    p[d].positions.push(_this.view.formatPosition(obj, aisLayerSearcher));\r\n                                    p[d].count = p[d].count + 1;\r\n                                }\r\n                                else{\r\n                                    p[d] = { ts_pos_utc: _this.view.formatDate(d), positions: [_this.view.formatPosition(obj, aisLayerSearcher)], count: 1 };\r\n                                    if (previous) // todo check date diff!!\r\n                                        previous.lastPos = {xmax: p[d].positions[0].xmax, ymax: p[d].positions[0].ymax};\r\n                                }\r\n                                previous = p[d];\r\n                                return p;\r\n                            }, {});\r\n//console.log(groups)       \r\n                        let counter = 0;\r\n                        for (var k in groups) {\r\n                            groups[k][\"n\"] = counter++;\r\n                            positions.push(groups[k]);\r\n                        }\r\n                        resolve({ Status: \"ok\", Result: { values: positions, total: response.Result.values.length } });\r\n                    }\r\n                    else\r\n                        resolve(response)\r\n                })\r\n            })\r\n                .then(function (response) {\r\n//console.log(response)       \r\n                    _this.isDirty = false;\r\n                    if (response.Status.toLowerCase() == \"ok\") {\r\n                        _this.data = { vessels: response.Result.values, total: response.Result.total }\r\n                        return Promise.resolve();\r\n                    }\r\n                    else {\r\n                        return Promise.reject(response);\r\n                    }\r\n                });\r\n        },\r\n        update: function () {\r\n            if (!this.vessel || !this.isDirty)\r\n                return;\r\n\r\n            _actualUpdate = new Date().getTime();\r\n            let _this = this,\r\n                actualUpdate = _actualUpdate;\r\n            this.view.inProgress(true);\r\n            //this.filterString&&console.log(this.filterString+\" \"+this.filterString.search(/\\r$/))\r\n            //this.filterString&&console.log(this.filterString.replace(/^\\s+/, \"\").replace(/\\s+\\r*$/, \"\")!=\"\")            \r\n\r\n            this.load(actualUpdate).then(function () {\r\n                //console.log(\"LOADED \"+(new Date().getTime()-_this._actualUpdate)+\"ms\")\r\n                //console.log(\"3>\"+new Date(_this._actualUpdate))\r\n                //console.log(\"4>\"+new Date(actualUpdate))\r\n                if (_actualUpdate == actualUpdate) {\r\n//_this.data.vessels && (_this.data.vessels.length>0) && console.log(_this.data.vessels[0].positions[0])                    \r\n                    _this.view.inProgress(false);\r\n                    _this.view.repaint();\r\n                }\r\n            }, function (json) {\r\n                _this.dataSrc = null;\r\n                console.log(json)\r\n                if (json.Status.toLowerCase() == \"auth\" ||\r\n                    (json.ErrorInfo && json.ErrorInfo.some &&\r\n                        json.ErrorInfo.some(function (r) { return r.Status.toLowerCase() == \"auth\" })) ||\r\n                    (json.ErrorInfo && json.ErrorInfo.ErrorMessage.search(/not access/i) != -1))\r\n                    _this.data = { msg: _gtxt(\"AISSearch2.auth\"), vessels: [] };\r\n                else {\r\n                    //_this.data = {msg:[{txt:\"!!!\"}], vessels:[]};\r\n                    console.log(json);\r\n                }\r\n                _this.view.inProgress(false);\r\n                _this.view.repaint();\r\n            });\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/Models/DbSearchModel.js","const displayInfoDialog = require('./infodialog.js'),\r\n      Polyfill = require('../Polyfill'),\r\n      VesselInfoScreen = require('./VesselInfoScreen');\r\n\r\nlet infoDialogCascade = [],\r\n    allIinfoDialogs = [],\r\n    vesselInfoScreen;\r\n\r\nmodule.exports = function ({\r\n    tools,\r\n    aisLayerSearcher: aisLayerSearcher,\r\n    modulePath: modulePath,\r\n    aisView: aisView, \r\n    myFleetView: myFleetView,\r\n    menuId:menuId }) {\r\n\r\n    vesselInfoScreen  = new VesselInfoScreen({modulePath: modulePath, aisServices: aisLayerSearcher.aisServices});\r\n    const _showPosition = function(vessel, track){ \r\n\r\n        aisView.vessel = vessel;\r\n        if (aisView.tab)\r\n        if (aisView.tab.is('.active'))\r\n            aisView.show();\r\n        else\r\n            aisView.tab.click(); \r\n        aisView.showTrack(track);    \r\n        \r\n        \r\n        window.iconSidebarWidget.open(menuId);\r\n    }, \r\n    _updateView = function (displayed, vessel, getmore){\r\n        if (displayed.vessel.ts_pos_utc!=vessel.ts_pos_utc){\r\n            $(displayed.dialog).dialog(\"close\")\r\n            return true;\r\n        }\r\n        else\r\n            return false;\r\n    };\r\n    return {\r\n        showPosition: function(vessel){  \r\n            _showPosition(vessel, vessel);\r\n            //aisView.showTrack(vessel);\r\n        },\r\n        show: function (vessel, getmore) {\r\n            let ind = Polyfill.findIndex(allIinfoDialogs, function (d) { \r\n                return (!vessel.imo || d.vessel.imo == vessel.imo) && d.vessel.mmsi == vessel.mmsi \r\n            }),\r\n            isNew = true,\r\n            dialogOffset;\r\n//console.log(vessel, ind, allIinfoDialogs)\r\n            if (ind >= 0) {\r\n                isNew = false;\r\n                let displayed = allIinfoDialogs[ind];\r\n                dialogOffset = $(displayed.dialog).parent().offset();\r\n                ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == displayed.dialog.id })\r\n                if(!_updateView(displayed, vessel)){\r\n                    $(displayed.dialog).parent().insertAfter($('.ui-dialog').eq($('.ui-dialog').length - 1));\r\n                    return;\r\n                }\r\n            }\r\n\r\n            let dialog = displayInfoDialog({\r\n                vessel: vessel,\r\n                getmore: getmore,\r\n                displayedTrack: tools.displayedTrack,\r\n                closeFunc: function (event) {\r\n                    let ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == dialog.id });\r\n                    if (ind >= 0)\r\n                        infoDialogCascade.splice(ind, 1);\r\n                    ind = Polyfill.findIndex(allIinfoDialogs, function (d) { return d.dialog.id == dialog.id });\r\n                    if (ind >= 0)\r\n                        allIinfoDialogs.splice(ind, 1);\r\n                },\r\n                aisLayerSearcher: aisLayerSearcher,\r\n                modulePath:modulePath, \r\n                aisView: aisView,\r\n                myFleetView: myFleetView,\r\n                tools: tools\r\n            },\r\n                {\r\n                    openVesselInfoScreen: vesselInfoScreen.open,\r\n                    showTrack: tools.showTrack,\r\n                    showPosition: _showPosition\r\n                })\r\n\r\n            if (!dialogOffset && infoDialogCascade.length > 0) {\r\n                let pos = $(infoDialogCascade[infoDialogCascade.length - 1]).parent().position();\r\n                dialogOffset = {left:pos.left - 10, top:pos.top + 10};\r\n            }\r\n            if (dialogOffset)\r\n                $(dialog).dialog(\"option\", \"position\", [dialogOffset.left, dialogOffset.top]);\r\n            if (ind >= 0)\r\n                infoDialogCascade.splice(ind, 0, dialog);\r\n            else if(isNew)\r\n                infoDialogCascade.push(dialog);\r\n\r\n            allIinfoDialogs.push({ vessel: vessel, dialog: dialog });\r\n            $(dialog).on(\"dialogdragstop\", function (event, ui) {\r\n                var ind = Polyfill.findIndex(infoDialogCascade, function (d) { return d.id == dialog.id });\r\n                if (ind >= 0)\r\n                    infoDialogCascade.splice(ind, 1);\r\n            });\r\n\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/Views/InfoDialogView.js","require(\"./infodialog.css\")\r\nconst SpecialFloatView = require('./SpecialFloatView.js');\r\n\r\nlet addUnit = function (v, u) {\r\n\treturn v != null && v != \"\" ? v + u : \"\";\r\n},\r\n\tformatDate,\r\n\tformatDateTime,\r\n\tround = function (d, p) {\r\n\t\tlet isNeg = d < 0,\r\n\t\t\tpower = Math.pow(10, p)\r\n\t\treturn d ? ((isNeg ? -1 : 1) * (Math.round((isNeg ? d = -d : d) * power) / power)) : d\r\n\t},\r\n\tformatVessel = function (vessel) {\r\n\t\tlet d = new Date(vessel.ts_pos_utc * 1000);\r\n\t\tvessel.ts_pos_org = vessel.ts_pos_utc;\r\n\t\tvessel.dt_pos_utc = formatDate(d);\r\n\t\tvessel.ts_pos_utc = formatDateTime(d);\r\n\t\tvessel.ts_pos_loc = \"<br><span class='local'>\" + formatDateTime(d, true) + \"</span>\";\r\n\t\tvessel.ts_eta = vessel.ts_eta ? formatDateTime(new Date(vessel.ts_eta * 1000)) : \"\";\r\n\t\tvessel.cog = !isNaN(vessel.cog)?addUnit(round(vessel.cog, 5), \"°\"):vessel.cog;\r\n\t\tvessel.sog = !isNaN(vessel.sog)?addUnit(round(vessel.sog, 5), nsGmx.Translations.getLanguage()==\"rus\"?\" уз\":\" kn\"):vessel.sog;\r\n\t\tvessel.rot = !isNaN(vessel.rot)?addUnit(round(vessel.rot, 5), nsGmx.Translations.getLanguage()==\"rus\"?\"°/мин\":\"°/min\"):vessel.rot;\r\n\t\tvessel.heading = !isNaN(vessel.heading)?addUnit(round(vessel.heading, 5), \"°\"):vessel.heading;\r\n\t\tvessel.draught = !isNaN(vessel.draught)?addUnit(round(vessel.draught, 5), nsGmx.Translations.getLanguage()==\"rus\"?\" м\":\" m\"):vessel.draught;\r\n\t\tvessel.length = !isNaN(vessel.length)?addUnit(vessel.length, nsGmx.Translations.getLanguage()==\"rus\"?\" м\":\" m\"):vessel.length;\r\n\t\tvessel.width = !isNaN(vessel.width)?addUnit(vessel.width, nsGmx.Translations.getLanguage()==\"rus\"?\" м\":\" m\"):vessel.width;\r\n\t\tvessel.source = vessel.source == 'T-AIS' ? _gtxt('AISSearch2.tais') : _gtxt('AISSearch2.sais');\r\n\t\treturn vessel;\r\n\t},\r\n\ttoDd = function (D, lng) {\r\n\t\tlet dir = D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n\t\t\tdeg = Math.round((D < 0 ? D = -D : D) * 1000000) / 1000000\r\n\t\treturn deg + \"°\" + dir\r\n\t},\r\n\tddToDms = function (D, lng) {\r\n\t\tlet dms = {\r\n\t\t\tdir: D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n\t\t\tdeg: 0 | (D < 0 ? D = -D : D),\r\n\t\t\tmin: 0 | D % 1 * 60,\r\n\t\t\tsec: (0 | D * 60 % 1 * 6000) / 100\r\n\t\t};\r\n\t\treturn dms.deg + \"°\" + dms.min + \"'\" + dms.sec + \"\\\" \" + dms.dir\r\n\t},\r\n\tshipCams = {};\r\n\r\nmodule.exports = function ({ vessel, closeFunc, aisLayerSearcher, getmore,\r\n\tmodulePath,\taisView, displayedTrack,\r\n\tmyFleetView, tools }, commands) {\r\n\r\n\tif (!shipCams[vessel.mmsi]){\r\n\t\tnsGmx.gmxMap.layers.forEach(l => {\r\n\t\t\tif (l && l._gmx && l._gmx.properties) {\r\n\t\t\t\tlet props = l._gmx.properties,\r\n\t\t\t\t\ttitle = props.title,\r\n\t\t\t\t\tmeta = props.MetaProperties;\r\n\t\t\t\tif (title && (title.search(/^shipcam[^_]*_/) != -1) &&\r\n\t\t\t\tmeta.ships && (meta.ships.Value.search(new RegExp('\"'+vessel.mmsi+'\"'))!=-1)) {\r\n\t\t\t\t\tshipCams[vessel.mmsi] = { \r\n\t\t\t\t\t\tlayer: props.name,\r\n\t\t\t\t\t\turls: meta.urls.Value\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n//console.log(shipCams);\r\n\t}\r\n\r\n\tformatDate = aisLayerSearcher.formatDate;\r\n\tformatDateTime = aisLayerSearcher.formatDateTime;\r\n\r\n\tlet myFleetModel = myFleetView.model,\r\n\t\tadd = myFleetModel && myFleetModel.findIndex(vessel) < 0;\r\n\r\n\tlet canvas = $('<div class=\"ais_myfleet_dialog\"/>'),\r\n\t\tmenu = $('<div class=\"column1 menu\"></div>').appendTo(canvas),\r\n\t\tphoto = $('<div class=\"photo\"><div></div></div>').appendTo(menu),\r\n\t\tunderphoto = $('<div class=\"underphoto\"><div></div></div>').appendTo(menu),\r\n\t\tcontent = $('<div class=\"column2 content\"></div>'),\r\n\t\tbuttons = $('<div class=\"column3 buttons\"></div>'),\r\n\t\tgifLoader = '<img src=\"img/progress.gif\">'\r\n\t//console.log(content);\r\n\r\n\tcanvas.append(content).append(buttons)\r\n\r\n\tlet searchInput = $('.leaflet-ext-search'),\r\n\t\tdialogW = 610, dialogH = 250,\r\n\t\tposX = searchInput.offset().left + searchInput.width() - dialogW,\r\n\t\tposY = searchInput.offset().top + searchInput.height() + 10,\r\n\t\tdialog = showDialog(vessel.vessel_name, canvas[0], { \r\n\t\t\twidth: dialogW, height: dialogH, posX: posX, posY:posY, \r\n\t\t\tcloseFunc: closeFunc \r\n\t\t}),\r\n\t\tvessel2,\r\n\t\tmoreInfo = function (v) {\r\n\t\t\tlet smallShipIcon = '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"14px\" height=\"14px\" viewBox=\"0 0 14 14\" style=\"margin-left: 10px\" xml:space=\"preserve\">' +\r\n\t\t\t\t'<g style=\"fill: #48aff1;\">' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M13.4,11H0.6c-0.2,0-0.4,0.1-0.5,0.3c-0.1,0.2-0.1,0.4,0,0.6l1.2,1.8C1.4,13.9,1.6,14,1.8,14h9.9   c0.2,0,0.3-0.1,0.4-0.2l1.7-1.8c0.2-0.2,0.2-0.4,0.1-0.7C13.9,11.1,13.7,11,13.4,11z\"/>' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M9.3,9.7h2.9c0.2,0,0.4-0.1,0.5-0.3c0.1-0.2,0.1-0.4,0-0.6L9.8,4.5C9.7,4.3,9.4,4.2,9.2,4.3   C8.9,4.4,8.7,4.6,8.7,4.9v4.3C8.7,9.5,9,9.7,9.3,9.7z\"/>' +\r\n\t\t\t\t'<path class=\"st0\" d=\"M1.2,9.7H7c0.3,0,0.6-0.3,0.6-0.6V0.6c0-0.3-0.2-0.5-0.4-0.6C6.9-0.1,6.7,0,6.5,0.3L0.7,8.8   C0.6,9,0.5,9.2,0.6,9.4C0.7,9.6,0.9,9.7,1.2,9.7z\"/>' +\r\n\t\t\t\t'</g>' +\r\n\t\t\t\t'</svg>',\r\n\t\t\t\tvesselPropTempl = '<div class=\"vessel_prop vname\"><b>{{vessel_name}}</b>' + smallShipIcon + '</div>' +\r\n\t\t\t\t\t'<div class=\"vessel_prop altvname\"><b>' + (vessel2.registry_name && vessel2.registry_name != vessel2.vessel_name ? vessel2.registry_name : '') + '&nbsp;</b></div>'\r\n\r\n\t\t\t$('.content', canvas).append(Handlebars.compile(\r\n\t\t\t\t'<div class=\"vessel_props1\">' + vesselPropTempl +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.vessel_type\"}}: </div></td><td><div class=\"vessel_prop value\">{{vessel_type}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.flag\"}}: </div></td><td><div class=\"vessel_prop value\">{{flag_country}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">IMO: </div></td><td><div class=\"vessel_prop value\">{{imo}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">MMSI: </div></td><td><div class=\"vessel_prop value mmsi\">{{mmsi}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.callsign\"}}: </div></td><td><div class=\"vessel_prop value mmsi\">{{callsign}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.source\"}}: </div></td><td><div class=\"vessel_prop value\">{{source}}</div></td></tr>' +\r\n\t\t\t\t'</table>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t)(v));\r\n\r\n\t\t\t$('.content', canvas).append(Handlebars.compile(\r\n\t\t\t\t'<div class=\"vessel_props2\">' + vesselPropTempl +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">COG | SOG: </div></td><td><div class=\"vessel_prop value\">{{cog}}&nbsp;&nbsp;&nbsp;{{sog}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">HDG | ROT: </div></td><td><div class=\"vessel_prop value\">{{heading}}&nbsp;&nbsp;&nbsp;{{rot}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.draught\"}}: </div></td><td><div class=\"vessel_prop value\">{{draught}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.destination\"}}: </div></td><td><div class=\"vessel_prop value\">{{destination}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">{{i \"AISSearch2.nav_status\"}}: </div></td><td><div class=\"vessel_prop value\">{{nav_status}}</div></td></tr>' +\r\n\t\t\t\t'<tr><td><div class=\"vessel_prop\">ETA: </div></td><td><div class=\"vessel_prop value\">{{ts_eta}}</div></td></tr>' +\r\n\r\n\t\t\t\t'</div>'\r\n\t\t\t)(v));\r\n\r\n\t\t\t$(underphoto).append('<table><tr>' +\r\n\t\t\t\t'<td class=\"ais_refresh\"><svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" height=\"16\" width=\"16\"><g class=\"nc-icon-wrapper\" fill=\"#444444\"><polyline data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 15,16 7,16 7,13 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 15,18 17,16 15,14 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" data-stroke=\"none\" fill=\"#444444\" points=\"15,18 17,16 15,14 \" stroke-linejoin=\"miter\" stroke-linecap=\"square\" style=\"stroke: currentColor;fill: currentColor;\"/> <polyline data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 9,8 17,8 17,11 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\"9,6 7,8 9,10 \" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/> <polygon data-color=\"color-2\" data-stroke=\"none\" fill=\"#444444\" points=\"9,6 7,8 9,10 \" stroke-linejoin=\"miter\" stroke-linecap=\"square\" style=\"stroke: currentColor;fill: currentColor;\"/> <rect x=\"2\" y=\"1\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" width=\"20\" height=\"22\" stroke-linejoin=\"miter\" style=\"stroke: currentColor;\"/></g></svg></td>' +\r\n\t\t\t\t'<td><div class=\"vessel_prop coordinates\"><span class=\"small\">' +\r\n\t\t\t\tddToDms(v.latitude, false) + ' ' + ddToDms(v.longitude, true) +\r\n\t\t\t\t'</small></div></td>' +\r\n\t\t\t\t'</tr></table>'\r\n\t\t\t);\r\n\r\n\t\t\tlet swap = \"<span class='small'>\" + toDd(v.latitude, false) + \" \" + toDd(v.longitude, true) + \"</span>\"\r\n\t\t\t$('.ais_refresh', underphoto).click((e) => {\r\n\t\t\t\tlet mi = $('.coordinates', underphoto),\r\n\t\t\t\t\tt = mi.html()\r\n\t\t\t\tmi.html(swap)\r\n\t\t\t\tswap = t\r\n\t\t\t})\r\n\r\n\t\t\t$('.vessel_props1', canvas).hide()\r\n\t\t\t$('.vessel_prop.vname svg', canvas).css('visibility', add ? 'hidden' : 'visible')\r\n\r\n\t\t}\r\n\r\n\t$(dialog).dialog({ resizable: false });\r\n\r\n\tif (!getmore) {\r\n\t\tvessel2 = $.extend({}, vessel);\r\n\t\tmoreInfo(formatVessel(vessel2));\r\n\t}\r\n\telse\r\n\t\taisLayerSearcher.searchNames([{ mmsi: vessel.mmsi, imo: vessel.imo }], function (response) {\r\n\t\t\tif (parseResponse(response)) {\r\n\t\t\t\tvessel2 = {};\r\n\t\t\t\tfor (var i = 0; i < response.Result.fields.length; ++i)\r\n\t\t\t\t\tvessel2[response.Result.fields[i]] = response.Result.values[0][i];\r\n\t\t\t\tmoreInfo(formatVessel(vessel2));\r\n\t\t\t\t$('.date', titlebar).html('<span class=\"utc\">' + vessel2.ts_pos_utc + ' UTC</span>' + vessel2.ts_pos_loc);\r\n\t\t\t\tif (typeof (getmore) == \"function\")\r\n\t\t\t\t\tgetmore(vessel2)\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t\tconsole.log(response)\r\n\t\t})\r\n\r\n\t// IMAGE\t\r\n\tlet scheme = document.location.href.replace(/^(https?:).+/, \"$1\");\r\n\r\n\t$('<img src=\"' + scheme + window.serverBase.replace(/^https?:/, \"\")+'plugins/ais/getphoto.ashx?mmsi=' + vessel.mmsi + '\">')\r\n\t.load(function(){\t\r\n\t\tif (this) $('div', photo).replaceWith(this);\r\n\t})\r\n\t.error(function(){\t\t\r\n\t\t$('<img src=\"' + scheme + '//photos.marinetraffic.com/ais/showphoto.aspx?size=thumb&mmsi=' + vessel.mmsi + '\">')\r\n\t\t.load(function(){\r\n\t\t\t\tif (this) $('div', photo).replaceWith(this);\r\n\t\t})\r\n\t});\t\r\n\r\n\t// BUTTONS\r\n\tlet menubuttons = $('<div class=\"menubuttons\"></div>').appendTo(buttons)\r\n\r\n\tlet openpage = $('<div class=\"button openpage\" title=\"' + _gtxt('AISSearch2.show_info') + '\">' +\r\n\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\">' +\r\n\t\t'<g class=\"nc-icon-wrapper\" style=\"fill:currentColor\">' +\r\n\t\t'<path d=\"M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z\"/>' +\r\n\t\t'</g>' +\r\n\t\t'</svg>'\r\n\t\t+ '</div>')\r\n\t\t.appendTo(menubuttons)\r\n\t\t.on('click', () => commands.openVesselInfoScreen.call(null, vessel, vessel2));\r\n\r\n\tlet showpos = $('<div class=\"button showpos\" title=\"' + _gtxt('AISSearch2.show_pos') + '\">' +\r\n\t\t'<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 24 24\" xml:space=\"preserve\" width=\"20\" height=\"20\"><g class=\"nc-icon-wrapper\" fill=\"#444444\"><polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 1,7 1,1 7,1 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 17,1 23,1 23,7 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 23,17 23,23 17,23 \" stroke-linejoin=\"miter\"/> <polyline style=\"stroke:currentColor\" data-color=\"color-2\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" points=\" 7,23 1,23 1,17 \" stroke-linejoin=\"miter\"/> <rect style=\"stroke:currentColor\" x=\"8\" y=\"8\" fill=\"none\" stroke=\"#444444\" stroke-width=\"2\" stroke-linecap=\"square\" stroke-miterlimit=\"10\" width=\"8\" height=\"8\" stroke-linejoin=\"miter\"/></g></svg>' +\r\n\t\t'</div>')\r\n\t\t.appendTo(menubuttons)\r\n\t\t.on('click', function () {\r\n\t\t\tif (!vessel.ts_pos_org)\r\n\t\t\t\tvessel.ts_pos_org = vessel.ts_pos_utc;\r\n\t\t\tvessel.lastPosition = true;\r\n\t\t\tcommands.showPosition(vessel);\r\n\t\t\t// if(showtrack.is('.active'))\r\n\t\t\t// \tcommands.showTrack.call(null, [vessel.mmsi])\r\n\t\t});\t\r\n\r\n\r\n\tlet shipCam = shipCams[vessel.mmsi.toString()],\r\n\tsetImages = function(shipCam, vessel){\r\n\t\tlet moment = new Date(vessel.ts_pos_org*1000);\r\n\t\tmoment.setMinutes(moment.getMinutes() + moment.getTimezoneOffset())\r\n\t\tmoment = moment.getFullYear() + \"-\" + (moment.getMonth()+1) + \"-\" + moment.getDate() + \" \" + \r\n\t\tmoment.getHours() + \":\" + moment.getMinutes() + \":\" + moment.getSeconds();\r\n//console.log(moment)\t\r\n\t\tlet images = [];\r\n\t\tshipCam.urls.split(' ').forEach((url) => {\r\n\t\t\timages.push({url: serverBase.replace(/https?:/, document.location.protocol).replace(/\\/$/, \"\") + url.replace(/\"/g, '') + \r\n\t\t\t(url.search(/\\?/)!=-1?'&':'?') +\r\n\t\t\t'layer=' + shipCam.layer +\r\n\t\t\t'&mmsi=' + vessel.mmsi +\r\n\t\t\t'&ts=' + moment});\r\n\t\t});\r\n//console.log(images)\t\r\n\t\treturn images;\r\n\t}\r\n\r\n\tif (shipCam) {\r\n\t\tif (!shipCam.view) {\r\n\t\t\tshipCam.view = new SpecialFloatView(\r\n\t\t\t\tsetImages(shipCam, vessel2 ? vessel2 : vessel),\r\n\t\t\t\tvessel.mmsi\r\n\t\t\t);\r\n\t\t}\r\n\t\tlet special = shipCam.view;\r\n\t\t//console.log(special);\r\n\t\tlet showCamBut = $('<div class=\"ais button showcam\" title=\"' + _gtxt('AISSearch2.show_pos') + '\">' +\r\n\t\t\t'<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"22\" height=\"22\"><title>camera</title><g class=\"nc-icon-wrapper\" fill=\"#384b50\" style=\"fill:currentColor\"><path d=\"M21,4H17L15,1H9L7,4H3A3,3,0,0,0,0,7V19a3,3,0,0,0,3,3H21a3,3,0,0,0,3-3V7A3,3,0,0,0,21,4ZM12,18a5,5,0,1,1,5-5A5,5,0,0,1,12,18Z\"/></g></svg>' +\r\n\t\t\t'</div>')\r\n\t\t\t.appendTo(menubuttons)\r\n\t\t\t.on('click', function (e) {\r\n\t\t\t\tlet b = e.currentTarget\r\n\t\t\t\tif (b.classList.contains('active')) {\r\n\t\t\t\t\tb.classList.remove('active');\r\n\t\t\t\t\tshipCam.visible = false;\r\n\t\t\t\t\tspecial.close();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tb.classList.add('active');\r\n\t\t\t\t\tspecial.show(setImages(shipCam, vessel2 ? vessel2 : vessel), () => {\r\n\t\t\t\t\t\tb.classList.remove('active');\r\n\t\t\t\t\t\tshipCam.visible = false;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tshipCam.visible = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t//console.log(showCamBut)\r\n\t\t//console.log(shipCams[vessel.mmsi.toString()].visible)\r\n\t\tif (shipCam.visible) {\r\n\t\t\tshowCamBut[0].classList.add('active');\r\n\t\t\tspecial.show(setImages(shipCam, vessel2 ? vessel2 : vessel), () => {\r\n\t\t\t\tshowCamBut[0].classList.remove('active');\r\n\t\t\t\tshipCam.visible = false;\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tlet addremoveIcon = function (add) {\r\n\t\treturn (add ? '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><g class=\"nc-icon-wrapper\" fill=\"#444444\" style=\"fill: currentColor;\"><path d=\"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z\"/></g></svg>'\r\n\t\t\t: '<svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" width=\"24px\" height=\"24px\" viewBox=\"0 0 24 24\" style=\"enable-background:new 0 0 24 24;fill: currentColor;\" xml:space=\"preserve\"><g><path class=\"st0\" d=\"M4,6H2v14c0,1.1,0.9,2,2,2h14v-2H4V6z M20,2H8C6.9,2,6,2.9,6,4v12c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V4    C22,2.9,21.1,2,20,2z M19,11h-4v4h-2v-4H9V9h4V5h2v4h4V11z\"/></g><rect x=\"9\" y=\"5\" class=\"st0\" width=\"10\" height=\"4\"/><rect x=\"9\" y=\"11\" class=\"st0\" width=\"10\" height=\"4\"/></g></svg>')\r\n\t}\r\n\t\r\n\tlet addremove = $('<div class=\"button addremove\">' + addremoveIcon(add) + '</div>')\r\n\t\t.attr('title', add ? _gtxt('AISSearch2.myfleet_add') : _gtxt('AISSearch2.myfleet_remove'))\r\n\t\t.appendTo(menubuttons)\r\n\tif (myFleetModel.filterUpdating)\r\n\t\taddremove.addClass('disabled');\r\n\r\n\taddremove.on('click', function () {\r\n\t\tif (addremove.is('.disabled'))\r\n\t\t\treturn;\r\n\r\n\t\t$('.addremove').addClass('disabled')\r\n\t\taddremove.hide()\r\n\t\tprogress.append(gifLoader)\r\n\r\n\t\tmyFleetView.beforeExcludeMember(vessel.mmsi.toString());\r\n\t\tmyFleetModel.changeMembers(vessel, myFleetView.infoDialogView).then(function () {\r\n\t\t\tadd = myFleetModel.findIndex(vessel) < 0;\r\n\t\t\tvar info = $('.icon-ship[vessel=\"' + vessel.mmsi + ' ' + vessel.imo + '\"]');\r\n\t\t\tinfo.css('visibility', !add ? 'visible' : 'hidden');\r\n\t\t\t$('.vessel_prop.vname svg', canvas).css('visibility', add ? 'hidden' : 'visible')\r\n\t\t\t\r\n\t\t\taddremove.attr('title', add ? _gtxt('AISSearch2.myFleetInclude') : _gtxt('AISSearch2.myFleetExclude'))\r\n\t\t\t\t.html(addremoveIcon(add))\r\n\t\t\tprogress.text('');\r\n\t\t\t$('.addremove').removeClass('disabled').show();\r\n\t\t\t\r\n\t\t\ttools.eraseMyFleetMarker(vessel.mmsi);\r\n\t\t\tif (myFleetView.isActive)\r\n\t\t\t\tmyFleetView.show();\r\n\t\t\telse\r\n\t\t\t\ttools.redrawMarkers();\r\n\t\t})\r\n\t\t.catch((ex)=>console.log(ex));\r\n\t});\r\n\t//}\r\n\r\n\tlet progress = $('<div class=\"progress\"></div>')\r\n\t\t.appendTo(menubuttons);\r\n\r\n\t// TITLEBAR\t\r\n\tcanvas.parent('div').css({ 'margin': '0', 'overflow': 'hidden' })\r\n\tlet titlebar = $(dialog).parent().find('.ui-dialog-titlebar').css('padding', '0')\r\n\t\t.html('<table class=\"ais_info_dialog_titlebar\">' +\r\n\t\t'<tr><td><div class=\"date\">' +\r\n\t\t(!getmore ? Handlebars.compile('<span class=\"utc\">{{{ts_pos_utc}}} UTC</span>{{{ts_pos_loc}}}')(vessel2 ? vessel2 : vessel) : '') +\r\n\t\t'</div></td>' +\r\n\t\t\r\n\t\t'<td><div class=\"choose chooser done\"><span unselectable=\"on\">'+_gtxt('AISSearch2.dialog_tab_params')+'</span></div></td>' +\r\n\t\t'<td><div class=\"choose chooser\"><span unselectable=\"on\">'+_gtxt('AISSearch2.dialog_tab_general')+'</span></div></td>' +\r\n\t\t\r\n\t\t'<td id=\"closebut\" title=\"'+_gtxt('AISSearch2.close_but')+'\"><div class=\"ais_info_dialog_close-button\" title=\"'+_gtxt(\"AISSearch2.close_but\")+'\"></div></td></tr>' +\r\n\t\t'</table>'),\r\n\t\tonDone = function (e) { \r\n\t\t\te.stopPropagation(); \r\n\t\t\t$('.choose', titlebar).removeClass('done'); \r\n\t\t\t$(e.currentTarget).addClass('done'); \r\n\t\t};\r\n\r\n\t$('#closebut', titlebar).on('click', (e) => {$(dialog).dialog(\"close\"); })\r\n\t.on('mouseover', (e) => { \r\n\t\t$('.ais_info_dialog_close-button', titlebar).css('background', 'url(\"data:image/svg+xml;charset=utf8,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cline x1=\\'0\\' y1=\\'0\\' x2=\\'12\\' y2=\\'12\\' style=\\'stroke:%2348aff1;stroke-width:2px\\'/%3E%3Cline x1=\\'0\\' y1=\\'12\\' x2=\\'12\\' y2=\\'0\\' style=\\'stroke:%2348aff1;stroke-width:2px\\'/%3E%3C/svg%3E\") no-repeat')\r\n\t})\r\n\t.on('mouseout', (e) => { \r\n\t\t$('.ais_info_dialog_close-button', titlebar).attr('style', '')\r\n\t})\r\n\t//url(\"data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Cline x1='0' y1='0' x2='12' y2='12' style='stroke:%2348aff1;stroke-width:2px'/%3E%3Cline x1='0' y1='12' x2='12' y2='0' style='stroke:%2348aff1;stroke-width:2px'/%3E%3C/svg%3E\") no-repeat\r\n\t$('.chooser', titlebar).eq(1).on('mousedown', (e) => { onDone(e); $('.vessel_props1', canvas).show(); $('.vessel_props2', canvas).hide() })\r\n\t$('.chooser', titlebar).eq(0).on('mousedown', (e) => { onDone(e); $('.vessel_props2', canvas).show(); $('.vessel_props1', canvas).hide() })\r\n\t$('.date span', titlebar).on('mousedown', (e) => { e.stopPropagation(); })\r\n\r\n\t//$( dialog ).on( \"dialogdragstart\", function( e, ui ) {console.log(e);console.log(ui)} );\r\n\r\n\treturn dialog\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Views/infodialog.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/infodialog.css\n// module id = 24\n// module chunks = 0","require(\"./SpecialFloatView.css\")\r\nconst _cssClassName = \"special\";\r\nconst BaseFloatView = require('./BaseFloatView.js');\r\nconst SpecialFloatView = function (images, mmsi){\r\n    BaseFloatView.apply(this, arguments);\r\n    this.images = images;\r\n//console.log(this.images)\r\n    this.frame.innerHTML = '<div class=\"' + _cssClassName + '\"></div><img class=\"img1\"><img class=\"img2\">';\r\n    if (FormData.prototype.set && mmsi==273316240)\r\n        this.frame.innerHTML += '<table class=\"logos\"><tr><td><img src=\"plugins/AIS/AISSearch/png/anchors.png\" style=\"position: unset;\"></td></tr>' +\r\n        '<tr><td><img src=\"plugins/AIS/AISSearch/png/rscc-logo.png\" style=\"position: unset;\"></td></tr></table>';\r\n    else\r\n        this.frame.innerHTML += '<table class=\"logos\" style=\"background:none\"><tr><td></td></tr></table>';\r\n    this.left = -10000;\r\n\r\n    this.contextMenu = document.createElement(\"div\"); \r\n    this.contextMenu.className = 'mf_group_menu';\r\n    let html = '<div class=\"command zoomin\">' + _gtxt('AISSearch2.zoomin_com') + '</div>' +\r\n    '<div class=\"command zoomout\" style=\"display:none\">' + _gtxt('AISSearch2.zoomout_com') + '</div>'; \r\n    if (images.length == 2) {\r\n        html += '<div class=\"command image1\">' + _gtxt('AISSearch2.image1_com') + '</div>' +\r\n            '<div class=\"command image2\">' + _gtxt('AISSearch2.image2_com') + '</div>' +\r\n            '<div class=\"command twoimages\">' + _gtxt('AISSearch2.twoimages_com') + '</div>';\r\n    }\r\n    html += '<div class=\"command close\">' + _gtxt('AISSearch2.close_com') + '</div>';\r\n    this.contextMenu.innerHTML = html;\r\n\r\n    this.contextMenu.addEventListener('mousedown', (e=>{\r\n        if(e.stopPropagation) e.stopPropagation();\r\n        //if(e.preventDefault) e.preventDefault();\r\n        e.cancelBubble=true;\r\n        e.returnValue=false;\r\n    }).bind(this)); \r\n    this.contextMenu.addEventListener('mouseleave', (e=>{\r\n            this.contextMenu.style.display = \"none\";\r\n            this.contextMenu.remove();\r\n    }).bind(this));  \r\n\r\n    let closeCom = this.contextMenu.querySelector('.close'),\r\n    zinCom = this.contextMenu.querySelector('.zoomin'),\r\n    zoutCom = this.contextMenu.querySelector('.zoomout'),\r\n    img1Com = this.contextMenu.querySelector('.image1'),\r\n    img2Com = this.contextMenu.querySelector('.image2'),\r\n    twoimgCom = this.contextMenu.querySelector('.twoimages'),\r\n    l, t , w , h,\r\n    rc1, rc2,\r\n    content = this.frame.querySelector('.'+_cssClassName),    \r\n    image1 = this.frame.querySelector('img.img1'),\r\n    image2 = this.frame.querySelector('img.img2'),\r\n    logos = this.frame.querySelector('.logos'),\r\n    showTwo = false,\r\n    restoreSize = function(){\r\n        let h1 = Math.floor(image1.getBoundingClientRect().height),\r\n        h2 = Math.floor(image2.getBoundingClientRect().height);\r\n        if (h1)        \r\n            content.style.height = h1+\"px\"; \r\n        else if (h2)       \r\n            content.style.height = h2+\"px\";\r\n        showTwo = false;         \r\n    },\r\n    zoomIn = function(image, w, h, wiw, wih){\r\n        let setPlace1 = function(){\r\n            image.style.width = wiw + \"px\";\r\n            image.style.height = \"\";\r\n\r\n            image.style.left = 0;\r\n            image.style.top = Math.round((wih - image.getBoundingClientRect().height)/2) + \"px\";\r\n        },\r\n        setPlace2 = function(){\r\n            image.style.width = \"\";\r\n            image.style.height = wih + \"px\";\r\n \r\n            image.style.left = Math.round((wiw - image.getBoundingClientRect().width)/2) + \"px\"; \r\n            image.style.top = 0; \r\n        };\r\n        if(wiw/wih>1)\r\n            if(parseInt(w)/parseInt(h)>wiw/wih)\r\n                setPlace1();\r\n            else\r\n                setPlace2();\r\n        else\r\n            if(parseInt(w)/parseInt(h)>wiw/wih)\r\n                setPlace1();\r\n            else\r\n                setPlace2();\r\n    },\r\n    zoomIn2 = function(image1, image2, w, h, wiw, wih){\r\n        let setPlace1 = function(){\r\n            image1.style.width = wiw + \"px\";\r\n            image2.style.width = wiw + \"px\";\r\n            image1.style.height = \"\";\r\n            image2.style.height = \"\";\r\n\r\n            image1.style.left = 0;\r\n            image2.style.left = 0;\r\n            image1.style.top = Math.round(wih/2 - image1.getBoundingClientRect().height) + \"px\";           \r\n            image2.style.top = image1.getBoundingClientRect().bottom + \"px\"; \r\n        },\r\n        setPlace2 = function(){\r\n            image1.style.width = \"\";\r\n            image2.style.width = \"\";\r\n            image1.style.height = Math.ceil(wih/2) + \"px\";\r\n            image2.style.height = Math.floor(wih/2) + \"px\";\r\n\r\n            image1.style.top = 0;       \r\n            image2.style.top = image1.getBoundingClientRect().bottom + \"px\"; \r\n            image1.style.left = Math.round((wiw - image1.getBoundingClientRect().width)/2) + \"px\"; \r\n            image2.style.left = image1.style.left;             \r\n        };\r\n        if(wiw/wih>1)\r\n            if(parseInt(w)/parseInt(h)>wiw/wih)\r\n                setPlace1();\r\n            else\r\n                setPlace2();\r\n        else\r\n            if(parseInt(w)/parseInt(h)>wiw/wih)        \r\n                setPlace1();\r\n            else\r\n                setPlace2();\r\n    };\r\n    closeCom.addEventListener(\"click\",(e=>{ \r\n        !this.allowMove && zoutCom.click(); \r\n        this.contextMenu.remove(); \r\n        this.left = -10000;\r\n\r\n        image1.style.display = \"block\";\r\n        image2.style.display = \"none\";\r\n        restoreSize();\r\n\r\n        this.hide(); \r\n        image1.src = \"\";\r\n        image2.src = \"\";\r\n\r\n        this.closeCallback();\r\n    }).bind(this));\r\n    zinCom.addEventListener(\"click\",(e=>{\r\n        this.contextMenu.remove();\r\n        e.srcElement.style.display = 'none'; \r\n        zoutCom.style.display = 'block';\r\n        img1Com && (img1Com.style.display = 'none');\r\n        img2Com && (img2Com.style.display = 'none');\r\n        twoimgCom && (twoimgCom.style.display = 'none');\r\n        let st = getComputedStyle(content);\r\n        w = st.width; h = st.height; \r\n        l = this.left; t = this.top;\r\n        this.left = 0; \r\n        this.top = 0;  \r\n\r\n        content.style.width = window.innerWidth + \"px\";   \r\n        content.style.height = window.innerHeight + \"px\"; \r\n\r\n        rc1 = image1.getBoundingClientRect();\r\n        rc2 = image2.getBoundingClientRect();\r\n        let wiw = window.innerWidth, wih = window.innerHeight;\r\n// console.log((parseInt(w)+\"/ \"+parseInt(h)));\r\n// console.log(\"w/h \"+(parseInt(w)/parseInt(h)));\r\n// console.log(\"wiw/wih \"+(wiw/wih));\r\n\r\n        if (rc1.width && rc1.height && !rc2.width && !rc2.height){\r\n            zoomIn(image1, w, h, wiw, wih);\r\n            logos.style.left = image1.style.left;\r\n            logos.style.top = image1.style.top;\r\n        }\r\n        if (rc2.width && rc2.height && !rc1.width && !rc1.height){\r\n            zoomIn(image2, w, h, wiw, wih);\r\n            logos.style.left = image2.style.left;\r\n            logos.style.top = image2.style.top;\r\n        }\r\n        if (rc2.width && rc2.height && rc1.width && rc1.height){\r\n            zoomIn2(image1, image2, w, h, wiw, wih);\r\n            logos.style.left = image1.style.left;\r\n            logos.style.top = image1.style.top;\r\n        }\r\n\r\n        content.classList.add('zoomed_in');  \r\n        image1.classList.add('zoomed_in');   \r\n        image2.classList.add('zoomed_in'); \r\n        logos.classList.add('zoomed_in'); \r\n        this.allowMove = false;\r\n    }).bind(this));\r\n    zoutCom.addEventListener(\"click\",(e=>{\r\n        this.contextMenu.remove();\r\n        e.srcElement.style.display = 'none'; \r\n        zinCom.style.display = 'block';\r\n        img1Com && (img1Com.style.display = 'block');\r\n        img2Com && (img2Com.style.display = 'block');\r\n        twoimgCom && (twoimgCom.style.display = 'block');\r\n        this.left = l; \r\n        this.top = t;\r\n        content.style.width = w;   \r\n        content.style.height = h; \r\n\r\n        if (rc1.width && rc1.height) {     \r\n            image1.style.left = Math.floor(rc1.left) + \"px\";\r\n            image1.style.top = Math.floor(rc1.top) + \"px\";              \r\n            image1.style.height = Math.floor(rc1.height) + \"px\";\r\n            image1.style.width = Math.floor(rc1.width) + \"px\"; \r\n        }\r\n        if (rc2.width && rc2.height) {     \r\n            image2.style.left = Math.floor(rc2.left) + \"px\";\r\n            image2.style.top = Math.floor(rc2.top) + \"px\";       \r\n            image2.style.height = Math.floor(rc2.height) + \"px\";\r\n            image2.style.width = Math.floor(rc2.width) + \"px\";\r\n        }        \r\n        logos.style.left = 0;\r\n        logos.style.top = 0;\r\n\r\n        content.classList.remove('zoomed_in'); \r\n        image1.classList.remove('zoomed_in');   \r\n        image2.classList.remove('zoomed_in');   \r\n        logos.classList.remove('zoomed_in');  \r\n        this.allowMove = true;  \r\n    }).bind(this));\r\n    img1Com && img1Com.addEventListener(\"click\",(e=>{\r\n        this.contextMenu.remove();\r\n        restoreSize();\r\n        image1.style.top = 0;\r\n        image1.style.display = \"block\";\r\n        image2.style.display = \"none\";\r\n    }).bind(this));\r\n    img2Com && img2Com.addEventListener(\"click\",(e=>{\r\n        this.contextMenu.remove();\r\n        restoreSize();\r\n        image2.style.top = 0;\r\n        image2.style.display = \"block\";\r\n        image1.style.display = \"none\";\r\n    }).bind(this));\r\n    twoimgCom && twoimgCom.addEventListener(\"click\",(e=>{\r\n        showTwo = true;\r\n\r\n        this.contextMenu.remove();\r\n        image1.style.display = \"block\";\r\n        image2.style.display = \"block\"; \r\n        let h1 = Math.floor(image1.getBoundingClientRect().height),\r\n        h2 = Math.floor(image2.getBoundingClientRect().height);\r\n        image2.style.top = Math.floor(h1)+\"px\";\r\n        if (h1 || h2)\r\n            content.style.height = (h1 + h2) + \"px\"; \r\n    }).bind(this));\r\n    image1.addEventListener(\"click\", (e=>{\r\n        if(!this.allowMove)\r\n            zoutCom.click();\r\n    }).bind(this));\r\n    image2.addEventListener(\"click\", (e=>{\r\n        if(!this.allowMove)\r\n            zoutCom.click();\r\n    }).bind(this));\r\n    content.addEventListener(\"click\", (e=>{\r\n        if(!this.allowMove)\r\n            zoutCom.click();\r\n    }).bind(this));\r\n\r\n    this.frame.addEventListener(\"contextmenu\", (e=>{\r\n        e.preventDefault();\r\n        this.frame.append(this.contextMenu);\r\n        this.contextMenu.style.display = \"block\";\r\n\r\n        if ((e.clientX - 10 + this.contextMenu.offsetWidth) < window.innerWidth) { \r\n            this.contextMenu.style.left = (e.clientX - this.left - 10) + \"px\";\r\n            this.contextMenu.style.right = \"\";\r\n        }\r\n        else{ \r\n            this.contextMenu.style.right = (this.right - e.clientX - 10) + \"px\";\r\n            this.contextMenu.style.left = \"\";\r\n        }\r\n        if ((e.clientY - 10 + this.contextMenu.offsetHeight) < window.innerHeight) {\r\n            this.contextMenu.style.top = (e.clientY - this.top - 10) + \"px\";\r\n            this.contextMenu.style.bottom = \"\";\r\n        }\r\n        else {  \r\n            this.contextMenu.style.bottom = (this.bottom - e.clientY - 10) + \"px\";\r\n            this.contextMenu.style.top = \"\";\r\n        }       \r\n    }).bind(this));\r\n}\r\n\r\nSpecialFloatView.prototype = Object.create(BaseFloatView.prototype);\r\n\r\nSpecialFloatView.prototype.close = function(){ \r\n    this.contextMenu.querySelector('.close').click();\r\n}\r\n\r\nSpecialFloatView.prototype.show = function(images, closeCallback){    \r\n    BaseFloatView.prototype.show.apply(this, arguments);\r\n    this.closeCallback = closeCallback;\r\n    if (this.left>-9999 && images.length>1)\r\n        return; \r\n    this.images = images;  \r\n//console.log(this.images)  \r\n\r\n    let content = this.frame.querySelector('.'+_cssClassName),\r\n    image1 = this.frame.querySelector('img.img1'),\r\n    image2 = this.frame.querySelector('img.img2'),\r\n    rc = this.frame.getBoundingClientRect(),\r\n    imageUrl = this.images[0].url + (this.images[0].url.search(/\\?/)!=1?\"&r=\":\"?r=\"),\r\n    timers = [];\r\n \r\n    let downloadingImage1 = new Image();\r\n    downloadingImage1.onload = function(){\r\n        image1.src = this.src; \r\n        image1.style.left = 0; image1.style.top = 0;\r\n        image1.style.width = rc.width + \"px\";\r\n        //image1.style.height = getComputedStyle(image1).height;\r\n//console.log(downloadingImage1.width)  \r\n//console.log(getComputedStyle(image1).height)  \r\n//console.log(this.width)  \r\n//console.log(image1.getBoundingClientRect())  \r\n        if (image1.getBoundingClientRect().height)        \r\n            content.style.height = Math.floor(image1.getBoundingClientRect().height)+\"px\"; \r\n    };\r\n    downloadingImage1.onerror = function (e) {\r\n        image1.src = \"\";\r\n        image1.style.height = \"\"; \r\n    };\r\n    downloadingImage1.src = imageUrl + Math.random();\r\n\r\n    if (this.images[1]) {\r\n        let downloadingImage2 = new Image(),        \r\n        imageUrl = this.images[1].url + (this.images[1].url.search(/\\?/)!=1?\"&r=\":\"?r=\");\r\n        downloadingImage2.onload = function () {\r\n            image2.src = this.src;\r\n            image2.style.left = 0; image2.style.top = 0;\r\n            image2.style.width = rc.width + \"px\";\r\n            //image2.style.height = getComputedStyle(image2).height;\r\n            image2.style.display = \"none\";\r\n            //console.log(image1.getBoundingClientRect())\r\n        };\r\n        downloadingImage2.onerror = function (e) {\r\n            image2.src = \"\";\r\n            image2.style.height = \"\"; \r\n        };\r\n        downloadingImage2.src = imageUrl + Math.random();\r\n    }\r\n \r\n\r\n    if (this.left>-9999)\r\n        return; \r\n\r\n    this.left = document.defaultView.getWindowWidth() - this.width;\r\n    this.top = 0;\r\n\r\n//console.log(\"SET TIMERS\")\r\n\r\n    // UPDATE 1\r\n    let intrerval = 1000 * 60 * 1,\r\n    thisInst = this,\r\n    timer = setTimeout(function update() {\r\n//console.log(\"TIME1 \" + timer)\r\n        let downloadingImage1 = new Image();\r\n        downloadingImage1.onload = function () {\r\n            image1.src = downloadingImage1.src;\r\n        };\r\n        downloadingImage1.src = thisInst.images[0].url + (thisInst.images[0].url.search(/\\?/)!=1?\"&r=\":\"?r=\") + Math.random();\r\n//console.log(downloadingImage1.src)\r\n        timers[0] = setTimeout(update, intrerval);\r\n    }, intrerval);\r\n    timers.push(timer);\r\n\r\n    // UPDATE 2    \r\n    if (this.images[1]) {\r\n        timer = setTimeout(function update() {\r\n//console.log(\"TIME2 \" + timer)\r\n            let downloadingImage2 = new Image();\r\n            downloadingImage2.onload = function () {\r\n                image2.src = downloadingImage2.src;\r\n            };\r\n            downloadingImage2.src = thisInst.images[1].url + (thisInst.images[1].url.search(/\\?/)!=1?\"&r=\":\"?r=\") + Math.random();\r\n//console.log(downloadingImage2.src)\r\n            timers[1] = setTimeout(update, intrerval);\r\n        }, intrerval);\r\n        timers.push(timer)\r\n    }\r\n    \r\n    let closeCom = this.contextMenu.querySelector('.close');\r\n    this.disposeTimer && closeCom.removeEventListener(\"click\", this.disposeTimer);\r\n    this.disposeTimer = function () {\r\n//console.log(\"STOP TIME\")\r\n        timers.forEach(t=>clearTimeout(t));\r\n        timers.length = 0;\r\n    };\r\n    closeCom.addEventListener(\"click\", this.disposeTimer);\r\n}\r\n\r\nmodule.exports = SpecialFloatView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/SpecialFloatView.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/SpecialFloatView.css\n// module id = 26\n// module chunks = 0","let _getMaxZindex = function(){\r\n    let dialogs = document.querySelectorAll('.ui-dialog'),\r\n    z,\r\n    zMax = Array.prototype.map.call(document.querySelectorAll('.ui-front'), e=>e).reduce((p,c)=>{\r\n        z = parseFloat(getComputedStyle(c).zIndex);\r\n        return isNaN(z) || z<=p ? p : z;\r\n    }, 0);\r\n    zMax = Array.prototype.map.call(document.querySelectorAll('.float_view'), e=>e).reduce((p,c)=>{\r\n        z = parseFloat(getComputedStyle(c).zIndex);\r\n        return isNaN(z) || z<=p ? p : z;\r\n    }, zMax);\r\n    return zMax;\r\n};\r\nconst BaseFloatView = function (){\r\n    let frame = document.createElement(\"div\"); \r\n    frame.className = \"float_view\";\r\n    frame.style.position = \"absolute\";\r\n    frame.style.display = \"none\";\r\n    let x, y;\r\n    frame.addEventListener('mousedown', e=>{\r\n        if (!this.allowMove)\r\n            return;\r\n            \r\n        x = e.clientX; y = e.clientY;\r\n        frame.style.zIndex = _getMaxZindex();\r\n        document.body.append(frame);\r\n            \r\n        if(e.stopPropagation) e.stopPropagation();\r\n        if(e.preventDefault) e.preventDefault();\r\n        e.cancelBubble=true;\r\n        e.returnValue=false;\r\n    });\r\n    frame.addEventListener('mouseup', e=>{\r\n        x = false; y = false;\r\n    });\r\n    document.body.addEventListener('mousemove', e=>{\r\n        if (!x && !y)\r\n            return;\r\n        let dx = e.clientX - x, dy = e.clientY - y,\r\n        rect = frame.getBoundingClientRect(),\r\n        fx = rect.left, fy = rect.top;\r\n        frame.style.left = fx + dx + \"px\";\r\n        frame.style.top = fy + dy + \"px\";\r\n        x = e.clientX; y = e.clientY;\r\n\r\n        if(e.stopPropagation) e.stopPropagation();\r\n        if(e.preventDefault) e.preventDefault();\r\n        e.cancelBubble=true;\r\n        e.returnValue=false;\r\n    }); \r\n    this.frame = frame;   \r\n    this.allowMove = true;\r\n}\r\n\r\nBaseFloatView.prototype = function () {\r\n    return {\r\n        get left(){ return this.frame.getBoundingClientRect().left; },\r\n        set left(v){ this.frame.style.left = v + \"px\"; },\r\n        get top(){ return this.frame.getBoundingClientRect().top; },\r\n        set top(v){ this.frame.style.top = v + \"px\"; },\r\n        get right(){ return this.frame.getBoundingClientRect().right; },\r\n        get bottom(){ return this.frame.getBoundingClientRect().bottom; },\r\n        get width(){ return this.frame.getBoundingClientRect().width; },\r\n        set width(v){ this.frame.style.width = v + \"px\"; },\r\n        get height(){ return this.frame.getBoundingClientRect().height; },\r\n        set height(v){ this.frame.style.height = v + \"px\"; },\r\n        show: function () {\r\n            this.frame.style.zIndex = _getMaxZindex();\r\n            document.body.append(this.frame);\r\n            this.frame.style.display = \"block\";\r\n        },\r\n        hide: function () {\r\n            this.frame.remove();\r\n        }\r\n    }\r\n}();\r\n\r\nmodule.exports = BaseFloatView;\n\n\n// WEBPACK FOOTER //\n// ./src/Views/BaseFloatView.js","require(\"./VesselInfoScreen.css\")\r\n\r\nmodule.exports = function ({modulePath, aisServices}){\r\n        var _ais,  \r\n        _galery, \r\n        _register, \r\n        _regcap,    \r\n        _leftPanel,  \r\n        _minh,\r\n        _lloyds,\r\n        resize,\r\n        menuAction,       \r\n\t    scheme = document.location.href.replace(/^(https?:).+/, \"$1\"),\r\n        show = function(vessel){\r\n//console.log(vessel) \r\n            $(\"body\").append(''+  \r\n'<table class=\"vessel-info-page overlay\">' +\r\n        '<tr>' +\r\n            '<td>' +\r\n'<table class=\"vessel-info-page container\">' +\r\n    '<tr>' +\r\n        '<td class=\"column1\">' +\r\n                '<table>' +\r\n                    '<tr>' +\r\n                        '<td>' +\r\n                            '<div>' +\r\n                                '<div class=\"title\">' +\r\n                                   '<div class=\"cell\">'+vessel.vessel_name+'<div class=\"timestamp\">'+vessel.ts_pos_utc+'</div></div>  ' +                  \r\n                                '</div>' +\r\n                                '<div class=\"menu\">' +\r\n                                '<div class=\"ais cell menu-item active\"><img src=\"'+modulePath+'svg/info_gen.svg\" class=\"icon\">'+_gtxt(\"AISSearch2.infoscreen_gen\")+'</div>' +\r\n                                '<div class=\"register cell menu-item\"><img src=\"'+modulePath+'svg/info.svg\" class=\"icon\">'+_gtxt(\"AISSearch2.infoscreen_reg\")+'</div>' +\r\n                                '<div class=\"galery cell menu-item\"><img src=\"'+modulePath+'svg/photogallery.svg\" class=\"icon\">'+_gtxt(\"AISSearch2.infoscreen_gal\")+'<div class=\"counter\">0</div></div>' +\r\n                               '</div>' +\r\n                            '</div>  ' +\r\n                        '</td>' +\r\n                    '</tr>' +\r\n                    '<tr>' +\r\n                        '<td class=\"frame\">' +\r\n                                '<div class=\"photo\">' +\r\n                                    '<img src=\"'+modulePath+'svg/no-image.svg\" class=\"no-image\">' +\r\n                                '</div>  ' +  \r\n                        '</td>' +\r\n                    '</tr>' +\r\n                '</table>' +\r\n    '</td>' +\r\n    '<td class=\"column2\">' +\r\n        '<div class=\"close-button-holder\">' +\r\n            '<div class=\"close-button\" title=\"'+_gtxt(\"AISSearch2.close_but\")+'\"></div>' +\r\n        '</div>' +\r\n        '<div class=\"register panel\">' +\r\n            '<div class=\"caption\">' +\r\n                '<span style=\"display: inline-block;height: 100%;vertical-align: middle;width: 40px;\"></span>' +\r\n                '<img src=\"img/progress.gif\" style=\"vertical-align: middle\">' +\r\n            '</div>' +\r\n            '<div class=\"menu\">' +\r\n                '<div>' +\r\n                    '<table>' +\r\n                        '<tr>' +\r\n                            '<td><div class=\"general menu-item active\">'+_gtxt(\"AISSearch2.reg_general_tab\")+'</div></td>' +\r\n                            '<td><div class=\"build menu-item\">'+_gtxt(\"AISSearch2.reg_build_tab\")+'</div></td>' +\r\n                            '<td><div class=\"dimensions menu-item\">'+_gtxt(\"AISSearch2.reg_chars_tab\")+'</div></td>' +\r\n                            '<td><div class=\"gears menu-item\">'+_gtxt(\"AISSearch2.reg_devs_tab\")+'</div></td>' +\r\n                        '</tr>' +\r\n                    '</table>' +\r\n                '</div>' +\r\n            '</div>' +\r\n            '<div class=\"content\">' +\r\n                '<div class=\"placeholder\"></div>' +\r\n            '</div>' +\r\n        '</div>' +\r\n\r\n        '<div class=\"galery panel\">' +   \r\n'<form action=\"' + aisServices + 'Upload.ashx\" class=\"uploadFile\" method=\"post\" enctype=\"multipart/form-data\" target=\"upload_target\" style=\"display:none\" >' +\r\n    '<input name=\"Filedata\" class=\"chooseFile\" type=\"file\">' +    \r\n    '<input name=\"imo\" type=\"hidden\" value=\"'+vessel.imo+'\">' +    \r\n    '<input name=\"mmsi\" type=\"hidden\" value=\"'+vessel.mmsi+'\">' +\r\n          //'<input type=\"submit\" name=\"submitBtn\" value=\"Upload\" />' +\r\n'</form>' + \r\n'<iframe id=\"upload_target\" name=\"upload_target\" src=\"#\" style=\"width:0;height:0;border:0px solid #fff;\"></iframe>' + \r\n            '<div class=\"placeholder\">' +\r\n                '<div class=\"photo\" onclick=\"document.querySelector(\\'.vessel-info-page .chooseFile\\').click();\"'+\r\n                ' style=\"background-image: url('+modulePath+'svg/add-image.svg);background-size: 50px;\"></div>' +                \r\n            '</div>' +\r\n        '</div>' +\r\n\r\n        '<div class=\"ais panel\">' +\r\n            '<div class=\"placeholder\"></div>' +\r\n        '</div>' +\r\n    '</td>' +\r\n    '</tr>' +\r\n'</table>' +\r\n            '</td>' +\r\n        '</tr>' +\r\n    '</table>'           \r\n            );\r\n        window.addEventListener(\"message\", function(e){\r\n            if (e.data.search(/\"uploaded\"\\:/)<0)\r\n                return;\r\n            var data = JSON.parse(e.data);    \r\n            if (data.id && parseInt(data.id)) { //uploaded:\r\n//console.log('UPLOADED '+id)\r\n                var counter = $('.vessel-info-page .menu-item .counter'), \r\n                count = parseInt(counter.text())+1;\r\n                counter.text(count).css('display', 'inline');\r\n                var preview = $(\"<div class='photo preview' id='\"+data.id+\"' style='background-image: url(\"+aisServices+\"getphoto.ashx?id=\"+data.id+\")'/>\");\r\n                $('.vessel-info-page .uploader').replaceWith(preview);\r\n                preview.click(showPicture);\r\n//console.log(preview)\r\n            }\r\n            else {//uploadError:            \r\n                $('.vessel-info-page .uploader').remove();\r\n                console.log(data.errmsg)\r\n            }  \r\n        }, false);\r\n\r\n        $('<img src=\"' + scheme + window.serverBase.replace(/^https?:/, \"\")+'plugins/ais/getphoto.ashx?mmsi=' + vessel.mmsi + '\">')\r\n        .load(function () {\t\r\n            if (this)\r\n                $('.column1 .photo img.no-image').replaceWith(this);\t\r\n        }).error(function(){\t\t\t\r\n            $('<img src=\"' + scheme + '//photos.marinetraffic.com/ais/showphoto.aspx?size=thumb&mmsi=' + vessel.mmsi + '\">').load(function () {\r\n                    if (this)\r\n                        $('.column1 .photo img.no-image').replaceWith(this);\r\n            });\r\n        });\r\n\r\n        $('.vessel-info-page .chooseFile').change(function(){            \r\n            $('<div class=\"photo uploader\" style=\"background-image:url(img/progress.gif);background-size:20px;\"></div>')\r\n            .insertAfter($('.vessel-info-page .galery .placeholder .photo').eq(0));\r\n            $('.vessel-info-page .uploadFile')[0].submit();\r\n        })\r\n        $('.vessel-info-page .close-button').click(function(){\r\n            $('.vessel-info-page.overlay').remove();\r\n        });\r\n/**/\r\n        $('.vessel-info-page .menu img[src$=\".svg\"]').each(function() {\r\n            var $img = jQuery(this);\r\n            var imgURL = $img.attr('src');\r\n            var attributes = $img.prop(\"attributes\");\r\n\r\n            $.get(imgURL, function(data) {\r\n                // Get the SVG tag, ignore the rest\r\n                var $svg = jQuery(data).find('svg');\r\n\r\n                // Remove any invalid XML tags\r\n                $svg = $svg.removeAttr('xmlns:a');\r\n\r\n                // Loop through IMG attributes and apply on SVG\r\n                $.each(attributes, function() {\r\n                    $svg.attr(this.name, this.value);\r\n                });\r\n\r\n                // Replace IMG with SVG\r\n                $img.replaceWith($svg);\r\n            }, 'xml');\r\n        });\r\n\r\n        _ais = document.querySelector('.vessel-info-page .column2 .ais') \r\n        _galery = document.querySelector('.vessel-info-page .column2 .galery')\r\n        _register = document.querySelector('.vessel-info-page .column2 .register .content')\r\n        _regcap = document.querySelector('.vessel-info-page .column2 .register .caption')    \r\n        _leftPanel = document.querySelector('.vessel-info-page .column1 table')      \r\n        _minh = 420\r\n        resize = function(){\r\n            var h = Math.floor(window.innerHeight*0.8);\r\n            if (h>_minh){\r\n                _leftPanel.style.height = _ais.style.height = _galery.style.height = h + \"px\";\r\n                _register.style.height = h - _regcap.offsetHeight + \"px\";\r\n            }\r\n            else{\r\n                _leftPanel.style.height = _ais.style.height = _galery.style.height = _minh + \"px\";\r\n                _register.style.height = _minh - _regcap.offsetHeight + \"px\";\r\n            }      \r\n        }\r\n        menuAction = function(e){\r\n            var target = e.currentTarget, p = target.parentElement, mia;\r\n            while(!(mia = p.querySelectorAll('.menu-item')) || mia.length<2){\r\n                p = p.parentElement;\r\n            }\r\n            for (var j=0; j<mia.length; ++j){\r\n                    //console.log( mia[j])\r\n                mia[j].className = mia[j].className.replace(/ active/, \"\");\r\n                var panel = document.querySelector('.panel.' + mia[j].classList[0]);\r\n                if (panel){\r\n                    if (mia[j]!=target)\r\n                    panel.style.display = \"none\";\r\n                    else{\r\n                    panel.style.display = \"block\";\r\n                    }\r\n                }\r\n            }\r\n            target.className += \" active\"\r\n            resize(); \r\n        }\r\n\r\n        window.addEventListener(\"resize\", resize, false); \r\n    \r\n        var mia = document.querySelectorAll('.column1 .menu-item');\r\n        for (var i=0; i<mia.length; ++i){\r\n            mia[i].addEventListener('click', menuAction)\r\n        }\r\n    \r\n        resize();    \r\n        $(_ais).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        $(_galery).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        $(_register).mCustomScrollbar({theme:\"vessel-info-theme\"});\r\n        document.querySelector('.vessel-info-page .container').style.display = \"table\";  \r\n    },\r\n    showPicture = function(){\r\n//console.log($(this))\r\n            $('.vessel-info-page .picture').remove();\r\n            var div = $('<div class=\"picture\" style=\"display:none;position:absolute;\"></div>')\r\n            .insertAfter('.vessel-info-page.container').click(function(){this.remove()});\r\n            $('<img src=\"'+aisServices+'getphoto.ashx?id='+this.id+'\">').load(function() {\r\n                    if (this){\r\n                        var w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,\r\n                        h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\r\n                        div.append(this)\r\n                        .css('display', 'table')\r\n                        .offset({\r\n                            left:(w-this.offsetWidth)/2,\r\n                            top:(h-this.offsetHeight)/2})\r\n//console.log($(this))\r\n//console.log(window.screen.width+\"-\"+$(this)[0].offsetWidth)\r\n//console.log((window.screen.width-$(this)[0].offsetWidth)/2)\r\n                    }\r\n            });\r\n        },\r\n    drawGallery = function(gallery){\r\n        if (gallery.length>0)\r\n            $('.vessel-info-page .menu-item .counter').text(gallery.length).css('display', 'inline');   \r\n        var galcontent = $(\".vessel-info-page .galery .placeholder\")\r\n        for (var i=0; i<gallery.length; ++i)\r\n            galcontent.append(\"<div class='photo preview' id='\"+gallery[i]+\"' style='background-image: url(\"+aisServices+\"getphoto.ashx?id=\"+gallery[i]+\")'/>\" )             \r\n        $('.photo.preview').click(showPicture)\r\n        resize();     \r\n    },\r\n    drawAis = function(ledokol){\r\n    var aiscontent = document.querySelector(\".vessel-info-page .ais .placeholder\")\r\n    aiscontent.innerHTML = \"\" +                \r\n    \"<div class='caption'><div>\"+_gtxt(\"AISSearch2.vessel_info\")+\"</div></div>\" +\r\n    \"<table>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.vessel_name\")+\"</td><td><b>\"+ledokol.vessel_name+(ledokol.registry_name?\" (\"+ledokol.registry_name+\")\":\"\")+\"</b></td></tr>\" +\r\n        \"<tr><td>IMO</td><td>\"+ledokol.imo+\"</td></tr>\" +\r\n        \"<tr><td>MMSI</td><td>\"+ledokol.mmsi+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.vessel_type\")+\"</td><td>\"+ledokol.vessel_type+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.flag\")+\"</td><td>\"+ledokol.flag_country+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.callsign\")+\"</td><td>\"+ledokol.callsign+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.length\")+\"</td><td>\"+ledokol.length+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.width\")+\"</td><td>\"+ledokol.width+\"</td></tr>\" +\r\n    \"</table>\" +\r\n    \"<div class='caption'><div>\"+_gtxt(\"AISSearch2.vessel_voyage\")+\"</div></div>\" +\r\n    \"<table>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.nav_status\")+\"</td><td>\"+ledokol.nav_status+\"</td></tr>\" +\r\n        \"<tr><td>COG</td><td>\"+ledokol.cog+\"</td></tr>\" +\r\n        \"<tr><td>SOG</td><td>\"+ledokol.sog+\"</td></tr>\" +\r\n        \"<tr><td>HDG</td><td>\"+ledokol.heading+\"</td></tr>\" +\r\n        \"<tr><td>ROT</td><td>\"+ledokol.rot+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.draught\")+\"</td><td>\"+ledokol.draught+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.destination\")+\"</td><td>\"+ledokol.destination+\"</td></tr>\" +\r\n        \"<tr><td>\"+_gtxt(\"AISSearch2.eta\")+\"</td><td>\"+ledokol.ts_eta+\"</td></tr>\" +\r\n    \"</table>\";     \r\n        resize();        \r\n    },\r\n    drawRegister = function(ledokol){\r\n        let regcontent = _register.querySelector(\".placeholder\"),\r\n        drawTable = function(groups, article, display){\r\n            let s = \"<div class='panel \"+article+\" article' style='display:\"+display+\"'>\";\r\n            for(let i=0; i<groups.length; ++i){\r\n                if (!groups[i])\r\n                    continue;\r\n                s += \"<div class='group'>\"+groups[i].name+\"</div><table>\"\r\n                for(let j=0; j<groups[i].properties.length; ++j){\r\n                    let pn = groups[i].properties[j].name,\r\n                    desc = nsGmx.Translations.getLanguage()==\"rus\"?groups[i].properties[j].description:null, \r\n                    pv = groups[i].properties[j].value\r\n                    s+= \"<tr><td>\"+pn+\r\n                    (desc ? \"<div class='description'>\" + desc + \"</div>\" : \"\")+ \r\n                    \"</td><td>\"+(pn==\"Название судна\"||pn==\"Латинское название\"?\"<b>\"+pv+\"</b>\":pv)+\"</td></tr>\"\r\n                }\r\n                s += \"<tr><td>&nbsp;</td><td>&nbsp;</td></tr></table>\"\r\n            }\r\n            s += \"</div>\"\r\n            return s;\r\n        }\t\r\n\r\n        _regcap.innerHTML = \"<table class='register-title'>\"+\r\n        \"<tr><td><span class='switch active'>\"+_gtxt(\"AISSearch2.rmrs\")+\"</span> <span class='switch'>Lloyd's register</span></td></tr>\"+\r\n        \"<tr><td><span class='update'></span></td></tr>\"+\r\n        \"</table>\";\r\n\r\n        let drawRMR = function(){\r\n            if (ledokol) {\r\n                regcontent.innerHTML =\r\n                    drawTable([ledokol.data[0], ledokol.data[1], ledokol.data[9]], \"general\", \"block\") +\r\n                    drawTable([ledokol.data[2]], \"build\", \"none\") +\r\n                    drawTable([ledokol.data[3]], \"dimensions\", \"none\") +\r\n                    drawTable([ledokol.data[4], ledokol.data[5], ledokol.data[6], ledokol.data[7], ledokol.data[8]], \"gears\", \"none\");\r\n                _regcap.querySelector('.update').innerText = _gtxt(\"AISSearch2.last_update\") + \" \" + ledokol.version.replace(/ \\S+$/g, '');\r\n            }\r\n            else{\r\n                regcontent.innerHTML = \"\";\r\n                _regcap.querySelector('.update').innerHTML = \"&nbsp;\"; \r\n            }\r\n        },\r\n        drawLloyds = function(){\r\n            regcontent.innerHTML =\r\n                drawTable([_lloyds.data[15], _lloyds.data[14], _lloyds.data[13], _lloyds.data[11], _lloyds.data[0]], \"general\", \"block\") +\r\n                drawTable([_lloyds.data[10], _lloyds.data[12]], \"build\", \"none\") +\r\n                drawTable([_lloyds.data[9], _lloyds.data[8], _lloyds.data[7], _lloyds.data[6]], \"dimensions\", \"none\") +\r\n                drawTable([_lloyds.data[4], _lloyds.data[3], _lloyds.data[2], _lloyds.data[1], _lloyds.data[5]], \"gears\", \"none\");\r\n            _regcap.querySelector('.update').innerText = _gtxt(\"AISSearch2.last_update\") + \" \" + _lloyds.version.replace(/ \\S+$/g, '');   \r\n        },\r\n        regSwitches = _regcap.querySelectorAll(\".switch\");\r\n        regSwitches.forEach((item, i)=>item.addEventListener('click', e => {\r\n            let cl = e.currentTarget.classList;\r\n            if (!cl.contains('active')) {\r\n                _regcap.querySelector(\".switch.active\").classList.remove('active');\r\n                cl.add('active');\r\n                switch (i){\r\n                    case 0:\r\n                        drawRMR();\r\n                        break;\r\n                    case 1:\r\n                        if (_lloyds)\r\n                            drawLloyds();\r\n                        else\r\n                            regcontent.innerHTML = \"\";                        \r\n                        break;\r\n                }           \r\n                resize();   \r\n                mia[0] && mia[0].click();\r\n            }\r\n        }));\r\n        var mia = document.querySelectorAll('.column2 .menu-item');\r\n        for (var i=0; i<mia.length; ++i){\r\n            mia[i].addEventListener('click', menuAction)\r\n        }\r\n        drawRMR();             \r\n        resize(); \r\n        if (!ledokol)        \r\n            regSwitches[1].click();         \r\n    }\r\n\t\r\n\tlet open = function(vessel, vessel2){\r\n                    show(vessel2);\r\n                    var onFail = function(error){\r\n                        if (error!='register_no_data')\r\n                            console.log(error)\r\n                        _regcap.innerHTML = \"\";\r\n                    } \r\n                    new Promise(function(resolve, reject){\r\n                        (function wait(){\r\n                            if(!vessel2)\r\n                                setTimeout(wait, 100);\r\n                        })();\r\n                        resolve(vessel2)\r\n                    })\r\n                    .then(function(ship){\r\n//console.log(ship)\r\n                        drawAis(ship)\r\n                    }, \r\n                    onFail);\r\n                    var registerServerUrl = scheme + \"//kosmosnimki.ru/demo/register/api/v1/\",\r\n                        lloydsServerUrl = scheme + \"//kosmosnimki.ru/demo/lloyds/api/v1/\",\r\n                        rmr;\r\n                    if(vessel.imo && vessel.imo!=0 && vessel.imo!=-1){\r\n                        fetch(registerServerUrl+\"Ship/Search/\"+vessel.imo+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"))\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            if (ship.length>0)\r\n                                return fetch(registerServerUrl+\"Ship/Get/\"+ship[0].RS+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"))\r\n                            else\r\n                                return Promise.resolve({json:()=>null});\r\n                            //else\r\n                            //    return Promise.reject('register_no_data');\r\n                        })\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            //console.log(ship)\r\n                            rmr = ship;\r\n                            if (rmr)\r\n                                drawRegister(rmr);\r\n                            return fetch(lloydsServerUrl+\"Ship/Search/\"+vessel.imo+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"));\r\n                        })                        \r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            if (ship.length>0)\r\n                                return fetch(lloydsServerUrl+\"Ship/Get/\"+ship[0].RS+(nsGmx.Translations.getLanguage()==\"rus\"?\"/ru\":\"/en\"))\r\n                            else\r\n                                return Promise.reject('register_no_data');\r\n                        })\r\n                        .then(function(response){\r\n                            return response.json();\r\n                        })  \r\n                        .then(function(ship) {\r\n                            _lloyds = ship;\r\n                            if (nsGmx.Translations.getLanguage()!=\"rus\"){\r\n                                _lloyds.data[15].name = \"Vessel Data\";\r\n                                _lloyds.data[14].name = \"Type and Status\";\r\n                                _lloyds.data[13].name = \"Companies\";\r\n                                _lloyds.data[12].name = \"Companies\";\r\n                                _lloyds.data[11].name = \"Safety\";\r\n                                _lloyds.data[10].name = \"History\";\r\n                                _lloyds.data[9].name = \"Characteristics\";\r\n                                _lloyds.data[8].name = \"Dimensions\";\r\n                                _lloyds.data[7].name = \"Hull\";\r\n                                _lloyds.data[6].name = \"Capacity\";\r\n                                _lloyds.data[5].name = \"Cargo\";\r\n                                _lloyds.data[4].name = \"Machinery\";\r\n                                _lloyds.data[3].name = \"Fuel\";\r\n                                _lloyds.data[2].name = \"Energy Supply\";\r\n                                _lloyds.data[1].name = \"Propellers and Thrusters\";\r\n                                _lloyds.data[0].name = \"Codes\";\r\n                            }\r\n                            if (!rmr)\r\n                                drawRegister(rmr);\r\n                        })\r\n                        .catch( onFail );\r\n                    }\r\n                    else                    \r\n                        _regcap.innerHTML = \"\";\r\n\r\n                    new Promise(function(resolve, reject){\r\n                        sendCrossDomainJSONRequest(aisServices + \r\n                            \"gallery.ashx?mmsi=\"+vessel.mmsi+\"&imo=\"+vessel.imo, function(response){\r\n                            if (response.Status==\"ok\") \r\n                                resolve(response.Result);\r\n                            else\r\n                                reject(response)\r\n                        });\r\n                    })\r\n                    .then(function(gallery){\r\n                        drawGallery(gallery)\r\n                    }, \r\n                    onFail);\r\n                }\r\n        \r\n    return {\r\n\t\topen:open,\r\n            show: show,\r\n            drawRegister: drawRegister,\r\n            drawAis: drawAis,\r\n            drawGallery:drawGallery\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Views/VesselInfoScreen.js","// removed by extract-text-webpack-plugin\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/Views/VesselInfoScreen.css\n// module id = 29\n// module chunks = 0","module.exports = function (options) {\r\n    const _baseUrl = document.location.href.replace(/^(https?:).+/, \"$1\") +\r\n        (window.serverBase.replace(/^https?:/, \"\") || '//maps.kosmosnimki.ru/'),\r\n        _aisServices = _baseUrl + \"Plugins/AIS/\",\r\n        _serverScript = _baseUrl + 'VectorLayer/Search.ashx',\r\n        { aisLastPoint: _aisLastPoint,\r\n            screenSearchLayer: _screenSearchLayer,\r\n            aisLayerID: _aisLayerID,\r\n            historyLayer: _historyLayer,\r\n            lastPointLayerAlt: _lastPointLayerAlt,\r\n            vesselLegend: _vesselLegend\r\n        } = options;\r\n\r\n    return {\r\n        baseUrl: _baseUrl,\r\n        get screenSearchLayer(){return _screenSearchLayer},\r\n        aisServices: _aisServices,\r\n        getBorder: function () {\r\n            var lmap = nsGmx.leafletMap;\r\n            var dFeatures = lmap.gmxDrawing.getFeatures();\r\n            if (dFeatures.length) { return dFeatures[dFeatures.length - 1].toGeoJSON(); }\r\n            var latLngBounds = lmap.getBounds(),\r\n                sw = latLngBounds.getSouthWest(),\r\n                ne = latLngBounds.getNorthEast(),\r\n                min = { x: sw.lng, y: sw.lat },\r\n                max = { x: ne.lng, y: ne.lat },\r\n                minX = min.x,\r\n                maxX = max.x,\r\n                geo = { type: 'Polygon', coordinates: [[[minX, min.y], [minX, max.y], [maxX, max.y], [maxX, min.y], [minX, min.y]]] },\r\n                w = (maxX - minX) / 2;\r\n\r\n            if (w >= 180) {\r\n                geo = { type: 'Polygon', coordinates: [[[-180, min.y], [-180, max.y], [180, max.y], [180, min.y], [-180, min.y]]] };\r\n            }\r\n            else if (maxX > 180 || minX < -180) {\r\n                var center = ((maxX + minX) / 2) % 360;\r\n                if (center > 180) { center -= 360; }\r\n                else if (center < -180) { center += 360; }\r\n                minX = center - w; maxX = center + w;\r\n                if (minX < -180) {\r\n                    geo = {\r\n                        type: 'MultiPolygon', coordinates: [\r\n                            [[[-180, min.y], [-180, max.y], [maxX, max.y], [maxX, min.y], [-180, min.y]]],\r\n                            [[[minX + 360, min.y], [minX + 360, max.y], [180, max.y], [180, min.y], [minX + 360, min.y]]]\r\n                        ]\r\n                    };\r\n                } else if (maxX > 180) {\r\n                    geo = {\r\n                        type: 'MultiPolygon', coordinates: [\r\n                            [[[minX, min.y], [minX, max.y], [180, max.y], [180, min.y], [minX, min.y]]],\r\n                            [[[-180, min.y], [-180, max.y], [maxX - 360, max.y], [maxX - 360, min.y], [-180, min.y]]]\r\n                        ]\r\n                    };\r\n                }\r\n            }\r\n            return geo;\r\n        },\r\n\r\n        formatTime: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleTimeString();\r\n        },\r\n        formatDate: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleDateString();\r\n        },\r\n        formatDateTime: function (d, local) {\r\n            if (d.isNaN)\r\n                return \"\";\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleString().replace(/,/, \"\");\r\n        },\r\n\r\n        formatDate2: function (d, local) {\r\n            var dd, m, y, h, mm;\r\n            if (local) {\r\n                dd = (\"0\" + d.getDate()).slice(-2);\r\n                m = (\"0\" + (d.getMonth() + 1)).slice(-2);\r\n                y = d.getFullYear();\r\n                h = (\"0\" + d.getHours()).slice(-2);\r\n                mm = (\"0\" + d.getMinutes()).slice(-2);\r\n                return dd + \".\" + m + \".\" + y + \" \" + h + \":\" + mm +\r\n                    \" (\" + (\"0\" + d.getUTCHours()).slice(-2) + \":\" + (\"0\" + d.getUTCMinutes()).slice(-2) + \" UTC)\";\r\n            }\r\n            else {\r\n                dd = (\"0\" + d.getUTCDate()).slice(-2);\r\n                m = (\"0\" + (d.getUTCMonth() + 1)).slice(-2);\r\n                y = d.getUTCFullYear();\r\n                h = (\"0\" + d.getUTCHours()).slice(-2);\r\n                mm = (\"0\" + d.getUTCMinutes()).slice(-2);\r\n                var\r\n                    ldd = (\"0\" + d.getDate()).slice(-2),\r\n                    lm = (\"0\" + (d.getMonth() + 1)).slice(-2),\r\n                    ly = d.getFullYear(),\r\n                    lh = (\"0\" + d.getHours()).slice(-2),\r\n                    lmm = (\"0\" + d.getMinutes()).slice(-2),\r\n                    offset = -d.getTimezoneOffset() / 60;\r\n                return dd + \".\" + m + \".\" + y + \" <span class='utc'>\" + h + \":\" + mm + \" UTC</span> (\" + lh + \":\" + lmm + \")\"\r\n                //return dd+\".\"+m+\".\"+y+\" \"+h+\":\"+mm+\" UTC <br>\"+\r\n                //\"<span class='small'>(\"+ldd+\".\"+lm+\".\"+ly+\" \"+lh+\":\"+lmm+\" UTC\"+(offset>0?\"+\":\"\")+offset+\")</span>\";\r\n            }\r\n        },\r\n        placeVesselTypeIcon: function(vessel){\r\n            let protocol = document.location.protocol,\r\n            icon;            \r\n            // speed icon\r\n            icon = _vesselLegend.getIconAlt(\"vessel.vessel_name\", vessel.sog);\r\n            if (icon){\r\n                vessel.iconAlt = protocol + icon.url; \r\n                vessel.imgAlt =  icon.img;\r\n                vessel.colorAlt = icon.color;\r\n            }         \r\n            // type icon\r\n            icon = _vesselLegend.getIcon(vessel.vessel_type, vessel.sog);\r\n            if (icon){\r\n                vessel.icon = protocol + icon.url;\r\n                vessel.img =  icon.img;\r\n                vessel.color = icon.color;\r\n            }\r\n        },\r\n        searchPositionsAgg2: function (mmsi, dateInterval, callback) {\r\n            fetch(`${_baseUrl}plugins/AIS/SearchPositionsAsync.ashx?layer=${_historyLayer}&mmsi=${mmsi}&s=${dateInterval.dateBegin.toISOString()}&e=${dateInterval.dateEnd.toISOString()}`, {\r\n                method: 'POST', // *GET, POST, PUT, DELETE, etc.\r\n                mode: 'cors', // no-cors, cors, *same-origin\r\n                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\r\n                credentials: 'include' // include, *same-origin, omit\r\n            })\r\n            .then(response => response.json())\r\n            .then(callback);\r\n        },\r\n        searchPositionsAgg2Mf: function (mmsi, dateInterval, callback) {\r\n            fetch(`${_baseUrl}plugins/AIS/SearchMfPositionsAsync.ashx?layer=${_historyLayer}&mmsi=${mmsi}&s=${dateInterval.dateBegin.toISOString()}&e=${dateInterval.dateEnd.toISOString()}`, {\r\n                method: 'POST', // *GET, POST, PUT, DELETE, etc.\r\n                mode: 'cors', // no-cors, cors, *same-origin\r\n                cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached\r\n                credentials: 'include' // include, *same-origin, omit\r\n            })\r\n            .then(response => response.json())\r\n            .then(callback);\r\n        },\r\n        searchPositionsAgg: function (vessels, dateInterval, callback) {\r\n            //console.log(dateInterval);\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _historyLayer, //'8EE2C7996800458AAF70BABB43321FA4',//\r\n                orderdirection: 'desc',\r\n                orderby: 'ts_pos_utc',\r\n                columns:'[{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"flag_country\"},{\"Value\":\"callsign\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"cog\"},{\"Value\":\"sog\"},{\"Value\":\"draught\"},{\"Value\":\"vessel_type\"},'+\r\n                '{\"Value\":\"destination\"},{\"Value\":\"ts_eta\"},{\"Value\":\"nav_status\"},{\"Value\":\"heading\"},{\"Value\":\"rot\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]',\r\n                \r\n                query: \"([mmsi] IN (\" + vessels.join(',') + \")) and '\" + dateInterval.dateBegin.toISOString() + \"'<=[ts_pos_utc] and [ts_pos_utc]<'\" + dateInterval.dateEnd.toISOString() + \"'\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchPositions: function (vessels, dateInterval, callback) {\r\n            //console.log(\"searchById\");\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _historyLayer, //'8EE2C7996800458AAF70BABB43321FA4',//\r\n                //orderdirection: 'desc',\r\n                //orderby: 'ts_pos_utc',\r\n                query: \"([mmsi] IN (\" + vessels.join(',') + \")) and '\" + dateInterval.dateBegin.toISOString() + \"'<=[ts_pos_utc] and [ts_pos_utc]<'\" + dateInterval.dateEnd.toISOString() + \"'\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchById: function (aid, callback) {\r\n            //console.log(\"searchById\");\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLayerID, //'8EE2C7996800458AAF70BABB43321FA4'\r\n                columns: `[{\"Value\":\"id\"},\r\n                        {\"Value\":\"vessel_name\"},\r\n                        {\"Value\":\"mmsi\"},\r\n                        {\"Value\":\"imo\"},\r\n                        {\"Value\":\"flag_country\"},\r\n                        {\"Value\":\"callsign\"},\r\n                        {\"Value\":\"ts_pos_utc\"},\r\n                        {\"Value\":\"cog\"},\r\n                        {\"Value\":\"sog\"},\r\n                        {\"Value\":\"draught\"},\r\n                        {\"Value\":\"vessel_type\"},\r\n                        {\"Value\":\"destination\"},\r\n                        {\"Value\":\"ts_eta\"},\r\n                        {\"Value\":\"nav_status\"},\r\n                        {\"Value\":\"heading\"},\r\n                        {\"Value\":\"rot\"},\r\n                        {\"Value\":\"longitude\"},\r\n                        {\"Value\":\"latitude\"},\r\n                        {\"Value\":\"source\"}]`,                \r\n                query: \"([id] IN (\" + aid.join(',') + \"))\"\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        \r\n        searchString2: function (query, isfuzzy, callback) {\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLastPoint,\r\n                columns: '[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"vessel_type\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]',\r\n                //orderdirection: 'desc',\r\n                //orderby: 'vessel_name',\r\n                query: query\r\n            };\r\n            if (isfuzzy)\r\n                request.pagesize = 1000;\r\n            L.gmxUtil.sendCrossDomainPostRequest(_aisServices + \"searchship.ashx\", request, callback);\r\n        },\r\n        searchString: function (searchString, isfuzzy, callback) {\r\n            //console.log(_aisLastPoint+\", \"+_aisLayerID)\r\n            var query = \"\";\r\n            if (searchString) {\r\n                searchString = searchString.toUpperCase();\r\n                if (searchString.search(/[^\\d, ]/) === -1) {\r\n                    var arr = searchString.replace(/ /g, '').split(/,/);\r\n                    query = \"([mmsi] IN (\" + arr.join(',') + \"))\" +\r\n                        \"OR ([imo] IN (\" + arr.join(',') + \"))\"\r\n                } else {\r\n                    if (isfuzzy)\r\n                        query = '([vessel_name] startswith \\'' + searchString + '\\') OR ([vessel_name] contains \\' ' + searchString + '\\')';\r\n                    else\r\n                        query = '([vessel_name] startswith \\'' + searchString + '\\') OR ([vessel_name] contains \\' ' + searchString + '\\')';\r\n                }\r\n            }\r\n            var request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLastPoint,\r\n                columns: '[{\"Value\":\"vessel_name\"},{\"Value\":\"mmsi\"},{\"Value\":\"imo\"},{\"Value\":\"ts_pos_utc\"},{\"Value\":\"vessel_type\"},{\"Value\":\"longitude\"},{\"Value\":\"latitude\"},{\"Value\":\"source\"}]',\r\n                //orderdirection: 'desc',\r\n                //orderby: 'vessel_name',\r\n                query: query\r\n            };\r\n            if (isfuzzy)\r\n                request.pagesize = 1000;\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchNames: function (avessels, callback) {\r\n            var a = avessels.reduce((p,c)=>{\r\n                if((c.mmsi && c.mmsi!=\"\") || (c.imo && c.imo!=\"\" && c.imo!=-1)) \r\n                    p.push(c); \r\n                return p;\r\n            },[]),\r\n            request = {\r\n                WrapStyle: 'window',\r\n                layer: _aisLastPoint,\r\n                orderdirection: 'desc',\r\n                orderby: 'ts_pos_utc',\r\n                query: a.map(function (v) { return \"([mmsi]=\" + v.mmsi + (v.imo && v.imo != \"\" ? (\" and [imo]=\" + v.imo) : \"\") + \")\" }).join(\" or \")\r\n            };\r\n            L.gmxUtil.sendCrossDomainPostRequest(_serverScript, request, callback);\r\n        },\r\n        searchScreen: function (options, callback) {\r\n            var lmap = nsGmx.leafletMap;\r\n            var latLngBounds = lmap.getBounds(),\r\n                sw = latLngBounds.getSouthWest(),\r\n                ne = latLngBounds.getNorthEast(),\r\n                min = { x: sw.lng, y: sw.lat },\r\n                max = { x: ne.lng, y: ne.lat };\r\n            // let queryParams = { WrapStyle: 'window', minx: min.x, miny: min.y, maxx: max.x, maxy: max.y, layer: _screenSearchLayer },\r\n            // dateInterval = nsGmx.widgets.commonCalendar.getDateInterval();\r\n            // queryParams.s = options.dateInterval.get('dateBegin').toJSON(),\r\n            // queryParams.e = options.dateInterval.get('dateEnd').toJSON();\r\n//console.log(queryParams);\r\n            //L.gmxUtil.sendCrossDomainPostRequest(_aisServices + \"SearchScreenAsync.ashx\",\r\n            // L.gmxUtil.sendCrossDomainPostRequest(_aisServices + \"SearchScreen.ashx\",\r\n            //     queryParams,\r\n            //     callback);\r\n            fetch(_aisServices + `SearchScreenAsync.ashx?${options.filter ? 'f=' + options.filter + '&' : ''}minx=${min.x}&miny=${min.y}&maxx=${max.x}&maxy=${max.y}&layer=${_screenSearchLayer}\r\n&s=${options.dateInterval.get('dateBegin').toJSON()}&e=${options.dateInterval.get('dateEnd').toJSON()}`, {\r\n                method: 'GET', \r\n                mode: 'cors', \r\n                cache: 'no-cache', \r\n                credentials: 'include', \r\n            })\r\n            .then(function(response) {\r\n                return response.json();\r\n            })\r\n            .then(callback);\r\n        }\r\n    };\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/Search/Searcher.js","module.exports = function (options) {\r\n    const {id, dateInterval, daysLimit: _daysLimit, mapDateInterval} = options, \r\n          MS_DAY = 24 * 3600 * 1000,\r\n          _utcLimits = function(dt){\r\n              dt  = dt || (new Date());\r\n              return {\r\n                  begin: new Date(Date.UTC(dt.getFullYear(), dt.getMonth(), dt.getDate())), \r\n                  end: new Date(Date.UTC(dt.getFullYear(), dt.getMonth(), dt.getDate() + 1))\r\n              }\r\n          };\r\n\r\n    const _calendar = $(`<div class=\"${id}\"><table border=0>    \r\n    <tr>   \r\n    <td><div class=\"CalendarWidget-iconScrollLeft ui-helper-noselect icon-left-open\"></td>\r\n    <td class=\"dateBegin\"><span class=\"ui-helper-hidden-accessible\"><input type=\"text\"/></span>\r\n    <input type=\"text\" class=\"gmx-input-text CalendarWidget-dateBegin\">\r\n    </td>\r\n    <td>&nbsp;&nbsp;&ndash;&nbsp;&nbsp;</td>\r\n    <td class=\"dateEnd\"><input type=\"text\" class=\"gmx-input-text CalendarWidget-dateEnd\"></td>\r\n    <td><div class=\"CalendarWidget-iconScrollRight ui-helper-noselect icon-right-open\"></td>\r\n    <td>&nbsp;&nbsp;<img class=\"default_date\" style=\"cursor:pointer\" title=\"${_gtxt('AISSearch2.calendar_today')}\" src=\"plugins/AIS/AISSearch/svg/calendar.svg\"></td>\r\n    </tr>    \r\n    </table></div>`);\r\n    \r\n    let _now = new Date(),\r\n        _begin = options.begin ? new Date(options.begin) : _utcLimits(_now).begin,\r\n        _end =  options.end ? new Date(options.end) : _utcLimits(_now).end,\r\n        _current = new Date(_end.getTime() - MS_DAY),\r\n        _onChangeCallbacks = [];\r\n\r\n    const _setBegin = function(dt){\r\n              _begin = new Date(dt);\r\n          },\r\n          _setEnd = function(dt){\r\n              _end = new Date(dt);\r\n          },\r\n          _onChangeHandler = function(s, dp){\r\n              const b = _beginCtl.datepicker('getDate'),\r\n                    e = _endCtl.datepicker('getDate');\r\n              let maxd = e;\r\n              if (b>e){\r\n                  if (this.id === _beginCtl[0].id){\r\n                    _setBegin(_utcLimits(b).begin);\r\n                    _setEnd(_utcLimits(b).end);\r\n                    _endCtl.datepicker( \"setDate\", b);\r\n                    maxd = b;\r\n                  }\r\n                  else{  \r\n                    _setEnd(_utcLimits(e).end);\r\n                    _setBegin(_utcLimits(e).begin);\r\n                    _beginCtl.datepicker( \"setDate\", e);\r\n                  }\r\n              }\r\n              else{\r\n                _setBegin(_utcLimits(b).begin);\r\n                _setEnd(_utcLimits(e).end);\r\n              }\r\n             \r\n              _beginCtl.datepicker( \"option\", {minDate: new Date(maxd.getTime() - (_daysLimit - 1) * MS_DAY), maxDate: maxd});\r\n              \r\n              _onChangeCallbacks.forEach(cb=>cb({interval: _thisInstance.interval}));\r\n//console.log(_thisInstance.interval);\r\n\r\n          },\r\n          _beginCtl = _calendar.find( \".CalendarWidget-dateBegin\" ).datepicker({\r\n              onSelect: _onChangeHandler,\r\n              minDate: '-' + (_daysLimit - 1),\r\n              maxDate: _current\r\n            }),\r\n          _endCtl = _calendar.find( \".CalendarWidget-dateEnd\" ).datepicker({\r\n              onSelect: _onChangeHandler,\r\n              //maxDate: _current\r\n            });\r\n\r\n    _beginCtl.datepicker( \"setDate\", _begin);\r\n    _endCtl.datepicker( \"setDate\", _current);\r\n\r\n    // walkaround with focus at first input in ui-dialog\r\n    //_calendar.append('<span class=\"ui-helper-hidden-accessible\"><input type=\"text\"/></span>');\r\n  \r\n    _calendar.find('.default_date').on('click', function() {\r\n        const limits = _utcLimits();\r\n        _thisInstance.interval = { begin: limits.begin, end: limits.end };\r\n    });\r\n    _calendar.find('.CalendarWidget-iconScrollRight').on('click', function() {\r\n        let newEnd = new Date(_end), newBegin = new Date(_begin), \r\n            shift = (newEnd.getTime() - newBegin.getTime()) / MS_DAY, \r\n            maxDate = _endCtl.datepicker( \"option\", \"maxDate\");\r\n        newEnd.setDate(newEnd.getDate() + shift);  newBegin.setDate(newBegin.getDate() + shift);\r\n        if (maxDate){\r\n            if (newEnd.getTime() - MS_DAY > maxDate.getTime())\r\n                newEnd = new Date(maxDate.getTime() + MS_DAY);\r\n            if (newBegin.getTime() > maxDate.getTime())\r\n                newBegin = new Date(maxDate.getTime()); \r\n        }           \r\n        _thisInstance.interval = { begin: newBegin, end: newEnd };\r\n    });\r\n    _calendar.find('.CalendarWidget-iconScrollLeft').on('click', function() {\r\n        const newEnd = new Date(_end), newBegin = new Date(_begin), \r\n        shift = (newEnd.getTime() - newBegin.getTime()) / MS_DAY, maxDate = _endCtl.datepicker( \"option\", \"maxDate\");\r\n        newEnd.setDate(newEnd.getDate() - shift);  newBegin.setDate(newBegin.getDate() - shift);\r\n        _thisInstance.interval = { begin: newBegin, end: newEnd };\r\n    });\r\n\r\n    const _thisInstance =  {\r\n        el: _calendar[0],\r\n\r\n        set onChange(cb) { \r\n            _onChangeCallbacks.push(cb); \r\n        },\r\n\r\n        set begin(dt){\r\n            if (_begin.getTime()===dt.getTime())\r\n                return;\r\n            _setBegin(dt); _beginCtl.datepicker( \"setDate\", dt); \r\n            _onChangeCallbacks.forEach(cb=>cb({interval: this.interval}));\r\n        },\r\n        get begin(){ return new Date(_begin); },\r\n\r\n        set end(dt){\r\n            if (_end.getTime()===dt.getTime())\r\n                return;\r\n\r\n            const dpEnd = new Date(dt.getTime() - MS_DAY);\r\n            _beginCtl.datepicker( \"option\", {minDate: new Date(end.getTime() - (_daysLimit - 1) * MS_DAY), maxDate: dpEnd});\r\n\r\n            _setEnd(dt); _endCtl.datepicker( \"setDate\", dpEnd ); \r\n            _onChangeCallbacks.forEach(cb=>cb({interval: this.interval}));\r\n        },\r\n        get end(){ return new Date(_end); },\r\n\r\n        set interval(di){     \r\n\r\n            if (_begin.getTime()===di.begin.getTime() && _end.getTime()===di.end.getTime())\r\n                return;\r\n\r\n            const pickerEnd = new Date(di.end.getTime() - MS_DAY);\r\n            _beginCtl.datepicker( \"option\", {minDate: new Date(pickerEnd.getTime() - (_daysLimit - 1) * MS_DAY), maxDate: pickerEnd});\r\n\r\n            _setBegin(di.begin); _beginCtl.datepicker( \"setDate\", di.begin);\r\n            _setEnd(di.end);  _endCtl.datepicker( \"setDate\", pickerEnd);\r\n\r\nconsole.log(id, this.interval) \r\n\r\n            _onChangeCallbacks.forEach(cb=>cb({interval: this.interval}));\r\n        },\r\n        get interval(){ return { begin: new Date(_begin), end: new Date(_end)}; }\r\n\r\n    }\r\n  \r\n    return _thisInstance;\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/Controls/Calendar.js","const SvgParser = require ('../canvg');\r\n\r\nconst LegendControl = function (tools, aisLastPointLayer, lastPointLayerAlt) {\r\n    const _layersByID = nsGmx.gmxMap.layersByID,\r\n        _layers = [_layersByID[aisLastPointLayer], _layersByID[lastPointLayerAlt]],\r\n        _getIcons = function () {\r\n            _layers[0] && _layers[0]._gmx.properties.gmxStyles.styles.forEach(s => {\r\n                let icon = {\r\n                    \"filter\": s.Filter, \r\n                    \"url\": s.RenderStyle.iconUrl.replace(/^https?:/, \"\")\r\n                        .replace(/^\\/\\/kosmosnimki.ru/, \"//www.kosmosnimki.ru\"), \"name\": s.Name,\r\n                    \"img\": new Image(),\r\n                    \"typeColor\": {}\r\n                };\r\n                _icons.push(icon);\r\n                _iconsDict[icon.filter] = {url:icon.url, name:icon.name, img: icon.img, color: icon.typeColor};\r\n            });\r\n            _layers[1] && _layers[1]._gmx.properties.gmxStyles.styles.forEach(s => {\r\n                let icon = {\r\n                    \"filter\": s.Filter.replace(/([^<>=])=([^=])/g, \"$1==$2\")\r\n                        .replace(/ *not ((.(?!( and | or |$)))+.)/ig, \" !($1)\")\r\n                        .replace(/ or /ig, \" || \").replace(/ and /ig, \" && \"), \r\n                    \"url\": s.RenderStyle.iconUrl.replace(/^https?:/, \"\")\r\n                        .replace(/^\\/\\/kosmosnimki.ru/, \"//www.kosmosnimki.ru\"), \"name\": s.Name,\r\n                    \"img\": new Image(),\r\n                    \"typeColor\": {}\r\n                };\r\n                _iconsAlt.push(icon);\r\n                _iconsAltDict[icon.filter] = {url:icon.url, name:icon.name, img: icon.img, color: icon.typeColor};\r\n            });\r\n// console.log(_icons);\r\n// console.log(_iconsAlt);\r\n        },\r\n        _getSvgPromise = ic => {\r\n            return new Promise(resolve => {\r\n                let httpRequest = new XMLHttpRequest();\r\n                httpRequest.onreadystatechange = function () {\r\n                    if (httpRequest.readyState === 4) {\r\n                        ic.svg = httpRequest.responseText;\r\n                        let a = /\\.cls-1{fill:(#[^};]+)/.exec(ic.svg);\r\n                        ic.color = '#888';\r\n                        if (a && a.length)\r\n                            ic.color = a[1];\r\n\r\n                        ic.typeColor.value = ic.color;\r\n \r\n                        let svg = httpRequest.responseText;\r\n                        let canvas = document.createElement(\"canvas\");\r\n                        if (canvas.msToBlob){\r\n                            document.body.appendChild(canvas);\r\n                            canvas.width = 21;\r\n                            canvas.height = 21;\r\n                            SvgParser.canvg(canvas, svg)\r\n                            ic.img.src = canvas.toDataURL(\"image/png\");\r\n                            document.body.removeChild(canvas);\r\n                            resolve();\r\n//console.log('CANVG')\r\n                        }\r\n                        else{\r\n\r\n                            let svg64 = btoa(unescape(encodeURIComponent(svg)));\r\n                            let b64Start = 'data:image/svg+xml;base64,';\r\n                            let image64 = b64Start + svg64; \r\n                            let imgSvg = new Image();             \r\n                            imgSvg.src = image64; \r\n//console.log(imgSvg)\r\n                            imgSvg.onload = function(){\r\n                                let canvas = document.createElement(\"canvas\");\r\n                                document.body.appendChild(canvas)\r\n                                canvas.width = imgSvg.width;\r\n                                canvas.height = imgSvg.height;\r\n                                let ctx = canvas.getContext(\"2d\");\r\n                                ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n                                ctx.drawImage(imgSvg, 0, 0);\r\n                                ic.img.src = canvas.toDataURL(\"image/png\");\r\n                                //ic.img.onload = function(){\r\n//console.log(ic.img)\r\n                                document.body.removeChild(canvas);\r\n\r\n                                resolve();\r\n                            //}\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                httpRequest.open(\"GET\", document.location.protocol + ic.url.replace(/^https?:/, \"\"));\r\n                httpRequest.send();\r\n            })\r\n        };\r\n\r\n    let _icons = [], _iconsAlt = [], _iconsDict = {}, _iconsAltDict = {};\r\n    _getIcons();\r\n\r\n    const _svgLoader = Promise.all(_icons.map(_getSvgPromise)),\r\n        _svgAltLoader = Promise.all(_iconsAlt.map(_getSvgPromise)),\r\n        _createSwitch = function (container) {\r\n            let div = document.createElement('div');\r\n            div.innerHTML = '<table class=\"ais_legend_switch\">' +\r\n                '<tr><td class=\"legend\" colspan=\"2\"><span class=\"label\">' + _gtxt(\"AISSearch2.legend_switch\") + ':</span>' +\r\n                '<span class=\"type unselectable on\" unselectable=\"on\">' + _gtxt(\"AISSearch2.legend_type\") + '</span>' +\r\n                '<span class=\"speed unselectable\" unselectable=\"on\">' + _gtxt(\"AISSearch2.legend_speed\") + '</span></td>' +\r\n                '<td class=\"show_info\">' +\r\n                '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><g><circle style=\"fill:white\" cx=\"12\" cy=\"12\" r=\"8\"></circle><path d=\"M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z\" style=\"fill:#48aff1\"></path></g></svg>' +\r\n                '</td></tr>' +\r\n                '</table>';\r\n            container.footer = div;\r\n            let lswitchClick = e => {\r\n                let cl = e.target.classList;\r\n                if (!cl.contains('on')) {\r\n                    tools.switchLegend(cl.contains('speed'));\r\n                    container.footer.querySelector('span.on').classList.remove('on');\r\n                    cl.add('on');\r\n                    if (legendDiv) {\r\n                        legendDiv.remove();\r\n                        legendDiv = null;\r\n                        container.footer.querySelector('td.show_info').click();\r\n                    }                    \r\n                }\r\n            }\r\n            container.footer.querySelector('span.speed').addEventListener('click', lswitchClick);\r\n            container.footer.querySelector('span.type').addEventListener('click', lswitchClick);\r\n            let legendDiv;\r\n            container.footer.querySelector('td.show_info').addEventListener('click', () => {\r\n                if (legendDiv) {\r\n                    legendDiv.remove();\r\n                    legendDiv = null;\r\n                    return;\r\n                }\r\n                legendDiv = document.createElement('div');\r\n                legendDiv.className = 'ais_legend_info';\r\n\r\n                let loader = !tools.needAltLegend ? _svgLoader : _svgAltLoader,\r\n                    iconCollection = !tools.needAltLegend ? _icons : _iconsAlt;\r\n                loader.then(r => {\r\n//console.log(r);\r\n                    let template = !tools.needAltLegend ? '<table class=\"colors\">' : '<table class=\"movement_colors\">';\r\n                    iconCollection.forEach((ic, i) => {\r\n                        if (ic.name.search(/\\S/) != -1) {\r\n                            // let a = /\\.cls-1{fill:(#[^};]+)/.exec(ic.svg);\r\n                            // ic.color = '#fff';\r\n                            // if (a && a.length)\r\n                            //     ic.color = a[1];\r\n                            if (!tools.needAltLegend)\r\n                                template += '<tr><td class=\"color\"><div style=\"width:10px; height:10px; background-color:' + ic.color + '\"></div></td><td>' + ic.name + '</td></tr>';\r\n                            else{\r\n                                let svg = i==iconCollection.length-1 ? '<div style=\"padding-top:2px\">' + _getAtAnchorIcon(0, ic.color, '#fff') + '</div>'\r\n                                : _getUnderWayIcon(0, ic.color, '#fff')\r\n                                template += '<tr><td class=\"color\">'+ svg + '</td><td>' + ic.name + '</td></tr>';\r\n                            }\r\n                        }\r\n                    });\r\n                    if (!tools.needAltLegend) {\r\n                        template += '<tr><td colspan=\"2\" style=\"padding: 8px 10px 0;\"><div style=\"border-bottom: solid 1px #e1e8ed;width: 100%;\"></div></td></tr>'\r\n                        template += '</table><table class=\"movement\"><tr><td>' + _getUnderWayIcon(0, '#888', '#fff') + '</td><td>' + _gtxt(\"AISSearch2.moving\") + '</td>' +\r\n                            '<td style=\"padding-top:10px\">' + _getAtAnchorIcon(0, '#888', '#fff') + '</td><td>' + _gtxt(\"AISSearch2.standing\") + '</td></tr></table>';\r\n                    }\r\n//console.log(template)\r\n                    legendDiv.innerHTML = template;\r\n                    document.body.append(legendDiv);\r\n                    let rc = legendDiv.getClientRects()[0];\r\n                    legendDiv.style.left = (window.innerWidth - rc.width - 20) + 'px';\r\n                    legendDiv.style.top = (window.innerHeight - rc.height - 40) + 'px';\r\n                });\r\n            });\r\n            if (tools.needAltLegend)\r\n                container.footer.querySelector('span.speed').click();\r\n\r\n        };\r\n\r\n    const _getUnderWayIcon = function (cog, type_color, group_style) {\r\n        return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(' + (!cog ? 0 : cog) + 'deg)\"><title>1</title><path style=\"fill:' + type_color + ';\" d=\"M13.8,20.07a1,1,0,0,1-.69-0.28l-1.79-1.72a0.72,0.72,0,0,0-1,0L8.52,19.79a1,1,0,0,1-.69.28,1,1,0,0,1-1-1V8.65c0-1.52,1.55-7.59,4-7.59s4,6.07,4,7.59V19a1,1,0,0,1-1,1h0Z\"/><path style=\"fill:' + group_style + ';\" d=\"M10.82,1.57c1.93,0,3.5,5.57,3.5,7.09V19a0.52,0.52,0,0,1-.51.53,0.49,0.49,0,0,1-.34-0.14l-1.79-1.72a1.22,1.22,0,0,0-1.71,0L8.17,19.42a0.49,0.49,0,0,1-.34.14A0.52,0.52,0,0,1,7.32,19V8.65c0-1.51,1.57-7.09,3.5-7.09h0m0-1c-3,0-4.5,6.72-4.5,8.09V19a1.52,1.52,0,0,0,1.51,1.53,1.49,1.49,0,0,0,1-.42l1.79-1.72a0.22,0.22,0,0,1,.32,0l1.79,1.72a1.49,1.49,0,0,0,1,.42A1.52,1.52,0,0,0,15.32,19V8.65c0-1.37-1.51-8.09-4.5-8.09h0Z\"/><ellipse style=\"fill:#fff;\" cx=\"10.82\" cy=\"10.54\" rx=\"1.31\" ry=\"1.35\"/><path style=\"fill:#fff;\" d=\"M10.73,3.34h0.12a0.35,0.35,0,0,1,.35.35v6.85a0,0,0,0,1,0,0H10.38a0,0,0,0,1,0,0V3.69A0.35,0.35,0,0,1,10.73,3.34Z\"/></svg>';\r\n    },\r\n        _getAtAnchorIcon = function (cog, type_color, group_style) {\r\n            return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(' + (!cog ? 0 : cog) + 'deg)\"><title>1</title><rect style=\"fill:' + type_color + ';stroke:' + group_style + ';stroke-miterlimit:10;\" x=\"5.9\" y=\"5.6\" width=\"9.19\" height=\"9.19\" rx=\"2\" ry=\"2\" transform=\"translate(-4.13 10.41) rotate(-45)\"/><circle style=\"fill:#fff;\" cx=\"10.5\" cy=\"10.19\" r=\"1.5\"/></svg>';\r\n        };\r\n    return {\r\n        getUnderWayIcon: _getUnderWayIcon,\r\n        getAtAnchorIcon: _getAtAnchorIcon,\r\n        createSwitch: _createSwitch,\r\n        get icons(){return _icons;},\r\n        get iconsAlt(){return _iconsAlt;},\r\n        //get iconsDict(){return _iconsDict;},\r\n        //get iconsAltDict(){return _iconsAltDict;},\r\n        getIconAlt: function(vessel_name, sog){           \r\n            // speed icon\r\n            for(let f in _iconsAltDict){\r\n                let cond = f.replace(/\"sog\"/ig,  sog);\r\n                if (vessel_name)\r\n                    cond = cond.replace(/\"vessel_name\"/ig,  \r\n                    \"'\" + vessel_name.replace(/'/g, \"\\\\\\'\").replace(/\\\\[^']/g, \"\\\\\\\\\") + \"'\");\r\n//console.log(cond + \" \" + \"eval(cond)\")\r\n                if(eval(cond))\r\n                    return _iconsAltDict[f];\r\n            }\r\n        },\r\n        getIcon: function(vessel_type, sog){ \r\n            for(let f in _iconsDict){\r\n                let re1 = new RegExp(\"'\"+vessel_type+\"'\"),\r\n                re2 = new RegExp(sog != 0 ? \">0\" : \"=0\");\r\n//console.log(vessel_type+\" \"+sog+\" \"+f+\" \"+f.search(re1)+\" \"+f.search(re2))\r\n                if(f.search(re1)!=-1 && f.search(re2)!=-1){\r\n//console.log( _iconsDict[f])\r\n                    return _iconsDict[f];\r\n                }\r\n            }\r\n        },\r\n        getIconAltUrl: function(vessel_name, sog){ \r\n            let icon = this.getIconAlt(vessel_name, sog)\r\n            return icon && icon.url; \r\n        },\r\n        getIconUrl: function(vessel_type, sog){ \r\n            let icon = this.getIcon(vessel_type, sog)\r\n            return icon && icon.url; \r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = LegendControl;\n\n\n// WEBPACK FOOTER //\n// ./src/Controls/LegendControl.js","/*\r\n * based on\r\n * canvg.js - Javascript SVG parser and renderer on Canvas\r\n * MIT Licensed \r\n * Gabe Lerner (gabelerner@gmail.com)\r\n * http://code.google.com/p/canvg/\r\n *\r\n * Requires: rgbcolor.js - http://www.phpied.com/rgb-color-parser-in-javascript/\r\n */\r\nif(!window.console) {\r\n\twindow.console = {};\r\n\twindow.console.log = function(str) {};\r\n\twindow.console.dir = function(str) {};\r\n}\r\n\r\n// <3 IE\r\nif(!Array.indexOf){\r\n\tArray.prototype.indexOf = function(obj){\r\n\t\tfor(var i=0; i<this.length; i++){\r\n\t\t\tif(this[i]==obj){\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t}\r\n}\r\n\r\nconst _parser = {}, \r\ncvd = {logCommand:()=>{}};\r\n\r\n(function(){\r\n\t// canvg(target, s)\r\n\t// target: canvas element or the id of a canvas element\r\n\t// s: svg string or url to svg file\r\n\t// opts: optional hash of options\r\n\t//\t\t ignoreMouse: true => ignore mouse events\r\n\t//\t\t ignoreAnimation: true => ignore animations\r\n\t//\t\t ignoreDimensions: true => does not try to resize canvas\r\n\t//\t\t ignoreClear: true => does not clear canvas\r\n\t//\t\t offsetX: int => draws at a x offset\r\n\t//\t\t offsetY: int => draws at a y offset\r\n\t//\t\t scaleWidth: int => scales horizontally to width\r\n\t//\t\t scaleHeight: int => scales vertically to height\r\n\t//\t\t renderCallback: function => will call the function after the first render is completed\r\n\t//\t\t forceRedraw: function => will call the function on every frame, if it returns true, will redraw\r\n\t_parser.canvg = function (target, s, opts) {\r\n\t\tif (typeof target == 'string') {\r\n\t\t\ttarget = document.getElementById(target);\r\n\t\t}\r\n\t\t\r\n\t\t// reuse class per canvas\r\n\t\tvar svg;\r\n\t\tif (target.svg == null) {\r\n\t\t\tsvg = build();\r\n\t\t\ttarget.svg = svg;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsvg = target.svg;\r\n\t\t\tsvg.stop();\r\n\t\t}\r\n\t\tsvg.opts = opts;\r\n\t\t\r\n\t\tvar ctx = target.getContext('2d');\r\n\t\tif (s.substr(0,1) == '<') {\r\n\t\t\t// load from xml string\r\n\t\t\tsvg.loadXml(ctx, s);\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// load from url\r\n\t\t\tsvg.load(ctx, s);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction build() {\r\n\t\tvar svg = { };\r\n\t\t\r\n\t\tsvg.FRAMERATE = 30;\r\n\t\t\r\n\t\t// globals\r\n\t\tsvg.init = function(ctx) {\r\n\t\t\tsvg.Definitions = {};\r\n\t\t\tsvg.Styles = {};\r\n\t\t\tsvg.Animations = [];\r\n\t\t\tsvg.Images = [];\r\n\t\t\tsvg.ctx = ctx;\r\n\t\t\tsvg.ViewPort = new (function () {\r\n\t\t\t\tthis.viewPorts = [];\r\n\t\t\t\tthis.SetCurrent = function(width, height) { this.viewPorts.push({ width: width, height: height }); }\r\n\t\t\t\tthis.RemoveCurrent = function() { this.viewPorts.pop(); }\r\n\t\t\t\tthis.Current = function() { return this.viewPorts[this.viewPorts.length - 1]; }\r\n\t\t\t\tthis.width = function() { return this.Current().width; }\r\n\t\t\t\tthis.height = function() { return this.Current().height; }\r\n\t\t\t\tthis.ComputeSize = function(d) {\r\n\t\t\t\t\tif (d != null && typeof(d) == 'number') return d;\r\n\t\t\t\t\tif (d == 'x') return this.width();\r\n\t\t\t\t\tif (d == 'y') return this.height();\r\n\t\t\t\t\treturn Math.sqrt(Math.pow(this.width(), 2) + Math.pow(this.height(), 2)) / Math.sqrt(2);\t\t\t\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\tsvg.init();\r\n\t\t\r\n\t\t// images loaded\r\n\t\tsvg.ImagesLoaded = function() { \r\n\t\t\tfor (var i=0; i<svg.Images.length; i++) {\r\n\t\t\t\tif (!svg.Images[i].loaded) return false;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// trim\r\n\t\tsvg.trim = function(s) { return s.replace(/^\\s+|\\s+$/g, ''); }\r\n\t\t\r\n\t\t// compress spaces\r\n\t\tsvg.compressSpaces = function(s) { return s.replace(/[\\s\\r\\t\\n]+/gm,' '); }\r\n\t\t\r\n\t\t// ajax\r\n\t\tsvg.ajax = function(url) {\r\n\t\t\tvar AJAX;\r\n\t\t\tif(window.XMLHttpRequest){AJAX=new XMLHttpRequest();}\r\n\t\t\telse{AJAX=new ActiveXObject('Microsoft.XMLHTTP');}\r\n\t\t\tif(AJAX){\r\n\t\t\t   AJAX.open('GET',url,false);\r\n\t\t\t   AJAX.send(null);\r\n\t\t\t   return AJAX.responseText;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t} \r\n\t\t\r\n\t\t// parse xml\r\n\t\tsvg.parseXml = function(xml) {\r\n\t\t\tif (window.DOMParser)\r\n\t\t\t{\r\n\t\t\t\tvar parser = new DOMParser();\r\n\t\t\t\treturn parser.parseFromString(xml, 'text/xml');\r\n\t\t\t}\r\n\t\t\telse \r\n\t\t\t{\r\n\t\t\t\txml = xml.replace(/<!DOCTYPE svg[^>]*>/, '');\r\n\t\t\t\tvar xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\r\n\t\t\t\txmlDoc.async = 'false';\r\n\t\t\t\txmlDoc.loadXML(xml); \r\n\t\t\t\treturn xmlDoc;\r\n\t\t\t}\t\t\r\n\t\t}\r\n\t\t\r\n\t\tsvg.Property = function(name, value) {\r\n\t\t\tthis.name = name;\r\n\t\t\tthis.value = value;\r\n\t\t\t\r\n\t\t\tthis.hasValue = function() {\r\n\t\t\t\treturn (this.value != null && this.value != '');\r\n\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\r\n\t\t\t// return the numerical value of the property\r\n\t\t\tthis.numValue = function() {\r\n\t\t\t\tif (!this.hasValue()) return 0;\r\n\t\t\t\t\r\n\t\t\t\tvar n = parseFloat(this.value);\r\n\t\t\t\tif ((this.value + '').match(/%$/)) {\r\n\t\t\t\t\tn = n / 100.0;\r\n\t\t\t\t}\r\n\t\t\t\treturn n;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.valueOrDefault = function(def) {\r\n\t\t\t\tif (this.hasValue()) return this.value;\r\n\t\t\t\treturn def;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.numValueOrDefault = function(def) {\r\n\t\t\t\tif (this.hasValue()) return this.numValue();\r\n\t\t\t\treturn def;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t/* EXTENSIONS */\r\n\t\t\tvar that = this;\r\n\t\t\t\r\n\t\t\t// color extensions\r\n\t\t\tthis.Color = {\r\n\t\t\t\t// augment the current color value with the opacity\r\n\t\t\t\taddOpacity: function(opacity) {\r\n\t\t\t\t\tvar newValue = that.value;\r\n\t\t\t\t\tif (opacity != null && opacity != '') {\r\n\t\t\t\t\t\tvar color = new RGBColor(that.value);\r\n\t\t\t\t\t\tif (color.ok) {\r\n\t\t\t\t\t\t\tnewValue = 'rgba(' + color.r + ', ' + color.g + ', ' + color.b + ', ' + opacity + ')';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn new svg.Property(that.name, newValue);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// definition extensions\r\n\t\t\tthis.Definition = {\r\n\t\t\t\t// get the definition from the definitions table\r\n\t\t\t\tgetDefinition: function() {\r\n\t\t\t\t\tvar name = that.value.replace(/^(url\\()?#([^\\)]+)\\)?$/, '$2');\r\n\t\t\t\t\treturn svg.Definitions[name];\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\tisUrl: function() {\r\n\t\t\t\t\treturn that.value.indexOf('url(') == 0\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\tgetFillStyle: function(e) {\r\n\t\t\t\t\tvar def = this.getDefinition();\r\n\t\t\t\t\t\r\n\t\t\t\t\t// gradient\r\n\t\t\t\t\tif (def != null && def.createGradient) {\r\n\t\t\t\t\t\treturn def.createGradient(svg.ctx, e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// pattern\r\n\t\t\t\t\tif (def != null && def.createPattern) {\r\n\t\t\t\t\t\treturn def.createPattern(svg.ctx, e);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// length extensions\r\n\t\t\tthis.Length = {\r\n\t\t\t\tDPI: function(viewPort) {\r\n\t\t\t\t\treturn 96.0; // TODO: compute?\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\tEM: function(viewPort) {\r\n\t\t\t\t\tvar em = 12;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);\r\n\t\t\t\t\tif (fontSize.hasValue()) em = fontSize.Length.toPixels(viewPort);\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn em;\r\n\t\t\t\t},\r\n\t\t\t\r\n\t\t\t\t// get the length as pixels\r\n\t\t\t\ttoPixels: function(viewPort) {\r\n\t\t\t\t\tif (!that.hasValue()) return 0;\r\n\t\t\t\t\tvar s = that.value+'';\r\n\t\t\t\t\tif (s.match(/em$/)) return that.numValue() * this.EM(viewPort);\r\n\t\t\t\t\tif (s.match(/ex$/)) return that.numValue() * this.EM(viewPort) / 2.0;\r\n\t\t\t\t\tif (s.match(/px$/)) return that.numValue();\r\n\t\t\t\t\tif (s.match(/pt$/)) return that.numValue() * 1.25;\r\n\t\t\t\t\tif (s.match(/pc$/)) return that.numValue() * 15;\r\n\t\t\t\t\tif (s.match(/cm$/)) return that.numValue() * this.DPI(viewPort) / 2.54;\r\n\t\t\t\t\tif (s.match(/mm$/)) return that.numValue() * this.DPI(viewPort) / 25.4;\r\n\t\t\t\t\tif (s.match(/in$/)) return that.numValue() * this.DPI(viewPort);\r\n\t\t\t\t\tif (s.match(/%$/)) return that.numValue() * svg.ViewPort.ComputeSize(viewPort);\r\n\t\t\t\t\treturn that.numValue();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// time extensions\r\n\t\t\tthis.Time = {\r\n\t\t\t\t// get the time as milliseconds\r\n\t\t\t\ttoMilliseconds: function() {\r\n\t\t\t\t\tif (!that.hasValue()) return 0;\r\n\t\t\t\t\tvar s = that.value+'';\r\n\t\t\t\t\tif (s.match(/s$/)) return that.numValue() * 1000;\r\n\t\t\t\t\tif (s.match(/ms$/)) return that.numValue();\r\n\t\t\t\t\treturn that.numValue();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// angle extensions\r\n\t\t\tthis.Angle = {\r\n\t\t\t\t// get the angle as radians\r\n\t\t\t\ttoRadians: function() {\r\n\t\t\t\t\tif (!that.hasValue()) return 0;\r\n\t\t\t\t\tvar s = that.value+'';\r\n\t\t\t\t\tif (s.match(/deg$/)) return that.numValue() * (Math.PI / 180.0);\r\n\t\t\t\t\tif (s.match(/grad$/)) return that.numValue() * (Math.PI / 200.0);\r\n\t\t\t\t\tif (s.match(/rad$/)) return that.numValue();\r\n\t\t\t\t\treturn that.numValue() * (Math.PI / 180.0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// fonts\r\n\t\tsvg.Font = new (function() {\r\n\t\t\tthis.Styles = ['normal','italic','oblique','inherit'];\r\n\t\t\tthis.Variants = ['normal','small-caps','inherit'];\r\n\t\t\tthis.Weights = ['normal','bold','bolder','lighter','100','200','300','400','500','600','700','800','900','inherit'];\r\n\t\t\t\r\n\t\t\tthis.CreateFont = function(fontStyle, fontVariant, fontWeight, fontSize, fontFamily, inherit) { \r\n\t\t\t\tvar f = inherit != null ? this.Parse(inherit) : this.CreateFont('', '', '', '', '', svg.ctx.font);\r\n\t\t\t\treturn { \r\n\t\t\t\t\tfontFamily: fontFamily || f.fontFamily, \r\n\t\t\t\t\tfontSize: fontSize || f.fontSize, \r\n\t\t\t\t\tfontStyle: fontStyle || f.fontStyle, \r\n\t\t\t\t\tfontWeight: fontWeight || f.fontWeight, \r\n\t\t\t\t\tfontVariant: fontVariant || f.fontVariant,\r\n\t\t\t\t\ttoString: function () { return [this.fontStyle, this.fontVariant, this.fontWeight, this.fontSize, this.fontFamily].join(' ') } \r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar that = this;\r\n\t\t\tthis.Parse = function(s) {\r\n\t\t\t\tvar f = {};\r\n\t\t\t\tvar d = svg.trim(svg.compressSpaces(s || '')).split(' ');\r\n\t\t\t\tvar set = { fontSize: false, fontStyle: false, fontWeight: false, fontVariant: false }\r\n\t\t\t\tvar ff = '';\r\n\t\t\t\tfor (var i=0; i<d.length; i++) {\r\n\t\t\t\t\tif (!set.fontStyle && that.Styles.indexOf(d[i]) != -1) { if (d[i] != 'inherit') f.fontStyle = d[i]; set.fontStyle = true; }\r\n\t\t\t\t\telse if (!set.fontVariant && that.Variants.indexOf(d[i]) != -1) { if (d[i] != 'inherit') f.fontVariant = d[i]; set.fontStyle = set.fontVariant = true;\t}\r\n\t\t\t\t\telse if (!set.fontWeight && that.Weights.indexOf(d[i]) != -1) {\tif (d[i] != 'inherit') f.fontWeight = d[i]; set.fontStyle = set.fontVariant = set.fontWeight = true; }\r\n\t\t\t\t\telse if (!set.fontSize) { if (d[i] != 'inherit') f.fontSize = d[i].split('/')[0]; set.fontStyle = set.fontVariant = set.fontWeight = set.fontSize = true; }\r\n\t\t\t\t\telse { if (d[i] != 'inherit') ff += d[i]; }\r\n\t\t\t\t} if (ff != '') f.fontFamily = ff;\r\n\t\t\t\treturn f;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\t// points and paths\r\n\t\tsvg.ToNumberArray = function(s) {\r\n\t\t\tvar a = svg.trim(svg.compressSpaces((s || '').replace(/,/g, ' '))).split(' ');\r\n\t\t\tfor (var i=0; i<a.length; i++) {\r\n\t\t\t\ta[i] = parseFloat(a[i]);\r\n\t\t\t}\r\n\t\t\treturn a;\r\n\t\t}\t\t\r\n\t\tsvg.Point = function(x, y) {\r\n\t\t\tthis.x = x;\r\n\t\t\tthis.y = y;\r\n\t\t\t\r\n\t\t\tthis.angleTo = function(p) {\r\n\t\t\t\treturn Math.atan2(p.y - this.y, p.x - this.x);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.applyTransform = function(v) {\r\n\t\t\t\tvar xp = this.x * v[0] + this.y * v[2] + v[4];\r\n\t\t\t\tvar yp = this.x * v[1] + this.y * v[3] + v[5];\r\n\t\t\t\tthis.x = xp;\r\n\t\t\t\tthis.y = yp;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.CreatePoint = function(s) {\r\n\t\t\tvar a = svg.ToNumberArray(s);\r\n\t\t\treturn new svg.Point(a[0], a[1]);\r\n\t\t}\r\n\t\tsvg.CreatePath = function(s) {\r\n\t\t\tvar a = svg.ToNumberArray(s);\r\n\t\t\tvar path = [];\r\n\t\t\tfor (var i=0; i<a.length; i+=2) {\r\n\t\t\t\tpath.push(new svg.Point(a[i], a[i+1]));\r\n\t\t\t}\r\n\t\t\treturn path;\r\n\t\t}\r\n\t\t\r\n\t\t// bounding box\r\n\t\tsvg.BoundingBox = function(x1, y1, x2, y2) { // pass in initial points if you want\r\n\t\t\tthis.x1 = Number.NaN;\r\n\t\t\tthis.y1 = Number.NaN;\r\n\t\t\tthis.x2 = Number.NaN;\r\n\t\t\tthis.y2 = Number.NaN;\r\n\t\t\t\r\n\t\t\tthis.x = function() { return this.x1; }\r\n\t\t\tthis.y = function() { return this.y1; }\r\n\t\t\tthis.width = function() { return this.x2 - this.x1; }\r\n\t\t\tthis.height = function() { return this.y2 - this.y1; }\r\n\t\t\t\r\n\t\t\tthis.addPoint = function(x, y) {\t\r\n\t\t\t\tif (x != null) {\r\n\t\t\t\t\tif (isNaN(this.x1) || isNaN(this.x2)) {\r\n\t\t\t\t\t\tthis.x1 = x;\r\n\t\t\t\t\t\tthis.x2 = x;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (x < this.x1) this.x1 = x;\r\n\t\t\t\t\tif (x > this.x2) this.x2 = x;\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\tif (y != null) {\r\n\t\t\t\t\tif (isNaN(this.y1) || isNaN(this.y2)) {\r\n\t\t\t\t\t\tthis.y1 = y;\r\n\t\t\t\t\t\tthis.y2 = y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (y < this.y1) this.y1 = y;\r\n\t\t\t\t\tif (y > this.y2) this.y2 = y;\r\n\t\t\t\t}\r\n\t\t\t}\t\t\t\r\n\t\t\tthis.addX = function(x) { this.addPoint(x, null); }\r\n\t\t\tthis.addY = function(y) { this.addPoint(null, y); }\r\n\t\t\t\r\n\t\t\tthis.addQuadraticCurve = function(p0x, p0y, p1x, p1y, p2x, p2y) {\r\n\t\t\t\tvar cp1x = p0x + 2/3 * (p1x - p0x); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n\t\t\t\tvar cp1y = p0y + 2/3 * (p1y - p0y); // CP1 = QP0 + 2/3 *(QP1-QP0)\r\n\t\t\t\tvar cp2x = cp1x + 1/3 * (p2x - p0x); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n\t\t\t\tvar cp2y = cp1y + 1/3 * (p2y - p0y); // CP2 = CP1 + 1/3 *(QP2-QP0)\r\n\t\t\t\tthis.addBezierCurve(p0x, p0y, cp1x, cp2x, cp1y,\tcp2y, p2x, p2y);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.addBezierCurve = function(p0x, p0y, p1x, p1y, p2x, p2y, p3x, p3y) {\r\n\t\t\t\t// from http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html\r\n\t\t\t\tvar p0 = [p0x, p0y], p1 = [p1x, p1y], p2 = [p2x, p2y], p3 = [p3x, p3y];\r\n\t\t\t\tthis.addPoint(p0[0], p0[1]);\r\n\t\t\t\tthis.addPoint(p3[0], p3[1]);\r\n\t\t\t\t\r\n\t\t\t\tfor (var i=0; i<=1; i++) {\r\n\t\t\t\t\tvar f = function(t) { \r\n\t\t\t\t\t\treturn Math.pow(1-t, 3) * p0[i]\r\n\t\t\t\t\t\t+ 3 * Math.pow(1-t, 2) * t * p1[i]\r\n\t\t\t\t\t\t+ 3 * (1-t) * Math.pow(t, 2) * p2[i]\r\n\t\t\t\t\t\t+ Math.pow(t, 3) * p3[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar b = 6 * p0[i] - 12 * p1[i] + 6 * p2[i];\r\n\t\t\t\t\tvar a = -3 * p0[i] + 9 * p1[i] - 9 * p2[i] + 3 * p3[i];\r\n\t\t\t\t\tvar c = 3 * p1[i] - 3 * p0[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (a == 0) {\r\n\t\t\t\t\t\tif (b == 0) continue;\r\n\t\t\t\t\t\tvar t = -c / b;\r\n\t\t\t\t\t\tif (0 < t && t < 1) {\r\n\t\t\t\t\t\t\tif (i == 0) this.addX(f(t));\r\n\t\t\t\t\t\t\tif (i == 1) this.addY(f(t));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar b2ac = Math.pow(b, 2) - 4 * c * a;\r\n\t\t\t\t\tif (b2ac < 0) continue;\r\n\t\t\t\t\tvar t1 = (-b + Math.sqrt(b2ac)) / (2 * a);\r\n\t\t\t\t\tif (0 < t1 && t1 < 1) {\r\n\t\t\t\t\t\tif (i == 0) this.addX(f(t1));\r\n\t\t\t\t\t\tif (i == 1) this.addY(f(t1));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar t2 = (-b - Math.sqrt(b2ac)) / (2 * a);\r\n\t\t\t\t\tif (0 < t2 && t2 < 1) {\r\n\t\t\t\t\t\tif (i == 0) this.addX(f(t2));\r\n\t\t\t\t\t\tif (i == 1) this.addY(f(t2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.isPointInBox = function(x, y) {\r\n\t\t\t\treturn (this.x1 <= x && x <= this.x2 && this.y1 <= y && y <= this.y2);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.addPoint(x1, y1);\r\n\t\t\tthis.addPoint(x2, y2);\r\n\t\t}\r\n\t\t\r\n\t\t// transforms\r\n\t\tsvg.Transform = function(v) {\t\r\n\t\t\tvar that = this;\r\n\t\t\tthis.Type = {}\r\n\t\t\r\n\t\t\t// translate\r\n\t\t\tthis.Type.translate = function(s) {\r\n\t\t\t\tthis.p = svg.CreatePoint(s);\t\t\t\r\n\t\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\t\tctx.translate(this.p.x || 0.0, this.p.y || 0.0);\r\n\t\t\t\t}\r\n\t\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\t\tp.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// rotate\r\n\t\t\tthis.Type.rotate = function(s) {\r\n\t\t\t\tvar a = svg.ToNumberArray(s);\r\n\t\t\t\tthis.angle = new svg.Property('angle', a[0]);\r\n\t\t\t\tthis.cx = a[1] || 0;\r\n\t\t\t\tthis.cy = a[2] || 0;\r\n\t\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\t\tctx.translate(this.cx, this.cy);\r\n\t\t\t\t\tctx.rotate(this.angle.Angle.toRadians());\r\n\t\t\t\t\tctx.translate(-this.cx, -this.cy);\r\n\t\t\t\t}\r\n\t\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\t\tvar a = this.angle.Angle.toRadians();\r\n\t\t\t\t\tp.applyTransform([1, 0, 0, 1, this.p.x || 0.0, this.p.y || 0.0]);\r\n\t\t\t\t\tp.applyTransform([Math.cos(a), Math.sin(a), -Math.sin(a), Math.cos(a), 0, 0]);\r\n\t\t\t\t\tp.applyTransform([1, 0, 0, 1, -this.p.x || 0.0, -this.p.y || 0.0]);\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.Type.scale = function(s) {\r\n\t\t\t\tthis.p = svg.CreatePoint(s);\r\n\t\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\t\tctx.scale(this.p.x || 1.0, this.p.y || this.p.x || 1.0);\r\n\t\t\t\t}\r\n\t\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\t\tp.applyTransform([this.p.x || 0.0, 0, 0, this.p.y || 0.0, 0, 0]);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.Type.matrix = function(s) {\r\n\t\t\t\tthis.m = svg.ToNumberArray(s);\r\n\t\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\t\tctx.transform(this.m[0], this.m[1], this.m[2], this.m[3], this.m[4], this.m[5]);\r\n\t\t\t\t}\r\n\t\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\t\tp.applyTransform(this.m);\r\n\t\t\t\t}\t\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.Type.SkewBase = function(s) {\r\n\t\t\t\tthis.base = that.Type.matrix;\r\n\t\t\t\tthis.base(s);\r\n\t\t\t\tthis.angle = new svg.Property('angle', s);\r\n\t\t\t}\r\n\t\t\tthis.Type.SkewBase.prototype = new this.Type.matrix;\r\n\t\t\t\r\n\t\t\tthis.Type.skewX = function(s) {\r\n\t\t\t\tthis.base = that.Type.SkewBase;\r\n\t\t\t\tthis.base(s);\r\n\t\t\t\tthis.m = [1, 0, Math.tan(this.angle.Angle.toRadians()), 1, 0, 0];\r\n\t\t\t}\r\n\t\t\tthis.Type.skewX.prototype = new this.Type.SkewBase;\r\n\t\t\t\r\n\t\t\tthis.Type.skewY = function(s) {\r\n\t\t\t\tthis.base = that.Type.SkewBase;\r\n\t\t\t\tthis.base(s);\r\n\t\t\t\tthis.m = [1, Math.tan(this.angle.Angle.toRadians()), 0, 1, 0, 0];\r\n\t\t\t}\r\n\t\t\tthis.Type.skewY.prototype = new this.Type.SkewBase;\r\n\t\t\r\n\t\t\tthis.transforms = [];\r\n\t\t\t\r\n\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\tfor (var i=0; i<this.transforms.length; i++) {\r\n\t\t\t\t\tthis.transforms[i].apply(ctx);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.applyToPoint = function(p) {\r\n\t\t\t\tfor (var i=0; i<this.transforms.length; i++) {\r\n\t\t\t\t\tthis.transforms[i].applyToPoint(p);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar data = v.split(/\\s(?=[a-z])/);\r\n\t\t\tfor (var i=0; i<data.length; i++) {\r\n\t\t\t\tvar type = data[i].split('(')[0];\r\n\t\t\t\tvar s = data[i].split('(')[1].replace(')','');\r\n\t\t\t\tvar transform = eval('new this.Type.' + type + '(s)');\r\n\t\t\t\tthis.transforms.push(transform);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// aspect ratio\r\n\t\tsvg.AspectRatio = function(ctx, aspectRatio, width, desiredWidth, height, desiredHeight, minX, minY, refX, refY) {\r\n\t\t\t// aspect ratio - http://www.w3.org/TR/SVG/coords.html#PreserveAspectRatioAttribute\r\n\t\t\taspectRatio = svg.compressSpaces(aspectRatio);\r\n\t\t\taspectRatio = aspectRatio.replace(/^defer\\s/,''); // ignore defer\r\n\t\t\tvar align = aspectRatio.split(' ')[0] || 'xMidYMid';\r\n\t\t\tvar meetOrSlice = aspectRatio.split(' ')[1] || 'meet';\t\t\t\t\t\r\n\t\r\n\t\t\t// calculate scale\r\n\t\t\tvar scaleX = width / desiredWidth;\r\n\t\t\tvar scaleY = height / desiredHeight;\r\n\t\t\tvar scaleMin = Math.min(scaleX, scaleY);\r\n\t\t\tvar scaleMax = Math.max(scaleX, scaleY);\r\n\t\t\tif (meetOrSlice == 'meet') { desiredWidth *= scaleMin; desiredHeight *= scaleMin; }\r\n\t\t\tif (meetOrSlice == 'slice') { desiredWidth *= scaleMax; desiredHeight *= scaleMax; }\t\r\n\t\t\t\r\n\t\t\trefX = new svg.Property('refX', refX);\r\n\t\t\trefY = new svg.Property('refY', refY);\r\n\t\t\tif (refX.hasValue() && refY.hasValue()) {\t\t\t\t\r\n\t\t\t\tctx.translate(-scaleMin * refX.Length.toPixels('x'), -scaleMin * refY.Length.toPixels('y'));\r\n\t\t\t} \r\n\t\t\telse {\t\t\t\t\t\r\n\t\t\t\t// align\r\n\t\t\t\tif (align.match(/^xMid/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width / 2.0 - desiredWidth / 2.0, 0); \r\n\t\t\t\tif (align.match(/YMid$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height / 2.0 - desiredHeight / 2.0); \r\n\t\t\t\tif (align.match(/^xMax/) && ((meetOrSlice == 'meet' && scaleMin == scaleY) || (meetOrSlice == 'slice' && scaleMax == scaleY))) ctx.translate(width - desiredWidth, 0); \r\n\t\t\t\tif (align.match(/YMax$/) && ((meetOrSlice == 'meet' && scaleMin == scaleX) || (meetOrSlice == 'slice' && scaleMax == scaleX))) ctx.translate(0, height - desiredHeight); \r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// scale\r\n\t\t\tif (align == 'none') ctx.scale(scaleX, scaleY);\r\n\t\t\telse if (meetOrSlice == 'meet') ctx.scale(scaleMin, scaleMin); \r\n\t\t\telse if (meetOrSlice == 'slice') ctx.scale(scaleMax, scaleMax); \t\r\n\t\t\t\r\n\t\t\t// translate\r\n\t\t\tctx.translate(minX == null ? 0 : -minX, minY == null ? 0 : -minY);\t\t\t\r\n\t\t}\r\n\t\t\r\n\t\t// elements\r\n\t\tsvg.Element = {}\r\n\t\t\r\n\t\tsvg.Element.ElementBase = function(node) {\t\r\n\t\t\tthis.attributes = {};\r\n\t\t\tthis.styles = {};\r\n\t\t\tthis.children = [];\r\n\t\t\t\r\n\t\t\t// get or create attribute\r\n\t\t\tthis.attribute = function(name, createIfNotExists) {\r\n\t\t\t\tvar a = this.attributes[name];\r\n\t\t\t\tif (a != null) return a;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\ta = new svg.Property(name, '');\r\n\t\t\t\tif (createIfNotExists == true) this.attributes[name] = a;\r\n\t\t\t\treturn a;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// get or create style\r\n\t\t\tthis.style = function(name, createIfNotExists) {\r\n\t\t\t\tvar s = this.styles[name];\r\n\t\t\t\tif (s != null) return s;\r\n\t\t\t\t\r\n\t\t\t\tvar a = this.attribute(name);\r\n\t\t\t\tif (a != null && a.hasValue()) {\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\ts = new svg.Property(name, '');\r\n\t\t\t\tif (createIfNotExists == true) this.styles[name] = s;\r\n\t\t\t\treturn s;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// base render\r\n\t\t\tthis.render = function(ctx) {\r\n\t\t\t\t// don't render display=none\r\n\t\t\t\tif (this.attribute('display').value == 'none') return;\r\n\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tthis.setContext(ctx);\r\n\t\t\t\tthis.renderChildren(ctx);\r\n\t\t\t\tthis.clearContext(ctx);\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// base set context\r\n\t\t\tthis.setContext = function(ctx) {\r\n\t\t\t\t// OVERRIDE ME!\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// base clear context\r\n\t\t\tthis.clearContext = function(ctx) {\r\n\t\t\t\t// OVERRIDE ME!\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\t// base render children\r\n\t\t\tthis.renderChildren = function(ctx) {\r\n\t\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\t\tthis.children[i].render(ctx);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.addChild = function(childNode, create) {\r\n\t\t\t\tvar child = childNode;\r\n\t\t\t\tif (create) child = svg.CreateElement(childNode);\r\n\t\t\t\tchild.parent = this;\r\n\t\t\t\tthis.children.push(child);\t\t\t\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tif (node != null && node.nodeType == 1) { //ELEMENT_NODE\r\n\t\t\t\t// add children\r\n\t\t\t\tfor (var i=0; i<node.childNodes.length; i++) {\r\n\t\t\t\t\tvar childNode = node.childNodes[i];\r\n\t\t\t\t\tif (childNode.nodeType == 1) this.addChild(childNode, true); //ELEMENT_NODE\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// add attributes\r\n\t\t\t\tfor (var i=0; i<node.attributes.length; i++) {\r\n\t\t\t\t\tvar attribute = node.attributes[i];\r\n\t\t\t\t\tthis.attributes[attribute.nodeName] = new svg.Property(attribute.nodeName, attribute.nodeValue);\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t// add tag styles\r\n\t\t\t\tvar styles = svg.Styles[this.type];\r\n\t\t\t\tif (styles != null) {\r\n\t\t\t\t\tfor (var name in styles) {\r\n\t\t\t\t\t\tthis.styles[name] = styles[name];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t// add class styles\r\n\t\t\t\tif (this.attribute('class').hasValue()) {\r\n\t\t\t\t\tvar classes = svg.compressSpaces(this.attribute('class').value).split(' ');\r\n\t\t\t\t\tfor (var j=0; j<classes.length; j++) {\r\n\t\t\t\t\t\tstyles = svg.Styles['.'+classes[j]];\r\n\t\t\t\t\t\tif (styles != null) {\r\n\t\t\t\t\t\t\tfor (var name in styles) {\r\n\t\t\t\t\t\t\t\tthis.styles[name] = styles[name];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// add inline styles\r\n\t\t\t\tif (this.attribute('style').hasValue()) {\r\n\t\t\t\t\tvar styles = this.attribute('style').value.split(';');\r\n\t\t\t\t\tfor (var i=0; i<styles.length; i++) {\r\n\t\t\t\t\t\tif (svg.trim(styles[i]) != '') {\r\n\t\t\t\t\t\t\tvar style = styles[i].split(':');\r\n\t\t\t\t\t\t\tvar name = svg.trim(style[0]);\r\n\t\t\t\t\t\t\tvar value = svg.trim(style[1]);\r\n\t\t\t\t\t\t\tthis.styles[name] = new svg.Property(name, value);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\r\n\r\n\t\t\t\t// add id\r\n\t\t\t\tif (this.attribute('id').hasValue()) {\r\n\t\t\t\t\tif (svg.Definitions[this.attribute('id').value] == null) {\r\n\t\t\t\t\t\tsvg.Definitions[this.attribute('id').value] = this;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tsvg.Element.RenderedElementBase = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.setContext = function(ctx) {\r\n\t\t\t\t// fill\r\n\t\t\t\tif (this.style('fill').Definition.isUrl()) {\r\n\t\t\t\t\tvar fs = this.style('fill').Definition.getFillStyle(this);\r\n\t\t\t\t\tif (fs != null) {ctx.fillStyle = fs; \r\n           // cvd.logCommand('ctx.fillStyle = \"' + ctx.fillStyle + '\"' );\r\n           cvd.logCommand('ctx.fillStyle = g');\r\n             \r\n            }\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.style('fill').hasValue()) {\r\n\t\t\t\t\tvar fillStyle = this.style('fill');\r\n\t\t\t\t\tif (this.style('fill-opacity').hasValue()) fillStyle = fillStyle.Color.addOpacity(this.style('fill-opacity').value);\r\n\t\t\t\t\tctx.fillStyle = (fillStyle.value == 'none' ? 'rgba(0,0,0,0)' : fillStyle.value);\r\n          cvd.logCommand('ctx.fillStyle = \"' + ctx.fillStyle + '\"' );\r\n        \r\n        }\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t// stroke\r\n\t\t\t\tif (this.style('stroke').Definition.isUrl()) {\r\n\t\t\t\t\tvar fs = this.style('stroke').Definition.getFillStyle(this);\r\n\t\t\t\t\tif (fs != null) { ctx.strokeStyle = fs;  cvd.logCommand('ctx.strokeStyle = \"' + ctx.strokeStyle + '\"' );}\r\n\t\t\t\t}\r\n\t\t\t\telse if (this.style('stroke').hasValue()) {\r\n\t\t\t\t\tvar strokeStyle = this.style('stroke');\r\n\t\t\t\t\tif (this.style('stroke-opacity').hasValue()) strokeStyle = strokeStyle.Color.addOpacity(this.style('stroke-opacity').value);\r\n\t\t\t\t\tctx.strokeStyle = (strokeStyle.value == 'none' ? 'rgba(0,0,0,0)' : strokeStyle.value);\r\n\t\t\t\t\tcvd.logCommand('ctx.strokeStyle = \"' + ctx.strokeStyle + '\"' );\r\n\t\t\t\t}\r\n\t\t\t\tif (this.style('stroke-width').hasValue()) { ctx.lineWidth = this.style('stroke-width').Length.toPixels(); cvd.logCommand('ctx.lineWidth = ' + ctx.lineWidth);}\r\n\t\t\t\tif (this.style('stroke-linecap').hasValue()) { ctx.lineCap = this.style('stroke-linecap').value; cvd.logCommand('ctx.lineCap = \"' + ctx.lineCap +'\"');}\r\n\t\t\t\tif (this.style('stroke-linejoin').hasValue()) { ctx.lineJoin = this.style('stroke-linejoin').value; cvd.logCommand('ctx.lineJoin = \"' + ctx.lineJoin +'\"');}\r\n\t\t\t\tif (this.style('stroke-miterlimit').hasValue()) { ctx.miterLimit = this.style('stroke-miterlimit').value; cvd.logCommand('ctx.miterLimit = ' + ctx.miterLimit);}\r\n\r\n\t\t\t\t// font\r\n\t\t\t\tif (typeof(ctx.font) != 'undefined') {\r\n\t\t\t\t\tctx.font = svg.Font.CreateFont( \r\n\t\t\t\t\t\tthis.style('font-style').value, \r\n\t\t\t\t\t\tthis.style('font-variant').value, \r\n\t\t\t\t\t\tthis.style('font-weight').value, \r\n\t\t\t\t\t\tthis.style('font-size').hasValue() ? this.style('font-size').Length.toPixels() + 'px' : '', \r\n\t\t\t\t\t\tthis.style('font-family').value).toString();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// transform\r\n\t\t\t\tif (this.attribute('transform').hasValue()) { \r\n\t\t\t\t\tvar transform = new svg.Transform(this.attribute('transform').value);\r\n\t\t\t\t\ttransform.apply(ctx);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// clip\r\n\t\t\t\tif (this.attribute('clip-path').hasValue()) {\r\n\t\t\t\t\tvar clip = this.attribute('clip-path').Definition.getDefinition();\r\n\t\t\t\t\tif (clip != null) clip.apply(ctx);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// opacity\r\n\t\t\t\tif (this.style('opacity').hasValue()) {\r\n\t\t\t\t\tctx.globalAlpha = this.style('opacity').numValue();\r\n          cvd.logCommand('ctx.globalAlpha = ' + ctx.globalAlpha );\r\n\t\t\t\t}\r\n\t\t\t}\t\t\r\n\t\t}\r\n\t\tsvg.Element.RenderedElementBase.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\tsvg.Element.PathElementBase = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tif (ctx != null) ctx.beginPath();\r\n\t\t\t\treturn new svg.BoundingBox();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.renderChildren = function(ctx) {\r\n\t\t\t\tthis.path(ctx);\r\n\t\t\t\tsvg.Mouse.checkPath(this, ctx);\r\n\t\t\t\tif (ctx.fillStyle != '') ctx.fill();\r\n\t\t\t\tif (ctx.strokeStyle != '') ctx.stroke();\r\n\t\t\t\t\r\n\t\t\t\tvar markers = this.getMarkers();\r\n\t\t\t\tif (markers != null) {\r\n\t\t\t\t\tif (this.attribute('marker-start').Definition.isUrl()) {\r\n\t\t\t\t\t\tvar marker = this.attribute('marker-start').Definition.getDefinition();\r\n\t\t\t\t\t\tmarker.render(ctx, markers[0][0], markers[0][1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.attribute('marker-mid').Definition.isUrl()) {\r\n\t\t\t\t\t\tvar marker = this.attribute('marker-mid').Definition.getDefinition();\r\n\t\t\t\t\t\tfor (var i=1;i<markers.length-1;i++) {\r\n\t\t\t\t\t\t\tmarker.render(ctx, markers[i][0], markers[i][1]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.attribute('marker-end').Definition.isUrl()) {\r\n\t\t\t\t\t\tvar marker = this.attribute('marker-end').Definition.getDefinition();\r\n\t\t\t\t\t\tmarker.render(ctx, markers[markers.length-1][0], markers[markers.length-1][1]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getBoundingBox = function() {\r\n\t\t\t\treturn this.path();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getMarkers = function() {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.PathElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\t\t\r\n\t\t// svg element\r\n\t\tsvg.Element.svg = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.baseClearContext = this.clearContext;\r\n\t\t\tthis.clearContext = function(ctx) {\r\n\t\t\t\tthis.baseClearContext(ctx);\r\n\t\t\t\tsvg.ViewPort.RemoveCurrent();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.baseSetContext = this.setContext;\r\n\t\t\tthis.setContext = function(ctx) {\r\n\t\t\t\tthis.baseSetContext(ctx);\r\n\t\t\t\t\r\n\t\t\t\t// create new view port\r\n\t\t\t\tif (this.attribute('x').hasValue() && this.attribute('y').hasValue()) {\r\n\t\t\t\t\tctx.translate(this.attribute('x').Length.toPixels('x'), this.attribute('y').Length.toPixels('y'));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar width = svg.ViewPort.width();\r\n\t\t\t\tvar height = svg.ViewPort.height();\r\n\t\t\t\tif (this.attribute('width').hasValue() && this.attribute('height').hasValue()) {\r\n\t\t\t\t\twidth = this.attribute('width').Length.toPixels('x');\r\n\t\t\t\t\theight = this.attribute('height').Length.toPixels('y');\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar x = 0;\r\n\t\t\t\t\tvar y = 0;\r\n\t\t\t\t\tif (this.attribute('refX').hasValue() && this.attribute('refY').hasValue()) {\r\n\t\t\t\t\t\tx = -this.attribute('refX').Length.toPixels('x');\r\n\t\t\t\t\t\ty = -this.attribute('refY').Length.toPixels('y');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(x, y);\r\n\t\t\t\t\tctx.lineTo(width, y);\r\n\t\t\t\t\tctx.lineTo(width, height);\r\n\t\t\t\t\tctx.lineTo(x, height);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t\tctx.clip();\r\n\t\t\t\t}\r\n\t\t\t\tsvg.ViewPort.SetCurrent(width, height);\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t// viewbox\r\n\t\t\t\tif (this.attribute('viewBox').hasValue()) {\t\t\t\t\r\n\t\t\t\t\tvar viewBox = svg.ToNumberArray(this.attribute('viewBox').value);\r\n\t\t\t\t\tvar minX = viewBox[0];\r\n\t\t\t\t\tvar minY = viewBox[1];\r\n\t\t\t\t\twidth = viewBox[2];\r\n\t\t\t\t\theight = viewBox[3];\r\n\t\t\t\t\t\r\n\t\t\t\t\tsvg.AspectRatio(ctx,\r\n\t\t\t\t\t\t\t\t\tthis.attribute('preserveAspectRatio').value, \r\n\t\t\t\t\t\t\t\t\tsvg.ViewPort.width(), \r\n\t\t\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\t\t\tsvg.ViewPort.height(),\r\n\t\t\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\t\t\tminX,\r\n\t\t\t\t\t\t\t\t\tminY,\r\n\t\t\t\t\t\t\t\t\tthis.attribute('refX').value,\r\n\t\t\t\t\t\t\t\t\tthis.attribute('refY').value);\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\tsvg.ViewPort.RemoveCurrent();\t\r\n\t\t\t\t\tsvg.ViewPort.SetCurrent(viewBox[2], viewBox[3]);\t\t\t\t\t\t\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t// initial values\r\n\t\t\t\tctx.strokeStyle = 'rgba(0,0,0,0)';\r\n\t\t\t\tcvd.logCommand(\"ctx.strokeStyle = 'rgba(0,0,0,0)'\");\r\n\t\t\t\tctx.lineCap = 'butt';\r\n\t\t\t\tcvd.logCommand(\"ctx.lineCap = 'butt'\");\r\n\t\t\t\tctx.lineJoin = 'miter';\r\n\t\t\t\tcvd.logCommand(\"ctx.lineJoin = 'miter'\");\r\n\t\t\t\tctx.miterLimit = 4;\r\n\t\t\t\tcvd.logCommand(\"ctx.miterLimit = 4\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.svg.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t\t// rect element\r\n\t\tsvg.Element.rect = function(node) {\r\n\t\t\tthis.base = svg.Element.PathElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tvar x = this.attribute('x').Length.toPixels('x');\r\n\t\t\t\tvar y = this.attribute('y').Length.toPixels('y');\r\n\t\t\t\tvar width = this.attribute('width').Length.toPixels('x');\r\n\t\t\t\tvar height = this.attribute('height').Length.toPixels('y');\r\n\t\t\t\tvar rx = this.attribute('rx').Length.toPixels('x');\r\n\t\t\t\tvar ry = this.attribute('ry').Length.toPixels('y');\r\n\t\t\t\tif (this.attribute('rx').hasValue() && !this.attribute('ry').hasValue()) ry = rx;\r\n\t\t\t\tif (this.attribute('ry').hasValue() && !this.attribute('rx').hasValue()) rx = ry;\r\n\t\t\t\t\r\n\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(x + rx, y);\r\n\t\t\t\t\tctx.lineTo(x + width - rx, y);\r\n\t\t\t\t\tctx.quadraticCurveTo(x + width, y, x + width, y + ry)\r\n\t\t\t\t\tctx.lineTo(x + width, y + height - ry);\r\n\t\t\t\t\tctx.quadraticCurveTo(x + width, y + height, x + width - rx, y + height)\r\n\t\t\t\t\tctx.lineTo(x + rx, y + height);\r\n\t\t\t\t\tctx.quadraticCurveTo(x, y + height, x, y + height - ry)\r\n\t\t\t\t\tctx.lineTo(x, y + ry);\r\n\t\t\t\t\tctx.quadraticCurveTo(x, y, x + rx, y)\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn new svg.BoundingBox(x, y, x + width, y + height);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.rect.prototype = new svg.Element.PathElementBase;\r\n\t\t\r\n\t\t// circle element\r\n\t\tsvg.Element.circle = function(node) {\r\n\t\t\tthis.base = svg.Element.PathElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tvar cx = this.attribute('cx').Length.toPixels('x');\r\n\t\t\t\tvar cy = this.attribute('cy').Length.toPixels('y');\r\n\t\t\t\tvar r = this.attribute('r').Length.toPixels();\r\n\t\t\t\r\n\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.arc(cx, cy, r, 0, Math.PI * 2, true); \r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn new svg.BoundingBox(cx - r, cy - r, cx + r, cy + r);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.circle.prototype = new svg.Element.PathElementBase;\t\r\n\r\n\t\t// ellipse element\r\n\t\tsvg.Element.ellipse = function(node) {\r\n\t\t\tthis.base = svg.Element.PathElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tvar KAPPA = 4 * ((Math.sqrt(2) - 1) / 3);\r\n\t\t\t\tvar rx = this.attribute('rx').Length.toPixels('x');\r\n\t\t\t\tvar ry = this.attribute('ry').Length.toPixels('y');\r\n\t\t\t\tvar cx = this.attribute('cx').Length.toPixels('x');\r\n\t\t\t\tvar cy = this.attribute('cy').Length.toPixels('y');\r\n\t\t\t\t\r\n\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(cx, cy - ry);\r\n\t\t\t\t\tctx.bezierCurveTo(cx + (KAPPA * rx), cy - ry,  cx + rx, cy - (KAPPA * ry), cx + rx, cy);\r\n\t\t\t\t\tctx.bezierCurveTo(cx + rx, cy + (KAPPA * ry), cx + (KAPPA * rx), cy + ry, cx, cy + ry);\r\n\t\t\t\t\tctx.bezierCurveTo(cx - (KAPPA * rx), cy + ry, cx - rx, cy + (KAPPA * ry), cx - rx, cy);\r\n\t\t\t\t\tctx.bezierCurveTo(cx - rx, cy - (KAPPA * ry), cx - (KAPPA * rx), cy - ry, cx, cy - ry);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn new svg.BoundingBox(cx - rx, cy - ry, cx + rx, cy + ry);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.ellipse.prototype = new svg.Element.PathElementBase;\t\t\t\r\n\t\t\r\n\t\t// line element\r\n\t\tsvg.Element.line = function(node) {\r\n\t\t\tthis.base = svg.Element.PathElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.getPoints = function() {\r\n\t\t\t\treturn [\r\n\t\t\t\t\tnew svg.Point(this.attribute('x1').Length.toPixels('x'), this.attribute('y1').Length.toPixels('y')),\r\n\t\t\t\t\tnew svg.Point(this.attribute('x2').Length.toPixels('x'), this.attribute('y2').Length.toPixels('y'))];\r\n\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tvar points = this.getPoints();\r\n\t\t\t\t\r\n\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(points[0].x, points[0].y);\r\n\t\t\t\t\tctx.lineTo(points[1].x, points[1].y);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn new svg.BoundingBox(points[0].x, points[0].y, points[1].x, points[1].y);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getMarkers = function() {\r\n\t\t\t\tvar points = this.getPoints();\t\r\n\t\t\t\tvar a = points[0].angleTo(points[1]);\r\n\t\t\t\treturn [[points[0], a], [points[1], a]];\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.line.prototype = new svg.Element.PathElementBase;\t\t\r\n\t\t\t\t\r\n\t\t// polyline element\r\n\t\tsvg.Element.polyline = function(node) {\r\n\t\t\tthis.base = svg.Element.PathElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.points = svg.CreatePath(this.attribute('points').value);\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tvar bb = new svg.BoundingBox(this.points[0].x, this.points[0].y);\r\n\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(this.points[0].x, this.points[0].y);\r\n\t\t\t\t}\r\n\t\t\t\tfor (var i=1; i<this.points.length; i++) {\r\n\t\t\t\t\tbb.addPoint(this.points[i].x, this.points[i].y);\r\n\t\t\t\t\tif (ctx != null) ctx.lineTo(this.points[i].x, this.points[i].y);\r\n\t\t\t\t}\r\n\t\t\t\treturn bb;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getMarkers = function() {\r\n\t\t\t\tvar markers = [];\r\n\t\t\t\tfor (var i=0; i<this.points.length - 1; i++) {\r\n\t\t\t\t\tmarkers.push([this.points[i], this.points[i].angleTo(this.points[i+1])]);\r\n\t\t\t\t}\r\n\t\t\t\tmarkers.push([this.points[this.points.length-1], markers[markers.length-1][1]]);\r\n\t\t\t\treturn markers;\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\tsvg.Element.polyline.prototype = new svg.Element.PathElementBase;\t\t\t\t\r\n\t\t\t\t\r\n\t\t// polygon element\r\n\t\tsvg.Element.polygon = function(node) {\r\n\t\t\tthis.base = svg.Element.polyline;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.basePath = this.path;\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tvar bb = this.basePath(ctx);\r\n\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\tctx.lineTo(this.points[0].x, this.points[0].y);\r\n\t\t\t\t\tctx.closePath();\r\n\t\t\t\t}\r\n\t\t\t\treturn bb;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.polygon.prototype = new svg.Element.polyline;\r\n\r\n\t\t// path element\r\n\t\tsvg.Element.path = function(node) {\r\n\t\t\tthis.base = svg.Element.PathElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\t\t\r\n\t\t\tvar d = this.attribute('d').value;\r\n\t\t\t// TODO: floating points, convert to real lexer based on http://www.w3.org/TR/SVG11/paths.html#PathDataBNF\r\n\t\t\td = d.replace(/,/gm,' '); // get rid of all commas\r\n\t\t\td = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2'); // separate commands from commands\r\n\t\t\td = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2'); // separate commands from commands\r\n\t\t\td = d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\\s])/gm,'$1 $2'); // separate commands from points\r\n\t\t\td = d.replace(/([^\\s])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2'); // separate commands from points\r\n\t\t\td = d.replace(/([0-9])([+\\-])/gm,'$1 $2'); // separate digits when no comma\r\n\t\t\td = d.replace(/(\\.[0-9]*)(\\.)/gm,'$1 $2'); // separate digits when no comma\r\n\t\t\td = d.replace(/([Aa](\\s+[0-9]+){3})\\s+([01])\\s*([01])/gm,'$1 $3 $4 '); // shorthand elliptical arc path syntax\r\n\t\t\td = svg.compressSpaces(d); // compress multiple spaces\r\n\t\t\td = svg.trim(d);\r\n\t\t\tthis.PathParser = new (function(d) {\r\n\t\t\t\tthis.tokens = d.split(' ');\r\n\t\t\t\t\r\n\t\t\t\tthis.reset = function() {\r\n\t\t\t\t\tthis.i = -1;\r\n\t\t\t\t\tthis.command = '';\r\n\t\t\t\t\tthis.previousCommand = '';\r\n\t\t\t\t\tthis.control = new svg.Point(0, 0);\r\n\t\t\t\t\tthis.current = new svg.Point(0, 0);\r\n\t\t\t\t\tthis.points = [];\r\n\t\t\t\t\tthis.angles = [];\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\tthis.isEnd = function() {\r\n\t\t\t\t\treturn this.i >= this.tokens.length - 1;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.isCommandOrEnd = function() {\r\n\t\t\t\t\tif (this.isEnd()) return true;\r\n\t\t\t\t\treturn this.tokens[this.i + 1].match(/[A-Za-z]/) != null;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.isRelativeCommand = function() {\r\n\t\t\t\t\treturn this.command == this.command.toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\tthis.getToken = function() {\r\n\t\t\t\t\tthis.i = this.i + 1;\r\n\t\t\t\t\treturn this.tokens[this.i];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.getScalar = function() {\r\n\t\t\t\t\treturn parseFloat(this.getToken());\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.nextCommand = function() {\r\n\t\t\t\t\tthis.previousCommand = this.command;\r\n\t\t\t\t\tthis.command = this.getToken();\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tthis.getPoint = function() {\r\n\t\t\t\t\tvar p = new svg.Point(this.getScalar(), this.getScalar());\r\n\t\t\t\t\treturn this.makeAbsolute(p);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.getAsControlPoint = function() {\r\n\t\t\t\t\tvar p = this.getPoint();\r\n\t\t\t\t\tthis.control = p;\r\n\t\t\t\t\treturn p;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.getAsCurrentPoint = function() {\r\n\t\t\t\t\tvar p = this.getPoint();\r\n\t\t\t\t\tthis.current = p;\r\n\t\t\t\t\treturn p;\t\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.getReflectedControlPoint = function() {\r\n\t\t\t\t\tif (this.previousCommand.toLowerCase() != 'c' && this.previousCommand.toLowerCase() != 's') {\r\n\t\t\t\t\t\treturn this.current;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// reflect point\r\n\t\t\t\t\tvar p = new svg.Point(2 * this.current.x - this.control.x, 2 * this.current.y - this.control.y);\t\t\t\t\t\r\n\t\t\t\t\treturn p;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.makeAbsolute = function(p) {\r\n\t\t\t\t\tif (this.isRelativeCommand()) {\r\n\t\t\t\t\t\tp.x = this.current.x + p.x;\r\n\t\t\t\t\t\tp.y = this.current.y + p.y;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn p;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.addMarker = function(p, from) {\r\n\t\t\t\t\tthis.addMarkerAngle(p, from == null ? null : from.angleTo(p));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.addMarkerAngle = function(p, a) {\r\n\t\t\t\t\tthis.points.push(p);\r\n\t\t\t\t\tthis.angles.push(a);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tthis.getMarkerPoints = function() { return this.points; }\r\n\t\t\t\tthis.getMarkerAngles = function() {\r\n\t\t\t\t\tfor (var i=0; i<this.angles.length; i++) {\r\n\t\t\t\t\t\tif (this.angles[i] == null) {\r\n\t\t\t\t\t\t\tfor (var j=i+1; j<this.angles.length; j++) {\r\n\t\t\t\t\t\t\t\tif (this.angles[j] != null) {\r\n\t\t\t\t\t\t\t\t\tthis.angles[i] = this.angles[j];\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn this.angles;\r\n\t\t\t\t}\r\n\t\t\t})(d);\r\n\t\t\t\r\n\t\t\tthis.path = function(ctx) {\t\t\r\n\t\t\t\tvar pp = this.PathParser;\r\n\t\t\t\tpp.reset();\r\n\t\t\t\t\r\n\t\t\t\tvar bb = new svg.BoundingBox();\r\n\t\t\t\tif (ctx != null) ctx.beginPath();\r\n\t\t\t\twhile (!pp.isEnd()) {\r\n\t\t\t\t\tpp.nextCommand();\r\n\t\t\t\t\tif (pp.command.toUpperCase() == 'M') {\r\n\t\t\t\t\t\tvar p = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\tpp.addMarker(p);\r\n\t\t\t\t\t\tbb.addPoint(p.x, p.y);\r\n\t\t\t\t\t\tif (ctx != null) ctx.moveTo(p.x, p.y);\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar p = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\t\tpp.addMarker(p);\r\n\t\t\t\t\t\t\tbb.addPoint(p.x, p.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.lineTo(p.x, p.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'L') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar c = pp.current;\r\n\t\t\t\t\t\t\tvar p = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\t\tpp.addMarker(p, c);\r\n\t\t\t\t\t\t\tbb.addPoint(p.x, p.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.lineTo(p.x, p.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'H') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar newP = new svg.Point((pp.isRelativeCommand() ? pp.current.x : 0) + pp.getScalar(), pp.current.y);\r\n\t\t\t\t\t\t\tpp.addMarker(newP, pp.current);\r\n\t\t\t\t\t\t\tpp.current = newP;\r\n\t\t\t\t\t\t\tbb.addPoint(pp.current.x, pp.current.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'V') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar newP = new svg.Point(pp.current.x, (pp.isRelativeCommand() ? pp.current.y : 0) + pp.getScalar());\r\n\t\t\t\t\t\t\tpp.addMarker(newP, pp.current);\r\n\t\t\t\t\t\t\tpp.current = newP;\r\n\t\t\t\t\t\t\tbb.addPoint(pp.current.x, pp.current.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.lineTo(pp.current.x, pp.current.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'C') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\t\tvar p1 = pp.getPoint();\r\n\t\t\t\t\t\t\tvar cntrl = pp.getAsControlPoint();\r\n\t\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\t\tpp.addMarker(cp, cntrl);\r\n\t\t\t\t\t\t\tbb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'S') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\t\tvar p1 = pp.getReflectedControlPoint();\r\n\t\t\t\t\t\t\tvar cntrl = pp.getAsControlPoint();\r\n\t\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\t\tpp.addMarker(cp, cntrl);\r\n\t\t\t\t\t\t\tbb.addBezierCurve(curr.x, curr.y, p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.bezierCurveTo(p1.x, p1.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'Q') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\t\tvar cntrl = pp.getAsControlPoint();\r\n\t\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\t\tpp.addMarker(cp, cntrl);\r\n\t\t\t\t\t\t\tbb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'T') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t\tvar curr = pp.current;\r\n\t\t\t\t\t\t\tvar cntrl = pp.getReflectedControlPoint();\r\n\t\t\t\t\t\t\tpp.control = cntrl;\r\n\t\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\t\tpp.addMarker(cp, cntrl);\r\n\t\t\t\t\t\t\tbb.addQuadraticCurve(curr.x, curr.y, cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t\tif (ctx != null) ctx.quadraticCurveTo(cntrl.x, cntrl.y, cp.x, cp.y);\r\n\t\t\t\t\t\t}\t\t\t\t\t\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'A') {\r\n\t\t\t\t\t\twhile (!pp.isCommandOrEnd()) {\r\n\t\t\t\t\t\t    var curr = pp.current;\r\n\t\t\t\t\t\t\tvar rx = pp.getScalar();\r\n\t\t\t\t\t\t\tvar ry = pp.getScalar();\r\n\t\t\t\t\t\t\tvar xAxisRotation = pp.getScalar() * (Math.PI / 180.0);\r\n\t\t\t\t\t\t\tvar largeArcFlag = pp.getScalar();\r\n\t\t\t\t\t\t\tvar sweepFlag = pp.getScalar();\r\n\t\t\t\t\t\t\tvar cp = pp.getAsCurrentPoint();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// Conversion from endpoint to center parameterization\r\n\t\t\t\t\t\t\t// http://www.w3.org/TR/SVG11/implnote.html#ArcImplementationNotes\r\n\t\t\t\t\t\t\t// x1', y1'\r\n\t\t\t\t\t\t\tvar currp = new svg.Point(\r\n\t\t\t\t\t\t\t\tMath.cos(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.sin(xAxisRotation) * (curr.y - cp.y) / 2.0,\r\n\t\t\t\t\t\t\t\t-Math.sin(xAxisRotation) * (curr.x - cp.x) / 2.0 + Math.cos(xAxisRotation) * (curr.y - cp.y) / 2.0\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t// adjust radii\r\n\t\t\t\t\t\t\tvar l = Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);\r\n\t\t\t\t\t\t\tif (l > 1) {\r\n\t\t\t\t\t\t\t\trx *= Math.sqrt(l);\r\n\t\t\t\t\t\t\t\try *= Math.sqrt(l);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// cx', cy'\r\n\t\t\t\t\t\t\tvar s = (largeArcFlag == sweepFlag ? -1 : 1) * Math.sqrt(\r\n\t\t\t\t\t\t\t\t((Math.pow(rx,2)*Math.pow(ry,2))-(Math.pow(rx,2)*Math.pow(currp.y,2))-(Math.pow(ry,2)*Math.pow(currp.x,2))) /\r\n\t\t\t\t\t\t\t\t(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2))\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tif (isNaN(s)) s = 0;\r\n\t\t\t\t\t\t\tvar cpp = new svg.Point(s * rx * currp.y / ry, s * -ry * currp.x / rx);\r\n\t\t\t\t\t\t\t// cx, cy\r\n\t\t\t\t\t\t\tvar centp = new svg.Point(\r\n\t\t\t\t\t\t\t\t(curr.x + cp.x) / 2.0 + Math.cos(xAxisRotation) * cpp.x - Math.sin(xAxisRotation) * cpp.y,\r\n\t\t\t\t\t\t\t\t(curr.y + cp.y) / 2.0 + Math.sin(xAxisRotation) * cpp.x + Math.cos(xAxisRotation) * cpp.y\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t// vector magnitude\r\n\t\t\t\t\t\t\tvar m = function(v) { return Math.sqrt(Math.pow(v[0],2) + Math.pow(v[1],2)); }\r\n\t\t\t\t\t\t\t// ratio between two vectors\r\n\t\t\t\t\t\t\tvar r = function(u, v) { return (u[0]*v[0]+u[1]*v[1]) / (m(u)*m(v)) }\r\n\t\t\t\t\t\t\t// angle between two vectors\r\n\t\t\t\t\t\t\tvar a = function(u, v) { return (u[0]*v[1] < u[1]*v[0] ? -1 : 1) * Math.acos(r(u,v)); }\r\n\t\t\t\t\t\t\t// initial angle\r\n\t\t\t\t\t\t\tvar a1 = a([1,0], [(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);\r\n\t\t\t\t\t\t\t// angle delta\r\n\t\t\t\t\t\t\tvar u = [(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];\r\n\t\t\t\t\t\t\tvar v = [(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];\r\n\t\t\t\t\t\t\tvar ad = a(u, v);\r\n\t\t\t\t\t\t\tif (r(u,v) <= -1) ad = Math.PI;\r\n\t\t\t\t\t\t\tif (r(u,v) >= 1) ad = 0;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (sweepFlag == 0 && ad > 0) ad = ad - 2 * Math.PI;\r\n\t\t\t\t\t\t\tif (sweepFlag == 1 && ad < 0) ad = ad + 2 * Math.PI;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// for markers\r\n\t\t\t\t\t\t\tvar halfWay = new svg.Point(\r\n\t\t\t\t\t\t\t\tcentp.x - rx * Math.cos((a1 + ad) / 2),\r\n\t\t\t\t\t\t\t\tcentp.y - ry * Math.sin((a1 + ad) / 2)\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tpp.addMarkerAngle(halfWay, (a1 + ad) / 2 + (sweepFlag == 0 ? 1 : -1) * Math.PI / 2);\r\n\t\t\t\t\t\t\tpp.addMarkerAngle(cp, ad + (sweepFlag == 0 ? 1 : -1) * Math.PI / 2);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbb.addPoint(cp.x, cp.y); // TODO: this is too naive, make it better\r\n\t\t\t\t\t\t\tif (ctx != null) {\r\n\t\t\t\t\t\t\t\tvar r = rx > ry ? rx : ry;\r\n\t\t\t\t\t\t\t\tvar sx = rx > ry ? 1 : rx / ry;\r\n\t\t\t\t\t\t\t\tvar sy = rx > ry ? ry / rx : 1;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tctx.translate(centp.x, centp.y);\r\n\t\t\t\t\t\t\t\tctx.rotate(xAxisRotation);\r\n\t\t\t\t\t\t\t\tctx.scale(sx, sy);\r\n\t\t\t\t\t\t\t\tctx.arc(0, 0, r, a1, a1 + ad, 1 - sweepFlag);\r\n\t\t\t\t\t\t\t\tctx.scale(1/sx, 1/sy);\r\n\t\t\t\t\t\t\t\tctx.rotate(-xAxisRotation);\r\n\t\t\t\t\t\t\t\tctx.translate(-centp.x, -centp.y);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (pp.command.toUpperCase() == 'Z') {\r\n\t\t\t\t\t\tif (ctx != null) ctx.closePath();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\treturn bb;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getMarkers = function() {\r\n\t\t\t\tvar points = this.PathParser.getMarkerPoints();\r\n\t\t\t\tvar angles = this.PathParser.getMarkerAngles();\r\n\t\t\t\t\r\n\t\t\t\tvar markers = [];\r\n\t\t\t\tfor (var i=0; i<points.length; i++) {\r\n\t\t\t\t\tmarkers.push([points[i], angles[i]]);\r\n\t\t\t\t}\r\n\t\t\t\treturn markers;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.path.prototype = new svg.Element.PathElementBase;\r\n\t\t\r\n\t\t// pattern element\r\n\t\tsvg.Element.pattern = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.createPattern = function(ctx, element) {\r\n\t\t\t\t// render me using a temporary svg element\r\n\t\t\t\tvar tempSvg = new svg.Element.svg();\r\n\t\t\t\ttempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n\t\t\t\ttempSvg.attributes['x'] = new svg.Property('x', this.attribute('x').value);\r\n\t\t\t\ttempSvg.attributes['y'] = new svg.Property('y', this.attribute('y').value);\r\n\t\t\t\ttempSvg.attributes['width'] = new svg.Property('width', this.attribute('width').value);\r\n\t\t\t\ttempSvg.attributes['height'] = new svg.Property('height', this.attribute('height').value);\r\n\t\t\t\ttempSvg.children = this.children;\r\n\t\t\t\t\r\n\t\t\t\tvar c = document.createElement('canvas');\r\n\t\t\t\tc.width = this.attribute('width').Length.toPixels();\r\n\t\t\t\tc.height = this.attribute('height').Length.toPixels();\r\n\t\t\t\ttempSvg.render(c.getContext('2d'));\t\t\r\n\t\t\t\treturn ctx.createPattern(c, 'repeat');\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.pattern.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// marker element\r\n\t\tsvg.Element.marker = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.baseRender = this.render;\r\n\t\t\tthis.render = function(ctx, point, angle) {\r\n\t\t\t\tctx.translate(point.x, point.y);\r\n\t\t\t\tif (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(angle);\r\n\t\t\t\tif (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(ctx.lineWidth, ctx.lineWidth);\r\n\t\t\t\tctx.save();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t// render me using a temporary svg element\r\n\t\t\t\tvar tempSvg = new svg.Element.svg();\r\n\t\t\t\ttempSvg.attributes['viewBox'] = new svg.Property('viewBox', this.attribute('viewBox').value);\r\n\t\t\t\ttempSvg.attributes['refX'] = new svg.Property('refX', this.attribute('refX').value);\r\n\t\t\t\ttempSvg.attributes['refY'] = new svg.Property('refY', this.attribute('refY').value);\r\n\t\t\t\ttempSvg.attributes['width'] = new svg.Property('width', this.attribute('markerWidth').value);\r\n\t\t\t\ttempSvg.attributes['height'] = new svg.Property('height', this.attribute('markerHeight').value);\r\n\t\t\t\ttempSvg.attributes['fill'] = new svg.Property('fill', this.attribute('fill').valueOrDefault('black'));\r\n\t\t\t\ttempSvg.attributes['stroke'] = new svg.Property('stroke', this.attribute('stroke').valueOrDefault('none'));\r\n\t\t\t\ttempSvg.children = this.children;\r\n\t\t\t\ttempSvg.render(ctx);\r\n\t\t\t\t\r\n\t\t\t\tctx.restore();\r\n\t\t\t\tif (this.attribute('markerUnits').valueOrDefault('strokeWidth') == 'strokeWidth') ctx.scale(1/ctx.lineWidth, 1/ctx.lineWidth);\r\n\t\t\t\tif (this.attribute('orient').valueOrDefault('auto') == 'auto') ctx.rotate(-angle);\r\n\t\t\t\tctx.translate(-point.x, -point.y);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.marker.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// definitions element\r\n\t\tsvg.Element.defs = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\t\r\n\t\t\t\r\n\t\t\tthis.render = function(ctx) {\r\n\t\t\t\t// NOOP\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.defs.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// base for gradients\r\n\t\tsvg.Element.GradientBase = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.gradientUnits = this.attribute('gradientUnits').valueOrDefault('objectBoundingBox');\r\n\t\t\t\r\n\t\t\tthis.stops = [];\t\t\t\r\n\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\tvar child = this.children[i];\r\n\t\t\t\tthis.stops.push(child);\r\n\t\t\t}\t\r\n\t\t\t\r\n\t\t\tthis.getGradient = function() {\r\n\t\t\t\t// OVERRIDE ME!\r\n\t\t\t}\t\t\t\r\n\r\n\t\t\tthis.createGradient = function(ctx, element) {\r\n\t\t\t\tvar stopsContainer = this;\r\n\t\t\t\tif (this.attribute('xlink:href').hasValue()) {\r\n\t\t\t\t\tstopsContainer = this.attribute('xlink:href').Definition.getDefinition();\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\tvar g = this.getGradient(ctx, element);\r\n\t\t\t\t\r\n        for (var i=0; i<stopsContainer.stops.length; i++) {\r\n\t\t\t\t\tg.addColorStop(stopsContainer.stops[i].offset, stopsContainer.stops[i].color);\r\n          cvd.logCommand('g.addColorStop('+ stopsContainer.stops[i].offset +',\"' + stopsContainer.stops[i].color +'\")');\r\n        }\r\n\t\t\t\treturn g;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.GradientBase.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// linear gradient element\r\n\t\tsvg.Element.linearGradient = function(node) {\r\n\t\t\tthis.base = svg.Element.GradientBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.getGradient = function(ctx, element) {\r\n\t\t\t\tvar bb = element.getBoundingBox();\r\n\t\t\t\t\r\n\t\t\t\tvar x1 = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.x() + bb.width() * this.attribute('x1').numValue() \r\n\t\t\t\t\t: this.attribute('x1').Length.toPixels('x'));\r\n\t\t\t\tvar y1 = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.y() + bb.height() * this.attribute('y1').numValue()\r\n\t\t\t\t\t: this.attribute('y1').Length.toPixels('y'));\r\n\t\t\t\tvar x2 = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.x() + bb.width() * this.attribute('x2').numValue()\r\n\t\t\t\t\t: this.attribute('x2').Length.toPixels('x'));\r\n\t\t\t\tvar y2 = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.y() + bb.height() * this.attribute('y2').numValue()\r\n\t\t\t\t\t: this.attribute('y2').Length.toPixels('y'));\r\n\t\t\t\t\r\n\t\t\t\tvar p1 = new svg.Point(x1, y1);\r\n\t\t\t\tvar p2 = new svg.Point(x2, y2);\r\n\t\t\t\tif (this.attribute('gradientTransform').hasValue()) { \r\n\t\t\t\t\tvar transform = new svg.Transform(this.attribute('gradientTransform').value);\r\n\t\t\t\t\ttransform.applyToPoint(p1);\r\n\t\t\t\t\ttransform.applyToPoint(p2);\r\n\t\t\t\t}\r\n\t\t\t\tcvd.logCommand('g=ctx.createLinearGradient('+p1.x+','+p1.y+','+p2.x+','+p2.y+')');\r\n\t\t\t\treturn ctx.createLinearGradient(p1.x, p1.y, p2.x, p2.y);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.linearGradient.prototype = new svg.Element.GradientBase;\r\n\t\t\r\n\t\t// radial gradient element\r\n\t\tsvg.Element.radialGradient = function(node) {\r\n\t\t\tthis.base = svg.Element.GradientBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.getGradient = function(ctx, element) {\r\n\t\t\t\tvar bb = element.getBoundingBox();\r\n\t\t\t\t\r\n\t\t\t\tvar cx = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.x() + bb.width() * this.attribute('cx').numValue() \r\n\t\t\t\t\t: this.attribute('cx').Length.toPixels('x'));\r\n\t\t\t\tvar cy = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.y() + bb.height() * this.attribute('cy').numValue() \r\n\t\t\t\t\t: this.attribute('cy').Length.toPixels('y'));\r\n\t\t\t\t\r\n\t\t\t\tvar fx = cx;\r\n\t\t\t\tvar fy = cy;\r\n\t\t\t\tif (this.attribute('fx').hasValue()) {\r\n\t\t\t\t\tfx = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.x() + bb.width() * this.attribute('fx').numValue() \r\n\t\t\t\t\t: this.attribute('fx').Length.toPixels('x'));\r\n\t\t\t\t}\r\n\t\t\t\tif (this.attribute('fy').hasValue()) {\r\n\t\t\t\t\tfy = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? bb.y() + bb.height() * this.attribute('fy').numValue() \r\n\t\t\t\t\t: this.attribute('fy').Length.toPixels('y'));\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvar r = (this.gradientUnits == 'objectBoundingBox' \r\n\t\t\t\t\t? (bb.width() + bb.height()) / 2.0 * this.attribute('r').numValue()\r\n\t\t\t\t\t: this.attribute('r').Length.toPixels());\r\n\t\t\t\t\r\n\t\t\t\tvar c = new svg.Point(cx, cy);\r\n\t\t\t\tvar f = new svg.Point(fx, fy);\r\n\t\t\t\tif (this.attribute('gradientTransform').hasValue()) { \r\n\t\t\t\t\tvar transform = new svg.Transform(this.attribute('gradientTransform').value);\r\n\t\t\t\t\ttransform.applyToPoint(c);\r\n\t\t\t\t\ttransform.applyToPoint(f);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\tcvd.logCommand('g=ctx.createRadialGradient('+f.x +','+f.y+',0,'+c.x+','+c.y+ ',' + r+')');\r\n\t\t\t\treturn ctx.createRadialGradient(f.x, f.y, 0, c.x, c.y, r);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.radialGradient.prototype = new svg.Element.GradientBase;\r\n\t\t\r\n\t\t// gradient stop element\r\n\t\tsvg.Element.stop = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.offset = this.attribute('offset').numValue();\r\n\t\t\t\r\n\t\t\tvar stopColor = this.style('stop-color');\r\n\t\t\tif (this.style('stop-opacity').hasValue()) stopColor = stopColor.Color.addOpacity(this.style('stop-opacity').value);\r\n\t\t\tthis.color = stopColor.value;\r\n\t\t}\r\n\t\tsvg.Element.stop.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// animation base element\r\n\t\tsvg.Element.AnimateBase = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tsvg.Animations.push(this);\r\n\t\t\t\r\n\t\t\tthis.duration = 0.0;\r\n\t\t\tthis.begin = this.attribute('begin').Time.toMilliseconds();\r\n\t\t\tthis.maxDuration = this.begin + this.attribute('dur').Time.toMilliseconds();\r\n\r\n\t\t\tthis.calcValue = function() {\r\n\t\t\t\t// OVERRIDE ME!\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.update = function(delta) {\t\t\t\r\n\t\t\t\t// if we're past the end time\r\n\t\t\t\tif (this.duration > this.maxDuration) {\r\n\t\t\t\t\t// loop for indefinitely repeating animations\r\n\t\t\t\t\tif (this.attribute('repeatCount').value == 'indefinite') {\r\n\t\t\t\t\t\tthis.duration = 0.0\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\treturn false; // no updates made\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\r\n\t\t\t\tthis.duration = this.duration + delta;\r\n\t\t\t\r\n\t\t\t\t// if we're past the begin time\r\n\t\t\t\tvar updated = false;\r\n\t\t\t\tif (this.begin < this.duration) {\r\n\t\t\t\t\tvar newValue = this.calcValue(); // tween\r\n\t\t\t\t\tvar attributeType = this.attribute('attributeType').value;\r\n\t\t\t\t\tvar attributeName = this.attribute('attributeName').value;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.parent != null) {\r\n\t\t\t\t\t\tif (attributeType == 'CSS') {\r\n\t\t\t\t\t\t\tthis.parent.style(attributeName, true).value = newValue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse { // default or XML\r\n\t\t\t\t\t\t\tif (this.attribute('type').hasValue()) {\r\n\t\t\t\t\t\t\t\t// for transform, etc.\r\n\t\t\t\t\t\t\t\tvar type = this.attribute('type').value;\r\n\t\t\t\t\t\t\t\tthis.parent.attribute(attributeName, true).value = type + '(' + newValue + ')';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.parent.attribute(attributeName, true).value = newValue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tupdated = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\treturn updated;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// fraction of duration we've covered\r\n\t\t\tthis.progress = function() {\r\n\t\t\t\treturn ((this.duration - this.begin) / (this.maxDuration - this.begin));\r\n\t\t\t}\t\t\t\r\n\t\t}\r\n\t\tsvg.Element.AnimateBase.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// animate element\r\n\t\tsvg.Element.animate = function(node) {\r\n\t\t\tthis.base = svg.Element.AnimateBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.calcValue = function() {\r\n\t\t\t\tvar from = this.attribute('from').numValue();\r\n\t\t\t\tvar to = this.attribute('to').numValue();\r\n\t\t\t\t\r\n\t\t\t\t// tween value linearly\r\n\t\t\t\treturn from + (to - from) * this.progress(); \r\n\t\t\t};\r\n\t\t}\r\n\t\tsvg.Element.animate.prototype = new svg.Element.AnimateBase;\r\n\t\t\t\r\n\t\t// animate color element\r\n\t\tsvg.Element.animateColor = function(node) {\r\n\t\t\tthis.base = svg.Element.AnimateBase;\r\n\t\t\tthis.base(node);\r\n\r\n\t\t\tthis.calcValue = function() {\r\n\t\t\t\tvar from = new RGBColor(this.attribute('from').value);\r\n\t\t\t\tvar to = new RGBColor(this.attribute('to').value);\r\n\t\t\t\t\r\n\t\t\t\tif (from.ok && to.ok) {\r\n\t\t\t\t\t// tween color linearly\r\n\t\t\t\t\tvar r = from.r + (to.r - from.r) * this.progress();\r\n\t\t\t\t\tvar g = from.g + (to.g - from.g) * this.progress();\r\n\t\t\t\t\tvar b = from.b + (to.b - from.b) * this.progress();\r\n\t\t\t\t\treturn 'rgb('+parseInt(r,10)+','+parseInt(g,10)+','+parseInt(b,10)+')';\r\n\t\t\t\t}\r\n\t\t\t\treturn this.attribute('from').value;\r\n\t\t\t};\r\n\t\t}\r\n\t\tsvg.Element.animateColor.prototype = new svg.Element.AnimateBase;\r\n\t\t\r\n\t\t// animate transform element\r\n\t\tsvg.Element.animateTransform = function(node) {\r\n\t\t\tthis.base = svg.Element.animate;\r\n\t\t\tthis.base(node);\r\n\t\t}\r\n\t\tsvg.Element.animateTransform.prototype = new svg.Element.animate;\r\n\t\t\r\n\t\t// text element\r\n\t\tsvg.Element.text = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tif (node != null) {\r\n\t\t\t\t// add children\r\n\t\t\t\tthis.children = [];\r\n\t\t\t\tfor (var i=0; i<node.childNodes.length; i++) {\r\n\t\t\t\t\tvar childNode = node.childNodes[i];\r\n\t\t\t\t\tif (childNode.nodeType == 1) { // capture tspan and tref nodes\r\n\t\t\t\t\t\tthis.addChild(childNode, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (childNode.nodeType == 3) { // capture text\r\n\t\t\t\t\t\tthis.addChild(new svg.Element.tspan(childNode), false);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.baseSetContext = this.setContext;\r\n\t\t\tthis.setContext = function(ctx) {\r\n\t\t\t\tthis.baseSetContext(ctx);\r\n\t\t\t\tif (this.attribute('text-anchor').hasValue()) {\r\n\t\t\t\t\tvar textAnchor = this.attribute('text-anchor').value;\r\n\t\t\t\t\tctx.textAlign = textAnchor == 'middle' ? 'center' : textAnchor;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.attribute('alignment-baseline').hasValue()) ctx.textBaseline = this.attribute('alignment-baseline').value;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.renderChildren = function(ctx) {\r\n\t\t\t\tvar x = this.attribute('x').Length.toPixels('x');\r\n\t\t\t\tvar y = this.attribute('y').Length.toPixels('y');\r\n\t\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\t\tvar child = this.children[i];\r\n\t\t\t\t\r\n\t\t\t\t\tif (child.attribute('x').hasValue()) {\r\n\t\t\t\t\t\tchild.x = child.attribute('x').Length.toPixels('x');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (child.attribute('dx').hasValue()) x += child.attribute('dx').Length.toPixels('x');\r\n\t\t\t\t\t\tchild.x = x;\r\n\t\t\t\t\t\tx += child.measureText(ctx);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (child.attribute('y').hasValue()) {\r\n\t\t\t\t\t\tchild.y = child.attribute('y').Length.toPixels('y');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif (child.attribute('dy').hasValue()) y += child.attribute('dy').Length.toPixels('y');\r\n\t\t\t\t\t\tchild.y = y;\r\n\t\t\t\t\t}\t\r\n\t\t\t\t\t\r\n\t\t\t\t\tchild.render(ctx);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.text.prototype = new svg.Element.RenderedElementBase;\r\n\t\t\r\n\t\t// text base\r\n\t\tsvg.Element.TextElementBase = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.renderChildren = function(ctx) {\r\n\t\t\t\tctx.fillText(svg.compressSpaces(this.getText()), this.x, this.y);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getText = function() {\r\n\t\t\t\t// OVERRIDE ME\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.measureText = function(ctx) {\r\n\t\t\t\tvar textToMeasure = svg.compressSpaces(this.getText());\r\n\t\t\t\tif (!ctx.measureText) return textToMeasure.length * 10;\r\n\t\t\t\treturn ctx.measureText(textToMeasure).width;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.TextElementBase.prototype = new svg.Element.RenderedElementBase;\r\n\t\t\r\n\t\t// tspan \r\n\t\tsvg.Element.tspan = function(node) {\r\n\t\t\tthis.base = svg.Element.TextElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\t//\t\t\t\t\t\t\t\t TEXT\t\t\t  ELEMENT\r\n\t\t\tthis.text = node.nodeType == 3 ? node.nodeValue : node.childNodes[0].nodeValue;\r\n\t\t\tthis.getText = function() {\r\n\t\t\t\treturn this.text;\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.tspan.prototype = new svg.Element.TextElementBase;\r\n\t\t\r\n\t\t// tref\r\n\t\tsvg.Element.tref = function(node) {\r\n\t\t\tthis.base = svg.Element.TextElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.getText = function() {\r\n\t\t\t\tvar element = this.attribute('xlink:href').Definition.getDefinition();\r\n\t\t\t\tif (element != null) return element.children[0].getText();\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.tref.prototype = new svg.Element.TextElementBase;\t\t\r\n\t\t\r\n\t\t// a element\r\n\t\tsvg.Element.a = function(node) {\r\n\t\t\tthis.base = svg.Element.TextElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.hasText = true;\r\n\t\t\tfor (var i=0; i<node.childNodes.length; i++) {\r\n\t\t\t\tif (node.childNodes[i].nodeType != 3) this.hasText = false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// this might contain text\r\n\t\t\tthis.text = this.hasText ? node.childNodes[0].nodeValue : '';\r\n\t\t\tthis.getText = function() {\r\n\t\t\t\treturn this.text;\r\n\t\t\t}\t\t\r\n\r\n\t\t\tthis.baseRenderChildren = this.renderChildren;\r\n\t\t\tthis.renderChildren = function(ctx) {\r\n\t\t\t\tif (this.hasText) {\r\n\t\t\t\t\t// render as text element\r\n\t\t\t\t\tthis.baseRenderChildren(ctx);\r\n\t\t\t\t\tvar fontSize = new svg.Property('fontSize', svg.Font.Parse(svg.ctx.font).fontSize);\r\n\t\t\t\t\tsvg.Mouse.checkBoundingBox(this, new svg.BoundingBox(this.x, this.y - fontSize.Length.toPixels('y'), this.x + this.measureText(ctx), this.y));\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// render as temporary group\r\n\t\t\t\t\tvar g = new svg.Element.g();\r\n\t\t\t\t\tg.children = this.children;\r\n\t\t\t\t\tg.parent = this;\r\n\t\t\t\t\tg.render(ctx);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.onclick = function() {\r\n\t\t\t\twindow.open(this.attribute('xlink:href').value);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.onmousemove = function() {\r\n\t\t\t\tsvg.ctx.canvas.style.cursor = 'pointer';\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.a.prototype = new svg.Element.TextElementBase;\t\t\r\n\t\t\r\n\t\t// image element\r\n\t\tsvg.Element.image = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tsvg.Images.push(this);\r\n\t\t\tthis.img = document.createElement('img');\r\n\t\t\tthis.loaded = false;\r\n\t\t\tvar that = this;\r\n\t\t\tthis.img.onload = function() { that.loaded = true; }\r\n\t\t\tthis.img.src = this.attribute('xlink:href').value;\r\n\t\t\t\r\n\t\t\tthis.renderChildren = function(ctx) {\r\n\t\t\t\tvar x = this.attribute('x').Length.toPixels('x');\r\n\t\t\t\tvar y = this.attribute('y').Length.toPixels('y');\r\n\t\t\t\t\r\n\t\t\t\tvar width = this.attribute('width').Length.toPixels('x');\r\n\t\t\t\tvar height = this.attribute('height').Length.toPixels('y');\t\t\t\r\n\t\t\t\tif (width == 0 || height == 0) return;\r\n\t\t\t\r\n\t\t\t\tctx.save();\r\n\t\t\t\tctx.translate(x, y);\r\n\t\t\t\tsvg.AspectRatio(ctx,\r\n\t\t\t\t\t\t\t\tthis.attribute('preserveAspectRatio').value,\r\n\t\t\t\t\t\t\t\twidth,\r\n\t\t\t\t\t\t\t\tthis.img.width,\r\n\t\t\t\t\t\t\t\theight,\r\n\t\t\t\t\t\t\t\tthis.img.height,\r\n\t\t\t\t\t\t\t\t0,\r\n\t\t\t\t\t\t\t\t0);\t\r\n\t\t\t\tctx.drawImage(this.img, 0, 0);\t\t\t\r\n\t\t\t\tctx.restore();\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.image.prototype = new svg.Element.RenderedElementBase;\r\n\t\t\r\n\t\t// group element\r\n\t\tsvg.Element.g = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t}\r\n\t\tsvg.Element.g.prototype = new svg.Element.RenderedElementBase;\r\n\r\n\t\t// symbol element\r\n\t\tsvg.Element.symbol = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t}\r\n\t\tsvg.Element.symbol.prototype = new svg.Element.RenderedElementBase;\t\t\r\n\t\t\t\r\n\t\t// style element\r\n\t\tsvg.Element.style = function(node) { \r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tvar css = node.childNodes[0].nodeValue;\r\n\t\t\tcss = css.replace(/(\\/\\*([^*]|[\\r\\n]|(\\*+([^*\\/]|[\\r\\n])))*\\*+\\/)|(\\/\\/.*)/gm, ''); // remove comments\r\n\t\t\tcss = svg.compressSpaces(css); // replace whitespace\r\n\t\t\tvar cssDefs = css.split('}');\r\n\t\t\tfor (var i=0; i<cssDefs.length; i++) {\r\n\t\t\t\tif (svg.trim(cssDefs[i]) != '') {\r\n\t\t\t\t\tvar cssDef = cssDefs[i].split('{');\r\n\t\t\t\t\tvar cssClasses = cssDef[0].split(',');\r\n\t\t\t\t\tvar cssProps = cssDef[1].split(';');\r\n\t\t\t\t\tfor (var j=0; j<cssClasses.length; j++) {\r\n\t\t\t\t\t\tvar cssClass = svg.trim(cssClasses[j]);\r\n\t\t\t\t\t\tif (cssClass != '') {\r\n\t\t\t\t\t\t\tvar props = {};\r\n\t\t\t\t\t\t\tfor (var k=0; k<cssProps.length; k++) {\r\n\t\t\t\t\t\t\t\tvar prop = cssProps[k].split(':');\r\n\t\t\t\t\t\t\t\tvar name = prop[0];\r\n\t\t\t\t\t\t\t\tvar value = prop[1];\r\n\t\t\t\t\t\t\t\tif (name != null && value != null) {\r\n\t\t\t\t\t\t\t\t\tprops[svg.trim(prop[0])] = new svg.Property(svg.trim(prop[0]), svg.trim(prop[1]));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsvg.Styles[cssClass] = props;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.style.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// use element \r\n\t\tsvg.Element.use = function(node) {\r\n\t\t\tthis.base = svg.Element.RenderedElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.baseSetContext = this.setContext;\r\n\t\t\tthis.setContext = function(ctx) {\r\n\t\t\t\tthis.baseSetContext(ctx);\r\n\t\t\t\tif (this.attribute('x').hasValue()) ctx.translate(this.attribute('x').Length.toPixels('x'), 0);\r\n\t\t\t\tif (this.attribute('y').hasValue()) ctx.translate(0, this.attribute('y').Length.toPixels('y'));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.getDefinition = function() {\r\n\t\t\t\treturn this.attribute('xlink:href').Definition.getDefinition();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.path = function(ctx) {\r\n\t\t\t\tvar element = this.getDefinition();\r\n\t\t\t\tif (element != null) element.path(ctx);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.renderChildren = function(ctx) {\r\n\t\t\t\tvar element = this.getDefinition();\r\n\t\t\t\tif (element != null) element.render(ctx);\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.use.prototype = new svg.Element.RenderedElementBase;\r\n\t\t\r\n\t\t// clip element\r\n\t\tsvg.Element.clipPath = function(node) {\r\n\t\t\tthis.base = svg.Element.ElementBase;\r\n\t\t\tthis.base(node);\r\n\t\t\t\r\n\t\t\tthis.apply = function(ctx) {\r\n\t\t\t\tfor (var i=0; i<this.children.length; i++) {\r\n\t\t\t\t\tif (this.children[i].path) {\r\n\t\t\t\t\t\tthis.children[i].path(ctx);\r\n\t\t\t\t\t\tctx.clip();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tsvg.Element.clipPath.prototype = new svg.Element.ElementBase;\r\n\r\n\t\t// title element, do nothing\r\n\t\tsvg.Element.title = function(node) {\r\n\t\t}\r\n\t\tsvg.Element.title.prototype = new svg.Element.ElementBase;\r\n\r\n\t\t// desc element, do nothing\r\n\t\tsvg.Element.desc = function(node) {\r\n\t\t}\r\n\t\tsvg.Element.desc.prototype = new svg.Element.ElementBase;\t\t\r\n\t\t\r\n\t\tsvg.Element.MISSING = function(node) {\r\n\t\t\tconsole.log('ERROR: Element \\'' + node.nodeName + '\\' not yet implemented.');\r\n\t\t}\r\n\t\tsvg.Element.MISSING.prototype = new svg.Element.ElementBase;\r\n\t\t\r\n\t\t// element factory\r\n\t\tsvg.CreateElement = function(node) {\r\n\t\t\tvar className = 'svg.Element.' + node.nodeName.replace(/^[^:]+:/,'');\r\n\t\t\tif (!eval(className)) className = 'svg.Element.MISSING';\r\n\t\t\r\n\t\t\tvar e = eval('new ' + className + '(node)');\r\n\t\t\te.type = node.nodeName;\r\n\t\t\treturn e;\r\n\t\t}\r\n\t\t\t\t\r\n\t\t// load from url\r\n\t\tsvg.load = function(ctx, url) {\r\n\t\t\tsvg.loadXml(ctx, svg.ajax(url));\r\n\t\t}\r\n\t\t\r\n\t\t// load from xml\r\n\t\tsvg.loadXml = function(ctx, xml) {\r\n\t\t\tsvg.init(ctx);\r\n\t\t\t\r\n\t\t\tvar mapXY = function(p) {\r\n\t\t\t\tvar e = ctx.canvas;\r\n\t\t\t\twhile (e) {\r\n\t\t\t\t\tp.x -= e.offsetLeft;\r\n\t\t\t\t\tp.y -= e.offsetTop;\r\n\t\t\t\t\te = e.offsetParent;\r\n\t\t\t\t}\r\n\t\t\t\tif (window.scrollX) p.x += window.scrollX;\r\n\t\t\t\tif (window.scrollY) p.y += window.scrollY;\r\n\t\t\t\treturn p;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// bind mouse\r\n\t\t\tif (svg.opts == null || svg.opts['ignoreMouse'] != true) {\r\n\t\t\t\tctx.canvas.onclick = function(e) {\r\n\t\t\t\t\tvar p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n\t\t\t\t\tsvg.Mouse.onclick(p.x, p.y);\r\n\t\t\t\t};\r\n\t\t\t\tctx.canvas.onmousemove = function(e) {\r\n\t\t\t\t\tvar p = mapXY(new svg.Point(e != null ? e.clientX : event.clientX, e != null ? e.clientY : event.clientY));\r\n\t\t\t\t\tsvg.Mouse.onmousemove(p.x, p.y);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\r\n\t\t\tvar dom = svg.parseXml(xml);\r\n\t\t\tvar e = svg.CreateElement(dom.documentElement);\r\n\t\t\t\t\t\r\n\t\t\t// render loop\r\n\t\t\tvar isFirstRender = true;\r\n\t\t\tvar draw = function() {\r\n\t\t\t\tif (svg.opts == null || svg.opts['ignoreDimensions'] != true) {\r\n\t\t\t\t\t// set canvas size\r\n\t\t\t\t\tif (e.style('width').hasValue()) {\r\n\t\t\t\t\t\tctx.canvas.width = e.style('width').Length.toPixels(ctx.canvas.parentNode.clientWidth);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (e.style('height').hasValue()) {\r\n\t\t\t\t\t\tctx.canvas.height = e.style('height').Length.toPixels(ctx.canvas.parentNode.clientHeight);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tsvg.ViewPort.SetCurrent(ctx.canvas.clientWidth, ctx.canvas.clientHeight);\t\t\r\n\t\t\t\t\r\n\t\t\t\tif (svg.opts != null && svg.opts['offsetX'] != null) e.attribute('x', true).value = svg.opts['offsetX'];\r\n\t\t\t\tif (svg.opts != null && svg.opts['offsetY'] != null) e.attribute('y', true).value = svg.opts['offsetY'];\r\n\t\t\t\tif (svg.opts != null && svg.opts['scaleWidth'] != null && svg.opts['scaleHeight'] != null) {\r\n\t\t\t\t\te.attribute('width', true).value = svg.opts['scaleWidth'];\r\n\t\t\t\t\te.attribute('height', true).value = svg.opts['scaleHeight'];\t\t\t\r\n\t\t\t\t\te.attribute('viewBox', true).value = '0 0 ' + ctx.canvas.clientWidth + ' ' + ctx.canvas.clientHeight;\r\n\t\t\t\t\te.attribute('preserveAspectRatio', true).value = 'none';\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t// clear and render\r\n\t\t\t\tif (svg.opts != null && svg.opts['ignoreClear'] != true) {\r\n\t\t\t\t\tctx.clearRect(0, 0, ctx.canvas.clientWidth, ctx.canvas.clientHeight);\r\n\t\t\t\t}\r\n\t\t\t\te.render(ctx);\r\n\t\t\t\tif (isFirstRender) {\r\n\t\t\t\t\tisFirstRender = false;\r\n\t\t\t\t\tif (svg.opts != null && typeof(svg.opts['renderCallback']) == 'function') svg.opts['renderCallback']();\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar waitingForImages = true;\r\n\t\t\tif (svg.ImagesLoaded()) {\r\n\t\t\t\twaitingForImages = false;\r\n\t\t\t\tdraw();\r\n\t\t\t}\r\n\t\t\tsvg.intervalID = setInterval(function() { \r\n\t\t\t\tvar needUpdate = false;\r\n\t\t\t\t\r\n\t\t\t\tif (waitingForImages && svg.ImagesLoaded()) {\r\n\t\t\t\t\twaitingForImages = false;\r\n\t\t\t\t\tneedUpdate = true;\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t// need update from mouse events?\r\n\t\t\t\tif (svg.opts == null || svg.opts['ignoreMouse'] != true) {\r\n\t\t\t\t\tneedUpdate = needUpdate | svg.Mouse.hasEvents();\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\t// need update from animations?\r\n\t\t\t\tif (svg.opts == null || svg.opts['ignoreAnimation'] != true) {\r\n\t\t\t\t\tfor (var i=0; i<svg.Animations.length; i++) {\r\n\t\t\t\t\t\tneedUpdate = needUpdate | svg.Animations[i].update(1000 / svg.FRAMERATE);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// need update from redraw?\r\n\t\t\t\tif (svg.opts != null && typeof(svg.opts['forceRedraw']) == 'function') {\r\n\t\t\t\t\tif (svg.opts['forceRedraw']() == true) needUpdate = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// render if needed\r\n\t\t\t\tif (needUpdate) {\r\n\t\t\t\t\tdraw();\t\t\t\t\r\n\t\t\t\t\tsvg.Mouse.runEvents(); // run and clear our events\r\n\t\t\t\t}\r\n\t\t\t}, 1000 / svg.FRAMERATE);\r\n\t\t}\r\n\t\t\r\n\t\tsvg.stop = function() {\r\n\t\t\tif (svg.intervalID) {\r\n\t\t\t\tclearInterval(svg.intervalID);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tsvg.Mouse = new (function() {\r\n\t\t\tthis.events = [];\r\n\t\t\tthis.hasEvents = function() { return this.events.length != 0; }\r\n\t\t\r\n\t\t\tthis.onclick = function(x, y) {\r\n\t\t\t\tthis.events.push({ type: 'onclick', x: x, y: y, \r\n\t\t\t\t\trun: function(e) { if (e.onclick) e.onclick(); }\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.onmousemove = function(x, y) {\r\n\t\t\t\tthis.events.push({ type: 'onmousemove', x: x, y: y,\r\n\t\t\t\t\trun: function(e) { if (e.onmousemove) e.onmousemove(); }\r\n\t\t\t\t});\r\n\t\t\t}\t\t\t\r\n\t\t\t\r\n\t\t\tthis.eventElements = [];\r\n\t\t\t\r\n\t\t\tthis.checkPath = function(element, ctx) {\r\n\t\t\t\tfor (var i=0; i<this.events.length; i++) {\r\n\t\t\t\t\tvar e = this.events[i];\r\n\t\t\t\t\tif (ctx.isPointInPath && ctx.isPointInPath(e.x, e.y)) this.eventElements[i] = element;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.checkBoundingBox = function(element, bb) {\r\n\t\t\t\tfor (var i=0; i<this.events.length; i++) {\r\n\t\t\t\t\tvar e = this.events[i];\r\n\t\t\t\t\tif (bb.isPointInBox(e.x, e.y)) this.eventElements[i] = element;\r\n\t\t\t\t}\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.runEvents = function() {\r\n\t\t\t\tsvg.ctx.canvas.style.cursor = '';\r\n\t\t\t\t\r\n\t\t\t\tfor (var i=0; i<this.events.length; i++) {\r\n\t\t\t\t\tvar e = this.events[i];\r\n\t\t\t\t\tvar element = this.eventElements[i];\r\n\t\t\t\t\twhile (element) {\r\n\t\t\t\t\t\te.run(element);\r\n\t\t\t\t\t\telement = element.parent;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\r\n\t\t\t\r\n\t\t\t\t// done running, clear\r\n\t\t\t\tthis.events = []; \r\n\t\t\t\tthis.eventElements = [];\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\treturn svg;\r\n\t}\r\n})();\r\n\r\nif (CanvasRenderingContext2D) {\r\n\tCanvasRenderingContext2D.prototype.drawSvg = function(s, dx, dy, dw, dh) {\r\n\t\tcanvg(this.canvas, s, { \r\n\t\t\tignoreMouse: true, \r\n\t\t\tignoreAnimation: true, \r\n\t\t\tignoreDimensions: true, \r\n\t\t\tignoreClear: true, \r\n\t\t\toffsetX: dx, \r\n\t\t\toffsetY: dy, \r\n\t\t\tscaleWidth: dw, \r\n\t\t\tscaleHeight: dh\r\n\t\t});\r\n\t}\r\n}\r\n\r\nmodule.exports = _parser;\n\n\n// WEBPACK FOOTER //\n// ./src/canvg.js","const Track  = require('./Track');\r\nconst Polyfill = require('./Polyfill');\r\n\r\nmodule.exports = function (options) {\r\n    const _lmap = nsGmx.leafletMap,\r\n        _layersByID = nsGmx.gmxMap.layersByID,\r\n        _aisLayer = _layersByID[options.aisLayerID],\r\n        _screenSearchLayer = _layersByID[options.searchLayer],\r\n        //_lastPointLayerAltFact = _layersByID[options.lastPointLayerAlt],\r\n        _lastPointLayerAlt = _layersByID[options.lastPointLayerAlt];\r\n\r\n    let _curLegendLayer = _screenSearchLayer, _prevLegendLayer = _lastPointLayerAlt;\r\n\r\n    let _almmsi, _tlmmsi, _aldt, _tldt;\r\n    let _needAltLegend = false;\r\n    try{\r\n          _almmsi = _aisLayer.getGmxProperties().attributes.indexOf(\"mmsi\") + 1, \r\n          _aldt = _aisLayer.getGmxProperties().attributes.indexOf(\"ts_pos_utc\") + 1;\r\n// console.log(_almmsi+\" \"+_aldt)\r\n// console.log(_tlmmsi+\" \"+_tldt)\r\n    }\r\n    catch(ex){}\r\n\r\n    let _displayedVessels = \"all\",  \r\n    _notDisplayedVessels = [],\r\n    _filterFunc = function (args) {\r\n        let mmsiArr = [];\r\n        let mmsi = args.properties[args.properties.length > 20 ? _almmsi : _tlmmsi].toString(),\r\n            dt = new Date(new Date(args.properties[args.properties.length>20 ? _aldt : _tldt]*1000).setUTCHours(0,0,0,0)),\r\n            i, j;\r\n        for (i = 0; i < mmsiArr.length; i++) {\r\n            if (mmsi == mmsiArr[i]) { \r\n                if (dates)\r\n                    for (j=0; j<dates.length; ++j){\r\n                        if (dates[j].getTime()==dt.getTime()){\r\n                            return true;\r\n                        }\r\n                    }\r\n                else{\r\n                    return true; \r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }, \r\n    _specialVesselFilters,\r\n    // _setVesselFilter = function(){\r\n    //     if (_screenSearchLayer) {\r\n    //         _screenSearchLayer.removeFilter();  \r\n\r\n    //         if (_displayedVessels!=\"all\" || _notDisplayedVessels.length || _specialVesselFilters) {            \r\n    //             let ai = _screenSearchLayer._gmx.tileAttributeIndexes, fields = [];\r\n    //             for (var k in ai)\r\n    //                 fields[ai[k]] = k;\r\n    //             _screenSearchLayer.setFilter((args) => {\r\n\r\n    //                 for(var f in _specialVesselFilters)\r\n    //                         _specialVesselFilters[f](args, ai, _displayedVessels);\r\n\r\n    //                 let mmsi = args.properties[ai.mmsi].toString();\r\n    //                 if ((_displayedVessels==\"all\" || _displayedVessels.indexOf(mmsi) >= 0) && \r\n    //                     _notDisplayedVessels.indexOf(mmsi) < 0)\r\n    //                     return true;\r\n    //                 else\r\n    //                     return false;\r\n    //             });\r\n    //         } \r\n    //     }\r\n\r\n    // },\r\n    _setVesselFilter = function(){\r\n        if (_curLegendLayer) {\r\n            _curLegendLayer.removeFilter();  \r\n\r\n            if (_displayedVessels!=\"all\" || _notDisplayedVessels.length || _specialVesselFilters) {            \r\n                let ai = _curLegendLayer._gmx.tileAttributeIndexes, fields = [];\r\n                for (var k in ai)\r\n                    fields[ai[k]] = k;\r\n                    _curLegendLayer.setFilter((args) => {\r\n\r\n                    for(var f in _specialVesselFilters)\r\n                            _specialVesselFilters[f](args, ai, _displayedVessels);\r\n\r\n                    let mmsi = args.properties[ai.mmsi].toString();\r\n                    if ((_displayedVessels==\"all\" || _displayedVessels.indexOf(mmsi) >= 0) && \r\n                        _notDisplayedVessels.indexOf(mmsi) < 0)\r\n                        return true;\r\n                    else\r\n                        return false;\r\n                });\r\n            } \r\n        }\r\n\r\n    },\r\n    _markers,\r\n    _visibleMarkers = [],\r\n    _icons = {},\r\n    _getSvg = function(url){\r\n        let svg = _icons[url]\r\n        if (!svg){\r\n            return new Promise(resolve=>{\r\n                let httpRequest = new XMLHttpRequest();\r\n                httpRequest.onreadystatechange = function () {\r\n                    if (httpRequest.readyState === 4) {\r\n                        _icons[url] = httpRequest.responseText\r\n                        resolve(_icons[url]);\r\n                    }\r\n                }\r\n                httpRequest.open(\"GET\", document.location.protocol + url.replace(/^https?:/, \"\"));\r\n                httpRequest.send();\r\n            })\r\n        }\r\n        return Promise.resolve(svg);\r\n    },\r\n    _markerIcon = function(icon, cog, sog, vtype, group_style){ \r\n        return _getSvg(icon).then(\r\n            svg=>{\r\n                let type_color = '#00f',\r\n                    a = /\\.cls-1{fill:(#[^};]+)/.exec(svg)\r\n                if (a && a.length)\r\n                    type_color = a[1];\r\n//console.log(type_color)\r\n                if (sog)\r\n                    return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(' + (!cog ? 0 : cog) + 'deg)\"><title>1</title><path style=\"fill:' + type_color + ';\" d=\"M13.8,20.07a1,1,0,0,1-.69-0.28l-1.79-1.72a0.72,0.72,0,0,0-1,0L8.52,19.79a1,1,0,0,1-.69.28,1,1,0,0,1-1-1V8.65c0-1.52,1.55-7.59,4-7.59s4,6.07,4,7.59V19a1,1,0,0,1-1,1h0Z\"/><path style=\"fill:' + group_style + ';\" d=\"M10.82,1.57c1.93,0,3.5,5.57,3.5,7.09V19a0.52,0.52,0,0,1-.51.53,0.49,0.49,0,0,1-.34-0.14l-1.79-1.72a1.22,1.22,0,0,0-1.71,0L8.17,19.42a0.49,0.49,0,0,1-.34.14A0.52,0.52,0,0,1,7.32,19V8.65c0-1.51,1.57-7.09,3.5-7.09h0m0-1c-3,0-4.5,6.72-4.5,8.09V19a1.52,1.52,0,0,0,1.51,1.53,1.49,1.49,0,0,0,1-.42l1.79-1.72a0.22,0.22,0,0,1,.32,0l1.79,1.72a1.49,1.49,0,0,0,1,.42A1.52,1.52,0,0,0,15.32,19V8.65c0-1.37-1.51-8.09-4.5-8.09h0Z\"/><ellipse style=\"fill:#fff;\" cx=\"10.82\" cy=\"10.54\" rx=\"1.31\" ry=\"1.35\"/><path style=\"fill:#fff;\" d=\"M10.73,3.34h0.12a0.35,0.35,0,0,1,.35.35v6.85a0,0,0,0,1,0,0H10.38a0,0,0,0,1,0,0V3.69A0.35,0.35,0,0,1,10.73,3.34Z\"/></svg>';\r\n                else\r\n                    return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"21\" height=\"21\" viewBox=\"0 0 21 21\" style=\"transform:rotate(' + (!cog ? 0 : cog) + 'deg)\"><title>1</title><rect style=\"fill:' + type_color + ';stroke:' + group_style + ';stroke-miterlimit:10;\" x=\"5.9\" y=\"5.6\" width=\"9.19\" height=\"9.19\" rx=\"2\" ry=\"2\" transform=\"translate(-4.13 10.41) rotate(-45)\"/><circle style=\"fill:#fff;\" cx=\"10.5\" cy=\"10.19\" r=\"1.5\"/></svg>';\r\n            }\r\n        );\r\n    },\r\n    _eraseMyFleetMarker = function(mmsi){\r\n        if (!_markers)\r\n            _markers = L.layerGroup().addTo(_lmap);\r\n        else{\r\n            let layers = _markers.getLayers(), layer;\r\n            for (var i in layers)\r\n                if (layers[i].id==mmsi){\r\n                    layer = layers[i];\r\n                    break;\r\n                }\r\n            layer && _markers.removeLayer(layer);\r\n        }\r\n    },\r\n    _drawMyFleetMarker = function(args, markerTemplate, group, ai, isVisible){ \r\n        let data = args.properties;\r\n        let di = nsGmx.widgets.commonCalendar.getDateInterval();\r\n        let icon = args.parsedStyleKeys.iconUrl;//args.parsedStyleKeys.iconUrl.replace(/.+(\\/|%5C)(?=[^\\/]+$)/, '')\r\n        _eraseMyFleetMarker(data[ai.mmsi]);\r\n\r\n        if (!isVisible)\r\n            return;\r\n\r\n        let label_line = function(label, label_color, label_shadow){\r\n            if (label!=\"\")\r\n            return '<div style=\"height:14px;\">'+\r\n            '<div class=\"label_shadow\" style=\"height:14px;color' + label_shadow.color + \";text-shadow:\" + label_shadow.text_shadow + '\">' + label + '</div>'+\r\n            '<div class=\"label_color\" style=\"position:relative;top:-14px;color:' + label_color + '\">' + label + '</div></div>';\r\n            else\r\n            return \"\";\r\n        }\r\n        if (di.get(\"dateBegin\").getTime()<=data[ai.ts_pos_utc]*1000 && data[ai.ts_pos_utc]*1000<di.get(\"dateEnd\").getTime()){ \r\n            _markerIcon(icon, data[ai.cog], data[ai.sog], data[ai.vessel_type], group.marker_style).then(marker=>{\r\n\r\n                _eraseMyFleetMarker(data[ai.mmsi]);\r\n\r\n                let temp = {};\r\n                temp.group_name = label_line(group.default?\"\":(group.title), group.label_color, group.label_shadow)\r\n                temp.vessel_name = label_line(data[ai.vessel_name], group.label_color, group.label_shadow);    \r\n                temp.sog = label_line(data[ai.sog] + _gtxt(\"AISSearch2.KnotShort\"), group.label_color, group.label_shadow);  \r\n                temp.cog = label_line(isNaN(data[ai.cog])?\"\":data[ai.cog].toFixed(1) + \"&deg;\", group.label_color, group.label_shadow);                 \r\n                temp.marker = marker;\r\n                let m = L.marker([data[ai.latitude], data[ai.longitude]>0?data[ai.longitude]:360+data[ai.longitude]],\r\n                    {\r\n                        id:data[ai.mmsi],\r\n                        icon: L.divIcon({\r\n                            className: 'mf_label gr' + group.id,\r\n                            html: Handlebars.compile(markerTemplate)(temp)\r\n                        }),\r\n                        zIndexOffset:1000\r\n                    });\r\n                m.id = data[ai.mmsi];\r\n                _markers.addLayer(m);\r\n            });\r\n        }\r\n\r\n    },\r\n    _switchLayers = function(l1, l2){\r\n        //l1 && console.log(l1.getGmxProperties().name +\" \"+ !!(l1._map))\r\n        if (!l2 || l2._map)\r\n            return;\r\n        if (l1 && l2){\r\n            _lmap.removeLayer(l1);\r\n            _lmap.addLayer(l2);\r\n        }\r\n    },\r\n    _legendSwitchedHandlers = [],\r\n    _legendSwitched = function(showAlternative){\r\n        _legendSwitchedHandlers.forEach(h=>h(showAlternative));\r\n    },\r\n\r\n    _round = function (d, p) {\r\n        let isNeg = d < 0,\r\n            power = Math.pow(10, p)\r\n        return d ? ((isNeg ? -1 : 1) * (Math.round((isNeg ? d = -d : d) * power) / power)) : d\r\n    },\r\n    _addUnit = function (v, u) {\r\n        return v != null && v != \"\" ? v + u : \"\";\r\n    },        \r\n    _toDd = function (D, lng) {\r\n        let dir = D < 0 ? lng ? 'W' : 'S' : lng ? 'E' : 'N',\r\n            deg = Math.round((D < 0 ? D = -D : D) * 1000000) / 1000000\r\n        return deg.toFixed(2) + \" \"//\"°\"\r\n            + dir\r\n    };\r\n\r\n    const _trackBuilder = new Track();\r\n\r\n    return {\r\n        set specialVesselFilters({key, value}) {\r\n            if (!_specialVesselFilters)\r\n                _specialVesselFilters = {};\r\n            _specialVesselFilters[key] = value;\r\n            //_setVesselFilter();\r\n        },\r\n        get hasAlternativeLayers(){ return _lastPointLayerAlt; },\r\n        get needAltLegend(){\r\n            //return !!(_lastPointLayerAltFact && _lastPointLayerAltFact._map); \r\n            return _needAltLegend;\r\n        },\r\n\r\n        ///////////////////////\r\n        removeMyFleetTrack: function (mmsi){\r\n            _trackBuilder.removeMyFleetTrack(mmsi);\r\n        }, \r\n\r\n        showMyFleetTrack: function (vessels, onclick, aisLayerSearcher, viewState) {\r\n            _trackBuilder.showMyFleetTrack (vessels, onclick, aisLayerSearcher, viewState, this.needAltLegend);\r\n        },\r\n     \r\n        showHistoryTrack: function (vessels, onclick) {\r\n            return _trackBuilder.showHistoryTrack(vessels, onclick, this.needAltLegend);\r\n        },\r\n\r\n        restoreDefault: function(){    \r\n            if (!_curLegendLayer)\r\n                return;\r\n            _lmap.addLayer(_curLegendLayer);\r\n            _prevLegendLayer && _lmap.removeLayer(_prevLegendLayer); \r\n        },\r\n\r\n        cleanMap: function(viewState){\r\n            _displayedVessels = 'all';\r\n            _notDisplayedVessels.length = 0;\r\n            _setVesselFilter();   \r\n\r\n            viewState.cleanTracks(_trackBuilder, this.needAltLegend);\r\n        },\r\n\r\n        hideVesselsOnMap: function (viewState, comment) {      \r\n            if (viewState.notDisplayed.length)\r\n                _notDisplayedVessels = viewState.notDisplayed.map(v => v);\r\n            else\r\n                _notDisplayedVessels.length = 0;\r\n//console.log('hideOnMap', comment, _notDisplayedVessels)           \r\n            _setVesselFilter();\r\n            viewState.hideTracks(_trackBuilder, this.needAltLegend);\r\n        },\r\n\r\n        showVesselsOnMap: function (viewState) { \r\n            _displayedVessels = viewState.displayedOnly && viewState.displayedOnly.length ? viewState.displayedOnly.map(v=>v) : \"all\"; \r\n//console.log('showOnMap', _displayedVessels)           \r\n            _setVesselFilter();\r\n\r\n            viewState.showTracks(_trackBuilder, this.needAltLegend);\r\n        },\r\n\r\n        redrawMarkers: function () {\r\n            _setVesselFilter();\r\n        },\r\n\r\n        clearMyFleetMarkers: function(){\r\n//console.log(\"clearMyFleetMarkers\")\r\n            _markers && _markers.clearLayers();\r\n        },\r\n\r\n        eraseMyFleetMarker: _eraseMyFleetMarker,\r\n\r\n        drawMyFleetMarker: _drawMyFleetMarker,\r\n\r\n        highlightMarker: function(i, group){\r\n            $('.mf_label.gr'+group.id+' svg').each((i,e)=>{\r\n                let paths = e.querySelectorAll('path');\r\n                if(paths[1])\r\n                    paths[1].style.fill = group.marker_style;\r\n            })\r\n            $('.mf_label.gr'+group.id+' svg rect').css({\"stroke\":group.marker_style});\r\n\r\n            $('.mf_label.gr'+group.id+' .label_color').css({\"color\":group.label_color});\r\n            $('.mf_label.gr'+group.id+' .label_shadow').css({\"color\":group.label_shadow.color, \"text-shadow\":group.label_shadow.text_shadow});\r\n        },\r\n\r\n        switchLegend: function(showAlternative){\r\n            // _switchLayers(_screenSearchLayer, _lastPointLayerAlt);\r\n            // let temp = _screenSearchLayer;\r\n            // _screenSearchLayer = _lastPointLayerAlt;\r\n            // _lastPointLayerAlt = temp;\r\n            // _needAltLegend = !!(_lastPointLayerAltFact && _lastPointLayerAltFact._map);\r\n            \r\n            _needAltLegend = showAlternative;\r\n\r\n            _switchLayers(_curLegendLayer, _prevLegendLayer);\r\n            let temp = _curLegendLayer;\r\n            _curLegendLayer = _prevLegendLayer;\r\n            _prevLegendLayer = temp;\r\n\r\n            _setVesselFilter();\r\n            _legendSwitched(showAlternative);\r\n\r\n            _trackBuilder.switchLegend(this.needAltLegend, _notDisplayedVessels);            \r\n        },\r\n\r\n        onLegendSwitched: function(handler){    \r\n            _legendSwitchedHandlers.push(handler);\r\n        },\r\n\r\n        formatPosition: function (vessel, aisLayerSearcher) {\r\n            vessel.cog_sog = vessel.cog && vessel.sog\r\n            vessel.heading_rot = vessel.heading && vessel.rot\r\n            vessel.x_y = vessel.longitude && vessel.latitude\r\n            let d = new Date(vessel.ts_pos_utc * 1000)\r\n            let eta = new Date(vessel.ts_eta * 1000)\r\n            vessel.tm_pos_utc = this.formatTime(d);\r\n            vessel.tm_pos_loc = this.formatTime(d, true);\r\n            vessel.dt_pos_utc = this.formatDate(d);\r\n            vessel.dt_pos_loc = this.formatDate(d, true);\r\n            vessel.eta_utc = aisLayerSearcher.formatDateTime(eta);\r\n            vessel.eta_loc = aisLayerSearcher.formatDateTime(eta, true);\r\n            vessel.icon_rot = Math.round(vessel.cog/15)*15;\r\n            vessel.cog = _addUnit(_round(vessel.cog, 5), \"°\");\r\n            vessel.rot = _addUnit(_round(vessel.rot, 5), \"°/мин\");\r\n            vessel.heading = _addUnit(_round(vessel.heading, 5), \"°\");\r\n            vessel.draught = _addUnit(_round(vessel.draught, 5), \" м\");\r\n            //vessel.length = _addUnit(vessel.length, \" м\");\r\n            //vessel.width = _addUnit(vessel.width, \" м\");\r\n            //vessel.source = 'plugins/AIS/AISSearch/svg/satellite-ais.svg'//vessel.source=='T-AIS'?_gtxt('AISSearch2.tais'):_gtxt('AISSearch2.sais');\r\n            vessel.source_orig = vessel.source;\r\n            vessel.source = vessel.source=='T-AIS'?'plugins/AIS/AISSearch/svg/waterside-radar.svg':'plugins/AIS/AISSearch/svg/satellite-ais.svg';\r\n                \r\n            vessel.xmin = vessel.longitude;\r\n            vessel.xmax = vessel.longitude;           \r\n            vessel.ymin = vessel.latitude;\r\n            vessel.ymax = vessel.latitude; \r\n        \r\n            vessel.longitude = _toDd(vessel.longitude, true);\r\n            vessel.latitude = _toDd(vessel.latitude);\r\n            aisLayerSearcher.placeVesselTypeIcon(vessel);\r\n            vessel.sog = _addUnit(_round(vessel.sog, 5), \" уз\");\r\n        \r\n            return vessel;\r\n        },\r\n        formatTime: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleTimeString();\r\n        },\r\n        formatDate: function (d, local) {\r\n            var temp = new Date(d)\r\n            if (!local)\r\n                temp.setMinutes(temp.getMinutes() + temp.getTimezoneOffset())\r\n            return temp.toLocaleDateString();\r\n        },\r\n\r\n        hideAisData: function(isNeeded){\r\n            if (isNeeded){\r\n                _lmap.removeLayer(_screenSearchLayer);\r\n                _lmap.removeLayer(_lastPointLayerAlt);\r\n                _markers && _lmap.removeLayer(_markers);\r\n            }\r\n            else{\r\n                if (_curLegendLayer){\r\n                    _lmap.addLayer(_curLegendLayer);\r\n                    _markers && _lmap.addLayer(_markers);\r\n                }\r\n            }\r\n        }\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Toolbox.js","const vesselMarker = require('./VesselMarker');\r\nmodule.exports = function (options) {\r\n\r\n    const _lmap = nsGmx.leafletMap,\r\n        _tracks = {}, _tracksAlt = {},\r\n        _tracksMF = {}, _tracksAltMF = {},\r\n        _canvas = L.canvas(),\r\n        _addMarker = function (p, ep, group, onclick, style, placeVesselTypeIcon) {\r\n            if (placeVesselTypeIcon)\r\n                placeVesselTypeIcon(p);\r\n            var options = {\r\n                radius: 10,\r\n                fillColor: style != 'SPEED' ? p.color.value : (p.colorAlt ? p.colorAlt.value : p.color.value),\r\n                fillOpacity: 0.25,\r\n                weight: 2,\r\n                color: 'SPEED' ? p.color.value : (p.colorAlt ? p.colorAlt.value : p.color.value),\r\n                cog: parseInt(p.cog),\r\n                img: style != 'SPEED' ? p.img : (p.imgAlt ? p.imgAlt : p.img),\r\n                renderer: _canvas,\r\n                pid: p.id,\r\n                next: !ep ? null : L.latLng(ep.ymax, ep.xmax < 0 ? 360 + ep.xmax : ep.xmax),\r\n                ts: new Date()\r\n            },\r\n                m = vesselMarker(L.latLng(p.ymax, p.xmax < 0 ? 360 + p.xmax : p.xmax), options);\r\n            m.on('click', e => onclick({ p, pid: p.id }));\r\n            group.addLayer(m);\r\n        },\r\n        _addMarkers = function (data, next, onclick, style, placeVesselTypeIcon) {\r\n            const group = L.layerGroup(null, { renderer: _canvas });\r\n            for (var i = 0; i < data.length; i++) {\r\n                if (data[i].positions) {\r\n                    for (var j = 0; j < data[i].positions.length; j++) {\r\n                        var p = data[i].positions[j];\r\n                        p.mmsi = data[i].mmsi; p.imo = data[i].imo;\r\n                        if (data[i].positions[j + 1])\r\n                            _addMarker(p, data[i].positions[j + 1], group, onclick, style, placeVesselTypeIcon);\r\n                        else\r\n                            _addMarker(p, null, group, onclick, style, placeVesselTypeIcon);\r\n                    }\r\n                }\r\n                else {\r\n                    if (data[i + 1])\r\n                        _addMarker(data[i], data[i + 1], group, onclick, style, placeVesselTypeIcon);\r\n                    else {\r\n                        _addMarker(data[i], next, group, onclick, style, placeVesselTypeIcon);\r\n                        if (next) {\r\n                            _addMarker(next, null, group, onclick, style, placeVesselTypeIcon);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return group;\r\n        }\r\n    let _prevCursor = null, _historyMmsi = null;\r\n\r\n    document.body.addEventListener('mousemove', e => {\r\n        if (!_canvas._container)\r\n            return;\r\n        _canvas._onMouseMove(e);\r\n        if (_canvas._container.className.search(/interactive/) > -1) {\r\n            if (_canvas._map._container.style.cursor != 'pointer') {\r\n                _prevCursor = _canvas._map._container.style.cursor;\r\n                _canvas._map._container.style.cursor = 'pointer'\r\n            }\r\n        }\r\n        else {\r\n            if (_prevCursor !== null) {\r\n                _canvas._map._container.style.cursor = _prevCursor;\r\n                _prevCursor = null;\r\n            }\r\n        }\r\n    });\r\n    document.body.addEventListener('click', e => {\r\n        if (!_canvas._container)\r\n            return;\r\n        if (_canvas._container.className.search(/interactive/) > -1){\r\n//console.log('canvas', e)\r\n            _canvas._onClick(e);\r\n        }\r\n    }, true);\r\n\r\n    return {\r\n        showHistoryTrack: function (vessels, onclick, needAltLegend) {\r\n            if (!vessels) { // CLEAN ALL  \r\n                for (let t in _tracks) {\r\n                    _lmap.removeLayer(_tracks[t]);\r\n                    _lmap.removeLayer(_tracksAlt[t]);\r\n                    delete _tracks[t];\r\n                    delete _tracksAlt[t];\r\n                }\r\n                return [];\r\n            }\r\n\r\n            for (let i = 0; i < vessels.length; ++i) {\r\n                let trackId = vessels[i].mmsi + '_' + vessels[i].imo + '_' + vessels[i].ts;\r\n                if (vessels[i].positions.length) {\r\n                    if (!_tracks[trackId]) {\r\n                        _tracks[trackId] = _addMarkers(vessels[i].positions, vessels[i].end, p => onclick(p, false), 'TYPE');\r\n                        _tracksAlt[trackId] = _addMarkers(vessels[i].positions, vessels[i].end, p => onclick(p, false), 'SPEED');\r\n                        //console.log(i, _tracks[trackId])\r\n\r\n                        if (!needAltLegend)\r\n                            _lmap.addLayer(_tracks[trackId]);\r\n                        else\r\n                            _lmap.addLayer(_tracksAlt[trackId]);\r\n                    }\r\n                }\r\n                else { // HIDE SOME\r\n                    _lmap.removeLayer(_tracks[trackId]);\r\n                    _lmap.removeLayer(_tracksAlt[trackId]);\r\n                    delete _tracks[trackId];\r\n                    delete _tracksAlt[trackId];\r\n                }\r\n            }\r\n\r\n            if (_canvas._container)\r\n                _canvas._container.style.pointerEvents = 'none';\r\n            \r\n            return Object.keys(_tracks);\r\n        },\r\n\r\n        showMyFleetTrack: function (vessels, onclick, aisLayerSearcher, viewState, needAltLegend) {\r\n            //console.log(vessels);\r\n            if (!vessels) {\r\n                for (let t in _tracksMF) {   \r\n                    _lmap.removeLayer(_tracksMF[t]);\r\n                    _lmap.removeLayer(_tracksAltMF[t]);\r\n                    delete _tracksMF[t];\r\n                    delete _tracksAltMF[t];\r\n                }\r\n                return;\r\n            }   \r\n\r\n            if (vessels.length && vessels[0].mmsi) {\r\n                let trackId = vessels[0].mmsi.toString();\r\n                if (_tracksMF[trackId]){                    \r\n                    _lmap.removeLayer(_tracksMF[trackId]);\r\n                    _lmap.removeLayer(_tracksAltMF[trackId]);\r\n                }\r\n                if (vessels[0].positions.length) {\r\n\r\n                    _tracksMF[trackId] = _addMarkers(vessels, null, onclick, 'TYPE', aisLayerSearcher.placeVesselTypeIcon);\r\n                    _tracksAltMF[trackId] = _addMarkers(vessels, null,  onclick, 'SPEED', aisLayerSearcher.placeVesselTypeIcon);\r\n\r\n                    if (viewState.isViewActive && viewState.notDisplayed.indexOf(trackId)<0)\r\n                        if (!needAltLegend)\r\n                            _lmap.addLayer(_tracksMF[trackId]);\r\n                        else\r\n                            _lmap.addLayer(_tracksAltMF[trackId]);\r\n\r\n                    if (_canvas._container)\r\n                        _canvas._container.style.pointerEvents = 'none'; \r\n                }\r\n            }\r\n        },\r\n\r\n        showMyFleetTracks: function(displayed, needAltLegend){\r\n            const a = displayed=='all' ? Object.keys(_tracksMF) : displayed;\r\n            a.forEach(mmsi => {\r\n                if (_tracksMF[mmsi])\r\n                    if (!needAltLegend)\r\n                        _lmap.addLayer(_tracksMF[mmsi]);\r\n                    else\r\n                        _lmap.addLayer(_tracksAltMF[mmsi]);\r\n            });\r\n        },\r\n        hideMyFleetTracks: function(notDisplayed, needAltLegend){\r\n            const a = Object.keys(_tracksMF);\r\n            a.forEach(mmsi => {\r\n                if (notDisplayed.indexOf(mmsi) < 0) {\r\n                    if (!needAltLegend)\r\n                        !_tracksMF[mmsi]._map && _lmap.addLayer(_tracksMF[mmsi]);\r\n                    else\r\n                        !_tracksAltMF[mmsi]._map && _lmap.addLayer(_tracksAltMF[mmsi]);\r\n                }\r\n                else {\r\n                    _lmap.removeLayer(_tracksMF[mmsi]);\r\n                    _lmap.removeLayer(_tracksAltMF[mmsi]);\r\n                }\r\n            });\r\n        },\r\n        cleanMyFleetTracks: function(){\r\n            for (let k in _tracksMF){\r\n                _lmap.removeLayer(_tracksMF[k]);\r\n                _lmap.removeLayer(_tracksAltMF[k]);\r\n            }\r\n        },\r\n        showHistoryTracks: function(displayed, needAltLegend){\r\n            const a = Object.keys(_tracks);\r\n            a.forEach(id => {\r\n                if (displayed.indexOf(id) > -1) {\r\n                    if (!needAltLegend)\r\n                        !_tracks[id]._map && _lmap.addLayer(_tracks[id]);\r\n                    else\r\n                        !_tracksAlt[id]._map && _lmap.addLayer(_tracksAlt[id]);\r\n                }\r\n                else {\r\n                    _lmap.removeLayer(_tracks[id]);\r\n                    _lmap.removeLayer(_tracksAlt[id]);\r\n                }\r\n            });\r\n\r\n        },\r\n        cleanHistoryTracks: function(){\r\n            const ra = [];\r\n            for (let k in _tracks){\r\n                if (_tracks[k]._map || _tracksAlt[k]._map)\r\n                    ra.push(k);\r\n                _lmap.removeLayer(_tracks[k]);\r\n                _lmap.removeLayer(_tracksAlt[k]);\r\n            }\r\n            return ra;\r\n        },\r\n\r\n       \r\n        switchLegend: function(needAltLegend, notDisplayedVessels){\r\n            for (let t in _tracks){\r\n                //if (notDisplayedVessels.indexOf(t)<0)\r\n                if (needAltLegend){\r\n                    if (_tracks[t]._map){\r\n                    _lmap.removeLayer(_tracks[t]);\r\n                    _lmap.addLayer(_tracksAlt[t]);\r\n                    }\r\n                }\r\n                else{\r\n                    if (_tracksAlt[t]._map){\r\n                    _lmap.removeLayer(_tracksAlt[t]);\r\n                    _lmap.addLayer(_tracks[t]);\r\n                    }\r\n                }\r\n            }\r\n            \r\n            for (let t in _tracksMF){\r\n                if (notDisplayedVessels.indexOf(t)<0){\r\n                    if (needAltLegend){\r\n                        if (_tracksMF[t]._map){\r\n                            _lmap.removeLayer(_tracksMF[t]);\r\n                            _lmap.addLayer(_tracksAltMF[t]);\r\n                        }\r\n                    }\r\n                    else{\r\n                        if (_tracksAltMF[t]._map){\r\n                            _lmap.removeLayer(_tracksAltMF[t]);\r\n                            _lmap.addLayer(_tracksMF[t]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        removeMyFleetTrack: function (mmsi){            \r\n            mmsi = mmsi.toString();\r\n            if (_tracksMF[mmsi]){\r\n                _lmap.removeLayer(_tracksMF[mmsi]);\r\n                _lmap.removeLayer(_tracksAltMF[mmsi]);\r\n                delete _tracksMF[mmsi];\r\n                delete _tracksAltMF[mmsi];\r\n            }\r\n        }, \r\n\r\n    };\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/Track.js","L.Canvas.include({\r\n    _updateVesselMarker: function (layer) {\r\n        if (!this._drawing || layer._empty()) { return; }\r\n\r\n        this._drawnLayers[layer._leaflet_id] = layer;\r\n\r\n        var p = layer._point,\r\n            ctx = this._ctx,\r\n            r = Math.max(Math.round(layer._radius), 1);\r\n        //ctx.globalCompositeOperation = 'destination-over';    \r\n        \r\n//         var bounds = this._redrawBounds;\r\n// console.log(bounds)\r\n// \t\tif (bounds) {\r\n// \t\t\tvar size = bounds.getSize();\r\n//             //this._ctx.clearRect(bounds.min.x, bounds.min.y, size.x, size.y);\r\n \r\n//             ctx.strokeStyle = '#ff0000';           \r\n// \t\t\tctx.beginPath();\r\n// \t\t\tctx.rect(bounds.min.x, bounds.min.y, size.x, size.y);\r\n//             ctx.stroke();\r\n//         }\r\n\r\n        if (layer.options.next){\r\n            var np = layer._map.latLngToLayerPoint(layer.options.next);\r\n            ctx.lineWidth = layer.options.weight;\r\n            ctx.strokeStyle = layer.options.fillColor;\r\n            ctx.beginPath();\r\n            ctx.moveTo(p.x, p.y);\r\n            ctx.lineTo(np.x, np.y);\r\n            ctx.stroke();\r\n        }\r\n\r\n        //ctx.beginPath();\r\n        //ctx.arc(p.x, p.y, r, 0, Math.PI * 2)\r\n        //this._fillStroke(ctx, layer);\r\n\r\n        let img = layer.options.img,\r\n        cog = layer.options.cog || 0;\r\n        if (img) {\r\n            ctx.save();\r\n            ctx.translate(p.x, p.y);\r\n            ctx.rotate(cog * Math.PI / 180.0);\r\n            ctx.drawImage(img, -(img.width / 2), -(img.height / 2))\r\n            ctx.restore();\r\n        }\r\n    }\r\n});\r\n\r\nvar VesselMarker = L.CircleMarker.extend({\r\n    _updatePath: function () {\r\n        this._renderer._updateVesselMarker(this);\r\n    }\r\n    // , _containsPoint: function(p) {\r\n    //     return L.CircleMarker.prototype._containsPoint.call(this, p.subtract([0, 10]));\r\n    // }\r\n});\r\n\r\nconst vesselMarker = function (p, options) {\r\n    return new VesselMarker(p, options);\r\n}\r\n\r\nmodule.exports = vesselMarker;\n\n\n// WEBPACK FOOTER //\n// ./src/VesselMarker.js"],"sourceRoot":""}