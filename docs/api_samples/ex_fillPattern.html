<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="stylesheet" type="text/css" href="http://maps.kosmosnimki.ru/api/jquery/jquery-ui-1.7.2.custom.css">
	
	<script src="../../api.js?key=E5FB6CCB5D23B5E119D2F1B26BCC57BD" charset="windows-1251"></script> 
	<script src="http://maps.kosmosnimki.ru/api/jquery/jquery-1.5.1.min.js"></script>
	<script src="http://maps.kosmosnimki.ru/api/jquery/jquery-ui-1.8.10.custom.min.js"></script>
	
	<title>GeoMixer API - Штриховка</title>

</head>

<style>
	div#controls
	{
		position: absolute;
		top: 250px;
		left: 13px;
		padding: 10px;
		background-color: rgba(1, 106, 138, 0.5);
	}
	#controls > *
	{
		margin: 3px;
	}
	#controls input, #controls select
	{
		opacity: 1;
		width: 255px;
	}
</style>

<body>
<br>
<div id="map_container" style="width: 100%; height: 100%; float:left"></div>
<div id="controls">
	<table><tbody>
		<tr><td>
			Тип
		</td><td>
			<select id="style">

				<option value="horizontal" selected>Горизонтальная</option>
				<option value="vertical">Вертикальная</option>
				<option value="diagonal1">Диагональная 1</option>
				<option value="diagonal2">Диагональная 2</option>
				<option value="cross">Перекрёстная 1(например, размер=2, шаг=10)</option>
<!--				<option value="cross1">Перекрёстная 2(например, размер=2, шаг=10)</option> -->
				<option value="circle">Круглая</option>

			</select>
		</td></tr>
		<tr><td>
			Размер
		</td><td>
			<input type="edit" value="200" id="size"></input><br>
		</td></tr>
		<tr><td>
			Шаг
		</td><td>

			<input type="edit" value="0" id="step"></input><br>
		</td></tr>
		<tr><td>
			Цвета
		</td><td>
			<input type="edit" value="0x0000FF,0xFF0000,0xFFFFFF" id="colors"></input><br>
		</td></tr>
		<tr><td>
			Прозрачность
		</td><td>

			<input type="edit" value="80" id="opacity"></input><br>
		</td></tr>
	</tbody></table>
	<button id="apply">Применить</button>
</div>
<script>
	createFlashMap(document.getElementById("map_container"), 'maps.kosmosnimki.ru', "DefaultMap", function(map)
	{
		var myLayer = map.layers["79EF26840533426DB96521279AC660F1"];

		var updateStyle = function()
		{
			var style = $("#style option:selected").val();
			var size = $("#size").val();
			var step = $("#step").val();
			var colors = $("#colors").val();
			var opacity = $("#opacity").val();
			var ph = {
				fill: {
					image: "http://mapstest.kosmosnimki.ru/GetLines.ashx?colors="+ colors +"&size="+ size +"&style=" + style + "&opacity=" + opacity + "&step=" + step,
					opacity: 0.1
				}
			};
			
			var tmp = colors.split(',');
			var arr = [];
			for (var i=0; i<tmp.length; i++)
			{
				arr[i] = parseInt(tmp[i]);
			}
			var ph = {
				fill: {
				  opacity: opacity,
				  pattern: {
						colors: arr,
						width: parseInt(size),
						style: style, //тут могут быть заданные строки horizontal, vertical, diagonal1, diagonal2, circle, cross
						step: parseInt(step)
					}
				}
			};

			map.layers["79EF26840533426DB96521279AC660F1"].filters[0].setStyle(ph);
		}
		$("#apply").click(updateStyle );
		$("#style").change(updateStyle );
		updateStyle();
/*
		document.getElementById("button1").onclick = function()
		{
			var style = {
				fill: {
				  opacity: '20 * [Плотность]',
				  pattern: {
						colors:[0xFF0000, 0x00FF00, 0x0000FF], // 0xffffff, 0xff00ff, 
						width: '4 * [Плотность]',
						style: "diagonal2", //тут могут быть заданные строки или число - угол наклона [0..360], horizontal, vertical, diagonal1, diagonal2, circle, cross, cross1
						step: 0
					}
				}
			};
			var style = {
				fill: {
				  opacity: 80,
				  pattern: {
						colors:['16777215 - [Численность]*100', '16277215 - [Численность]*100'],
						width: '4 * [Плотность]',
						style: "diagonal2", //тут могут быть заданные строки или число - угол наклона [0..360], horizontal, vertical, diagonal1, diagonal2, circle, cross, cross1
						step: 0
					}
				}
			};
			var style = {
				fill: {
				  opacity: 80,
				  pattern: {
						colors:[0xFF0000, 0x00FF00, 0x0000FF],
						width: 12,
						style: "horizontal", //тут могут быть заданные строки или число - угол наклона [0..360], horizontal, vertical, diagonal1, diagonal2, circle, cross, cross1
						step: 0
					}
				}
			};
			myLayer.filters[0].setStyle(style); 
		}
*/

	});
</script>

</body>
</html>